/* Copyright (C) 2012 Microsoft Corporation */History={};(function(){var d=_innerWindow=window,a=History,o=$Utility,c=d;try{if(d.top.location.href)c=d.top}catch(X){}var H=d["$Config"],m=H&&H.AjaxHistory;function B(b){a.disableBookmarking=b&&b.db;a.configState=b&&b.state||{};a.configHash=g("",a.configState);a.sessionId=a.disableBookmarking&&Math.floor(Math.random()*1e3+1)||""}a.initInstance=B;jQuery(d).bind("unload",u);function u(){c.$Do.iff("$History.detachAll");if(d==c)G();else c.$Do.remove("$History",0,y);jQuery(d).unbind("unload",u)}a.dispose=u;function y(){_innerWindow.History=c.History;c.History.initInstance(m);_innerWindow.$Do.register("$History",0,true);_innerWindow.$Do.register("$History.attach",c.History.attach,true);_innerWindow.$Do.register("$History.attachPF",c.History.attachPF,true);_innerWindow.$Do.register("$History.navigateTo",c.History.navigateTo,true)}if(_innerWindow!=c){c.$Do.when("$History",0,y);return}else B(m);var x="ajhs",k="NavigateEvent",s="PFEvent",R=document.documentMode,Q=m&&m.id,i=a.configState,K=i,q=$B.BB_M5?"#":"",b=p(),C=b,t,e,l,r=$B.IE&&($B.V<8||R<8),L="onhashchange" in window&&!r,h=false;a.forceNextNavigate=O;a.attach=I;a.attachPF=F;a.detachPF=G;a.detach=V;a.detachAll=E;a.addNavigationStep=S;a.addPFState=U;a.navigateTo=D;j();if(L)d.onhashchange=j;else setInterval(j,100);function I(b){jQuery(a).bind(k,b)}function F(b){jQuery(a).bind(s,b)}function G(b){jQuery(a).unbind(s,b)}function V(b){jQuery(a).unbind(k,b)}function E(){jQuery(a).unbind(k)}function j(){if(!l){l=1;try{var a=p();if(a!=b||h)w(a)}finally{l=0;h=0}}}function w(c){if(r&&l&&(b!=c||h))z(c);var d=n(b),a=n(c);if(d.pf!=a.pf)P(a.pf,a.app);else if(!J(d.app,a.app)||h)M(a.app);b=p()}function M(b){b=b?b:a.configHash;i=f(b).app;if(a.disableBookmarking&&i[x]!=a.sessionId)i=a.configState;e=1;jQuery(a).trigger(k,i);e=0}function P(d,c){e=1;var b=jQuery.Event(s);b.pfState=c?[d,"#",c].join(""):d;jQuery(a).trigger(b);if(b.result)T(g(b.result,{}));e=0}function O(a){h=!!a}function D(a){if(typeof a==="string")a=f(a).app;var c=f(b).pf;v(q+g(c,a));j()}function A(a){var c=b;b=a;if(c!=b){v(q+b,true);if(r)z(b)}}function S(c,i){if(!e){if(typeof c==="string")c=f(c).app;if(a.disableBookmarking)c[x]=a.sessionId;var d=f(b);if(i)d.app={};for(var h in c)d.app[h]=c[h];var j=g(d.pf,d.app);A(j)}}function U(c){if(!e){var d=f(b).pf,a=g(c,{});A(a)}}function W(b,a){if(!t){v(q+(a?C:b));w(a?g(n(C).pf,K):b)}}function z(c){var b=_ge(Q).contentWindow.document;t=1;setTimeout(function(){a.Inform=W},0);b.open();b.write(["<s","cript>","function _a(){",$Config.dl?"document.domain='"+$Config.d+"';":"","window['stateStr']='",escape(c),"';var ph=parent.History;if(ph&&ph.Inform){ph.Inform(unescape(window['stateStr']))}","}","</s","cript>","<body onload='_a()'></body>"].join(""));b.close();t=0}function p(){var b=c.document.location.href,a=b.indexOf("#"),d=a==-1?"":b.substr(a+1);return d}function v(c,a){document.location.hash=c;if(a)b=p()}function T(b){var a=d.top.document.location;a.replace([a.protocol,"//",a.host,a.pathname,a.search,"#",b].join(""))}function g(c,d){var a=o.serialize(d),b=a;if(c)b=["!",c,a!=""?"!":"",a].join("");return b}function f(c){var a=n(c),b=a.app!=""?o.deserialize(a.app):{};return {pf:a.pf,app:b}}function n(a){var d,b;if(a.indexOf("!")==0){a=a.substr(1);var c=a.indexOf("!");if(c>-1){d=a.substr(0,c);b=a.substr(c+1)}else{d=a;b=""}}else b=a;return {pf:d,app:b}}function J(a,b){var c=o.deserialize(a),d=o.deserialize(b);return N(c,d)}function N(a,b){for(var c in a)if((a[c]||0)!==(b[c]||0))return false;for(var d in b)if((b[d]||0)!==(a[d]||0))return false;return true}$Do.register("$History",0,true);$Do.register("$History.attach",I,true);$Do.register("$History.attachPF",F,true);$Do.register("$History.detachAll",E,true);$Do.register("$History.navigateTo",D,true)})()