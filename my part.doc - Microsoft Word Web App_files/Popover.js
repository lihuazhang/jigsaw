/* Copyright (C) 2012 Microsoft Corporation */registerNamespace("$UI");$UI.Dialog=function(v,e,F,m,D,u){var y=window;if(D)y=D;var f=y.document||y.ownerDocument,s=f.body,n=f.documentElement,w=$B.RE_WebKit?s:f.documentElement,z=s.className.indexOf("rtl")>-1,g,r,b=this,d=jQuery(),h=jQuery(),a=null,i=null,l=jQuery(),o=null,k,p,H,A,j=null,c,G;this.dock=new $UI.Dialog.Rect(0,0,0,0);if(e&&e<5)e=5;m=m?" "+m:"";function q(){if(g){var b=g.style,a=$B.IE&&$B.V==7?r.offsetLeft/100:1;if(a==0)a=1;if($B.IE&&$B.V==6){b.width=w.scrollWidth-3+"px";b.pixelTop=Math.max(0,w.scrollTop/a)}b.pixelHeight=n.clientHeight/a;b.pixelWidth=n.clientWidth/a}}function x(c){var b;if(c.target==k)b=$UI.Dialog.findFocusableElement(a,p,false);else b=$UI.Dialog.findFocusableElement(a,k,true);if(b)setTimeout(function(){try{b.focus()}catch(a){}},0)}this.dispose=function(){G=true;if(j){clearTimeout(j);j=null}d.remove();d=jQuery();h.remove();h=jQuery();c=null;g=null;r=null;k=null;p=null;jQuery(window).unbind(".ext",t)};this.setContents=function(j){d.remove();d=jQuery();a=j;var h=a.parentNode;if(null==h||null==h.tagName){s.appendChild(a);d=d.add(jQuery(a))}var g=$B.RE_WebKit?"input":"a";k=f.createElement(g);p=f.createElement(g);var b=jQuery(k).attr("href","#").css("position","absolute"),c=jQuery(p).attr("href","#").css("position","absolute");if(u===undefined||u){b.bind("focus",x);c.bind("focus",x)}d=d.add(b);d=d.add(c);jQuery(a).prepend(b).append(c);if($B.RE_WebKit){var e="-10000px";if(z)p.style.right=k.style.right=e;else p.style.left=k.style.left=e}a.style.position="absolute";a.className+=m;if(!v&&$B.IE&&$B.V<7){i=new $UI.FramePopup;o=new $UI.FramePopup}l=jQuery(f.createElement("div")).css("position","absolute").addClass("UI_Dialog_Shadow"+m).appendTo(jQuery(a).parent());d=d.add(l);E();return a};this.recalc=function(k){if(!a)return;q();var f=jQuery(a);if(!F){var c=$UI.Dialog.getLocation(a);if(!c||c.isEmpty()){var j={visibility:f.css("visibility")||"visible",display:f.css("display")||"auto"};f.css({visibility:"hidden",display:"block"});c=$UI.Dialog.getLocation(a);f.css({visibility:j.visibility,display:j.display})}if(!b.dock)b.dock=new $UI.Dialog.Rect(0,0,0,0);var h=n.clientWidth/2-c.width/2;if(z){b.dock.x=Math.min(h,0-(c.width-n.clientWidth)-25);if($B.RE_WebKit)b.dock.x+=w.scrollWidth-n.clientWidth}else b.dock.x=Math.max(h,25);if(k){var g=n.clientHeight-c.height-3;b.dock.y=w.scrollTop+Math.min(Math.max(g>200?g:(n.clientHeight-c.height)/2,0),100)}b.dock.height=c.height;b.dock.width=c.width}var d=null;if(b.dock.y!==null)d={top:b.dock.y};if(b.dock.x!==null){d=d||{};d.left=b.dock.x}if(d)f.css(d);if(i)i.positionAt(b.dock,e?1e3:e-2);C(true)};function C(g){var d=jQuery(a).height(),f=jQuery(a).width();if(d!=A||g){var c=new $UI.Dialog.Rect;c.width=f+2;c.height=d+2;c.x=b.dock.x+(z?-3:3);c.y=b.dock.y+3;l.css({width:c.width+"px",height:c.height+"px",left:c.x+"px",top:c.y+"px"});if(i)o.positionAt(c,e?1e3:e-2);A=d}if(j){clearTimeout(j);j=null}j=setTimeout(C,25)}this.show=function(j,k){l.css({backgroundColor:"#000",opacity:.3});b.recalc(true);var i=jQuery(a);i.show();if(e){l.css("z-index",e-1);i.css("z-index",e)}if(v){g=f.createElement("div");B();r=f.createElement("div");var o=jQuery(r).addClass("UI_Dialog_ZoomTest"+m),c=function(a){a.stopImmediatePropagation();return false},d=jQuery(g).attr("id","UI_Dialog_BG").addClass("UI_Dialog_BG"+m).bind({click:c,mousedown:c,keydown:c,keypress:c,dblclick:c});if(u===undefined||u)d.bind("focus",x);if(e)d.css("z-index",e-1);d.width(jQuery(window).width()).height(jQuery(window).height());s.appendChild(g);s.appendChild(r);jQuery(window).bind({resize:function(){setTimeout(q,0)},focus:c});h=h.add(d);h=h.add(o);q()}function n(){try{(j?j:$UI.Dialog.findFocusableElement(a)).focus()}catch(b){}}if(!k)setTimeout(n,10)};this.hide=function(){h.remove();h=jQuery();if($B.IE&&$B.V<7)if(c){for(var a=0;a<c.length;a++)if(typeof c[a].wlppHide!="undefined")c[a].style.visibility=c[a].wlppHide;c=null}};this.minimize=function(){l.hide();if(i)i.minimize();if(o)o.minimize();a.style.visibility="hidden";if(v){g.style.display="none";if(c)for(var b=0;b<c.length;b++)c[b].style.visibility=c[b].wlppHide;q()}};this.restore=function(){l.show();a.style.visibility="visible";if(i)i.restore();if(o)o.restore();b.recalc(true);if(v){g.style.display="block";B();q()}};function E(){jQuery(window).bind({"resize.ext":t,"scroll.ext":t})}function t(){jQuery(window).unbind(".ext",t);b.recalc(false);E()}function B(){if($B.IE&&$B.V<7){c=f.getElementsByTagName("select");var e=a.getElementsByTagName("select");for(var b=0;b<c.length;b++){var g=false;for(var d=0;d<e.length;d++)if(c[b]==e[d]){g=true;break}if(!g){c[b].wlppHide=c[b].style.visibility;c[b].style.visibility="hidden"}}}}};$UI.Dialog.Rect=function(c,d,b,a){return new function(){var e=this;this.x=c;this.y=d;this.width=b;this.height=a;this.isEmpty=function(){return e.width<=0||e.height<=0}}};$UI.Dialog.findFocusableElement=function(b,a,c){function g(a){$el=jQuery(a);var c=$el.attr("tabindex");if(c==="-1")return false;if($el.is(".CloseX")&&$el.is(":visible")&&$el.parents(":hidden").length===0)return true;var b="|BUTTON|TEXTAREA|FIELDSET|IFRAME|SELECT|";return a.tagName&&!a.disabled&&(b.indexOf("|"+a.tagName+"|")>-1||a.tagName=="A"&&a.href&&a.className.indexOf("CloseX")==-1||a.tagName=="INPUT"&&a.type.toLowerCase()!="hidden"&&(!$B.Firefox||a.type.toLowerCase()!="file"))&&jQuery(a).is(":visible")}function d(b){if(!b)return null;var a=c?b.nextSibling:b.previousSibling;while(a&&a.nodeType!=1)a=c?a.nextSibling:a.previousSibling;if(!a)return d(b.parentNode);else return a}function f(b,e){var a=e;if(a&&(a==b||jQuery.contains(b,a)))while(a!=null)if(!g(a))if(c&&a.firstChild)a=a.firstChild;else if(!c&&a.lastChild)a=a.lastChild;else a=d(a);else return a;return null}if(a)a=d(a);else a=b;var e=f(b,a);if(!e&&a&&a!=b)return f(b,b);else return e};$UI.Dialog.getLocation=function(b){if(!b)return new $UI.Dialog.Rect(0,0,0,0);var c=0,d=0,a=b;while(a){c+=a.offsetLeft;d+=a.offsetTop;a=a.offsetParent}return new $UI.Dialog.Rect(c,d,b.offsetWidth,b.offsetHeight)};$UI.Popover=function(){this.header=null;this.body=null;this.footerText=null;this.width=300;this.bodyPadding=true;this.showHeader=true;this.showFooter=true;this.modal=false;this.showCloseX=false;this.zIndex=null;this.dispose=function(){if(b){b.dispose();b=null}};this.addButton=function(e,c,a,b){d.push({name:e,value:c,isDefault:a,isCancel:b})};this.show=function(z,y,q,w){if(e)return;s=z;r=y;if(!b){b=new $UI.Dialog(a.modal,a.zIndex);c=_ce("div");var u=jQuery(c).hide().html('<a href="#"></a><div><h3></h3></div><div></div><div><nobr></nobr></div>');b.setContents(c);t();u.addClass("UI_Popover");var m=c.childNodes;h=m[1];j=m[2];k=m[3];i=m[4];p=j.firstChild;n=i.firstChild;jQuery(h).addClass("CloseX");jQuery(j).addClass("Header");jQuery(k).addClass("Body");jQuery(i).addClass("Footer");if(a.width!=null){var o=a.width;u.css("width",parseInt(o,10)==o?o+"px":o)}f=null;g=[];for(var l=0;l<d.length;l++)v(d[l].name,d[l].value,d[l].isDefault,d[l].isCancel);if(d.length==0)a.showFooter=false;x()}b.show(q?g[q]:null,w);e=true};this.hide=function(){if(!e)return;if(r)setTimeout(w,10);try{jQuery(h).unbind("click");l.unbind(".showhide",o);l=jQuery();m.remove();m=jQuery();b.hide();this.dispose()}catch(a){}e=false;c=h=j=i=k=p=n=g=null};this.enableButton=function(a){jQuery(g[a]).attr("disabled",false)};this.disableButton=function(a){jQuery(g[a]).attr("disabled",true)};function w(){try{r.focus()}catch(a){}}function t(){var b=a.modal?$B.IE?jQuery("body"):jQuery(window):jQuery(c);if($B.IE)b.bind("keypress.showhide",o);else b.bind("keydown.showhide",o);l=l.add(b)}function u(){var b=a.modal?$B.IE?jQuery("body"):jQuery(window):jQuery(c);b.unbind(".showhide",o)}function v(a,h,b,e){jQuery("<span />").text(" ").appendTo(jQuery(n));var d=_ce("div");jQuery(d).html('<button id="popover_btn_{0}" type="{1}" />'.format(a,b?"submit":"button"));var c=jQuery(d.firstChild).toggleClass("Default",b).html("<nobr>"+h+"</nobr>").bind("click",function(b){q(a);b.stopPropagation()});m=m.add(jQuery(c));if(!b&&e)f=a;g[a]=c;jQuery(c).appendTo(jQuery(n))}function o(a){switch(a.which){case 27:q(f?f:"$cancel");a.stopPropagation()}}function q(c){var b=true;if(s)b=s(a,c);if(b)a.hide()}function x(){function b(a,c){if(a){var b=jQuery(c);if(typeof a=="string")b.html(a);else b.html("").append(a)}}jQuery(j).toggle(a.showHeader);jQuery(i).toggle(a.showFooter);jQuery(h).toggle(a.showCloseX).bind("click",function(){q(f?f:"$cancel");return false});if(a.showCloseX){var c=GetString("live.shared.skydrive.pc.Sharing.Close");jQuery(h).append(wLive.Core.ImageStrip.getImage("close",c,c))}if(!a.bodyPadding)jQuery(k).css("padding","0px");b(a.header,p);b(a.body,k)}this.recalc=function(){if(!e)return;if(b)b.recalc(false)};this.minimize=function(){if(!b||!e)return;b.minimize();u()};this.restore=function(){if(!b||!e)return;b.restore();t()};var e=false,b,a=this,j,k,i,h,p,n,f,g,m=jQuery(),l=jQuery(),c,d=[],s=null,r=null}