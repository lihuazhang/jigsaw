/* Copyright (C) 2012 Microsoft Corporation */var __LICENSETERMS__='jQuery Observable Subcomponent of JsViews Data change events for data linking See: http://github.com/BorisMoore/jsviews Microsoft grants you the right to use these script files for the sole purpose of either: (i) interacting through your browser with the Microsoft website, subject to the website�s terms of use; or (ii) using the files as bundled with a Microsoft product subject to that product�s license terms. Microsoft reserves all other rights to the files not expressly granted by Microsoft, whether by implication, estoppel or otherwise. The notices and licenses below are for informational purposes only. Copyright (c) Boris Moore and Brad Olenick Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software. THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.';(function(a,f){a.observable=function(b){return a.isArray(b)?new d(b):new c(b)};var g=[].splice;function c(a){if(!this.data)return new c(a);this._data=a;return this}a.observable.Object=c;c.prototype={_data:null,data:function(){return this._data},setProperty:function(b,e){if(a.isArray(b))for(var g=0,l=b.length;g<l;g++){var i=b[g];this.setProperty(i.name,i.value)}else if(typeof b==="object")for(var j in b)this.setProperty(j,b[j]);else{var f,d,k=this._data,c=h(k,b);b=c[1];c=c[0];if(c){d=c[b];if(a.isFunction(d)){f=d;d=d.call(c)}if(d!=e){if(f){f.call(c,e);e=f.call(c)}else c[b]=e;a(c).triggerHandler("propertyChange",{path:b,value:e,oldValue:d})}}}return this}};function h(a,b){if(a&&b){var c=b.split(".");b=c.pop();while(a&&c.length)a=a[c.shift()];return [a,b]}return []}function d(a){if(!this.data)return new d(a);this._data=a;return this}function b(c,b){a([c]).triggerHandler("arrayChange",b)}function e(a){if(typeof a!=="number")throw"Invalid index.";}a.observable.Array=d;d.prototype={_data:null,data:function(){return this._data},insert:function(d,c){e(d);if(arguments.length>1){c=a.isArray(c)?c:[c];if(c.length>0){g.apply(this._data,[d,0].concat(c));b(this._data,{change:"insert",index:d,items:c})}}return this},remove:function(c,a){e(c);a=a===f||a===null?1:a;if(a&&c>-1){var d=this._data.slice(c,c+a);a=d.length;if(a){this._data.splice(c,a);b(this._data,{change:"remove",index:c,items:d})}}return this},move:function(c,d,a){e(c);e(d);a=a===f||a===null?1:a;if(a){var g=this._data.slice(c,c+a);this._data.splice(c,a);this._data.splice.apply(this._data,[d,0].concat(g));b(this._data,{change:"move",oldIndex:c,index:d,items:g})}return this},refresh:function(a){var c=this._data.slice(0);g.apply(this._data,[0,this._data.length].concat(a));b(this._data,{change:"refresh",oldItems:c});return this}}})(jQuery);var __LICENSETERMS__='JsRender v1.0pre - (jsrender.js version: does not require jQuery): http://github.com/BorisMoore/jsrenderOptimized version of jQuery Templates, fosr rendering to string, using "codeless" markup.Microsoft grants you the right to use these script files for the sole purpose of either: (i) interacting through your browser with the Microsoft website, subject to the website�s terms of use; or (ii) using the files as bundled with a Microsoft product subject to that product�s license terms. Microsoft reserves all other rights to the files not expressly granted by Microsoft, whether by implication, estoppel or otherwise. The notices and licenses below are for informational purposes only. Copyright (c) Boris Moore Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions: The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software. THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.';window.JsViews||window.jQuery&&jQuery.views||function(d,k){var b,u,l,a,i,f,h,s,r,c,g=false,n=true,e=d.jQuery,G=d.document,B=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,m=/^(true|false|null|[\d\.]+)|(\w+|\$(view|data|ctx|(\w+)))([\w\.]*)|((['"])(?:\\\1|.)*\7)$/g,D=/(\$?[\w\.\[\]]+)(?:(\()|\s*(===|!==|==|!=|<|>|<=|>=)\s*|\s*(\=)\s*)?|(\,\s*)|\\?(\')|\\?(\")|(\))|(\s+)/g,C=/\r?\n/g,x=/\\(['"])/g,y=/\\?(['"])/g,z=/\x08([^\x08]+)\x08/g,A=0,q={"&":"&amp;","<":"&lt;",">":"&gt;"},v=/[\x00"&'<>]/g,E=Array.prototype.slice;if(e){b=e;b.fn.extend({render:function(c,b,a,d){return f(c,this[0],b,a,d)},template:function(c,a){return b.template(c,this[0],a)}})}else{u=d.$;d.JsViews=l=d.$=b={extend:function(c,b){var a;for(a in b)c[a]=b[a];return c},isArray:Array.isArray||function(a){return Object.prototype.toString.call(a)==="[object Array]"},noConflict:function(){if(d.$===l)d.$=u;return l}}}c=b.extend;function o(e,h,b,g,f){b=b||{viewsCount:0,ctx:a.helpers};var d=b&&b.ctx;return {jsViews:"v1.0pre",path:h||"",itemNumber:++b.viewsCount||1,viewsCount:0,tmpl:f,data:g||b.data||{},ctx:e&&e===d?d:d?c(c({},d),e):e||{},parent:b}}c(b,{views:a={templates:{},tags:{"if":function(){var b=this,a=b._view;a.onElse=function(e,b){var c=0,d=b.length;while(d&&!b[c++])if(c===d)return "";a.onElse=k;return f(a.data,e.tmpl,a.ctx,a)};return a.onElse(this,arguments)},"else":function(){var a=this._view;return a.onElse?a.onElse(this,arguments):""},each:function(){var c,a=this,d="",e=arguments,h=e.length,g=a.tmpl,b=a._view;for(c=0;c<h;c++)d+=e[c]?f(e[c],g,a.ctx||b.ctx,b,a._path,a._ctor):"";return h?d:d+f(b.data,g,b.ctx,b,a._path,a.tag)},"=":function(a){return a},"*":function(a){return a}},helpers:{not:function(a){return !a}},allowCode:g,debugMode:n,err:function(b){return a.debugMode?"<br/><b>Error:</b> <em> "+(b.message||b)+". </em>":'""'},setDelimiters:function(c,b){var a=b.charAt(0),d=b.charAt(1);c="\\"+c.charAt(0)+"\\"+c.charAt(1);b="\\"+a+"\\"+d;h=c+"(?:(?:(\\#)?(\\w+(?=[!\\s\\"+a+"]))"+"|(?:(\\=)|(\\*)))"+"\\s*((?:[^\\"+a+"]|\\"+a+"(?!\\"+d+"))*?)"+"(!(\\w*))?"+"|(?:\\/([\\w\\$\\.\\[\\]]+)))"+b;h=new RegExp(h,"g")},registerTags:s=function(b,d){var c;if(typeof b==="object")for(c in b)s(c,b[c]);else a.tags[b]=d;return this},registerHelpers:r=function(b,d){if(typeof b==="object"){var c;for(c in b)r(c,b[c])}else a.helpers[b]=d;return this},encode:function(b,a){return a?(i[b||"html"]||i.html)(a):""},encoders:i={none:function(a){return a},html:function(a){return String(a).replace(v,w)}},renderTag:function(h,g,l,e,b){var f,d,m,j=arguments,i=a.presenters;hash=b._hash,tagFn=a.tags[h];if(!tagFn)return "";e=e&&g.tmpl.nested[e-1];b.tmpl=b.tmpl||e||k;if(i&&i[h]){d=c(c({},b.ctx),b);delete d.ctx;delete d._path;delete d.tmpl;b.ctx=d;b._ctor=h+(hash?"="+hash.slice(0,-1):"");b=c(c({},tagFn),b);tagFn=a.tags.each}b._encode=l;b._view=g;f=tagFn.apply(b,j.length>5?E.call(j,5):[g.data]);return f||(f===k?"":f.toString())}},render:f=function(c,d,g,e,i,n){var j,l,f,m,k,h="";if(arguments.length===2&&c.jsViews){e=c;g=e.ctx;c=e.data}d=b.template(d);if(!d)return "";if(b.isArray(c)){m=new o(g,i,e,c);l=c.length;for(j=0,l=c.length;j<l;j++){f=c[j];k=f?d(f,new o(g,i,m,f,d,this)):"";h+=a.activeViews?"<!--item-->"+k+"<!--/item-->":k}}else h+=d(c,new o(g,i,e,c,d));return a.activeViews?"<!--tmpl("+(i||"")+") "+(n?"tag="+n:d._name)+"-->"+h+"<!--/tmpl-->":h},template:function(d,c){if(c){if(""+c===c)c=t(c);else if(e&&c instanceof b)c=c[0];if(c){if(e&&c.nodeType)c=b.data(c,"tmpl")||b.data(c,"tmpl",t(c.innerHTML));a.templates[c._name=c._name||d||"_"+A++]=c}return c}return d?""+d!==d?d._name?d:b.template(null,d):a.templates[d]||b.template(null,B.test(d)?d:F(d)):null}});a.setDelimiters("{{","}}");function j(h,e,a,c,b,f,d){return a?(c?b?"$view."+b:a:"$data."+a)+(f||""):d||(e||"")}function t(d){var e,k=0,i=[],f=[],c=f,b=[,,f];function l(a){a-=k;if(a)c.push(d.substr(k,a).replace(C,"\\n"))}function o(C,q,f,A,B,d,w,y,v,t){var r,s="",h=0,p=g,o=g;function u(e,a,k,c,q,i,b,d,f,l){return o?(o=!b,o?e:'"'):p?(p=!d,p?e:'"'):c?a.replace(m,j)+c:q?h?"":(r=n,"\b"+a+":"):k?(h++,a.replace(m,j)+"("):f?(h--,")"):a?a.replace(m,j):i?",":l?h?"":r?(r=g,"\b"):",":(o=b,p=d,'"')}f=f||A;l(t);if(B){if(a.allowCode)c.push(["*",d.replace(x,"$1")])}else if(f){if(f==="else"){b=i.pop();c=b[2];q=n}d=d?(d+" ").replace(D,u).replace(z,function(c,a){s+=a+",";return ""}):"";d=d.slice(0,-1);e=[f,w?y||"none":"",q&&[],"{"+s+"_hash:'"+s+"',_path:'"+d+"'}",d];if(q){i.push(b);b=e}c.push(e)}else if(v)b=i.pop();k=t+C.length;if(!b)throw"Expected block tag";c=b[2]}d=d.replace(y,"\\$1");d.replace(h,o);l(d.length);return p(f)}function p(k){var j,a,b,h=[],m=k.length,d="try{var views="+(e?"jQuery":"JsViews")+'.views,tag=views.renderTag,enc=views.encode,html=views.encoders.html,$ctx=$view && $view.ctx,result=""+\n\n';for(b=0;b<m;b++){a=k[b];if(a[0]==="*")d=d.slice(0,b?-1:-3)+";"+a[1]+(b+1<m?"result+=":"");else if(""+a===a)d+='"'+a+'"+';else{var l=a[0],c=a[1],g=a[2],n=a[3],i=a[4],f=i+'||"")+';if(g)h.push(p(g));d+=l==="="?!c||c==="html"?"html("+f:c==="none"?"("+f:'enc("'+c+'",'+f:'tag("'+l+'",$view,"'+(c||"")+'",'+(g?h.length:'""')+","+n+(i?",":"")+i+")+"}}j=new Function("$data, $view",d.slice(0,-1)+";return result;\n\n}catch(e){return views.err(e);}");j.nested=h;return j}function w(a){return q[a]||(q[a]="&#"+a.charCodeAt(0)+";")}function F(a){try{return b(a)}catch(c){}return a}}(window);var __LICENSETERMS__='JsViews v1.0pre jQuery plugin providing interactive data-driven views, based on integration between jQuery Templates and jQuery Data Link. Requires jquery.render.js (optimized version of jQuery Templates, for rendering to string)     See JsRender at http://github.com/BorisMoore/jsrender and jquery.observable.js.     See JsViews at http://github.com/BorisMoore/jsviews Microsoft grants you the right to use these script files for the sole purpose of either: (i) interacting through your browser with the Microsoft website, subject to the website�s terms of use; or (ii) using the files as bundled with a Microsoft product subject to that product�s license terms. Microsoft reserves all other rights to the files not expressly granted by Microsoft, whether by implication, estoppel or otherwise. The notices and licenses below are for informational purposes only. Copyright (c) Boris Moore Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions: The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software. THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.';(function(a,b){var f=false,e=true,h,c,D,B=a.cleanData,u={value:"val",html:"html",text:"text"},m="_jsvData";function z(p){var w,v,d,x,e,r,h,g,n,j,q=this.target,i=p.target,s=a(i),m=a.view(i),z=this.links,t=m.ctx,y=t.beforeChange,A=z.length;while(A--&&!v){g=z[A];if(!g.filter||g.filter&&s.is(g.filter)){d=g.fromAttr;if(!d){d=c.merge[i.nodeName.toLowerCase()];d=d?d.from.fromAttr:"text"}w=u[d];h=a.isFunction(d)?d(i):w?s[w]():s.attr(d);if((!y||!(v=y.call(m,p)===f))&&h!==b){e=g.to||a.trim(i.getAttribute(c.linkToAttr));if(e){n=g.convert;e=l(e);j=e[0].slice(0,-1);q=m&&m.data||q;j=k(q,m,j);n=e[3];x=a.trim(e[1].slice(0,-1));r={source:i,target:j,convert:n,path:x};if(n)h=o(r,q,m,n,h);if(h!==b&&j){a.observable(j).setProperty(x,h);if(t.afterChange)t.afterChange.call(r,p)}p.stopPropagation()}}if(v)p.stopImmediatePropagation()}}}function x(m,e){var q,i,y,h,b,d,s,k=this,j=k.target,g=a(j),v=m.target,x=e&&e.path||m.path,l=a.view(j),r=l.ctx,t=r.beforeChange,p=n(j,v).paths[x],w=p&&p.length;while(w--){q=p[w];if((!t||!(e&&(y=t.call(this,m,e)===f)))&&(!l||l.onDataChanged(e)!==f)){b=q.attr;d=o(k,k.source,l,q.expr,e&&e.value);if(a.isFunction(d))d=d.call(v);if(!b){b=c.merge[j.nodeName.toLowerCase()];b=b?b.to.toAttr:"text"}if(s=b.indexOf("css-")===0&&b.substr(4)){if(h=g.css(s)!==d)g.css(s,d)}else{i=u[b];if(i){if(h=g[i]()!==d)g[i](d)}else if(h=g.attr(b)!==d)g.attr(b,d)}if(e&&h&&r.afterChange)r.afterChange.call(k,m,e)}}}function y(g,a){var i,d=this.ctx,e=d.beforeChange,h=a?a.change:c.linkToAttr;if((!e||!(i=e.call(this,g,a)===f))&&h!==b){this.onDataChanged(a);if(d.afterChange)d.afterChange.call(this,g,a)}}function j(d){var e,c=d.data,b=d._onArrayChange;if(b){if(b[1]===c)return;a([b[1]]).unbind("arrayChange",b[0])}if(a.isArray(c)){e=function(){y.apply(d,arguments)};a([c]).bind("arrayChange",e);d._onArrayChange=[e,c]}}function t(d,c,f){var b=d.parent&&d.parent.ctx,e=d._ctx;d.ctx=f?e&&b?a.extend({},b,e):b||e:c&&c!==b?(d._ctx=c,b?a.extend({},b,c):c):b}function i(l,n,o,i,d,u,e){var h,g,s,m,r,f,q,b=this;a.extend(b,{views:[],nodes:n?[]:[document.body],tmpl:i||d&&d.tmpl,path:o,parent:d,prevNode:n,parentElem:n&&n.parentNode});if(d){h=d.views;u.push(b);e=e||d.data;if(a.isArray(d.data)){b.index=g=o;h.splice(g,0,b);s=h.length;e=e[g];while(g++<s-1)a.observable(h[g]).setProperty("index",g);b.tag=d.tag}else{if(o){e=p(e,d,o);l=l||e[1];e=e[0]}b.index=h.length;h.push(b);if(l.tag)b.tag=[l.tag];else{i=i.split("=");if(i.shift()==="tag")b.tag=i}}}b.data=e;t(b,l);j(b);if((m=b.tag)&&!a.isArray(e)){f=c.tags[m[0]];if(f&&f.presenter){r=f.ctx||{};q=m[1]?k(d.data,d,"{"+m[1]+"}"):d.ctx;a.extend(q,f.options||{});r[m[0]]=new f.presenter(q,b);b.context(r)}}}function g(f,q,p,A,m,k,y,s){var l,n,j,x,w,E,D,C,B,z,t,h=q,o=A;k=k||{};s=s||0;f=y||f;if(!y&&f.nodeType===1){if(o++===0)h.nodes.push(f);var u=f.getAttribute(c.linkFromAttr),v=f.getAttribute(c.getFromAttr);if(u||v)r(m||q.data,f,v,u,e);f=f.firstChild}else f=f.nextSibling;while(f&&f!==p){if(f.nodeType===1)g(f,h,p,o,m,k);else if(f.nodeType===8&&(l=/^(\/?)(?:(item)|(?:(tmpl)(?:\((.*)\))?(?:\s+([^\s]+))?))$/.exec(f.nodeValue))){w=f.parentNode;if(l[1]){h.nextNode=f;if((z=h.tag)&&(t=h.ctx[z[0]])&&t.onAfterCreate)t.onAfterCreate();if(h.ctx.onAfterCreate)h.ctx.onAfterCreate.call(h,h);if(l[2])h=q;else return f}else{n=n||d(w,"view",e);if(l[2])h=new i(k,f,s++,b,h,n);else{j=a.view(f);if(j&&j.prevNode===f)if(j.data===m)x=j.nextNode;else{j.data=m;j.render(k);return j.nextNode}else j=new i(k,f,l[4],l[5],h,n,m);f=x||g(f,j,p,0)}}}else if(o===0)h.nodes.push(f);f=f.nextSibling}}function p(d,b,c){return Function("$","$data","$view","$ctx","with($data){return ["+c+"];}")(a,d,b,b.ctx)}function o(d,e,b,c,f){try{return Function("$","$data","$view","$ctx","$value","with($data){return "+c+";}").call(d,a,e,b,b.ctx,f)}catch(g){throw g.message;}}function k(c,d,b){try{return b?Function("$","$data","$view","$ctx","with($data){return "+b+";}")(a,c,d,d.ctx):c}catch(e){throw e.message;}}function w(l,m,f,o){var c,k,n,h,j,i,e;if(f){f=a.isArray(f)?f:[f];h=[];j=[];e=f.length;while(e--){c=f[e];if(c.to)h.push({to:c.to,filter:c.filter});if(c.from||c.getFrom)j.push(c)}e=j.length;while(e--){c=j[e];k=c.filter;n=k?l.find(k).add(a(this).filter(k)):l;n.each(function(){r(m,this,c.getFrom,c.from)})}}if(!f||h.length)l.each(function(){if(!f){i=d(this,"to");e=i.length;while(e--){c=i[e];if(c.links===declLinkTo){if(c.target===m)return;q(this,declLinkTo);i.splice(e,1)}}h=declLinkTo;g(this,a.view(this),b,b,m,o)}A(this,m,h)});return l}function r(q,x,u,n){var b,d,h,g,j,r,i,B,p,f,A,m=[],c="";n=l((n?n+",":"")+(u?"|,"+u+",":""),e);while(b=n.shift()){g=b.length;j=b.charAt(g-1);b=b.slice(0,-1);switch(j){case ":":r=a.trim(b);break;case "[":c=a.trim(b);break;case ")":c=c||b;break;case "]":m=[[c,b]];c=c?c+"."+b:b;c+=a.isFunction(q[b])?"()":"";break;case "\r":i=++b;break;case ",":if(b==="|")B=e;else{if(i){f=c.slice(i);f=l(f);for(h=0,g=f.length;h<g;h++){d=a.trim(f[h]);j=d.charAt(d.length-1);d=d.slice(0,-1);if(j==="[")f[h]=p=d;else if(j==="]"){m.push([p,d]);f[h]=p?"."+d:d;f[h]+=a.isFunction(q[d])?"()":"";p=""}}c=c.slice(0,i)+f.join("")+")"}c+=b;A=a.view(x);g=m.length;while(g--){var v=m[g],z=v[1],w=k(q,A,v[0]),y={source:q,target:x},t=z.split("."),o=w;while(t.length>1){o=o[t.shift()];if(o)s(o,y,t.join("."),c,r)}s(w,y,z,c,r,!g&&B)}i=0;m=[];r=c=""}}}}function s(f,l,g,o,m,p){var i,j,b,h=l.target,c=n(h,f),k={attr:m,expr:o};if(c){j=c.paths[g]=c.paths[g]||[];j.push(k);b=c.handler}else{b=function(){x.apply(l,arguments)};if(h){i={};i[g]=[k];d(h,"from",e).push({source:f,paths:i,handler:b})}a(f).bind("propertyChange",b)}if(p)b({target:f,path:g})}function A(c,f,g){var b=function(){z.apply({target:f,links:g},arguments)};d(c,"to",e).push({target:f,links:g,handler:b});a(c).bind("change",b)}function q(f,g){var c,b=d(f,"to"),e=b.length;while(e--){c=b[e];if(c.links===g){a(f).unbind("change",c.handler);b.splice(e,1)}}}function n(f,e){var a,b=d(f,"from"),c=b.length;while(c--){a=b[c];if(a.source===e)return a}}function v(g){var h,e,b,f,d,i,c=a.cache[g[a.expando]];c=c&&c.data;linksAndViews=c&&c[m];if(linksAndViews){if(linksAndViews.to.length)a(g).unbind("change");e=linksAndViews.from;b=e.length;while(b--){h=e[b];a(h.source).unbind("propertyChange",h.handler)}f=linksAndViews.view;if(b=f.length){d=a.view(g);while(b--){i=f[b];if(i.parent===d)d.removeViews(i.index,1)}}}}function d(c,e,d){var b=a.data(c,m)||d&&a.data(c,m,{view:[],from:[],to:[]});return b?b[e]:[]}function l(a,h){var c,d=0,b=0,g=f,e=f;a=a.replace(/\s+/g," ");return a.replace(/(\))|([\:\,])|(\')|(\")|([\(\[\{])|([\}\]])/g,function(f,o,n,j,k,m,l,i){if(e){e=!j;return f}if(g){g=!k;return f}if(o)return --b?f:h&&a.charAt(i+1)===","?(c-=d,d=i,f+"\t"+c+"\r\t"):f;if(n)return b?f:(d=i+1,f+"\t");if(m){if(b++)return f;if(f==="(")c=i;return f!=="["?f:"[\t"}if(l)return --b||f!=="]"?f:"]\t";e=j;g=k;return f}).split("\t")}function C(b){return b.type==="checkbox"?b.checked:a(b).val()}a.extend({view:function(b,o){var c,f,g,k,j,m=/^item|^tmpl(\(\$?[\w\.\(\)\$,\"\']*\))?(\s+[^\s]+)?$/,l=document.body,n=b;if(o){j=b.nextSibling||b.parentNode;while(j!==(b=b.firstChild||b.nextSibling||b.parentNode.nextSibling))if(b.nodeType===8&&m.test(b.nodeValue)){f=a.view(b);if(f.prevNode===b)return f}return}b=b||l;if(h&&!h.views.length)c=h;else{while(!(g=d(j=b.parentNode||l,"view")).length){if(!j||b===l){d(l.parentNode,"view",e).push(c=h=new i);h.ctx={};break}b=j}if(!c&&b===l)c=g[0];while(!c&&b){if(b.nodeType===8)if(/^\/item|^\/tmpl$/.test(b.nodeValue)){k=g.length;while(k--){f=g[k];if(f.nextNode===b){c=b===n&&f;b=f.prevNode;break}}}else if(m.test(b.nodeValue)){k=g.length;while(k--){f=g[k];if(f.prevNode===b){c=f;break}}}b=b.previousSibling}c=c||a.view(j)}return c},cleanData:function(b){var c=b.length;while(c--)v(b[c]);B.call(a,b)}});c=a.views=a.views||{};a.extend(c,{presenters:{},activeViews:true,getProperty:function(c,b){return a.isFunction(b)?b.call(c):b},linkToAttr:"data-to",linkFromAttr:"data-from",getFromAttr:"data-getfrom",merge:{input:{from:{fromAttr:C},to:{toAttr:"value"}}},registerPresenters:registerPresenters=function(e,d){var g,f;if(typeof e==="object")for(g in e)registerPresenters(g,e[g]);else{d.ctx=d.ctx||{};f=(f=d.tag)===b?e:f;if(f){d.tag=f;c.tags[f]=d}plugin=(plugin=d.plugin)===b?e:plugin;if(plugin){a.fn[plugin]=a.fn[plugin]||function(b,a){return this.link(b,d,a)};d.plugin=plugin}c.presenters[e]=d}return this},view:{onDataChanged:function(a){if(a){var b=this,f=a.change,c=a.index,d=a.items;switch(f){case "insert":b.addViews(c,d);break;case "remove":b.removeViews(c,d.length);break;case "move":b.render();break;case "refresh":b.render()}}return e},render:function(){var c=this.prevNode,e=this.nextNode,d=c.parentNode;a(this.nodes).remove();this.removeViews(0,this.views.length);this.nodes=[];a(c).after(a.render(this.data,this.tmpl,this.ctx));d.removeChild(c.nextSibling);d.removeChild(e.previousSibling);g(d,this,e,0,b,b,c,0);j(this);return this},addViews:function(d,i,o){var h,m=i.length,k=this.ctx,l=this.views;if(d&&!l[d-1])return;if(m){if(this.path){h=this.parent;k=p(h.data,h,this.path)[1]}var n=a.render(i,o||this.tmpl,k,this,e),c=d?l[d-1].nextNode:this.prevNode,j=c.nextSibling,f=c.parentNode;a(c).after(n);f.removeChild(c.nextSibling);f.removeChild(j.previousSibling);g(f,this,j,0,b,b,c,d)}return this},removeViews:function(f,l,n){if(l){var h,k,m,i=this.views,o=f+l;while(o-->f){var c=i[o],g=c.views.length,e=c.prevNode,q=c.nextNode,p=[e];if(g)c.removeViews(0,g,n);h=h||d(c.parentElem,"view");g=h.length;while(g--&&k===b)if(h[g]===c)k=g;h.splice(k,1);if(!n){while(e&&e.parentNode&&e!==q){e=e.nextSibling;p.push(e)}a(p).remove()}c.data=b;j(c)}i.splice(f,l);m=i.length;while(f<m)a.observable(i[f]).setProperty("index",f++)}return this},context:function(c){var a=this,d=a.parent,e=d?d.ctx:{};if(!c)a.each(function(a){a.ctx=e;a._ctx=b});else if(c!==a.ctx)a.each(function(b){t(b,c,b!==a)});return this},each:function(a){a(this);var b=this.views.length;while(b--)this.views[b].each(a);return this},content:function(b){return b?a(b,this.nodes):a(this.nodes)}}});a.fn.extend({view:function(b){return a.view(this[0],b)},addLinks:function(c,b,a){return w(this,c,b,a)},link:function(e,c,d){if(!this.length)return this;if(c){c=c.tag&&c===a.views.tags[c.tag]?(d.tag=c.tag,d.tmpl||c.tmpl):a.isPlainObject(c)?(d=c,f):c;if(c&&(c=a.template(c))){q(this[0],declLinkTo);v(this[0]);this.empty();if(e)this.append(a.render(e,c,d))}}return w(this,e,b,d)}});i.prototype=c.view;D=c.decl;declLinkTo=[{filter:"input["+c.linkToAttr+"]"}]})(jQuery);(function(){var f=window,b=f.wLive;b.Search=b["Search"]||{};b.Search.RankSearchKeyWeight=c;function c(d,b,c){var a=this;a.key=d;a.weight=b;a.order=c}function d(){var d=this,g="<strong>",i="</strong>",b="",c="",e=" !\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~",h=new RegExp("["+e.escapeRegex()+"]","ig");d.accent=new function(){var b=this,a={a:/[\xE0-\xE4]/ig,e:/[\xE8-\xEB]/ig,i:/[\xED-\xEF]/ig,o:/[\xF3-\xF5]/ig,u:/[\xF9-\xFC]/ig,n:/\xF1/ig,y:/\xFF/ig,c:/\xE7/ig};b.fold=function(b){b=b.toLowerCase();for(var c in a)b=b.replace(a[c],c);return b}};d.getSuffixStringsFor=function(d){var b=[],a=null,c=null;if(d){b.push(a=d.lTrim());while((c=a.search(h))!=-1)b.push(a=a.substring(c+1).lTrim())}return b};function f(g,q,p){var d,n=[q].concat(q.split(" ")),f=new Array(g.length+2),r="(^|\\s"+(p?"|@":"")+(!p?"|["+e.escapeRegex()+"]":"")+")";for(d=0;d<f.length;d++)f[d]=0;for(d=0;d<n.length;d++){var s=n[d],m=a.accent.fold(g).replace(new RegExp(r+"("+a.accent.fold(s).escapeRegex()+")","ig"),"$1"+b+"$2"+c),o=0,h=0,j=0;while((o=m.indexOf(b,h))!=-1){h=m.indexOf(c,h+1);j+=2;for(var l=o-j+2;l<h-j+1;l++)f[l+1]=1}}var i=[];for(d=1;d<f.length;d++)if(f[d]!=f[d-1])i.push(d-1);var k=0;for(d=0;d<i.length;d++){k=i[d]+d;g=g.substr(0,k)+(d%2?c:b)+g.substr(k)}return g}d.isHighlighted=function(a){return a&&a.indexOf(g)-1};d.makeBold=function(d,e,j){var h=a.korean.match(d)?a.korean.highlight(d,e):f(d,e,j);return h.encodeHtml().replace(new RegExp(b.encodeHtml(),"g"),g).replace(new RegExp(c.encodeHtml(),"g"),i)};d.korean=new function(){var d=this,h=new RegExp("([\\uAC00-\\uD7AF])","g"),o=44032,i=4352,j=4449,k=4519,q=b,a=c,g={"ㄱ":"ᄀ","ㄲ":"ᄁ","ㄴ":"ᄂ","ㄷ":"ᄃ","ㄸ":"ᄄ","ㄹ":"ᄅ","ㅁ":"ᄆ","ㅂ":"ᄇ","ㅃ":"ᄈ","ㅅ":"ᄉ","ㅆ":"ᄊ","ㅇ":"ᄋ","ㅈ":"ᄌ","ㅉ":"ᄍ","ㅊ":"ᄎ","ㅋ":"ᄏ","ㅌ":"ᄐ","ㅍ":"ᄑ","ㅎ":"ᄒ"},m=l(g),p=new RegExp("([\\u1100-\\u1112][\\u1161-\\u1175][\\u11A8-\\u11C2]{0,1})","g"),n=new RegExp("([\\u1100-\\u1112]"+a+"{0,1}[\\u1161-\\u1175]"+a+"{0,1}[\\u11A8-\\u11C2]{0,1})","g");d.expand=function(a){a=a.replace(m,function(a){return g[a]});return a.replace(h,function(f){var a=f.charCodeAt(0)-o,b=Math.floor(a/588),d=Math.floor((a-b*588)/28),c=a%28;return e(b+i)+e(d+j)+(c?e(c+k):"")})};d.highlight=function(c,g){var b=f(d.expand(c),d.expand(g),0);return b.replace(n,function(b){return b.replace(a,"")+(b.match(a)?a:"")}).replace(p,function(a){var b=a.charCodeAt(0)-i,c=a.charCodeAt(1)-j,d=a.length>2?a.charCodeAt(2)-k:0;return e(b*588+c*28+d+44032)})};d.match=function(a){return a.match(h)};function e(a){return String.fromCharCode(a)}function l(){var a=["(["];for(var b in g)a.push(b);a.push("])");return new RegExp(a.join(""),"g")}}}var a=b.Search.Helpers=new d;b.Search.Indexer=e;function e(s){var b=this,d=null,k=/\s+/g,c=s,r=c.comparer,e=c.matchField;b.autoCompleteTokens=[];b.getMatches=function(u,D){m(u);var s=l(u),k=[],q=null,b=null,a;if(s=="")return {result:[],query:u};q=h(s);for(a=0;a<q.length;a++){b=q[a];k.push({obj:b.obj,weight:e(b.obj).toLowerCase()==s?b.weight+1.5:b.weight,bucket:0})}var r=s.split(" ");if(r.length>1)for(a=0;a<r.length;a++){q=h(r[a]);for(var x=0;x<q.length;x++){b=q[x];k.push({obj:b.obj,weight:b.weight-.1*Math.abs(a+1-b.order),bucket:a+1})}}var i=[];if(k.length){var A=c.compareParents?[o]:[];A.addRange([g,n]);k.sort(f(A));var d=null,t=null,w=null,v=null,C=r.length>1?r.length:0,z=function(a){d=a;t=d.bucket;w=t==0?0:1},B=function(){(!v||c.isValid(v.obj,d.obj))&&w==C&&i.push(v=d)};z(k[0]);for(a=1;a<k.length;a++){b=k[a];if(g(d,b)){B();z(b)}else{d.weight=d.weight+b.weight;if(t!=b.bucket){t=b.bucket;w++}}}B()}i.sort(f([p,j]));i.length=Math.min(i.length,D);var y=new Array(i.length);for(a=0;a<i.length;a++)y[a]=i[a].obj;return {result:y,query:u}};function f(a){return function(d,e){var c=0,b=0;while(c<a.length&&!(b=a[c++](d,e)));return b}}function o(a,b){return c.compareParents(a.obj,b.obj)}function n(a,b){return a.bucket-b.bucket}function g(a,b){return r(a.obj,b.obj)}function j(a,b){return e(a.obj).length-e(b.obj).length}function p(a,b){return b.weight-a.weight}function m(d){var a=0,c;while(a<b.autoCompleteTokens.length){c=i(b.autoCompleteTokens[a]);if(d.indexOf(c)==-1)b.autoCompleteTokens.splice(a,1);else{d=d.replace(c,"");a++}}}function i(a){return a}function l(a){a=q(a);return a.toLowerCase().trim().replace(k," ")}function q(a){for(var c=0;c<b.autoCompleteTokens.length;c++)a=a.replace(i(b.autoCompleteTokens[c]),"");return a}function h(b){return d.matchPrefix(a.accent.fold(a.korean.expand(b)))}b.initialize=function(f){d=new $Trie;for(var b=0;b<f.length;b++){var h=c.getKeysAndWeights(f[b]);for(var g=0;g<h.length;g++){var e=h[g];d.insert(a.accent.fold(a.korean.expand(e.key.toLowerCase().trim())),{obj:f[b],weight:e.weight,order:e.order})}}d.sort()}}$Do.register("wlxsearchshared")})();(function(){var b=window.wLive,a=b.ContactList=b["ContactList"]||{};a.Controls=a["Controls"]||{};a.Core=a["Core"]||{}})();(function(){var k=window,a=k.wLive,b=k.jQuery,r=".VirtualizedGrid",e=0,d="unique-id",j=[].splice,f="mousedown",g="mouseover",h="mouseout",i="click",s="scroll",q="arrayChange",m="beginBatchUpdate",n="endBatchUpdate";a.ContactList.Controls.VirtualizedGrid=o;function o(l,kb,gb,db,hb,P){var c=this;c.$=b(this);e++;var y=r+e,w=l,p;if(P)p=P;else p=l.parent();var T=document.createElement("ul");w.append(T);w.css("overflow","hidden");var L=b(T);sutra(L,hb||"$Sutra.Shared.ContactsList");var j=b.extend({height:51,width:100,padding:{top:0,right:0,bottom:0,left:0},renderPages:3,maxColumns:1,itemClass:"",alphabetHelper:null,fadeBackground:true},db||{}),t=j.height+j.padding.top+j.padding.bottom,ib=j.width+j.padding.left+j.padding.right,Q,R,u,K,G,A,O,cb=-1,z=-1,H,M=false,J=kb,v="."+j.itemClass,Z="li"+v,D=-1,x,k=new Array(J.length),B=[],U=gb,o,F=false;N();if(j.letterHeader&&j.alphabetHelper)o=new a.ContactList.Controls.LetterHeaderGridLayout(c,p,U,j.alphabetHelper,j.fadeBackground);else o=new a.ContactList.Controls.ListGridLayout(c,U);o.init(J,k,B);E();p.bind(s+y,jb);var I=b([J]);I.bind(q+y,fb);I.bind(m+y,ab);I.bind(n+y,bb);if(j.supportsHover){l.delegate(v,g,W);l.delegate(v,h,X)}l.delegate(v,f,V);l.delegate(v,i,Y);function N(){Q=j.containerHeight||w.innerHeight();R=j.containerWidth||w.innerWidth();u=j.maxColumns!==0?j.maxColumns:Math.round(Math.floor(R/ib));K=Math.round(Math.ceil(Q/t));G=K*u;A=G*j.renderPages;O=K*j.renderPages*t}function ab(){F=true}function bb(){F=false;E();c.render()}c.isVisible=function(b){if(!F){x=x||S();var a=Math.floor(x.startIndex/u)*t;return b>=a&&b<=a+O}else return false};c.hide=function(){l.hide()};c.closeLetterPicker=function(){o&&o.closeLetterPicker&&o.closeLetterPicker()};c.show=function(){l.show()};c.setVisibility=function(a){p.css("overflow",a?"auto":"hidden");l.css("visibility",a?"visible":"hidden")};c.createTile=function(i,n,l,k,e,f){var a=[];a.push('<li class="');a.push(j.itemClass);if(e)for(var h=0,m=e.length;h<m;h++){a.push(" ");a.push(e[h])}a.push('" style="top:');a.push(n);a.push("px; left:");a.push(l);a.push("px");if(f)for(var g in f)if(g){a.push(";");a.push(g);a.push(":");a.push(f[g])}a.push('" data-');a.push(d);a.push('="');a.push(i.encodeHtmlAttribute());a.push('">');a.push(k);a.push("</li>");var c=b(a.join(""));c.data(d,i);sutra(c,"$Sutra.Shared.ContactsListItem");L.append(c);return c};c.getTileCount=function(){return k.length};c.getTileCountPerPage=function(){return G};c.getTile=function(a){return a<k.length?k[a]:null};c.getTileIndex=function(b){for(var a=k.length-1;a>=0;a-=1)if(k[a]===b)return a;return -1};function fb(d,a){if(!M){var b=a.change;if(b==="insert")o.processInsertedItems(a.index,a.items);else if(b==="remove")o.processRemovedItems(a.index,a.items);else if(b==="move")throw new Error("Move is not supported");else if(b==="refresh")eb();if(!F){E();c.render()}}}function eb(){for(var a=0,b=k.length;a<b;a++)k[a].remove();k=[];B=[];o.init(J,k,B);E();c.render()}function C(d){var a=b(d.target);return c.getItemForEvent(a)}function W(b){var a=C(b);if(a.mouseover)a.mouseover(b)}function X(b){var a=C(b);if(a.mouseout)a.mouseout(b)}function V(b){var a=C(b);if(a.mousedown)a.mousedown(b)}function Y(b){var a=C(b);if(a.click)a.click(b)}function E(){var b=L.innerHeight(),a=Math.ceil(k.length/u)*t;if(b!=a)w.css({height:a+"px"})}c.resize=function(){N();c.render();o.resize()};c.getScrollData=function(){return x};c.render=function(){if(D<0)D=w.offset().top-p.offset().top;x=S();var a=x.startIndex,c=0,d=Math.floor(a/u)*t,b=a,e,h=k.length,g=x.scrollTop;if(o.onRender)o.onRender(a,d,c);for(var f=0;f<A;f++)if(b<h){e=b%u;if(b!=a)if(e==0){d+=t;c=0}else c+=j.width;k[b++].render(b,d,c,g)}cb=a};c.scrollTo=function(a){var b=Math.floor(a/u)*t;p.scrollTop(b)};c.isItemVisible=function(c){var b=Math.floor(c/u)*t,a=p.scrollTop()-D;return a<=b&&b+t<=a+p.height()};c.getItemForEvent=function(b){var a=b.closest(Z),c=a.data(d);return B[c]};function jb(){c.render()}function S(){var d=p.scrollTop()-D,c=Math.floor(d/t)*u,g=Math.ceil(d/t)*u,a,b,e;if(c===z||z===-1){a=c;b=a+A}else if(c>z){a=c;b=a+A}else if(c<z){b=c+G;a=b-A}if(b>k.length){var f=b-k.length;b-=f;a-=f}if(a<0)a=0;z=c;if(H)if(H>d)e=-1;else if(H<d)e=1;else e=0;H=d;return {startIndex:a,endIndex:b,firstVisibleIndex:g,scrollTop:d,dir:e}}c.dispose=function(){if(!M){M=true;c.closeLetterPicker();o.dispose();p.unbind(y);if(j.supportsHover){l.undelegate(v,g,W);l.undelegate(v,h,X)}l.undelegate(v,f,V);l.undelegate(v,i,Y);I.unbind(y);w.empty();B=k=null;c.$.unbind()}}}a.ContactList.Controls.LetterHeaderGridLayout=l;function l(u,p,t,i,r){var e=this,f=u,g,b,d,n,o=t,h=new a.ContactList.Controls.LetterPicker(p,i,r);h.$.bind("letterClick",s);h.$.bind("close",q);function k(a){return i.getAlphabetLetter(a.sortName())}e.showLetterPicker=function(){f.setVisibility(false);var b=i.getAlphabet(),e=[];for(var a=0,g=b.length;a<g;a++)if(d[c(b[a])])e.push(b[a]);h.show(e)};e.closeLetterPicker=function(){h.close()};function q(){f.setVisibility(true)}function s(e,a){f.setVisibility(true);f.scrollTo(b.indexOf(d[c(a.letter)]));setTimeout(function(){f.$.triggerHandler("clickLetter",a)},0)}e.init=function(m,r,q){g=m;b=r;d=q;n=m.length;if(g.length>0){var i=-1,h,p=0,j=0;for(var a=0,s=g.length;a<s;a++){var c=k(g[a]);if(i!=c){i=c;h=b[p++]=l(c,j);j+=2}var e=o.createTile(f,g[a]);b[p++]=e;d[e.uniqueId]=e;h.itemsCount++}}};e.onRender=function(){};e.processInsertedItems=function(p,r){var h=[],u="",e,a;if(g.length>0&&p<n-1)if(p===0)e=0;else e=m(p,g[p-1])+1;else e=b.length;for(var q=0,v=r.length;q<v;q++){var i=k(r[q]);if(i!=u){a=d[c(i)];u=i;if(!a){a=l(i,0);h.push(a)}else{var t=b.indexOf(a);if(t>=e){h.push(a);b.splice(t,1)}}}var s=o.createTile(f,r[q]);h.push(s);d[s.uniqueId]=s;a.itemsCount++}j.apply(b,[e,0].concat(h))};e.processRemovedItems=function(h,f){for(var e=0,l=f.length;e<l;e++){var i=m(h,f[e]),g=b.splice(i,1);g[0].remove();delete d[g.uniqueId];var j=k(f[e]),a=d[c(j)];if(--a.itemsCount===0){a.remove();b.splice(b.indexOf(a,h),1);delete d[a.uniqueId]}}};function l(g){var b=new a.ContactList.Controls.LetterGridTile(c(g),g,f,e,i);d[b.uniqueId]=b;return b}function m(e,f){var d=-1;for(var c=e,g=b.length;c<g;c++)if(!(b[c]instanceof a.ContactList.Controls.LetterGridTile)&&b[c].itemEquals(f)){d=c;break}return d}e.resize=function(){h.resize()};e.dispose=function(){h.dispose()}}function c(a){return a}a.ContactList.Controls.ListGridLayout=p;function p(g,e){var a=this,f=g,d,c,b;a.init=function(i,j,h){d=i;c=j;b=h;for(var a=0,k=d.length;a<k;a++){var g=e.createTile(f,d[a]);c[a]=g;b[g.uniqueId]=g}};a.processInsertedItems=function(i,g){var h=[];for(var d=0,k=g.length;d<k;d++){var a=e.createTile(f,g[d]);h.push(a);b[a.uniqueId]=a}j.apply(c,[i,0].concat(h))};a.processRemovedItems=function(f,e){var d=c.splice(f,e.length);for(var a=0,g=d.length;a<g;a++){delete b[d[a].uniqueId];d[a].remove()}};a.resize=function(){};a.dispose=function(){}}})();(function(){var f=window,b=f.wLive;b.Search=b["Search"]||{};b.Search.RankSearchKeyWeight=c;function c(d,b,c){var a=this;a.key=d;a.weight=b;a.order=c}function d(){var d=this,g="<strong>",i="</strong>",b="",c="",e=" !\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~",h=new RegExp("["+e.escapeRegex()+"]","ig");d.accent=new function(){var b=this,a={a:/[\xE0-\xE4]/ig,e:/[\xE8-\xEB]/ig,i:/[\xED-\xEF]/ig,o:/[\xF3-\xF5]/ig,u:/[\xF9-\xFC]/ig,n:/\xF1/ig,y:/\xFF/ig,c:/\xE7/ig};b.fold=function(b){b=b.toLowerCase();for(var c in a)b=b.replace(a[c],c);return b}};d.getSuffixStringsFor=function(d){var b=[],a=null,c=null;if(d){b.push(a=d.lTrim());while((c=a.search(h))!=-1)b.push(a=a.substring(c+1).lTrim())}return b};function f(g,q,p){var d,n=[q].concat(q.split(" ")),f=new Array(g.length+2),r="(^|\\s"+(p?"|@":"")+(!p?"|["+e.escapeRegex()+"]":"")+")";for(d=0;d<f.length;d++)f[d]=0;for(d=0;d<n.length;d++){var s=n[d],m=a.accent.fold(g).replace(new RegExp(r+"("+a.accent.fold(s).escapeRegex()+")","ig"),"$1"+b+"$2"+c),o=0,h=0,j=0;while((o=m.indexOf(b,h))!=-1){h=m.indexOf(c,h+1);j+=2;for(var l=o-j+2;l<h-j+1;l++)f[l+1]=1}}var i=[];for(d=1;d<f.length;d++)if(f[d]!=f[d-1])i.push(d-1);var k=0;for(d=0;d<i.length;d++){k=i[d]+d;g=g.substr(0,k)+(d%2?c:b)+g.substr(k)}return g}d.isHighlighted=function(a){return a&&a.indexOf(g)-1};d.makeBold=function(d,e,j){var h=a.korean.match(d)?a.korean.highlight(d,e):f(d,e,j);return h.encodeHtml().replace(new RegExp(b.encodeHtml(),"g"),g).replace(new RegExp(c.encodeHtml(),"g"),i)};d.korean=new function(){var d=this,h=new RegExp("([\\uAC00-\\uD7AF])","g"),o=44032,i=4352,j=4449,k=4519,q=b,a=c,g={"ㄱ":"ᄀ","ㄲ":"ᄁ","ㄴ":"ᄂ","ㄷ":"ᄃ","ㄸ":"ᄄ","ㄹ":"ᄅ","ㅁ":"ᄆ","ㅂ":"ᄇ","ㅃ":"ᄈ","ㅅ":"ᄉ","ㅆ":"ᄊ","ㅇ":"ᄋ","ㅈ":"ᄌ","ㅉ":"ᄍ","ㅊ":"ᄎ","ㅋ":"ᄏ","ㅌ":"ᄐ","ㅍ":"ᄑ","ㅎ":"ᄒ"},m=l(g),p=new RegExp("([\\u1100-\\u1112][\\u1161-\\u1175][\\u11A8-\\u11C2]{0,1})","g"),n=new RegExp("([\\u1100-\\u1112]"+a+"{0,1}[\\u1161-\\u1175]"+a+"{0,1}[\\u11A8-\\u11C2]{0,1})","g");d.expand=function(a){a=a.replace(m,function(a){return g[a]});return a.replace(h,function(f){var a=f.charCodeAt(0)-o,b=Math.floor(a/588),d=Math.floor((a-b*588)/28),c=a%28;return e(b+i)+e(d+j)+(c?e(c+k):"")})};d.highlight=function(c,g){var b=f(d.expand(c),d.expand(g),0);return b.replace(n,function(b){return b.replace(a,"")+(b.match(a)?a:"")}).replace(p,function(a){var b=a.charCodeAt(0)-i,c=a.charCodeAt(1)-j,d=a.length>2?a.charCodeAt(2)-k:0;return e(b*588+c*28+d+44032)})};d.match=function(a){return a.match(h)};function e(a){return String.fromCharCode(a)}function l(){var a=["(["];for(var b in g)a.push(b);a.push("])");return new RegExp(a.join(""),"g")}}}var a=b.Search.Helpers=new d;b.Search.Indexer=e;function e(s){var b=this,d=null,k=/\s+/g,c=s,r=c.comparer,e=c.matchField;b.autoCompleteTokens=[];b.getMatches=function(u,D){m(u);var s=l(u),k=[],q=null,b=null,a;if(s=="")return {result:[],query:u};q=h(s);for(a=0;a<q.length;a++){b=q[a];k.push({obj:b.obj,weight:e(b.obj).toLowerCase()==s?b.weight+1.5:b.weight,bucket:0})}var r=s.split(" ");if(r.length>1)for(a=0;a<r.length;a++){q=h(r[a]);for(var x=0;x<q.length;x++){b=q[x];k.push({obj:b.obj,weight:b.weight-.1*Math.abs(a+1-b.order),bucket:a+1})}}var i=[];if(k.length){var A=c.compareParents?[o]:[];A.addRange([g,n]);k.sort(f(A));var d=null,t=null,w=null,v=null,C=r.length>1?r.length:0,z=function(a){d=a;t=d.bucket;w=t==0?0:1},B=function(){(!v||c.isValid(v.obj,d.obj))&&w==C&&i.push(v=d)};z(k[0]);for(a=1;a<k.length;a++){b=k[a];if(g(d,b)){B();z(b)}else{d.weight=d.weight+b.weight;if(t!=b.bucket){t=b.bucket;w++}}}B()}i.sort(f([p,j]));i.length=Math.min(i.length,D);var y=new Array(i.length);for(a=0;a<i.length;a++)y[a]=i[a].obj;return {result:y,query:u}};function f(a){return function(d,e){var c=0,b=0;while(c<a.length&&!(b=a[c++](d,e)));return b}}function o(a,b){return c.compareParents(a.obj,b.obj)}function n(a,b){return a.bucket-b.bucket}function g(a,b){return r(a.obj,b.obj)}function j(a,b){return e(a.obj).length-e(b.obj).length}function p(a,b){return b.weight-a.weight}function m(d){var a=0,c;while(a<b.autoCompleteTokens.length){c=i(b.autoCompleteTokens[a]);if(d.indexOf(c)==-1)b.autoCompleteTokens.splice(a,1);else{d=d.replace(c,"");a++}}}function i(a){return a}function l(a){a=q(a);return a.toLowerCase().trim().replace(k," ")}function q(a){for(var c=0;c<b.autoCompleteTokens.length;c++)a=a.replace(i(b.autoCompleteTokens[c]),"");return a}function h(b){return d.matchPrefix(a.accent.fold(a.korean.expand(b)))}b.initialize=function(f){d=new $Trie;for(var b=0;b<f.length;b++){var h=c.getKeysAndWeights(f[b]);for(var g=0;g<h.length;g++){var e=h[g];d.insert(a.accent.fold(a.korean.expand(e.key.toLowerCase().trim())),{obj:f[b],weight:e.weight,order:e.order})}}d.sort()}}$Do.register("wlxsearchshared")})();(function(){var c=window,e=c.wLive,a="@",b="#";e.ContactList.Core.AlphabetHelper=d;function d(){var d=this,e=[],f=[],h,g=c.$Config.ContactListV2;function i(){if(g){var d=g.alphabet;if(d){f.push(b);e[b]=-1;for(var j=0;j<=9;j++)e[j.toString()]=-1;var i=0;for(var c=0,l=d.length;c<l;c++){var k=d[c];f.push(k);e[k]=c;i++}e[a]=i;f.push(a);h=i}}}d.getAlphabetLetter=function(d){var c;if(d===undefined||d.length===0)c=a;else{c=d.substring(0,1).toUpperCase();if(e[c]===undefined)c=a;else if(c>="0"&&c<="9")c=b}return c};d.compareString=function(b,c,a){var f=e[d.getAlphabetLetter(b)],g=e[d.getAlphabetLetter(c)];if(f>g)return a?-1:1;else if(f<g)return a?1:-1;else if(b>c)return a?-1:1;else if(b<c)return a?1:-1;else return 0};d.getAlphabet=function(){return f};d.getDigitsLetter=function(){return b};d.getNonAlphabetLetter=function(){return a};d.getLetterHtml=function(b){if(b!==a)return b.encodeHtml();else return '<span class="GlobeIcon cl_ImgStrip">&nbsp;</span>'};i()}})();(function(){var b=window,g=b.wLive,a=b.jQuery,c="Hidden",e="<div>",d="click";g.ContactList.Controls.LetterPicker=f;function f(k,m,h){var f=this;f.$=a(f);var p=m.getAlphabet(),q=a("body");if(h)var i=a(e).addClass(c).addClass("UI_Dialog_BG").css({position:"absolute",width:a(b).width(),height:a(b).height()}).appendTo(q);var g=a(e).addClass(c).addClass("LetterPickerContainer").css(a.extend({overflow:"auto",position:"absolute"},l())).appendTo(q),j=a(e).addClass("LetterPicker");sutra(g,"$Sutra.Shared.ContactsLetterPicker");g.append(j);j.delegate(".Enabled",d,n);if(h)i.bind(d,o);function r(){if(h)i.addClass(c);g.addClass(c)}function o(){f.close()}function s(f){var c=[];for(var d=0,g=p.length;d<g;d++){var e=p[d];if(d%4===0&&d!==0)c.push('<div style="clear:both"></div>');c.push('<div class="Letter ');if(f.indexOf(e)!==-1)c.push("Enabled t_bci");else c.push("Disabled");c.push('" title="'+e.encodeHtml()+'">');c.push(m.getLetterHtml(e));c.push("</div>")}j.html(c.join(""));if(b.$Sutra)a(".Letter",j).each(function(){sutra(a(this),"$Sutra.Shared.ContactsLetterPickerLetter")})}f.show=function(a){s(a);f.resize();if(h)i.removeClass(c);g.removeClass(c)};f.close=function(){r();f.$.triggerHandler("close",null)};f.resize=function(){if(h)i.css({width:a(b).width(),height:a(b).height()});g.css(l())};function n(c){r();var b=a(c.target).closest(".Letter").attr("title");f.$.triggerHandler("letterClick",{letter:b})}function l(){var a=k.offset();return {top:a.top,left:a.left,width:k.innerWidth(),height:k.innerHeight()}}f.dispose=function(){f.$.unbind();j.undelegate(".Enabled",d,n);if(h){i.unbind(d,o);i.remove()}g.remove()}}})();(function(){var b=window,d=b.wLive,a=b.jQuery;d.ContactList.Controls.LetterGridTile=c;function c(c,e,f,d,b){var a=this;a._letter=e;a._grid=f;a.uniqueId=c;a._layout=d;a._alphabetHelper=b}c.prototype={uniqueId:null,_grid:null,_$container:null,_layout:null,_top:-1,_left:-1,_letter:"",itemsCount:0,render:function(f,d,c){var a=this;if(a._$container){if(d!==a._top||c!==a._left){a._$container.css({top:d+"px",left:c+"px"});a._top=d;a._left=c}a._renderUpdates()}else{a._onBeforeRender();a._$container=a._grid.createTile(a.uniqueId,d,c,a._getHtml(),a._getCssClasses(),a._getStyles());a._top=d;a._left=c;if(b.$Sutra)a._setupSutraTags()}},_onBeforeRender:a.noop,_renderUpdates:a.noop,_getHtml:function(){var a=this;return '<div class="Letter t_bci">'+a._alphabetHelper.getLetterHtml(a._letter)+"</div>"},_setupSutraTags:function(){var b=this;sutra(a(".Letter",b._$container),"$Sutra.Shared.ContactsListLetterTile")},_getCssClasses:a.noop,_getStyles:a.noop,click:function(){var a=this;a._layout.showLetterPicker()},remove:function(){var a=this;if(a._$container){a._$container.empty();a._$container=null}a.dispose()},dispose:a.noop}})();(function(){var c=window,b=c.wLive,a={};b.cpThrottle=function(b,c,d){if(a[b])clearTimeout(a[b]);a[b]=setTimeout(function(){d();delete a[b]},c)}})();(function(){var m=window,h=m.jQuery,b=m.wLive=m["wLive"]||{},d=b.ContactPickerV2=b["ContactPickerV2"]||{};d.ViewModels=b.ContactPickerV2["ViewModels"]||{};d.Controls=b.ContactPickerV2["Controls"]||{};var a,i,o,p,f,e,g,c,q,n;$Do.when("wlxcontacts",0,function(){a=b.Contacts.WLXContactsSchema;i=a.person.emails;_schemaPersonPhones=a.person.phones;o=a.person.nickName;p=a.contact.emails;f=a.category;e=a.group;g=a.email;c=a.phone;q=[g.personal,g.work,g.other];n=[c.mobile,c.home,c.home2,c.work,c.work2]});var l=d.ViewModels.ContactType=new $Flags("Person",0,"Category",1,"Group",2,"PicwEmail",3),k=d.ViewModels.DisplayNameType=new $Flags("Nickname",0,"Email",1,"Phone",2),j="DisplayNameType",r={sortOrder:null,displayOrder:null,includeMeContact:true};d.ViewModels.Factory=s;function s(a,w){var x=this,d=h.extend({},r,w||{});function q(c){var b=a.getPersonHelper(c),d={Id:b.getId(),Cid:b.getCid(),HexCid:b.getHexCid(),Name:b.getOrderedName()||a.getFullName(c),Company:b.getCompanyName(),NickName:c[o],Phone:g(c[_schemaPersonPhones],n),UserTile:b.getUserTileMedium(),IsFavorite:b.getIsFavorite(),CategoryIds:b.getCategoryIds(),WlxObject:c};return d}function m(b){var c,f,h,u=b.WlxObject,e=a.getPersonHelper(u);if(!(c=b["Name"]))if(!(c=b["NickName"]))if(!(c=b["Company"]))if(!(c=b["Email"])){if(!!(c=b["Phone"]))b[j]=k.Phone}else b[j]=k.Email;else h=e.getYomiCompanyName();else b[j]=k.Nickname;else{var g=e.getNameType()||a.getDefaultNameType(),i=a.isLastNameFirstForNameType(g),r=!i&&d.sortOrder,q=!i&&d.displayOrder,o=e.getFirstName(),p=e.getLastName(),m=e.getYomiFirstName(),n=e.getYomiLastName(),l=!!(m||n),s=l?m:o,t=l?n:p;h=a.formatName(g,r?"sortNameReverse":"sortName",null,s,null,t,null);f=a.formatName(g,q?"displayNameReverse":"displayName",null,o,null,p,null)}f=f||c;b["ListDisplayName"]=f;b["DisplayName"]=c;b["SortName"]=(h||f).toLowerCase()}function g(d,c){if(d){var b=null;for(var a=0,e=c.length;a<e;a++){b=d[c[a]];if(b)break}}return b}function v(c,d){var a=h.extend({},c,{Email:d,Type:l.Person});m(a);return new b.ContactPickerV2.ViewModels.Contact(a)}function t(f,s){if(!a.isHiddenContact(f)&&(d.includeMeContact||!a.isMeContact(f))){var r=q(f),k=a.getPersonHelper(f),m=k.getPassportMemberName(),o=k.getContacts()||[],e=[],n={},b=0,g,j;if(m)e.push(m);if(h.isArray(f[i]))e=e.concat(f[i]);j=o.length;for(b=0;b<j;b++){var l=o[b][p];if(h.isArray(l))e=e.concat(l)}j=e.length;for(b=0;b<j;b++){g=e[b];if(g&&!n[g]){c(v(r,g),s);n[g]=true}}}}function c(a,c){var d=c.emailHash,b=a.email();c.contacts.push(a);c.idHash[a.clientId()]=a;if(b){b=b.toLowerCase();if(!d[b])d[b]=a}}function s(a,e){var d=a[f.name];c(new b.ContactPickerV2.ViewModels.Contact({Id:a[f.id],Type:l.Category,IsFavoriteCategory:a[f.isFavorite],DisplayName:d,ListDisplayName:d,SortName:d,WlxObject:a}),e)}function u(a,f){var d=a[e.name];c(new b.ContactPickerV2.ViewModels.Contact({Id:a[e.id],Cid:a[e.cid],HexCid:a[e.hexCid],Type:l.Group,DisplayName:d,ListDisplayName:d,SortName:d,WlxObject:a}),f)}x.createContacts=function(){var b={contacts:[],emailHash:{},idHash:{}},d=a.persons,e=a.groups,c=a.categories;for(var f=d.length;f--;)t(d[f],b);for(var g=e.length;g--;)u(e[g],b);for(var h=c.length;h--;)s(c[h],b);return b}}})();(function(){var b=window,f=b.jQuery,e=b.wLive,d=Number.MAX_VALUE,c=e.ContactPickerV2;c.ViewModels.Contact=a;function a(f){var b=this;b.model=f;b.$model=jQuery(b.model);function e(){if(b.model["PicwOrder"]===undefined)b.model["PicwOrder"]=d}function c(c,a){if(a===undefined)a=b.model[c];else jQuery.observable(b.model).setProperty(c,a);return a}b.type=function(){return c("Type")};b.clientId=function(){return b.email()+":"+b.id()+":"+b.type()};b.id=function(){return c("Id")};b.cid=function(){return c("Cid")};b.hexCid=function(){return c("HexCid")};b.displayName=function(){return c("DisplayName")};b.listDisplayName=function(){return c("ListDisplayName")};b.name=function(){return c("Name")};b.company=function(){return c("Company")};b.nickName=function(){return c("NickName")};b.sortName=function(){return c("SortName")};b.picwOrder=function(a){return c("PicwOrder",a)};b.email=function(){return c("Email")};b.userTile=function(a){return c("UserTile",a)};b.isFavorite=function(){return c("IsFavorite")};b.isFavoriteCategory=function(){return c("IsFavoriteCategory")};b.categoryIds=function(){return c("CategoryIds")||[]};b.isSelected=function(a){return c("IsSelected",a)};b.bindPropertyChange=function(a){b.$model.bind("propertyChange",a)};b.unbindPropertyChange=function(a){b.$model.unbind("propertyChange",a)};b.equals=function(c){return c instanceof a&&c.id()===b.id()};b.dispose=function(){b.$model.unbind()};e()}})();(function(){var b=window,e=b.jQuery,d=b.wLive,a=d.ContactPickerV2;a.ViewModels.SelectedContact=c;function c(f,e){var c=this;function g(){c.model={};if(f){c.model.DisplayName=f.name();c.model.Email=f.email();if(!e||!c.model.Email)c.model.SelectionText=f.raw()}if(e){if(e.displayName()){c.displayName(e.displayName());if(!c.model.SelectionText&&!c.model.Email)c.selectionText(e.displayName())}if(e.email())c.email(e.email());c.contact(e)}c.$model=jQuery(c.model);c.model.Error=c.contactRequiresEmail()&&!c.model.Email}function d(b,a){if(a===undefined)a=c.model[b];else jQuery.observable(c.model).setProperty(b,a);return a}c.id=function(a){return d("Id",a===undefined?a:a.toString())};c.displayName=function(a){if(arguments.length===0)if(c.model["DisplayName"])return d("DisplayName",a);else if(c.model["Email"])return d("Email",a);else return d("SelectionText",a);return d("DisplayName",a)};c.userTileHtml=function(){var b="",a=c.contact();if(a&&a.userTile()){var d=$ic.ic.createICFromTemplate("CPV2_addressWell",0,0,0,0,a.hexCid(),a.cid(),"","","",a.userTile(),"",0,0,0,0);b=d.html}return b};c.selectionText=function(a){if(arguments.length===0&&!c.model["SelectionText"])return c.model["Email"];return d("SelectionText",a)};c.email=function(a){return d("Email",a)};c.editing=function(a){return !!d("Editing",a)};c.error=function(a){return !!d("Error",a)};c.contact=function(a){return d("Contact",a)};c.isCategory=function(){var b=c.contact();return !!(b&&b.type()===a.ViewModels.ContactType.Category)};c.isGroup=function(){var b=c.contact();return !!(b&&b.type()===a.ViewModels.ContactType.Group)};c.contactRequiresEmail=function(){return !(c.isCategory()||c.isGroup())};c.isSameContact=function(b){var a=c.contact();return !!(a&&a.equals(b&&b.contact()))};c.tooltip=function(){var d;if(c.error())d=b.$Config.ContactPickerV2.InvalidAddress;else{var a=c.displayName(),e=c.email();d=e&&a!==e?a+" <"+e+">":a}return d};c.bindPropertyChange=function(a){c.$model.bind("propertyChange",a)};c.unbindPropertyChange=function(a){c.$model.unbind("propertyChange",a)};c.errorClass=function(){return c.error()?"cp_error":""};c.ctnrDivClass=function(){return c.isCategory()?"cp_ctnrExp":"cp_ctnr"};g()}})();(function(){var f=window,d=f.jQuery,j=f.wLive,h=new wLive.ContactList.Core.AlphabetHelper,c=f.$WLXContacts,a=j.ContactPickerV2,b=a.ViewModels.SortHelpers={alphabeticalComparer:function(a,b){return h.compareString(a.sortName(),b.sortName(),false)},picwComparer:function(a,b){return a.picwOrder()-b.picwOrder()},picwAlphaComparer:function(c,d){var a=b.picwComparer(c,d);return a!==0?a:b.alphabeticalComparer(c,d)}};a.ViewModels.FlatContactsDataModel=g;var e=g.Events={initialize:"initialize"},i={sortOrder:null,displayOrder:null,picwEmails:[],createContactsFromUnmatchedPicwEmails:true,maxPicwEntries:0,includeMeContact:true};function g(w){var f=this;f.$=d(f);var j=d.extend({},i,w),t=null,g=[],s=[],r=[],p=j.picwEmails,q={},o={},n=false,k=null,l=j.maxPicwEntries;function m(){if(!k)v();else{var a=k.createContacts();g=a.contacts.sort(b.alphabeticalComparer);o=a.emailHash;q=a.idHash;t=c.syncKey;u();f.$.triggerHandler(e.initialize)}}function v(){if(!k&&!n){n=true;c.callWhenReady(function(){k=new wLive.ContactPickerV2.ViewModels.Factory(c,{sortOrder:j.sortOrder,displayOrder:j.displayOrder,includeMeContact:j.includeMeContact});n=false;m()})}}function u(){var d=[],h=g.clone(),k=p||[];for(var c=0;c<k.length;c++){var e=k[c].toLowerCase(),f=o[e];if(f){f.picwOrder(c);if(l===0||d.length<l)d.push(f)}else if(j.createContactsFromUnmatchedPicwEmails){var i=new a.ViewModels.Contact({Id:c,Type:a.ViewModels.ContactType.PicwEmail,DisplayName:e,Email:e,SortName:e,PicwOrder:c});if(l===0||d.length<l)d.push(i);h.push(i)}}s=d;r=h.sort(b.picwAlphaComparer)}f.doWhenInitialized=function(a){if(k)a();else{var b=function(){f.$.unbind(e.initialize,b);a()};f.$.bind(e.initialize,b)}};f.dispose=function(){f.$.unbind()};f.reinitializeIfStale=function(){if(k&&c.syncKey!==t)m()};f.setPicwEmails=function(a){if(a.join(";")!==p.join(";"))f.doWhenInitialized(function(){p=a;m()})};f.getAlphabetHelper=function(){return h};f.getContactsByCategory=function(c){var a=[],b={};d.each(g,function(g,e){var f=e.id();if(!b[f]&&d.inArray(c,e.categoryIds())!==-1){a.push(e);b[f]=true}});return a};f.getContactByClientId=function(a){return q[a]};f.getContactByEmail=function(a){if(!a)return;return o[a.toLowerCase()]};f.getContactByName=function(a){if(!a||a==="")return;a=a.toLowerCase();for(var b=0,e=g.length;b<e;b++){var d=g[b].name()||"",c=g[b].displayName()||"";if(a===d.toLowerCase()||a===c.toLowerCase())return g[b]}};f.getContacts=function(){return g.clone()};f.getPicwContacts=function(c,b){var a=s.clone();if(jQuery.isArray(b)){var f={};for(var e=0;e<b.length;e++)f[b[e].clientId()]=b;var g=[];for(var d=0;d<a.length;d++)if(!f[a[d].clientId()])g.push(a[d]);a=g}if(c&&c>0&&a.length>c)a=a.splice(0,c);return a};f.getMergedContacts=function(){return r.clone()};m()}})();(function(){var f=window,j=f.jQuery,e=f.wLive||{},d=/(?:[<"]\s*)?[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?(?:\s*[>"])?/i,g=/^[<"]?([^<>"]*)[>"]?$/,b=/[,;](?=(?:[^"]*"[^"]*")*(?![^"]*"))/,a={None:0,Quoted:1,Bare:2,Bracketed:3},c=e.ContactPickerV2=e["ContactPickerV2"]||{};wLive.ContactPickerV2.EmailAddressParser=h;function h(i){var b=this,e={};function h(){f(i)}function c(b,a){if(a===undefined)a=e[b];else jQuery.observable(e).setProperty(b,a);return a}b.email=function(a){return c("Email",a)};b.name=function(a){return c("Name",a)};b.raw=function(a){return c("Raw",a)};function f(f){var t,e;b.raw(f);if(!f)return;f=f.trim();var s=new RegExp(d.source,"gi"),j,m=a.None,h=a.None;while((currMatch=s.exec(f))!=null){var k=currMatch[0],n=k.charAt(0),p=k.charAt(k.length-1);if(n==="<"&&p===">")h=a.Bracketed;else if(n==='"'&&p==='"')h=a.Quoted;else h=a.Bare;if(h>m){j=currMatch;m=h;if(h===a.Bracketed)break}}var c=f;if(j){e=j[0];var l=j.index,o=l+e.length,q=l>0?f.substr(0,l).trim():"",i=o<f.length?f.substr(o):"",r=g.exec(e);e=r[1];if(e.charAt(0)==="'"&&i&&i.charAt(0)==="'"){e=e.slice(1);i=i.slice(1).trim()}c=q===""?i:q;b.email(e.trim())}c=c.replace(/^\s*"\s*/,"").trim();if(c.length>1&&c.charAt(c.length-2)!=="/")c=c.replace(/\s*"$/,"");c=c.replace(/\//g,"");if(c!==""&&c!==e)b.name(c)}h()}c.EmailAddressParser.isValidEmailSyntax=function(a){if(!a)return false;return !!d.exec(a.trim())};function i(d){var a=d.split(b);for(var c=a.length-1;c>=0;c--){a[c]=a[c].trim();if(a[c].length===0)a.splice(c,1)}return a}wLive.ContactPickerV2.EmailAddressParser.parse=function(e){if(!e)return [];var d=i(e),b=[];for(var a=0,f=d.length;a<f;a++)b.push(new c.EmailAddressParser(d[a]));return b};wLive.ContactPickerV2.EmailAddressParser.endsWithDelimiter=function(c){if(c){var a=c.split(b);return !a[a.length-1].trim()}else return false}})();(function(){var f=window,a=f.jQuery,e=f.wLive,c=e.ContactPickerV2;c.ViewModels.ContactPickerModel=d;var b=d.Events={initialize:"initialize",selectedContacts:"selectedContacts",deselectedContacts:"deselectedContacts",editedContact:"editedContact",refreshedContacts:"refreshedContacts",freeformContactRejected:"freeformContactRejected",duplicateContactRejected:"duplicateContactRejected",tooManyContactsRejected:"tooManyContactsRejected"},g={allowDuplicateSelection:true,selectionMaximum:0,allowFreeformEntry:true,autoExpandCategories:false,errorOnDomains:"home.com;attbi.com;example.com;hotmail.co;yaho.com;hotmai.com;yahoo.co;yahoomail.com;direcway.com;homail.com;ims-ms-daemon;local.transport;ethome.net.tw;ethome.net.tw;hotmil.com;hotmial.com;yhoo.com;collegeclub.com;sbcglobal.com;hotamil.com;yaoo.com;yahoo.net;yhaoo.com;mail.hotmail.com;passport.com;kimo.com.tw;yahooo.com;yahho.com;ol.com;gateway.net;hotmail.com.mx;otmail.com;htomail.com;aol.co;altavista.com;hotmaill.com;taiwan.com;hotmail.con;ahoo.com;hotmail.om;hotmail.net;hormail.com;hotail.com;hotamail.com;yahoo.om;homtail.com;msn.net;sprint.ca;angelfire.com;cm1.ethome.net.tw;yohoo.com;a0l.com;alo.com;msn.de;gmail.co"};function d(u,w,t){var d=this;d.$=a(d);var h=u,i={},f=[],y=0,o,k={},x=Math.random().toString();d.getAlphabetHelper=function(){return h.getAlphabetHelper()};d.getContactList=function(){return h.getContacts()};d.getMergedContactList=function(){return h.getMergedContacts()};d.getPicwContactList=function(b,a){return h.getPicwContacts(b,a)};d.selectContacts=function(c,h,g){if(!a.isArray(c))c=[c];h=typeof h==="number"?h:f.length;var e=[],k=[],j=[],m=[],n=i.selectionMaximum;if(i.autoExpandCategories)c=s(c);a.each(c,function(b,a){if(!i.allowFreeformEntry&&!a.contact())k.push(a);else if(!i.allowDuplicateSelection&&r(a))j.push(a);else if(n>0&&f.length+e.length>=n)m.push(a);else{a.id(++y);a.bindPropertyChange(l);e.push(a)}});if(e.length>0){a.observable(f).insert(h,e);d.$.triggerHandler(b.selectedContacts,{model:d,contacts:e,context:g})}if(k.length>0)d.$.triggerHandler(b.freeformContactRejected,{model:d,contacts:k,context:g});if(j.length>0)d.$.triggerHandler(b.duplicateContactRejected,{model:d,contacts:j,context:g});if(m.length>0)d.$.triggerHandler(b.tooManyContactsRejected,{model:d,contacts:m,context:g});return e};d.addSelectedContact=function(a,e,b){var f=j(a.email(),a.name());selectedContact=new c.ViewModels.SelectedContact(a,f);selectedContact.error(selectedContact.contactRequiresEmail()&&!selectedContact.email());return d.selectContacts(selectedContact,e,b)};d.modifySelectedContact=function(c,b,f){var a=b.contact();if(!a)a=j(c.email(),c.name());var d,e;if(c){d=c.name();e=c.email();b.selectionText(c.raw())}b.displayName(a&&a.displayName()?a.displayName():d);if(f&&d)b.displayName(d);b.email(a&&a.email()?a.email():e);b.error(p(b));b.contact(a)};d.refreshContacts=function(){n()};d.contactExists=function(a){if(!a)return false;var b=j(a.email(),a.name());return !!b};d.getContactsByCategory=function(a){return h.getContactsByCategory(a)};d.getContactsByCategoryContact=function(a){var c=a.contact(),b=c.id();return d.getContactsByCategory(b)};d.deselectContactByIndex=function(c){var e=null;if(c>=0){selectedContact=f[c];selectedContact.unbindPropertyChange(l);a.observable(f).remove(c,1);d.$.triggerHandler(b.deselectedContacts,{model:d,contacts:[selectedContact]})}return e};d.deselectContactBySelectedContactId=function(a){return d.deselectContactByIndex(d.indexOfSelectedContactId(a))};d.indexOfSelectedContactId=function(c){var b=-1;a.each(f,function(d,a){if(c===a.id()){b=d;return false}});return b};d.getSelectedContactByIndex=function(a){return f[a]};d.getSelectedContactById=function(a){return d.getSelectedContactByIndex(d.indexOfSelectedContactId(a))};d.selectedContacts=function(a){var b=a?f:f.clone();return b};d.countSelected=function(){return f.length};d.serializeSelection=function(){var b=[];a.each(f,function(d,a){if(a.isCategory()||a.isGroup())b.push('"'+a.displayName()+'"');else{var c=a.displayName().replace('"','\\"');if(a.email())b.push('"'+c+'" <'+a.email()+">");else b.push(c)}});return b.join("; ")};d.dispose=function(){for(var a=0;a<f.length;a++)f[a].unbindPropertyChange(l);d.$.unbind();h.$.unbind(c.ViewModels.FlatContactsDataModel.Events.initialize,m);f=null;h=null};function v(){i=a.extend({},g,w);a.each(t||[],function(b,a){d.selectContacts(a)});o=i.errorOnDomains.split(";");h.$.bind(c.ViewModels.FlatContactsDataModel.Events.initialize,m)}function j(a,b){return a?h.getContactByEmail(a):h.getContactByName(b)}function m(){for(var e=0,g=f.length;e<g;e++){var a=f[e];if(!a.contact()){contact=j(a.email(),a.displayName());if(contact)d.modifySelectedContact(new c.EmailAddressParser(a.selectionText()),a,true)}}d.$.triggerHandler(b.initialize)}function r(c){var b=false;a.each(f,function(d,a){if(c.isSameContact(a)){b=true;return false}});return b}function q(b){var c=b.lastIndexOf("@"),d=b.substring(c+1).trim().toLowerCase();return a.inArray(d,o)!==-1}function p(a){var b=a.email();return a.contactRequiresEmail()&&!b||!a.contact()&&q(b)}function l(g,f){var c=g.target.Id,a=d.getSelectedContactById(c);d.$.triggerHandler(b.editedContact,{model:d,contacts:[a],contact:a,change:f});k[c]=a;e.cpThrottle("cpRefreshDirty"+x,20,n)}function n(){var c=[];for(var g in k){var h=k[g],e=d.indexOfSelectedContactId(g);a.observable(f).move(e,e,1);c.push(h)}k={};d.$.triggerHandler(b.refreshedContacts,{model:d,contacts:[c]})}function s(h){var a=[];for(var e=0;e<h.length;e++){var b=h[e];if(b.isCategory()){var g=d.getContactsByCategoryContact(b);for(var f=0;f<g.length;f++)a.push(new c.ViewModels.SelectedContact(null,g[f]))}else a.push(b)}return a}v()}})();(function(){var a=window,i=a.jQuery,f=a.wLive,b=f.ContactPickerV2,e="CL_Hov",g="CL_Sel",h=a.$Config.imgsBase+"ic/groupsnmxl.png",d=b.ViewModels.ContactType;b.Controls.ContactListTile=c;function c(e,b,d,c){var a=this;a._grid=e;a._contact=b;a.uniqueId=b.clientId();a._searchQuery=d;a._useListDisplayName=c}c.prototype={uniqueId:null,_grid:null,_$container:null,_top:-1,_left:-1,_isDirty:false,_contact:null,_pendingUpdates:null,_propertyChangeProxy:null,render:function(e,c,b){var a=this;if(a._$container){if(c!==a._top||b!==a._left){a._$container.css({top:c,left:b});a._top=c;a._left=b}a._renderUpdates()}else{a._onBeforeRender();a._$container=a._grid.createTile(a.uniqueId,c,b,a._getHtml(),a._getCssClasses(),a._getStyles());a._top=c;a._left=b}},_searchQuery:null,_onBeforeRender:function(){var a=this;a._propertyChangeProxy=function(c,b){a.onPropertyChange(c,b)};a._contact.bindPropertyChange(a._propertyChangeProxy)},_makeBold:function(c,b,a){return f.Search.Helpers.makeBold(c,b,a)},_addHiddenField:function(d,a,e){if(!a)return false;var c=this,b=c._makeBold(a,e,false);if(b!==c._makeBold(a,"",false)){d.fieldHtml=b;return true}else return false},_getHtml:function(){var a=this,c=a._contact,g=[],d=a._useListDisplayName?c.listDisplayName():c.displayName(),b=c.email()||"",e=null;if(d===b)b="";if(a._searchQuery){d=a._makeBold(d,a._searchQuery,false);var h=d!==a._makeBold(c.displayName(),"",false),f=b||"";b=a._makeBold(f,a._searchQuery,true);var j=b!==a._makeBold(f,"",true);if(!j&&!h){e={};a._addHiddenField(e,c.nickName(),a._searchQuery)||a._addHiddenField(e,c.company(),a._searchQuery)||a._addHiddenField(e,c.name(),a._searchQuery);if(!e.fieldHtml)e=null}}else{d=d.encodeHtml();b=b.encodeHtml()}g=i.render({displayNameHtml:d,userTileHtml:a._getUserTileHtml(),emailHtml:b,hidden:e,favoriteStyle:c.isFavorite()?"":"display: none"},"#cp_contactListTileTemplate");return g},_getUserTileHtml:function(){var a=this._contact,b=a.type()===d.Category||a.type()===d.Group?h:a.userTile(),c=$ic.ic.createICFromTemplate("CPV2_contactList",0,0,0,0,a.hexCid(),a.cid(),"","","",b,"",0,0,0,0);return c.html},_getCssClasses:function(){if(this._contact.isSelected())return ["CL_Sel"]},_getStyles:jQuery.noop,_renderUpdates:function(){var a=this;if(a._pendingUpdates){var b=a._pendingUpdates["IsSelected"];if(b!==undefined)a._$container.toggleClass(g,b);a._pendingUpdates=null}},onPropertyChange:function(c,b){var a=this;a._pendingUpdates=a._pendingUpdates||{};a._pendingUpdates[b.path]=b.value;if(a._grid.isVisible(a._top))a._renderUpdates()},mouseover:function(){this._$container.toggleClass(e,true)},mouseout:function(a){this._$container.toggleClass(e,false);this.triggerEvent(a,"mouseoutContact")},mousedown:function(a){this.triggerEvent(a,"mousedownContact")},click:function(a){this.triggerEvent(a,"clickContact")},triggerEvent:function(d,c){var a=this,e=jQuery(d.target,a._$container),b={contact:a._contact,tile:a};setTimeout(function(){a._grid.$.triggerHandler(c,b)},0)},remove:function(){var a=this;if(a._$container){a._$container.empty();a._$container=null}a.dispose()},dispose:function(){var a=this;if(a._propertyChangeProxy)a._person.unbindPropertyChange(a._propertyChangeProxy)},itemEquals:function(a){return this._contact.equals(a)}}})();(function(){var e=window,d=e.jQuery,a=e.wLive,g=".SearchControl",i="keyup"+g,h=9,c=a.ContactPickerV2;c.Controls.SearchResults=b;function b(){}b.prototype={contacts:[],query:""};c.Controls.SearchControl=f;function f(j,o,p){var c=this;c.$=jQuery(c);var g=d(j).delegate(o,i,m),f=false,e,q=new n;c.dispose=function(){g.undelegate();c.$.unbind();$container.empty()};c.getQuery=function(a){return d(a).val()};c.show=function(a){k(function(){var d=new b;d.query=a;if(a&&a!==""){var f=e.getMatches(a,25);d.contacts=f.result}else d.contacts=[];c.$.triggerHandler("search",d)})};function l(b){return a.Search.Helpers.getSuffixStringsFor(b)}function k(b){if(!f)$Do.when("wlxsearchshared",0,function(){f=true;e=new a.Search.Indexer(q);e.initialize(p.getMergedContactList());b()});else b()}function m(b){a.cpThrottle("SearchControl",100,function(){if(b.keyCode===h)return;var a=c.getQuery(b.target);c.show(a)})}function n(){var c=this;c.matchField=function(a){return a.displayName()};function d(a){return a.displayName()}function b(c,h,i,g){var e=[];if(c&&typeof c==="string"){var b;if(!g)b=l(c);else{b=[c];b.push(c.split("@")[1])}b[0]&&e.push(new a.Search.RankSearchKeyWeight(b[0],h,1));for(var d=1,j=b.length;d<j;d++){var f=b[d];if(f)e.push(new a.Search.RankSearchKeyWeight(f,i,d+1))}}return e}c.getKeysAndWeights=function(d){var a=[],c=1e6-d.picwOrder();a=a.concat(b(d.sortName(),c,c-1));a=a.concat(b(d.displayName(),c,c-1));a=a.concat(b(d.name(),c,c-1));a=a.concat(b(d.company(),c-1.5,c-2));a=a.concat(b(d.nickName(),c-1.5,c-2));a=a.concat(b(d.email(),c-2.25,c-2.5,true));return a};c.autoComplete=function(a){return d(a)};c.isValid=function(){return true};c.compareParents=null;c.comparer=function(d,e){var b=d.clientId(),c=e.clientId(),a=0;if(b>c)a=1;else if(b<c)a=-1;return a}}}})();(function(){var c=window,a=c.jQuery,bb=c.wLive,R={maxHeight:400,contactListBottomMargin:60,maxLinesInAddressWell:3,showContactListOnFocus:d,toggleContactListTransitions:null,numFrequentContactsShownLimit:0,excludeSelectedFromFrequentList:false,handleButtonFocus:false,$toggleButton:null},D=13,ab=188,U=c.KeyEvent?c.KeyEvent.DOM_VK_SEMICOLON:186,z=[ab,U],x=9,B=8,Y=46,C=37,S=39,W=38,T=40,Z=33,V=34,w=27,M=200,g=35,Q=35,P=60,q="cp_selected t_bci",G="CL_RelatedHidden",k="cp_primaryInput",A="cp_editInput",v="cp_anyInput",cb="cp_error",p="CL_Highlight t_bci",y="cp_textarea",u="Focus",H=".cpv2",L=".cp_clist",n=".cp_Contact",I="a.cp_exp",i="a.cp_ctBtn",K="a.cp_remBtn",N=".cp_inputArea",F=".CL_Related",O=".cp_textRuler",J="."+k,j="."+v,m="."+A,s=0,d=1,f=2,b=bb.ContactPickerV2,E=h.ListMode={none:s,related:d,full:f},o=h.DefaultTransitions={};o[s]=d;o[d]=f;o[f]=d;function X(b){for(var a in E)if(E[a]===b)return true;return false}var r=h.EntryPoints={relevancy:1,autocomplete:2,contactpicker:3,freeform:4},l=h.UserActionType={deleteContact:1,editContact:2,expandCategory:3,copy:4,paste:5},e=h.UserActionInput={none:0,mouse:1,key:2},t=h.Events={userAction:"userAction"};b.Controls.ContactPicker=h;function h(kc,Ic,Uc){var E=this,U=null,Wc=null,h=null,Fb=null,lb=[],jb="",eb=a.extend({},R,Uc||{}),pb=null,Ib=null,hb=null,gb=null,ab=null,fb=null,dc=null,lc=null,Xb=null,Gb=null,db={contact:null,$contactElt:null},rb=null,bc=105,bb=-1,cb=eb.showContactListOnFocus,kb=eb.$toggleButton,qb=null,zb=eb.handleButtonFocus,Jb=E.$=jQuery(E);E.createTile=function(a,c){return new b.Controls.ContactListTile(a,c,jb,cb===f&&!jb)};E.toggleContactList=function(a){Oc(a);E.setFocus(false)};E.hideContactList=function(){h&&h.closeLetterPicker();fb.toggle(false);bb=-1;cb=eb.showContactListOnFocus};E.addFreeformSelection=function(a){ab.val(a);Hb(ab)};E.refreshLayout=function(){Rb();ob()};E.setFocus=function(d){var b=nb();ob(b);b.focus();var a=b[0];if(a.createTextRange){var c=a.createTextRange();c.moveStart("character",a.value.length);c.collapse();c.select()}else{var e=a.value;a.value="";a.value=e}if(d)b.keyup()};E.completeUserEntry=function(){return Hb(ab)};E.hasIncompleteUserEntry=function(){return !!ab.val()};E.resetSettings=function(c){var d=eb;delete c.$toggleButton;eb=a.extend({},eb,c||{});Wb();var b=eb.showContactListOnFocus;if(b!==d.showContactListOnFocus&&b!==cb){cb=b;if(!jb&&Zb())ib()}E.refreshLayout()};E.dispose=function(){yb();hb.unbind();ab.unbind();fb.remove();uc();U.$.unbind(b.ViewModels.ContactPickerModel.Events.selectedContacts,Ab);U.$.unbind(b.ViewModels.ContactPickerModel.Events.refreshedContacts,Ab);U.$.unbind(b.ViewModels.ContactPickerModel.Events.initialize,fc);a(c).unbind("resize",Rb);if(kb&&zb)kb.unbind("keydown",ac)};function Sc(){Wb();U=Ic;U.$.bind(b.ViewModels.ContactPickerModel.Events.selectedContacts,Ab);U.$.bind(b.ViewModels.ContactPickerModel.Events.refreshedContacts,Ab);U.$.bind(b.ViewModels.ContactPickerModel.Events.initialize,fc);lb=U.getContactList();pb=a(kc);Ib=pb.find("."+y);pb.on("focusin",Ec).on("focusout",Bc).on("copy",Vc);wc();Jc();setTimeout(rc,0);a(c).bind("resize",Rb);if(kb&&zb)kb.bind("keydown",ac)}function Wb(){bc=Q*eb.maxLinesInAddressWell;var b=eb.maxHeight;if(typeof b==="object"||typeof b==="string")qb=a(b);else qb=null;if(!jQuery.isPlainObject(eb.toggleContactListTransitions))eb.toggleContactListTransitions=o}function Jc(){hb=a("<div/>",{"class":"cp_inputContainer"}).appendTo(pb).delegate(I,"click",Hc).delegate(K,"click",qc).delegate(i,"click",yc).delegate(i,"keydown",sc).delegate(i,"mousedown",mc).delegate(i,"mouseout",pc).delegate(i,"focusout",oc).delegate(n,"dblclick",Fc).delegate(j,"keyup",Mc).delegate(j,"paste",Nc).delegate(j,"keydown",Kc).delegate(J,$B.IE&&$B.V<=8?"focus":"focusin",Dc).link({selectedContacts:U.selectedContacts(true)},"#cp_inputTemplate");gb=hb.find(N);Gb=hb.find(O);ab=hb.find(j);var d=gc(Ib,true);ab.val(d);if(U.selectedContacts(true).length===0)ob(ab);else ub(ab);Fb=new b.Controls.SearchControl(kc,j,U);Fb.$.bind("search",Tc);if(c.document.activeElement===Ib[0])E.setFocus();Ib.hide()}function Hb(c){var b=a(c);gc(b);b.val("")}function wc(){fb=a("<div/>",{"class":"cp_clist"}).hide().html(a.render({},"#cp_contactListContainerTemplate")).appendTo(pb);sutra(fb,"$Sutra.Shared.ContactPicker");lc=fb.find(".VirtualizedGrid");dc=fb.find(".GridContainer");Xb=fb.find(F)}function ec(b){fb.show();Kb();h=new wLive.ContactList.Controls.VirtualizedGrid(lc,lb,E,{letterHeader:b,alphabetHelper:U.getAlphabetHelper(),itemClass:"CL_Row",containerHeight:a(window).height(),supportsHover:true,maxColumns:1,height:60,fadeBackground:false},null,fb);h.render();h.$.bind("clickContact",Gc);h.$.bind("clickLetter",xc);h.$.bind("mousedownContact",Ac);h.$.bind("mouseoutContact",Cc);setTimeout(function(){Bb()},0);Xb.toggleClass(G,!!(cb!==d||jb&&jb!==""));h.scrollTo(0);Yb()}function Rc(a,c){var b=0;while(a.length){if(a.charAt(0)===c)b+=1;a=a.slice(1)}return b}function nc(b){var h=a(b.target),i=h.val(),g=Rc(i,'"')%2,e=b.which===D&&!(b.ctrlKey||b.shiftKey),f=!e,c=e;if(!g&&!b.shiftKey)for(var d=0;d<z.length;d++)if(b.which===z[d]){c=true;break}if(c)ic(b,f);return c}function Tb(a,d){var c=false;if(!d){var b=a.val();if(b.length>0&&(bb<0||!h||b!==jb))Fb.show(b);$Do.when("wlxsearchshared",0,function(){if(bb>=0&&h){Qb(a,h.getTile(bb)._contact);c=true}})}$Do.when("wlxsearchshared",0,function(){if(d||!c){Hb(a);setTimeout(function(){E.setFocus(false);ib()},0)}})}function ic(b,c){Tb(a(b.target),c);b.stopPropagation()}function Vc(){Jb.triggerHandler(t.userAction,{type:l.copy,input:e.none})}function Nc(b){setTimeout(function(){Hb(b.target);ob(a(b.target));Jb.triggerHandler(t.userAction,{type:l.paste,input:e.none})},0)}function Mc(b){ob(a(b.target));var d=a(b.target).hasClass(k),c=d?a(b.target).val()==="":false;if(c&&b.keyCode==w){b.stopPropagation();return false}}function Vb(a){var e=a.hasClass(k),c=a.val();if(c.length===0)return [];var d=b.EmailAddressParser.parse(c);a.val("");ub(a);return d}function gc(a,i){var e=a.hasClass(k)||a.hasClass(y),m=sb(a),d=Vb(a),g="";if(i&&d.length>0&&!b.EmailAddressParser.endsWithDelimiter(a.val()))g=d.pop().raw();var c;if(!e)c=U.indexOfSelectedContactId(a.view().data.id());var j={entryPt:r.freeform};for(var f=0,l=d.length;f<l;f++){var h=U.addSelectedContact(d[f],c,j);if(!e&&h&&h.length>0)c++}if(!e)U.deselectContactByIndex(c);return g}function Lb(d,b){var a=d.data;if(!a||a.editing()===b)return;$selectedContactElt=Pb(gb,a.id());var c=$selectedContactElt.width();a.editing(b);setTimeout(function(){U.refreshContacts();if(b){var d=nb();d.css("min-width",c);ob(d);Fb.show(a.selectionText());E.setFocus(false)}},0);return a}function fc(){if(Zb())ib()}function Gc(e,a){if(!h)return;var c=a.contact,d=a.tile;if(ab.val()===""){wb(bb,h.getTileCount());bb=h.getTileIndex(d);Eb(bb)}var b=nb();Qb(b,c)}function xc(){E.setFocus()}function Ac(c,a){var b=a.tile;b._$container.toggleClass(p,true)}function Cc(c,b){if(!h)return;var a=b.tile;if(bb&&h.getTile(bb)!==a)a._$container.toggleClass(p,false)}function nb(){var a=hb.find(m);if(a.length===0)a=ab;return a}function sb(b){return a(b).closest(n)}function qc(b){var c=a.view(b.target).data;xb(c.id(),{input:e.mouse});b.preventDefault()}function yc(b){rb=a.view(b.target).data;b.preventDefault()}function mc(b){var c=a.view(b.target).data;if(!db||c!==db.contact){var d=sb(b.target);d.addClass(q)}}function pc(b){var c=a.view(b.target).data;if(!db||c!==db.contact){var d=sb(b.target);d.removeClass(q)}}function oc(b){var a=sb(b.target);if(db.$contactElt&&a[0]===db.$contactElt[0])vb()}function Hc(c){var b=a.view(c.target).data;if(b.isCategory()){var d=b.id(),f=U.getContactsByCategoryContact(b);Qb(a(c.target),f,U.indexOfSelectedContactId(d));xb(d,{type:l.expandCategory,input:e.mouse})}c.preventDefault()}function Dc(b){vb();if(!tb()||jb!==a(b.target).val()||nb()[0]!==ab[0])ib()}function Ec(){if(!gb.hasClass(u))setTimeout(E.setFocus,0);gb.addClass(u)}function Bc(){setTimeout(function(){if(!document.activeElement||!Ob())gb.removeClass(u)},50)}function Kc(b){var e=a(b.target).hasClass(k),c=e?a(b.target).val()==="":false;switch(b.keyCode){case w:if(e)if(!c){setTimeout(function(){a(b.target).val("")},0);ib()}else{E.hideContactList();b.stopPropagation();return false}else{Lb(a.view(b.target),false);setTimeout(function(){E.setFocus(false);ib()},0)}break;case C:case B:if(c&&Mb()){b.stopPropagation();return false}break;case T:mb(1,true);b.stopPropagation();return false;case W:mb(-1,true);b.stopPropagation();return false;case V:if(h){mb(h.getTileCountPerPage(),true);b.stopPropagation();return false}break;case Z:if(h){mb(-h.getTileCountPerPage(),true);b.stopPropagation();return false}break;case x:var d=true;if(c)E.hideContactList();else{ic(b);d=false}if(!b.shiftKey&&!d){setTimeout(function(){E.setFocus(false);ib()},0);b.stopPropagation();return false}else if(b.shiftKey&&kb&&zb){setTimeout(function(){kb.focus()},0);b.stopPropagation();return false}break;default:return !nc(b)}}function ac(a){if(a.keyCode===x&&!a.shiftKey){E.setFocus(false);a.stopPropagation();return false}}function mb(d,f){if(!h)return false;var e=d/Math.abs(d),a=bb+d,b=h.getTileCount(),c=false,g;if(bb>0&&a<0)if(Eb(0)||bb===1)a=0;else a=1;else if(bb<b-1&&a>=b)a=b-1;while(0<=a&&a<b){if(Eb(a)){c=true;break}a+=e}if(c){wb(bb,b);bb=a}else if(f)if(e<0){wb(bb,b);bb=h.getTileCount();c=mb(-1,false)}else{wb(bb,b);bb=-1;c=mb(1,false)}return c}function Yb(){if(!h)return;var b=hb.find(m);if(b.length===0||c.document.activeElement===ab[0])if(ab.val()!==""){bb=-1;mb(1,false)}else{wb(bb,h.getTileCount());bb=-1}else{var d=b.view().data.contact();if(d){for(var a=lb.length-1;a>=0;a-=1)if(lb[a]===d){bb=a;Eb(a);break}}else{bb=-1;mb(1,false)}}}function Eb(a){if(!h)return;var c=false,b=h.getTile(a);if(!h.isItemVisible(a)){h.scrollTo(a);h.render()}if(b._contact&&b._$container){b._$container.toggleClass(p,true);c=true}return c}function wb(a,c){if(!h)return;if(0<=a&&a<c){var b=h.getTile(a);if(b._$container)b._$container.toggleClass(p,false)}}function sc(b){var d=a.view(b.target).data.id(),c={input:e.key};switch(b.keyCode){case B:Mb()||Nb()||E.setFocus(true);xb(d,c);b.stopPropagation();return false;case Y:Nb()||E.setFocus(true);xb(d,c);break;case C:Mb();break;case S:if(!Nb()){vb();E.setFocus(true)}break;case D:cc(b.target,c);break;case w:E.setFocus(true);break;case x:if(b.shiftKey&&kb&&zb){kb.focus();b.stopPropagation();return false}}}function rc(){a("BODY").bind("click",Db).bind("dblclick",Db)}function uc(){a("BODY").unbind("click",Db).unbind("dblclick",Db)}function Db(c){if(!c||!c.target)return;var d=c.target,b=a(d);if(b.closest(".LetterPickerContainer").length>0)return;if(b.closest(L).length>0)return;if(kb&&jc(kb[0],b[0])){if(nb()[0]===ab[0])E.completeUserEntry();else{Sb();setTimeout(function(){E.setFocus(false)},0)}return}if(b.hasClass(A)&&Ub(b))return;Sb();if(rb){E.completeUserEntry();setTimeout(function(){if(rb){Cb(rb,Pb(ab,rb.id()));rb=null}},0)}if(Ob())return;E.completeUserEntry();E.hideContactList()}function Sb(){var a=hb.find(m);if(a.length!==0)Tb(a,false)}function Ub(a){return jc(pb,a)}function jc(b,c){return a(c).closest(b).length===1}function Zb(){return tb()||Ob()}function tb(){return fb.css("display")!=="none"}function Ob(){return Ub(document.activeElement)}function Fc(a){cc(a.target,{input:e.mouse})}function cc(c,b){Lb(a.view(c),true);if(b)Jb.triggerHandler(t.userAction,a.extend({type:l.editContact,input:e.none},b))}function Qb(c,e,o){if(!c.hasClass(v))c=ab;var n=c.hasClass(k),q=sb(c),l=Vb(c),h;if(l.length>0)h=l[0];ub(ab);if(!a.isArray(e))e=[e];var g=0;if(!n){var j=Lb(c.view(),false);j.contact(e[0]);U.modifySelectedContact(h,j,false);g=1}var i=[];for(;g<e.length;g++)i.push(new b.ViewModels.SelectedContact(h,e[g]));var p=jb?r.autocomplete:cb===f?r.contactpicker:r.relevancy;U.selectContacts(i,o,{entryPt:p});var m=!(c[0]===ab[0]&&c.val()===0);c.val("");vb();setTimeout(function(){if(eb.excludeSelectedFromFrequentList&&cb===d)ib(true);E.setFocus(m);Bb()},0)}function xb(c,b){var f=U.getSelectedContactById(c);if(f===db.contact)db={};U.deselectContactBySelectedContactId(c);if(eb.excludeSelectedFromFrequentList&&cb===d)ib(true);ob();setTimeout(Bb,0);if(b)Jb.triggerHandler(t.userAction,a.extend({type:l.deleteContact,input:e.none},b))}function Cb(b,a){vb();db={contact:b,$contactElt:a};a.addClass(q);a.find(i).focus();E.hideContactList()}function vb(){if(db.$contactElt){db.$contactElt.removeClass(q);db={}}}function Mb(){var b=false;if(!db.contact||!db.$contactElt){var a=hc();if(a.contact&&a.$contactElt){Cb(a.contact,a.$contactElt);b=true}}else{var c=U.indexOfSelectedContactId(db.contact.id())-1;if(c>=0){var e=U.getSelectedContactByIndex(c),d=db.$contactElt.prev();Cb(e,d);b=true}}return b}function Nb(){if(!db.contact||!db.$contactElt)return false;var a=U.indexOfSelectedContactId(db.contact.id());if(a<U.selectedContacts(true).length-1){a+=1;var c=U.getSelectedContactByIndex(a),b=db.$contactElt.next();Cb(c,b);return true}else return false}function hc(){var c=U.selectedContacts(true),d=c.length-1,b=null,a=null;if(d>=0){b=c[d];a=Pb(ab,b.id());if(!a[0])a=hb.find(m).closest(n)}return {contact:b,$contactElt:a}}function Pb(a,c){var b=jQuery(a).closest(H);return b.find(n+"[cid='"+c+"']")}function Tc(g,a){if(c.document.activeElement&&nb()[0]===ab[0]){var f=jQuery(c.document.activeElement);if(!f.hasClass(v))return}var e=nb();if(e[0]!==ab[0]&&(cb===d||cb===s)&&e.val()===""){E.hideContactList();return}if(jb===a.query&&h&&tb())return;if(a.query==="")ib();else Lc(a.query,a.contacts.sort(b.ViewModels.SortHelpers.picwComparer));Yb()}function Ab(){setTimeout(function(){ob(ab)},0)}function ub(b,c){c=c||parseInt(b.css("min-width"),10)||0;var a=Math.max(c,Qc(b.val())),d=gb[0].clientWidth;if(d!==0)a=Math.min(a,d-g);b.width(a);return a}function ob(e){if(e)ub(e);if(!ab)return;var b=gb[0].clientWidth;if(b===0)return;var h=gb.position().left,a=h+b-g,c=hc();if(c.$contactElt){var d=c.$contactElt.position().left;if($B.rtl)a=d-g;else a-=d+c.$contactElt[0].clientWidth}var f=false;if(a<g){a=b-g;f=true}ab.width(0);a=ub(ab,a);gb.css("max-height",bc+"px");setTimeout(function(){if(f)a=gb[0].clientWidth-g;ab.width(0);ab.width(a);if(tb())Kb();zc()},0)}function zc(){var b=jQuery(c.document.activeElement).closest(j);b=b.length>0?b:ab;var a=b[0],e=gb.scrollTop(),d=0;if(a){while(a&&a!==gb[0]){d+=a.offsetTop;a=a.offsetParent}if(d<e||d>e+gb.height())gb.scrollTop(d)}}function Bb(){var a=vc(),b=Math.max(M,gb.innerWidth());fb.width(b);fb.height(a);a=tc(a);if(h)h.resize();return {width:b,height:a}}function vc(){var a=eb.maxHeight;if(qb&&qb.length>0){var g=parseInt(qb.css("padding-bottom"),10),e=pb.offset().top+pb.outerHeight()-qb.offset().top;a=qb.innerHeight()-e-g}else{var b=fb.outerHeight()-fb.innerHeight();a=a&&a>0?a-hb.outerHeight()-b:Number.MAX_VALUE;var c=$f.getLocation(hb[0]),d=$f.clientHeight(),f=c.addScrollTop!=-1?$f.scrollTop():0;a=Math.min(d+f-c.bottom-b-eb.contactListBottomMargin,a)}a=Math.max(P,a);return a}function tc(a){a=Math.min(a,dc.outerHeight());fb.height(a);return a}function Rb(){Bb()}function Qc(a){Gb.text(a);var b=Gb.innerWidth();Gb.text("");return b+g}function Kb(){c.$f.dockIt(fb[0],hb[0],0,-1,1)}function ib(i){var a=[],b=false;if(cb===s)b=true;else{var c=null;if(eb.excludeSelectedFromFrequentList&&cb==d){var g=U.selectedContacts();c=[];for(var e=0;e<g.length;e++){var h=g[e].contact();if(h)c.push(h)}}a=cb===d?U.getPicwContactList(eb.numFrequentContactsShownLimit,c):U.getContactList();jb="";if(a.length>0){if(i||!tb()||!Pc(a,lb)){yb();lb=a;ec(cb===f)}}else b=true}if(b){yb();lb=a;E.hideContactList()}}function Pc(a,c){var b=a===c;if(a&&c&&!b)if(a.length===c.length){b=true;for(var d=0;d<a.length;d++)if(a[d]!==c[d]){b=false;break}}return b}function Lc(b,a){yb();lb=a;jb=b;if(lb.length>0)ec(false);else E.hideContactList()}function yb(){h&&h.dispose();h=null;lb=null;bb=-1}function Oc(b){var a=nb(),c=a.length>0?a.val():ab.val(),d=cb;cb=typeof b==="undefined"?eb.toggleContactListTransitions[cb]:b;if(!X(cb))cb=f;if(c===""||cb===f)ib(cb!==d);else a.keyup();if(h){fb.show();Kb()}}Sc()}$Do.register("WLXContactPickerV2")})();(function(){var a=wLive.Core,h="change";a.ProcessItemSet=j;a.ProcessItemSet.updateEventName=h;a.ProcessItemSet.Type={Upload:1,Delete:2,Move:3,Copy:4,RemoteUpload:5,UpdateStatus:6};a.ProcessItemSet.State={Pending:1,Active:2,Completed:3,Error:4,Canceling:5};var c=a.ProcessItemSet.State,f=0;function j(c){var b=this;a.ItemSet.apply(this);b.key=++f;b.v=0;b.type=0;b.state=0;b.completedCount=0;b.completed=false;b.startTime=null;b.completedTime=null;b.totalErrorCount=0;b.errorOrgin=null;b.errorCount=0;b.errorMessage=null;b.errorFormatParams=null;b.errorCode=null;b.progress=0;b.data=null;b.operation=null;b._parentCollection=c;b.isVisible=true;b._filters.push(g)}a.ProcessItemSet.prototype=new wLive.Core.ItemSet;var b=a.ProcessItemSet.prototype,i=a.ItemSet.prototype;function d(a,b,d){if(d)e(a,null,null,null,false,null);if(a._parentCollection){if(!a.completed&&b){a._parentCollection._updateCompletedCount(true);a.progress=100;a.state=c.Completed;a.completedTime=(new Date).getTime()}else if(a.completed&&!b){a._parentCollection._updateCompletedCount(false);a.state=c.Pending;a.completedTime=null}a.completed=b}}function e(a,b,h,g,e,f){if(e)d(a,false,false);if(a._parentCollection){if(!a.errorMessage&&b){a.state=c.Error;a._updateErrorCount()}else if(a.errorMessage&&!b){a.state=c.Pending;a._updateErrorCount()}a.errorFormatParams=f;a.errorMessage=b;a.errorCode=h;a.errorOrgin=g}}b.setCompleted=function(a){d(this,a,true)};b.setError=function(b,d,c,a){e(this,b,d,c,true,a)};b.invalidate=function(){var a=this;i.invalidate.call(a);a.v++;if(a._parentCollection)a._parentCollection.invalidate()};b.add=function(c){var b=this;b.startTime=(new Date).getTime();c._setParent(b);a.ItemSet.prototype.add.apply(b,[c])};b.removeAt=function(e,c){var b=this,d=b.get(e,c);if(d){d.setError(null);d.setCompleted(false)}a.ItemSet.prototype.removeAt.apply(b,[e,c]);if(b.completedCount==b.getCount(c))b.setCompleted(true)};b._updateCompletedCount=function(b){var a=this;a.completedCount+=b?1:-1;a.setCompleted(a.completedCount==a.getCount(true))};b._updateErrorCount=function(){var a=this,d=a.getCount(true);if(d>0){a.totalErrorCount=0;a.errorCount=0;for(var b=0;b<d;b++){var e=a.get(b,true);a.totalErrorCount+=e.totalErrorCount;if(e.totalErrorCount>0)a.errorCount++}}else{a.errorCount=0;a.totalErrorCount=a.state==c.Error?1:0}if(a._parentCollection)a._parentCollection._updateErrorCount()};b._setParent=function(a){var b=this;b._parentCollection=a};function g(b){switch(b.type){case a.ProcessItemSet.Type.RemoteUpload:case a.ProcessItemSet.Type.Upload:return !b._parentCollection||!b._parentCollection._parentCollection&&b._parentCollection&&b.getCount(true)>0||b._parentCollection._parentCollection&&b.isVisible&&b.getCount(true)==0&&b._parentCollection;default:return !b._parentCollection||!b._parentCollection._parentCollection&&b._parentCollection&&b.getCount(true)>0||b.errorMessage&&b.isVisible&&b.getCount(true)==0&&b._parentCollection}}})();(function(){var c=wLive.Core,a=c.AleHelpers.getPCString,e=c.ProcessErrorActionsManager={},b=c.ProcessErrorActions={NameConflictOverwrite:{id:1,text:a("ProcessWindow.NameConflictOverwrite"),rollupText:a("ProcessWindow.NameConflictOverwriteAll")},NameConflictRename:{id:2,text:a("ProcessWindow.NameConflictRename"),rollupText:a("ProcessWindow.NameConflictRenameAll")},Retry:{id:3,text:a("ProcessWindow.Retry"),rollupText:a("ProcessWindow.RetryAll")},Unlock:{id:4,text:a("ProcessWindow.Unlock"),rollupText:a("ProcessWindow.UnlockAll")},MoveUnlock:{id:4,text:a("ProcessWindow.MoveUnlock"),rollupText:a("ProcessWindow.MoveUnlockAll")},CopyUnlock:{id:4,text:a("ProcessWindow.CopyUnlock"),rollupText:a("ProcessWindow.CopyUnlockAll")},DeleteUnlock:{id:4,text:a("ProcessWindow.DeleteUnlock"),rollupText:a("ProcessWindow.DeleteUnlockAll")},UploadUnlock:{id:4,text:a("ProcessWindow.UploadUnlock"),rollupText:a("ProcessWindow.UploadUnlockAll")}},d={"1000":[b.NameConflictOverwrite,b.NameConflictRename],"1012":[b.NameConflictRename],folder_1000:[b.NameConflictRename],"9001":[b.Unlock],Delete_9001:[b.DeleteUnlock],Move_9001:[b.MoveUnlock],Copy_9001:[b.CopyUnlock],up_1:[b.Retry],rup_1:[b.Retry]};e.getActionLinks=function(b,k){var a,e="";if(k)for(var j=0,l=b.getCount(true);j<l;j++){var c=b.get(j,true);if(c.errorCode)if(!a){a=c.errorCode;e=c.errorOrgin}else if(a!=c.errorCode){a=0;e="";break}}else{a=b.errorCode;e=b.errorOrgin}var h=null;if(a){var g=d[e+"_"+a]||d[a];if(g){h=[];for(var i=0;i<g.length;i++)h.push(f(g[i],b,k,a))}}return h};function f(b,a,c,d){return {text:c?b.rollupText:b.text,click:function(){var g=a.operation;if(c){var h=[];for(var e=0,i=a.getCount(true);e<i;e++){var f=a.get(e,true);if(f.errorCode==d)h.push(f)}g.handleErrorResolution(h,b)}else g.handleErrorResolution([a],b);return false}}}})();(function(){var a=wLive.Core,b=a.AleHelpers.getPCString;a.ProcessRow=m;var d=b("ProcessWindow.DismissRow"),h=b("ProcessWindow.RowCancelingText"),j=b("ProcessWindow.RowPendingText"),i=b("ProcessWindow.RowCompletedText"),g=b("ProcessWindow.RowUploadActiveText"),f=b("ProcessWindow.RowUploadActiveNoProgressText"),l="{".encodeHtml(),k="}".encodeHtml(),n='<div class="procr_cont"><div class="procw_dismissicon"><a href="#"></a>&nbsp;</div><div class="procr_fileicon">&nbsp;</div><div class="procr_filename"></div><div class="c_clr"></div><div class="procr_displayText"><span class="procr_text"></span></div><div class="procr_errorText"><span class="procr_error"></span><span class="procr_erroroptions"></span></div><div class="c_clr"></div></div>',c=a.ProcessItemSet.State,e=a.ProcessItemSet.Type;function m(z){var r=this;r.$container=z;var b=jQuery(n),F=jQuery(".procr_fileicon",b),B=jQuery(".procr_filename",b),x=jQuery(".procr_displayText",b),A=jQuery(".procr_errorText",b),G=jQuery(".procr_error",b),q=jQuery(".procr_text",b),p=jQuery(".procr_erroroptions",b),m=jQuery(".procw_dismissicon a",b),t=jQuery(".procw_dismissicon",b),w=a.ImageStrip.getImage("cancelRest",d);w.className+=" rest";var v=a.ImageStrip.getImage("cancelHover",d);v.className+=" hover";var u=a.ImageStrip.getImage("cancelActive",d);u.className+=" active";m.append(w).append(v).append(u);z.append(b);m.mousedown(function(){m.addClass("pressed")}).mouseup(function(){m.removeClass("pressed");$B.IE||y()}).click(y);var o,s;sutra(b,"$Sutra.SkyDrive.ProcessWindowRow");sutra(m,"$Sutra.SkyDrive.ProcessWindowRowDismiss");r.render=function(a){if(s!=a.v){o=a;s=a.v;var d=a.data;B.html(d.name.encodeHtml());B.attr("title",d.name);F.html(wLive.Core.SkyDriveItemHelper.getIcon(a.data,16));C();if(a.errorMessage){b.addClass("procr_error");G.html(D(a));p.empty();A.show();x.hide();E(a)}else{x.show();A.hide();b.removeClass("procr_error");switch(a.type){case e.RemoteUpload:case e.Upload:switch(a.state){case c.Canceling:q.html(h.format(a.progress));break;case c.Pending:q.html(j.format(a.progress));break;case c.Active:q.html((a.progress>=0?g:f).format(a.progress));break;case c.Completed:q.html(i.format(a.progress))}}}}};r.dispose=function(){m.unbind();p.find("a").unbind();p.empty();processItemSet=null};function D(b){var c=b.errorMessage.encodeHtml();if(b.errorFormatParams){var d=b.errorFormatParams,e=d.length;for(var a=0;a<e;a++){var f=l+a+k;c=c.replace(f,d[a])}}return c}function C(){var a=o._parentCollection.getCount(true);if(a>1&&(!o.completed||o.errorMessage))t.show();else t.hide()}function y(){var a=o.operation;a.abort();return false}function E(e){p.empty();var b=a.ProcessErrorActionsManager.getActionLinks(e,false);if(b)for(var c=0;c<b.length;c++){var d=b[c];p.append(jQuery('<button class="default">'+d.text.encodeHtml()+"</button>").click(d.click))}}}})();(function(){var c=wLive.Core,a=c.AleHelpers.getPCString;c.ProcessGroup=s;var b=c.ProcessItemSet.Type,v=a("expandicontooltip"),u=a("collapseicontooltip"),l=a("ProcessWindow.CopyMultipleFormat"),q=a("ProcessWindow.CopySingleFormat"),k=a("ProcessWindow.UploadMultipleFormat"),p=a("ProcessWindow.UploadSingleFormat"),i=a("ProcessWindow.DeleteMultipleFormat"),m=a("ProcessWindow.DeleteSingleFormat"),n=a("ProcessWindow.MoveMultipleFormat"),r=a("ProcessWindow.MoveSingleFormat"),j=a("ProcessWindow.UpdateMultipleFormat"),o=a("ProcessWindow.UpdateSingleFormat"),e=a("ProcessWindow.DismissGroup"),g=a("ProcessWindow.RowCompletedText"),f="{0}",h=f.encodeHtml(),d="procg_indeter",t='<div class="procg_cont"><div class="procg_header"><div class="procw_dismissicon"><a href="#"></a>&nbsp;</div><div class="procg_displayText"><span></span></div><div class="c_clr"></div><div class="procg_statusText"></div><div class="procg_progressBar"><div class="procg_progressBarProg t_hdbg"></div><div class="procg_progressBarRemaining"></div></div><div class="c_clr"></div></div><ul class="procg_rows"></ul></div>';function s(A,R,O){var s=this,K=wLive.Core.PageController.getInstance().getViewContext();s.$container=A;s.dismissable=true;var v=jQuery(t),D=jQuery(".procg_header",v),C=jQuery(".procg_displayText span",v),z,w=jQuery(".procg_progressBar",v),Q=jQuery(".procg_progressBarProg",v),E=jQuery(".procg_rows",v),B=jQuery(".procw_dismissicon a",v),y=jQuery(".procw_dismissicon",v),u=jQuery(".procg_statusText",v),I=c.ImageStrip.getImage("cancelRest",e);I.className+=" rest";var H=c.ImageStrip.getImage("cancelHover",e);H.className+=" hover";var G=c.ImageStrip.getImage("cancelActive",e);G.className+=" active";B.append(I).append(H).append(G);var a,F;B.mousedown(function(){B.addClass("pressed")}).mouseup(function(){B.removeClass("pressed");$B.IE||J()}).click(J);var x={};A.append(v);sutra(v,"$Sutra.SkyDrive.ProcessWindowGroup");sutra(u,"$Sutra.SkyDrive.ProcessWindowGroupStatusText");sutra(C,"$Sutra.SkyDrive.ProcessWindowGroupDisplayText");sutra(w,"$Sutra.SkyDrive.ProcessWindowGroupProgressBar");sutra(B,"$Sutra.SkyDrive.ProcessWindowGroupDismiss");sutra(E,"$Sutra.SkyDrive.ProcessWindowRows");s.render=function(d){if(F!=d.v){a=d;F=d.v;var v=d.data,Q=d.getCount(),e=d.getCount(true),s="";switch(d.type){case b.Copy:s=e>1?l:q;break;case b.RemoteUpload:case b.Upload:s=e>1?k:p;break;case b.Delete:s=e>1?i:m;break;case b.Move:s=e>1?n:r;break;case b.UpdateStatus:s=e>1?j:o}if(z)z.unbind();var H=e;if(e==1){var R=d.get(0,true);H=R.data.name}C.html(s.format(H,f).encodeHtml().replace(h,'<a href="#"></a>'));z=jQuery("a",C);var S=v.getDisplayName&&v.getDisplayName(c.PageController.getInstance().getViewContext())||v.name;z.html(S.encodeHtml());var J=K.actionManager.getAction("ViewItem",v);if(J)K.actionManager.setATagAction(J,z);M();if(d.completed){u.empty();u.text(g);u.show();w.hide();D.removeClass("procg_noErrText")}else{w.show();N();P()}if(O){w.hide();E.hide();u.hide();y.hide()}else{var I={};for(var G=0;G<Q;G++){var B=d.get(G),t,A=B.key;if(x[A]){t=x[A];delete x[A]}else{t=new c.ProcessRow(jQuery("<li></li>"));E.append(t.$container)}t.render(B);I[B.key]=t}L(I)}}};s.updateProgressBar=function(a,b){Q.width(Math.ceil(a/b*100)+"%")};s.getFirstProcessRowError=function(){var d=null;for(var b=a.getCount()-1;b>=0;b--){var c=a.get(b);if(c.errorMessage){d=x[c.key];break}}return d};s.dispose=function(){z.unbind();L(null);processItemSet=null};function M(){switch(a.type){default:case b.Copy:case b.Delete:case b.Move:if(a.errorCount>0&&a.completedCount+a.errorCount==a.getCount(true)){y.show();s.dismissable=true}else if(a.completedCount==a.getCount(true)){y.hide();s.dismissable=true}else{y.hide();s.dismissable=false}break;case b.RemoteUpload:case b.Upload:if(a.completedCount==a.getCount())y.hide();else y.show();s.dismissable=true}}function P(){var b=c.ProcessErrorActionsManager.getActionLinks(a,true);if(b&&a.errorCount>1&&a.errorCount+a.completedCount===a.getCount(true)){u.empty();u.show();w.hide();for(var d=0;d<b.length;d++){var e=b[d];u.append(jQuery('<button class="default">'+e.text.encodeHtml()+"</button>").click(e.click))}}else if(a.errorCount>0){u.show();u.empty();D.addClass("procg_noErrText");w.hide()}else{D.addClass("procg_noErrText");u.hide();w.show()}}function N(){if(a.type==b.Upload||a.type==b.RemoteUpload){var c=0,f=a.getCount();for(var e=0;e<f;e++){var g=a.get(e);c+=g.progress}if(c<0)A.addClass(d);else{s.updateProgressBar(c,f*100);A.removeClass(d)}}else{if(!a.completed)A.addClass(d);else A.removeClass(d);s.updateProgressBar(1,1)}}function J(){var b=a.operation;b.abort();return false}function L(b){var a;for(var c in x){a=x[c];a.dispose();a.$container.remove()}x=b}}})();(function(){var a=wLive.Core,b=a.AleHelpers.getPCString;a.ProcessWindow=g;var f=a.ProcessItemSet.Type,d=a.ProcessItemSet.State,q=100,m=250,c=5e3,s=b("ProcessWindow.MinErrorsText"),t=b("ProcessWindow.ResizePhotosText"),o=b("ProcessWindow.TaskRunningConfirmation"),v=b("ProcessWindow.TasksRunningWarning"),l=b("ProcessWindow.TasksRunningLeavePageWarning"),r=b("ProcessWindow.HeaderProgressText"),e="live.shared.globalsettings.webim.client.",n="ImageStripConfig",k="ImageStrip.Close",i="ImageStrip.Minimize",j="ImageStrip.Restore",u='<div class="procw"><div class="procw_ui"><div class="procw_header"><div class="procw_headertext"></div><div class="procw_headerminimize"></div><div class="procw_headerclose"></div><div class="c_clr"></div></div><div class="procw_resize"><input id="procw_resize" name="photoresize" type="checkbox" checked="checked" /><label for="procw_resize">'+t.format(FilesConfig.maxThumbnailSize)+"</label>"+"</div>"+'<div class="procw_body">'+'<ul class="procw_pgroups"></ul>'+"</div>"+"</div>"+"</div>",h=new a.ProcessItemSet,p=new g;a.ProcessWindow.getProcessItemSet=function(){return h};a.ProcessWindow.getInstance=function(){return p};a.ProcessWindow.getInstance().init(a.ProcessWindow.getProcessItemSet());function g(){var t=this,h=jQuery(u);h.hide();var nb=jQuery(".procw_header",h),B=jQuery(".procw_headertext",h),Q=jQuery(".procw_pgroups",h),D=jQuery(".procw_body",h),M=jQuery(".procw_resize",h),cb=jQuery(".procw_ui",h),K=jQuery("input",h),bb=jQuery(window),v,y,C,w={},g,A,p=null,x=false,z=null,G=false,W=0,O=true,F=-1,Z=false,mb=$B.IE_M7?window:window.parent;jQuery(mb.document.body).append(h);h.bind("mouseenter",kb).bind("mouseleave",lb);K.bind("change",eb);sutra(h,"$Sutra.SkyDrive.ProcessWindow");sutra(nb,"$Sutra.SkyDrive.ProcessWindowHeader");sutra(Q,"$Sutra.SkyDrive.ProcessWindowGroups");window.parent.$Network.fetchCSS(FilesConfig.bucket3CssLocation,function(){function a(){window.parent.$Do.when("wLive.Controls.DraggableWindow",0,fb)}if(FilesConfig.webImDraggableWindowUrl)window.parent.$Network.fetchScript(FilesConfig.webImStringsUrl,function(){window.parent.$Network.fetchScript(FilesConfig.webImDraggableWindowUrl,a,"webimui")},"window.live.shared.globalsettings.webim");else a()});t.init=function(b){g=b;g.addListener(a.ProcessItemSet.updateEventName,X);t.render(g)};t.render=function(e){if(!Z){R();if(e.getCount()>0){if(p){h.is(":visible")||p.dock();db();h.show();L();p.initialize()}I()}else{h.hide();E()}Y();var d={};for(var f=0;f<e.getCount();f++){var b=e.get(f),c;if(w[b.key]){c=w[b.key];delete w[b.key]}else{c=new a.ProcessGroup(jQuery("<li></li>"),t);Q.prepend(c.$container)}c.render(b);d[b.key]=c}if(W<g.totalErrorCount){if(x)N();if(!G)hb(d)}W=g.totalErrorCount;S();P(d);T();V()}};t.dispose=function(){if(g){g.removeListener(a.ProcessItemSet.updateEventName,X);ab(true)}if(p)p.dispose();if(v){v.unbind();y.unbind();C.unbind()}P(null);p=null;g=null;E();h.empty();h.remove();bb.unbind("unload",t.dispose);h=null;Z=true};t.resizeState=function(){return O};t.preResizeWindow=function(){R()};t.resizeWindow=function(){T()};bb.bind("unload",t.dispose);$Do.when("$PF.attach",0,t.dispose);function lb(){G=false;if(g.getCount()>0)I();else E()}function kb(){G=true;E()}function I(){if(!z&&!G)z=setTimeout(gb,c)}function E(){if(z){clearTimeout(z);z=null}}function eb(){O=K[0].checked;var c=wLive.Controls.Notifications.createModalDialog({buttons:{action:b("YesCommand"),close:b("NoCommand")},title:b("ProcessWindow.UploadConfirmResizeHeader"),content:b("ProcessWindow.UploadConfirmResize")}),a=jQuery(c);a.bind({"afterdismiss.dlg":function(){a&&a.unbind("._dlg");a=null;c=null},"buttonclick.dlg":function(c,b,a){if(a=="action")jb();else K[0].checked=!O;return true}});c.show()}function jb(){for(var a=0;a<g.getCount();a++){var b=g.get(a);if(b.type==f.Upload){var c=b.operation;c.restartUpload()}}}function hb(d){for(var a=g.getCount()-1;a>=0;a--){var b=g.get(a);if(b.errorCount>0){var c=d[b.key].getFirstProcessRowError();if(c){D.animate({scrollTop:c.$container.offset().top-Q.offset().top},m);break}}}}function S(b){if(!x||b){for(var a=0,d=g.getCount();a<d;a++){var c=g.get(a);if(c.type==f.Upload){M.show();return}}M.hide()}}function gb(){if(g){var d=(new Date).getTime();for(var a=0;a<g.getCount(true);a++){var b=g.get(a,true);if(b.completedTime&&d-b.completedTime>=c){var e=b.operation;e.abort();a--}}z=null;I()}}function fb(){if(g){p=new window.parent.wLive.Controls.DraggableWindow(null,h[0],B[0]);t.render(g)}}function X(){wLive.throttle("processWindowThrottle",q,ib,true)}function ib(){t.render(g)}function H(){if(A){A.dispose();A=null}}function Y(){if(x){var b=g.totalErrorCount;if(b>0){H();B.html(s.format(b))}else if(g.completedCount==g.getCount()){H();B.html(r)}else{if(!A){B.empty();A=new a.ProcessGroup(B,t,true)}var c=g.getCount();if(c>0)A.render(g.get(c-1))}}else{H();B.empty()}}function P(b){var a;for(var c in w){a=w[c];a.dispose();a.$container.remove()}w=b}function ab(b){while(g.getCount()>0){var a=g.get(0),c=a.operation;c.abort(b)}}function U(){if(g)for(var b=0;b<g.getCount(true);b++){var e=g.get(b,true);for(var c=0;c<e.getCount(true);c++){var a=e.get(c,true),f=a.state;if(a.state==d.Active||a.state==d.Pending)return true}}return false}function ob(){for(var c in w){var b=w[c];if(!b.dismissable)return false}var a=U();if(!a||a&&confirm(o)){ab(false);P({});h.hide()}}function R(){F=h.height()}function T(){L();if(p)p.restore()}function N(){if(p){if(x){v.show();y.hide();D.show();S(true)}else{v.hide();y.show();D.hide();M.hide()}V();L();x=!x;p.set_isMinimized(x);Y();if(x)p.dock();else p.restore()}}function L(){h.height(cb.height()+42);h.width(cb.width()+65);if(F>0&&F>h.height()&&p){var a=parseInt(h.css("top"));p.setCurrentY(a+(F-h.height()))}}function V(){h.toggleClass("scrollbar",D[0].scrollHeight>D.outerHeight(true))}function db(){if(!v){v=jQuery(J(i));y=jQuery(J(j));C=jQuery(J(k));v.click(N);y.click(N);C.click(ob);y.hide();jQuery(".procw_headerminimize",h).append(v).append(y);jQuery(".procw_headerclose",h).append(C);sutra(y,"$Sutra.SkyDrive.ProcessWindowHeaderMinimize");sutra(v,"$Sutra.SkyDrive.ProcessWindowHeaderMinimize");sutra(C,"$Sutra.SkyDrive.ProcessWindowHeaderClose")}}function J(a){return $IS.CreateFromConfig(GetString(e+n),GetString(e+a),$Config.WebIM.imgBase)}a.BeforeUnloadManager.registerHandler(function(){if(U())return l})}})();(function(){var b=wLive.Core;b.BaseOperation=g;var j=0,h=0,k=b.AleHelpers.getString("LoadGenericError");function g(e,f,c,h,g){var a=this;if(e.length>0){a.id=++j;a._processItemSet=new b.ProcessItemSet;a._parentSet=f;a._parentSet.add(a._processItemSet);a._processItemSet.type=a.getCollectionType();a._processItemSet.data=c;a._processItemSet.operation=a;a._targetItem=c;a._dataRequests=[];d(a,e,h,g);a._processItemSet.invalidate()}}var a=g.prototype;a.getRequestUrl=function(){return null};a.getOperationName=function(){return null};a.getRequestPriority=function(){return null};a.handleError=function(c,d){var b=this,a;if(c.error)a=e(b,c.error.message,d);else a=f(b,c,d);b.postProcessItems(a,false)};a.handleSuccess=function(c,b){var a=f(this,c,b);this.postProcessItems(a,false)};a.postProcessItems=function(c,b){if(c){var a=this;!b&&a._targetItem.expire(true);a._targetItem.invalidate()}};a.processSingleItemSuccess=function(){};a.processSingleItemError=function(){};a.processSingleItemResponse=function(a,c){var b=false,d=this,e=a.data;if(c.error){a.setError(c.error.message,c.error.code,d.getOperationName());b=d.processSingleItemError(a)}else{a.setCompleted(true);b=d.processSingleItemSuccess(a)}a.invalidate();return b};a.start=function(){var b=this;for(var a=0;a<b._dataRequests.length;a++){var c=b._dataRequests[a];c.start()}};a.abort=function(){var a=this;for(var b=0;b<a._dataRequests.length;b++){var c=a._dataRequests[b];c.abort()}a._processItemSet.clear();a._parentSet.removeAt(a._parentSet.indexOf(a._processItemSet,true),true);a._parentSet.invalidate()};a.batchSizeLimit=function(){return 1};a.requestTimeout=function(){return 3e4};a.getCollectionType=function(){return 0};a.processItemSet=function(){};a.handleErrorResolution=function(a,e){var d=this;switch(e.id){case b.ProcessErrorActions.NameConflictOverwrite.id:c(d,a,{nameConflict:1});break;case b.ProcessErrorActions.NameConflictRename.id:c(d,a,{nameConflict:2});break;case b.ProcessErrorActions.Unlock.id:c(d,a,{overrideLock:true})}};function c(g,b,f){var e=b.length;if(e>0){for(var c=0;c<e;c++){var a=b[c];a.setError(null);a.setCompleted(false);a.progress=0;a.invalidate()}d(g,b,f,null,true,true)}}function d(a,h,v,c,t,r){var l,q=a.batchSizeLimit(),g=Math.ceil(h.length/q),m={},f={};for(var e=0;e<g;e++){m[e]=[];f[e]={};if(c)for(var u in c)f[e][u]=[]}for(var d=0;d<h.length;d++){if(r)subProcessItemSet=h[d];else{var w=h[d];subProcessItemSet=new b.ProcessItemSet;subProcessItemSet.data=w;subProcessItemSet.operation=a;a._processItemSet.add(subProcessItemSet)}l=a.processItemSet(subProcessItemSet)||l;if(!subProcessItemSet.errorMessage)m[d%g].push(subProcessItemSet)}if(c)for(var p in c){var o=c[p];for(var k=0;k<o.length;k++)f[k%g][p].push(o[k])}for(var j=0;j<g;j++){var s=m[j],n=i(a,s,v,f[j]);a._dataRequests.push(n);if(t)n.start()}a.postProcessItems(l,true)}function i(a,d,j,f){var c=jQuery.extend(jQuery.extend({},j||{}),f||{});if(!c.items)c.items=[];if(a._targetItem){c.targetId=a._targetItem.id;c.cid=a._targetItem.ownerCid;c.group=a._targetItem.group}for(var e=0;e<d.length;e++){var i=d[e],k=i.data;c.items.push(k.id)}var l="operation"+a.getCollectionType()+"id"+a.id+"dr"+h++,m=a.getRequestUrl(),g=new b.DataRequest(l,m,Object.toJSON(c),function(b){a.handleSuccess(b,d)},function(b){a.handleError(b,d)},a.requestTimeout(),a.getRequestPriority());return g}function e(e,f,d){var b=false;for(var c=0;c<d.length;c++){var a=d[c];b=e.processSingleItemError(a)||b;a.setError(f,0,e.getOperationName());a.invalidate()}return b}function f(j,c,b){var a=false;if(c.items&&c.items.length==b.length){var g={};for(var d=0;d<b.length;d++){var i=c.items[d];g[i.id.toUpperCase()]=i}for(var f=0;f<b.length;f++){var h=b[f],l=g[h.data.id.toUpperCase()];a=j.processSingleItemResponse(h,l)||a}}else a=e(j,k,b)||a;return a}})();(function(){var b=wLive.Core;b.CopyOperation=c;function c(){b.BaseOperation.apply(this,arguments)}var a=c.prototype=new b.BaseOperation([],null);a.getOperationName=function(){return "Copy"};a.getRequestPriority=function(){return b.RequestPriorityEnum.CopyOperation};a.getRequestUrl=function(){return FilesConfig.baseApiUrl+"CopyItems"};a.batchSizeLimit=function(){return 1};a.requestTimeout=function(){return 1.2e5};a.getCollectionType=function(){return b.ProcessItemSet.Type.Copy};a.processSingleItemSuccess=function(){return true};a.processSingleItemError=function(){}})();(function(){var b=wLive.Core;b.MoveOperation=d;var c=b.SkyDriveItemHelper;function d(){b.BaseOperation.apply(this,arguments)}var a=d.prototype=new b.BaseOperation([],null);a.getOperationName=function(){return "Move"};a.getRequestPriority=function(){return b.RequestPriorityEnum.MoveOperation};a.getRequestUrl=function(){return FilesConfig.baseApiUrl+"MoveItems"};a.batchSizeLimit=function(){return 40};a.requestTimeout=function(){return 6e4};a.getCollectionType=function(){return b.ProcessItemSet.Type.Move};a.postProcessItems=function(d,c){if(d){var a=this;if(a._processItemSet.getCount(true)>0){var e=a._processItemSet.get(0,true),b=e.data,f=b.getParent();if(!c)b.expire(true);b.invalidate()}!c&&a._targetItem.expire(true);a._targetItem.invalidate()}};a.processItemSet=function(d){var a=d.data,f=a.commands.indexOf("mv")>=0,e=true;if(f)!c.isMruQuery(a)&&!c.isSharedQuery(a)&&a.setVisibility(false);else{d.setError(b.AleHelpers.getString("LoadGenericError"),0,this.getOperationName());e=false}return e};a.processSingleItemSuccess=function(b){var a=b.data;if(!c.isMruQuery(a)&&!c.isSharedQuery(a)){a.remove();a.setVisibility(true)}a.expire(true);a.invalidate();return true};a.processSingleItemError=function(b){var a=b.data;if(!c.isMruQuery(a)&&!c.isSharedQuery(a))a.setVisibility(true);if(b.errorCode=="1000"&&a.folder)b.errorCode="folder_1000";return true}})();(function(){var a="Photo",c="Audio",b="Video",d={JPG:a,JPEG:a,JPE:a,GIF:a,PNG:a,BMP:a,TIFF:a,TIF:a,ICO:a,DIB:a,JFIF:a,JIF:a,JFI:a,WDP:a,MP3:c,WMA:c,M4A:c,WAV:c,AIFF:c,MID:c,AU:c,MPG:b,AVI:b,MP4:b,"3GP":b,WLMP:b,WMX:b,"DVR-MS":b,M1V:b,MOD:b,MP2:b,MPE:b,MPV:b,MPV2:b,MP2V:b,VOB:b,WM:b,QT:b,MM4P:b,MPA:b,FLV:b,MOV:b,MPEG:b,WMV:b,ASF:b,RAW:a,ARW:a,CR2:a,CRW:a,DCR:a,DNG:a,ERF:a,KDC:a,MRW:a,NEF:a,ORF:a,ODT:"Odt",ODS:"Ods",ODP:"Odp",PEF:a,PTX:a,RAF:a,SRF:a,SR2:a,X3F:a,DOC:"Doc",DOCX:"Docx",DOCM:"Docm",DOT:"Dot",DOTM:"Dotm",DOTX:"Dotx",XLS:"Xls",XLL:"Xls",XLSX:"Xlsx",XLSB:"Xlsb",XLSM:"Xlsm",XLTX:"Xltx",XLT:"Xlt",XLAM:"Xlam",XLA:"Xla",XLTM:"Xltm",PPT:"Ppt",PPTX:"Pptx",PPS:"Pps",PPSX:"Ppsx",PPTM:"Pptm",POT:"Pot",PPSM:"Ppsm",POTX:"Potx",POTM:"Potm",PPAM:"Ppam",PPA:"Ppa",ONE:"One",ONETMP:"One",ONEBIN:"One",ONEPKG:"Onepkg",ONETOC2:"Onetoc2",MDB:"Mdb",ACCDB:"Mdb",MPP:"Mpp",PUB:"Pub",VSD:"Vsd",XPS:"Xps",TXT:"Txt",HWP:"Txt",HTML:"Html",HTM:"Html",MHTML:"Html",MHT:"Html",URL:"Html",XML:"Xml",RTF:"Rtf",EXE:"Exe",ZIP:"Zip",RAR:"Zip",PDF:"Pdf",XSN:"Xsn",XAML:"Xaml"};wLive.Core.SkyDriveItemHelper.convertExtToIconType=function(a){if(a.startsWith("."))a=a.substr(1);return d[a.toUpperCase()]||"Default"}})();(function(){var a=wLive.Core;a.Html5FileUpload=b;function b(c,g){var b=this;b.name=c.fileName||c.name;var f=b.name.lastIndexOf("."),d=false;b.extension=f>=0?b.name.substring(f):"";b.iconType=a.SkyDriveItemHelper.convertExtToIconType(b.extension);b.size=c.size;b.downlevel=false;b.canResizeOnClient=false;b.upType="h5";b.dragDrop=g;b.isLocked=false;function e(a,d){var b="";if(c)if(c.slice)if($B.Firefox&&$B.V==4||$B.Chrome&&$B.V==10)b=c.slice(a,d-a);else b=c.slice(a,d);else if(c.mozSlice)b=c.mozSlice(a,d);else if(c.webkitSlice)b=c.webkitSlice(a,d);return b}b.isFolder=function(f){if(c.isFolder)f(true);else{var a=new FileReader;a.onload=function(){if(!d)if(!a.result&&!b.extension)f(true);else f(false)};a.onerror=function(){if(!d)f(true)};try{if(a.readAsArrayBuffer)a.readAsArrayBuffer(e(0,Math.min(1,c.size)));else a.readAsBinaryString(e(0,Math.min(1,c.size)))}catch(g){f(true)}}};b.post=function(j,l,c,f,b,k,i){if(!d){var h="";if(c!=f)h=e(c,f);var g={};for(var a=0;a<b.length;a++)g[b[a]]=k[a];$Network.fetchXML(j,l,"POST",h,g,null,i)}};b.dispose=function(){d=true;c=null}}})();(function(){var a=wLive.Core;a.SLFileUpload=b;function b(c,d){var b=this,i=d;b.control=d;b.file=c;b.name=c.FileName;var h=b.name.lastIndexOf("."),g=false,e=false;b.extension=h>=0?b.name.substring(h):"";b.iconType=a.SkyDriveItemHelper.convertExtToIconType(b.extension);b.size=c.FileSize;var f=c.ParentResourceId.split(";");b.parentResourceId=f[0];b.ownerCid=f[1];b.group=f[2]=="1"?1:0;b.downlevel=false;b.canResizeOnClient=true;b.upType="sl";b.dragDrop=c.WasDragAndDropped;b.isLocked=c.IsLocked;b.isFolder=function(a){if(c)a(c.IsFolder)};b.post=function(j,k,i,l,f,h){if(!g){for(var b=0;b<f.length;b++){f[b]=f[b]+"";h[b]=h[b]+""}a.FileUploadManager.registerSLCallback(c.FileId,k);a.FileUploadManager.registerSLOperation(c.FileId,function(){if(!e)d.PostUpload(c.FileId,j,i,l-i,f,h)})}};b.resize=function(f,i,h){if(!g){a.FileUploadManager.registerSLCallback(c.FileId,function(a){if(!e){b.size=a;h(a)}});a.FileUploadManager.registerSLOperation(c.FileId,function(){if(!e)if(i)d.ResetToOrginal(c.FileId,f);else d.ResizeImage(c.FileId,f)})}};b.dispose=function(){if(c){g=true;a.FileUploadManager.registerSLOperation(c.FileId,function(){e=true;d.RemoveFile(c.FileId);c=null;d=null})}}}})();(function(){var a=wLive.Core,c=a.AleHelpers.getPCString;a.DownlevelFileUpload=b;function b(d){var b=this;if(d){var e=d.lastIndexOf("\\");d=e>=0&&e<d.length-1?d.substring(e+1):d}b.name=d||c("ProcessWindow.DownlevelUploadFileName");var f=b.name.lastIndexOf(".");b.extension=f>=0?b.name.substring(f):"";b.iconType=a.SkyDriveItemHelper.convertExtToIconType(b.extension);b.size=0;b.downlevel=true;b.canResizeOnClient=false;b.upType="dl";b.dragDrop=false;b.isLocked=false;b.isFolder=function(a){a(false)};b.dispose=function(){}}})();(function(){var a=wLive.Core,c=a.AleHelpers.getPCString,o=true,D="write",r=FilesConfig.storageUploadBaseUrl,z=3,g={sl:10*1024,h5:100*1024},C={sl:10*1024*1024,h5:100*1024*1024},x={sl:2*1e3,h5:2*1e3},e={sl:g.sl*10,h5:g.h5*10},l=99,i=1e3,v=4e3,q="",t="compFileUpload",s="1ProgFileUpload",m="X-ClientErrorCode",p=FilesConfig.maxFileSize,w=p*1024*1024,n=1e3,b="ProcessWindow.UploadErrors.",y=c(b+"UploadGenericError"),u=c(b+"UploadFileSizeLimitError").format(p),j=c(b+"UploadFolderEmptyFileError"),d=null,k=false,F=0,B=0,E=new a.PriorityQueue(z),h=0,f=a.ProcessItemSet.State;a.SingleFileUpload=A;function A(R,lb,G){var p=this,N,K,H,eb=0,U=false,Q=false,bb=false,P=false,M=0,z=null;p.id=F++;p.file=R;p.aborted=false;p.executing=false;p.pendingRestart=false;p._processItemSet=new a.ProcessItemSet;p._parentSet=lb;p._parentSet.add(p._processItemSet);p._processItemSet.type=a.ProcessItemSet.Type.Upload;p._processItemSet.state=f.Pending;p._processItemSet.data=R;p._processItemSet.operation=p;if(!k&&!d){d=$CSIPerf.startTrace(s,null,o);z=$CSIPerf.startTrace(t,null,o);d.addCsd("type",p.file.upType);z.addCsd("type",p.file.upType);var X=p.file.extension.replace(".","");if(X){d.addCsd("ext",X);z.addCsd("ext",X)}k=true}p._processItemSet.invalidate();p.start=function(){if(P||h<n){if(!P)h++;P=true;if(!p.aborted)if(this.file.downlevel){p._processItemSet.state=f.Active;p._processItemSet.progress=-1;p._processItemSet.invalidate()}else{M++;E.enqueue(function(a){M--;if(I()&&M==0){N=a;p.executing=true;kb();return true}else return false},function(){M--;p.abort()},1,"uploadqueue_"+p.id+"_"+eb,"upload")}}else{p._processItemSet.setError(c(b+"FilesCountLimit").format(n),"up_filecountlimit");p._processItemSet.invalidate();p.file.dispose()}};p.abort=function(){if(!p.aborted){db();H=q;p.pendingRestart=false;p._parentSet.remove(p._processItemSet);p._parentSet.invalidate();p._processItemSet=null;p._parentSet=null;p.file.dispose();J();A();if(P)h--}p.aborted=true};p.handleErrorResolution=function(c,b){switch(b.id){case a.ProcessErrorActions.NameConflictRename.id:Q=true;p.restartUpload();break;case a.ProcessErrorActions.NameConflictOverwrite.id:Q=false;U=true;p.restartUpload();break;case a.ProcessErrorActions.Retry.id:p.restartUpload()}};p.setDownlevelStatus=function(a){switch(a){case "Success":p._processItemSet.setCompleted(true);Y();p._processItemSet.invalidate();break;default:Z(a,true)}};p.restartUpload=function(){if(!p.executing&&!p.file.downlevel){if(bb||p._processItemSet.state==f.Completed){Q=false;U=true}eb++;p._processItemSet.setCompleted(false);p._processItemSet.setError(null);p._processItemSet.state=f.Pending;p._processItemSet.progress=0;p._processItemSet.invalidate();p.start()}else{if(d)d.addCsd("restarted",1);if(z)z.addCsd("restarted",1);p.pendingRestart=true;db()}};function ib(){if(p.pendingRestart){J();A();p.pendingRestart=false;p.restartUpload();return true}else return false}function I(){return !p.aborted&&!ib()}function J(){if(K){K();K=null}}function A(){if(N){p.executing=false;N();N=null}}function ab(j,h,f,i){var a=p.file.upType,b=(new Date).getTime(),d=i-f,k=d/(b-h),c=Math.round(x[a]*k);if(j)e[a]=Math.max(Math.min(c,C[a]),g[a]);else e[a]=Math.max(e[a]/2,g[a])}function fb(){if(G.id=="root")return r.format(G.ownerCid)+"/users/0x"+G.ownerCid+"/LiveFolders/"+p.file.name.encodeURIComponent();else return r.format(G.ownerCid)+"/items/"+G.id+"/"+p.file.name.encodeURIComponent()}function Z(f,d){var a,e;switch(f){case "RequestEntityTooLarge":a=c(b+"UploadFileSizeLimitError").format(FilesConfig.maxDownLevelFileSize);break;case "InsufficientSpaceAvailable":case "QuotaLimitReached":a=c(b+"UploadQuotaLimitReached");break;case "BadArgument":case "InvalidPath":a=c(b+"UploadInvalidFileName");break;case "UsageRestricted":case "AccessDenied":a=c(b+"UploadAccessDenied");break;case "LockOwnerMismatch":case "LockMismatch":a=c(b+"UploadItemLocked2");e=d?"dlUpload_9001":"Upload_9001";break;case "RelationshipNameAlreadyExists":case "ItemAlreadyExists":a=c(b+(d?"DLUploadNameConflict":"UploadNameConflict"));e=d?"dl1000":"1000";break;default:a=y;e=d?"up_dl_1":"up_1"}p._processItemSet.setError(a,e);p._processItemSet.invalidate()}function W(a){a=a||{};Z(a[m],false);A()}function O(c,b,i,j,g,h,d){if(H){c.push("BITS-Session-Id");b.push(H)}c.push("Application");b.push("LiveFolders");c.push("Accept");b.push("application/wls-response-headers+json");c.push("X-Http-Method-Override");b.push("BITS_POST");c.push("Overwrite");b.push(Q?"choosenewname":U);c.push("Content-Type");b.push("application/octet-stream");if(a.ProcessWindow.getInstance().resizeState()){c.push("X-PhotoSizeConstraint");b.push(FilesConfig.maxThumbnailSize+"x"+FilesConfig.maxThumbnailSize)}var e=[];e.push("upType="+R.upType);e.push("dragDrop="+R.dragDrop);c.push("X-RequestStats");b.push(e.join(","));function f(){if(!p.aborted)p.file.post(fb(),function(b){var c=b.responseText,a=Object.fromJSON(c);if(a&&(a["StatusCode"]==200||a["StatusCode"]==201))g(a);else g(a,true);if(!d)J()},i,j,c,b,h);else if(!d)J()}if(!d)window.requests.enqueue(function(a){K=a;f();return true},function(){p.abort()},a.RequestPriorityEnum.UploadOperation,"uploadrequest_"+p.id+"_"+B++,D);else f()}function V(b){var a=true;if(b)switch(b[m]){case "InsufficientSpaceAvailable":case "QuotaLimitReached":case "BadArgument":case "InvalidPath":case "UsageRestricted":case "AccessDenied":case "RelationshipNameAlreadyExists":case "ItemAlreadyExists":case "LockOwnerMismatch":case "LockMismatch":a=false;break;default:a=true}return a}function S(a){if(d){d.addCsd("bytesSent",a);d.endTrace();d=null}}function Y(){var a=G;wLive.throttle("uploadInvalidate_"+G.id,v,function(){a.expire(true);a.invalidate()},true)}function gb(d){var b={id:d};function a(){if(I()){p._processItemSet.setCompleted(true);p._processItemSet.invalidate();Y();A()}}if(p.file.iconType=="Video"){p._processItemSet.progress=99;p._processItemSet.invalidate();var c={canary:FilesConfig.canary,Accept:"application/json",AppId:FilesConfig.appId},e=FilesConfig.baseApiUrl+"UpdateVideoMetadata/?canary="+FilesConfig.canary.encodeUrl();$Network.fetchXML(e,a,"POST",Object.toJSON(b),c)}else a()}function jb(){if(z){z.addCsd("bytesSent",p.file.size);z.endTrace();z=null}S(p.file.size);var b=3;function a(){var d=[],c=[];d.push("BITS-Packet-Type");c.push("Close-Session");var e=(new Date).getTime();O(d,c,0,0,function(c,d){wLive.PageStats.add({url:"Upload Close Session",error:L(c,d)},e);bb=!d;if(I())if(!d)gb(c["X-Resource-Id"]);else if(b-->0&&V(c,d))setTimeout(a,i);else W(c)})}a()}function hb(){var a=0,b=Math.min(a+e[p.file.upType],p.file.size),g=true,f=3;function c(b){p._processItemSet.progress=Math.min(Math.floor((a+b.loaded)/p.file.size*100),l);if(p._processItemSet.progress>=1)S(a+b.loaded);p._processItemSet.invalidate()}function d(g,j,h){if(!j)if(b==p.file.size)jb();else{f=3;ab(true,h,a,b);a=b;b=Math.min(a+e[p.file.upType],p.file.size);p._processItemSet.progress=Math.min(Math.floor(a/p.file.size*100),l);if(p._processItemSet.progress>=1)S(a);p._processItemSet.invalidate();T(a,b,d,c)}else if(f-->0&&V(g,j)){ab(false,h,a,b);b=Math.min(a+e[p.file.upType],p.file.size);setTimeout(function(){T(a,b,d,c)},i)}else W(g)}T(a,b,d,c)}function T(c,e,g,f){var b=[],a=[];b.push("BITS-Packet-Type");a.push("Fragment");b.push("Content-Range");a.push("bytes "+c+"-"+Math.max(0,e-1)+"/"+p.file.size);var d=(new Date).getTime();O(b,a,c,e,function(a,b){if(I()){wLive.PageStats.add({url:"Upload Fragment",error:L(a,b)},d);g(a,b,d)}},f)}function kb(){var d=p.file;d.isFolder(function(e){if(e){p._processItemSet.setError(j,"up_folder");p._processItemSet.invalidate();A();return}else if(d.size&&d.size>w){p._processItemSet.setError(u,"up_limit");p._processItemSet.invalidate();A();return}else if(d.size==0){p._processItemSet.setError(j,"up_nosize");p._processItemSet.invalidate();A();return}else if(d.isLocked){p._processItemSet.setError(c(b+"UploadFileLockedError"),"up_filelocked");p._processItemSet.invalidate();A();return}if(d.canResizeOnClient)d.resize(FilesConfig.maxThumbnailSize,!a.ProcessWindow.getInstance().resizeState(),function(){cb()});else cb()})}function cb(){var c=p.file;H=q;p._processItemSet.state=f.Active;p._processItemSet.invalidate();var b=3;function a(){var d=[],c=[];d.push("BITS-Packet-Type");c.push("Create-Session");d.push("BITS-Supported-Protocols");c.push("{7df0354d-249b-430f-820d-3d2a9bef4931}");var e=(new Date).getTime();O(d,c,0,0,function(c,d){if(I()){wLive.PageStats.add({url:"Upload Create Session",error:L(c,d)},e);if(!d){H=c["BITS-Session-Id"];hb()}else if(b-->0&&V(c,d))setTimeout(a,i);else W(c)}})}a()}function db(){var d=p.file;if(!d.downlevel&&H){var b=[],a=[];b.push("BITS-Packet-Type");a.push("Cancel-Session");var c=(new Date).getTime();O(b,a,0,0,function(a,b){wLive.PageStats.add({url:"Upload Abort Session",error:L(a,b)},c)},null,true)}}function L(a,b){if(b)return a.StatusDescription?a.StatusDescription:"Generic Error";else return null}}})();(function(){var a=wLive.Core,g=wLive.Controls;a.FileUploadManager=d;$Network.requiresDomainLowering(false);var e={},f={};function d(f){var b=this,c=[];b._processItemSet=new a.ProcessItemSet;b._parentSet=a.ProcessWindow.getProcessItemSet();b._parentSet.add(b._processItemSet);b._processItemSet.type=a.ProcessItemSet.Type.Upload;b._processItemSet.data=f.item;b._processItemSet.operation=b;d(f);b._processItemSet.invalidate();b.start=function(){for(var a=0;a<c.length;a++){var b=c[a];b.start()}};b.restartUpload=function(){for(var a=0;a<c.length;a++){var b=c[a];b.restartUpload()}};b.abort=function(){for(var a=0;a<c.length;a++){var d=c[a];d.abort()}c=[];b._processItemSet.clear();b._parentSet.removeAt(b._parentSet.indexOf(b._processItemSet,true),true);b._parentSet.invalidate()};$Do.register("CancelChunkedUploads",b.abort);b.addUploads=function(f){var b=c.length;d(f);for(var a=b;a<c.length;a++){var e=c[a];e.start()}};b.handleErrorResolution=function(b,e){for(var a=0;a<b.length;a++){var c=b[a],d=c.operation;d.handleErrorResolution([c],e)}};function d(d){if(d.files){var h=d.files;for(var f=0;f<h.length;f++){var l=new a.Html5FileUpload(h[f],d.wasDragAndDropped),j=new a.SingleFileUpload(l,b._processItemSet,d.item);c.push(j)}}else if(d.slFile){var m=new a.SLFileUpload(d.slFile,d.control);b._processItemSet.data=d.slDataItem;var i=new a.SingleFileUpload(m,b._processItemSet,d.slDataItem);c.push(i)}else if(d.dlFile){var k=new a.DownlevelFileUpload(d.fileName),g=new a.SingleFileUpload(k,b._processItemSet,d.item);c.push(g);e[d.dlFile]=g}}}var c={},b={};$Do.register("FileUploadManagerPost",function(d){var a=d.fileId;if(c[a]){var h=c[a][0],e,f=d.newSize;if(f!==undefined)e=f;else{var g={StatusCode:d.statusCode};e={responseText:d.responseText?d.responseText:Object.toJSON(g),status:d.statusCode}}c[a]=c[a].slice(1);b[a]=b[a].slice(1);h(e);if(b[a].length>=1)b[a][0]()}});d.registerSLCallback=function(a,b){if(!c[a])c[a]=[];c[a].push(b)};d.registerSLOperation=function(a,c){if(!b[a])b[a]=[];b[a].push(c);if(b[a].length==1)b[a][0]()};$Do.register("FileUploadManager",function(b){if(b.dlFile&&b.status){var d=e[b.dlFile];if(d){d.setDownlevelStatus(b.status);e[b.dlFile]=null}}else if(b.slFile&&b.slFile.SessionId&&f[b.slFile.SessionId]){var c=f[b.slFile.SessionId];if(c)c.addUploads(b)}else{var g=new a.FileUploadManager(b);g.start();if(b.slFile&&b.slFile.SessionId)f[b.slFile.SessionId]=g}})})();(function(){var b=wLive.Core;b.DeleteOperation=c;function c(){b.BaseOperation.apply(this,arguments)}var a=c.prototype=new b.BaseOperation([],null);a.getOperationName=function(){return "Delete"};a.getRequestPriority=function(){return b.RequestPriorityEnum.DeleteOperation};a.getRequestUrl=function(){return FilesConfig.baseApiUrl+"DeleteItems"};a.batchSizeLimit=function(){return 40};a.requestTimeout=function(){return 6e4};a.getCollectionType=function(){return b.ProcessItemSet.Type.Delete};a.processItemSet=function(a){var b=a.data;b.setVisibility(false);return true};a.processSingleItemSuccess=function(b){var a=b.data;a.expire();a.invalidate();return true};a.postProcessItems=function(e){b.BaseOperation.prototype.postProcessItems.apply(this,arguments);if(e&&window.FilesConfig.recycleBinEnabled){var d=FilesConfig.hcid,g=b.SkyDriveItem.getItemKey("root",d,null,"recyclebin"),f=b.PageController.getInstance().getViewContext(),c=f.dataModel,a=c&&c.getItem(g,false);if(a){a.expire();a.invalidate()}}};a.processSingleItemError=function(a){var b=a.data;b.setVisibility(true);return true}})();(function(){var a=wLive.Core;a.OperationManager.Current.register("Copy",function(d,b){var c=new a.CopyOperation(b.items,a.ProcessWindow.getProcessItemSet(),b.targetItem,b.options);c.start()});a.OperationManager.Current.register("Delete",function(d,b){var c=new a.DeleteOperation(b.items,a.ProcessWindow.getProcessItemSet(),b.targetItem,b.options);c.start()});a.OperationManager.Current.register("Move",function(d,b){var c=new a.MoveOperation(b.items,a.ProcessWindow.getProcessItemSet(),b.targetItem,b.options);c.start()})})();(function(){var a=wLive.Core,c=a.ItemActionHelper;a.DownloadAsZipOperation=b;var e=250,d=20;function b(b){var f=this,a;f.start=function(){d()};function e(){return jQuery('<iframe src="'+FilesConfig.iFrameEmptyUrl.encodeHtmlAttribute()+'"></iframe>').hide().appendTo(window.document.body)}function d(){if(!a)a=e();if(b.length==1&&window.navigator&&window.navigator.userAgent&&window.navigator.userAgent.toLowerCase().indexOf("msn 9.0")>0){var g=c.itemStringFormat("/downloadfolder.aspx?{cidQueryString}{resIdQueryString}&canary={FilesConfig.dlCanary:encodeURIComponent}",b[0]);a.attr("src",g);return}var h=c.itemStringFormat("/downloadasziplanding?canary={FilesConfig.dlCanary:encodeURIComponent}",null),f=[];for(var d=0;d<b.length;d++){var i=b[d];f.push(i.id)}window.downloadAsZipIframeReady=function(){a[0].contentWindow.startDownloadAsZip(f.join(";"),FilesConfig.dlCanary)};a.attr("src",h)}}a.OperationManager.Current.register("DownloadAsZip",function(d,c){var a=new b(c.items);a.start()})})();(function(){var b=wLive.Core,d=b.AleHelpers.getPCString,e=0,i=2*60*1e3,h=4,f=3012,g=60*1e3;a.Role={Owner:-1,View:1,Edit:2,Submit:3};a.GroupRole={View:0,Edit:1};a.EntityType={Email:0,User:1,Group:2,Link:3,Public:4,Friends:5,GroupOwned:99};a.LinkType={Network:1,Embed:3,View:5,Edit:6,Form:7};a.UserAction={Share:0,Manage:1};b.PermissionsProvider=a;function a(A){var i=this,z=A,j=b.SkyDriveItemHelper.isRootItem,m=b.SkyDriveItemHelper.getTopLevelItem;i.hasCachedData=function(a){return v(a)===undefined};i.deletePermission=function(f,b,d,c){b.role=e;this.updatePermissions(f,b,{suppressNotification:true},a.UserAction.Manage,d,k(c))};i.embedLink=function(e,c,b){var d={role:a.Role.View,type:a.EntityType.Link,linkType:a.LinkType.Embed};this.updatePermissions(e,d,null,a.UserAction.Share,c,k(b))};i.submitFormLink=function(e,c,b){var d={role:a.Role.Submit,type:a.EntityType.Link,linkType:a.LinkType.Form};this.updatePermissions(e,d,null,a.UserAction.Share,c,k(b))};i.makePublic=function(e,c,b){var d={role:a.Role.View,type:a.EntityType.Public};this.updatePermissions(e,d,null,a.UserAction.Share,c,k(b))};i.createLink=function(f,b,d,c){var e={role:b,type:a.EntityType.Link,linkType:b==a.Role.Edit?a.LinkType.Edit:a.LinkType.View};this.updatePermissions(f,e,null,a.UserAction.Share,d,k(c))};i.shareToContacts=function(h,o,v,s,u,r,b){var i=[],t=jQuery("<div></div>"),m,l;for(var k=0;k<o.length;k++){var e=o[k],c=e&&e.contact(),q=FilesConfig.managedAccount&&!e.isGroup()&&!(c&&c.cid());if(q){l=true;break}if(e.isValid===false){m=true;break}var f=c&&c.cid();if(f&&f.indexOf("-")>-1)f=null;var j=e.isGroup()?a.EntityType.Group:f?a.EntityType.User:a.EntityType.Email,g={role:v,type:j},n=e.email();if(n)g.email=t.html(n).text();if(j==a.EntityType.User)g.did=f;else if(j==a.EntityType.Group)g.abId=c&&c.id();i.push(g)}if(l)b&&b(h,{message:d("Sharing.ManagedAccountMessage")});else if(m)b&&b(h,{message:d("Sharing.ShareInvalidEmailError")});else if(i.length==0)b&&b(h,{message:d("Sharing.ShareNoRecipientError")});else p(h,i,u,s,false,null,null,a.UserAction.Share,r,b)};i.shareToNetworks=function(k,d,h,i,f,e){var c=[];for(var b=0;b<d.length;b++){var j=d[b],g={role:h,type:a.EntityType.Link,linkType:a.LinkType.Network,linkName:j.id};c.push(g)}p(k,c,i,null,false,null,null,a.UserAction.Share,f,e)};i.updatePermissions=function(i,c,f,h,e,g){var d=c.type==a.EntityType.GroupOwned;delete c.link;p(i,d?[]:[c],null,null,d,d?c.role:null,f&&f.suppressNotification,h,function(i,f){var h;if(f)for(var g=0;g<f.length;g++){var a=f[g];if(c.linkType===a.linkType&&c.role===a.role&&c.type===a.type&&(c.id==null||b.StringHelpers.caseInsensitiveStringEquals(c.id,a.id)))h=f[g]}e&&e(i,d?c:h)},g)};i.fetchPermissions=function(a,c,f,i){if(!i&&a.sharingLevelValue==h){var k={canChange:true,group:false,groupUserRole:0,ownerName:a.ownerName,ownerCid:a.ownerCid,permissionScopes:[l(a)]};c(a,k);return}var g=!i&&t(a);if(g)c(a,g);else{var e=v(a),d={id:a.id,v:Math.random(),mkt:$Config.mkt};if(a.ownerCid)d.cid=a.ownerCid;if(b.SkyDriveItemHelper.isGroupItem(a))d.group=a.group;if(e)d.itemOnly=e;var j=FilesConfig.baseApiUrl+"GetPermissions?"+$Utility.serialize(d),m=new b.DataRequest(j,j,null,function(d){u(a,d,e);var b=t(a,true);c&&c(a,b)},function(b){f&&f(a,b.error)});m.start()}};function k(a){return function(e,d,c){var b=c&&c[0];if(b)d.code=b.code;a&&a(e,d)}}function p(a,h,n,l,q,p,j,m,d,k){var c={id:a.id,entities:h};if(l!==null)c.requireSignIn=l;if(q){c.group=1;c.groupUserRole=p;c.ownerCid=a.ownerCid}if(n)c.message=n;if(j!==null)c.suppressNotification=j;if(m!=null)c.userAction=m;var o=Object.toJSON(c),s=FilesConfig.baseApiUrl+"SetPermissions",r=new b.DataRequest(null,s,o,function(f){var c=f.permissions,b=c&&c.permissionScopes,e=b&&b[0]&&b[0].entities;u(a,c);a.expire(false);a.invalidate();d&&d(a,e)},function(b){if(h.length==1&&h[0].role==e&&b.error&&b.error["code"]==f){i.fetchPermissions(a,function(){a.expire(false);a.invalidate()},null,true);d&&d(a,undefined)}else{if(b.errorResult)i.fetchPermissions(a,function(){a.expire(false);a.invalidate()},null,true);k&&k(a,b.primaryError?b.primaryError:b.error,b.errorResult)}},g,null,0);r.start()}function l(a){return {id:a.id,name:a.name,entities:[]}}function n(d,f,e,g){var a=f.permissionScopes;for(var b=0;b<a.length;b++)if(a[b].id==d.id){if(!g)return a[b];return a.splice(b,1)[0]}if(e){var c=l(d);a.push(c);return c}return null}function y(b,c){var a;if(!b["getParent"]){a=n(b,c,false,true);if(a)c.permissionScopes.unshift(a);return}var d=[];while(b){a=n(b,c,false,true);if(a)d.push(a);b=b.getParent(true)}c.permissionScopes=d.concat(c.permissionScopes)}function x(d,c){c.permissionScopes=c.permissionScopes||[];y(d,c);var e=c.permissionScopes,f=e[0];if(e.length==0||!b.StringHelpers.caseInsensitiveStringEquals(f.id,d.id)){f=l(d);e.splice(0,0,f)}if(c.group||!q(d)){var h,g;if(c.group){var i=m(d);h=n(i,c,true);g={role:c.groupUserRole,type:a.EntityType.GroupOwned}}else{h=e[0];g={did:d.ownerDCid,id:c.ownerCid,name:c.ownerName,role:a.Role.Owner,type:a.EntityType.User}}h.entities.unshift(g);return}}function u(b,g,f){x(b,g);if(r(b)){w(b,g);return}if(f===undefined)f=false;var e=g.permissionScopes,h={};for(var i in g)if(i!=="permissionScopes")h[i]=g[i];var a=b,d;a:for(d=0;a&&!j(a)&&d<e.length;d++){var k=false;while(a&&!j(a)){k=false;if(e[d].id===a.id){a._permissionScope=new c(e[d]);k=true}else a._permissionScope=new c(l(a));if(f)break a;a=a.getParent(true);if(k)break}}if(d<e.length&&!f){var p=e.splice(d,e.length-d);m(b)._cappedPermissions=p}else if(o(b))m(b)._cappedPermissions=[];while(a&&!j(a)&&!f){a._permissionScope=new c(l(a));a=a.getParent(true)}var n=new c(h);b._permissionExtra=n;if(!h["group"]&&!f){a=b.getParent(true);while(a&&!j(a)){a._permissionExtra=n;a=a.getParent(true)}}}function t(b,g){if(r(b))return s(b,g);var d=b._permissionExtra;if(!d||!g&&d.isExpired())return null;var c={};for(var i in d.value)c[i]=d.value[i];c.permissionScopes=[];var a=b;while(a&&!j(a)){var e=a._permissionScope;if(!e||!g&&e.isExpired())return null;var f=e.value;if(f.entities.length>0||a==b){f.name=a.name;c.permissionScopes.push(f)}a=a.getParent(true)}if(o(b)){var h=m(b);if(h._cappedPermissions&&h._cappedPermissions.length>0)c.permissionScopes=c.permissionScopes.concat(h._cappedPermissions)}return c}function v(c){if(r(c))return s(c)?undefined:false;if(o(c)){var h=m(c);if(!h._cappedPermissions)return false}var d=-1,e=0,a=c;while(a&&!j(a)){var g=a._permissionScope;if(!g||g.isExpired())d=e;else{var f=a._permissionExtra;if(a===c&&(!f||f.isExpired()))d=e}if(d>0)break;a=a.getParent(true);e++}if(d===-1)return undefined;if(b.SkyDriveItemHelper.isGroupItem(c))return false;return !d}function s(c,b){var a=c._simplePermissions;if(!a||!b&&a.isExpired())return null;return a.value}function w(b,a){b._simplePermissions=new c(a)}function r(a){return FilesConfig.isWacSharing||!a["getParent"]||!a.group&&!q(a)}function o(a){return (a.isQt("mru")||a.isQt("shared"))&&q(a)}function q(a){return b.StringHelpers.caseInsensitiveStringEquals(z,a.ownerCid)}}function c(a){this.value=a;this.expires=(new Date).getTime()+i;this.isExpired=function(){return this.expires<(new Date).getTime()}}})();(function(){var c=wLive.Core,d=1,b;a.Status={None:0,Connected:1,Error:2};c.NetworksProvider=a;function a(){var h=this,g,f=[],e=[];h.clearCache=function(){b=null};h.fetchNetworks=function(a,h){if(b)a&&a(b.networks);else{if(a)f.push(a);if(h)e.push(h);if(!g){g=true;var k={resultSet:d},i=FilesConfig.baseApiUrl+"GetNetworks?"+$Utility.serialize(k),l=new c.DataRequest(i,i,null,function(a){g=false;b=a;j(f,b.networks);f=[];e=[]},function(a){g=false;var b=a&&a.error;j(e,b);f=[];e=[]});l.start()}}};function j(b,d){for(var a=0;a<b.length;a++){var c=b[a];try{c&&c(d)}catch(e){}}}h.getConnectedNetworks=function(c){var b=i(c,a.Status.Connected),d=i(c,a.Status.Error);jQuery.merge(b,d);return b};h.getUpsellNetworks=function(b){return i(b,a.Status.None)};function i(c,f){var b=[],e=c.length;for(var a=0;a<e;a++){var d=c[a];if(d.status==f)b.push(d)}return b}}})();(function(){var a=wLive.Core,d=wLive.Controls,e=a.AleHelpers.getPCString,b="SharingListExpandedTemplate",f="click";d.PermissionScopeControl=c;function c(g,l,j,c,d,n,q,p){var h=e("Sharing.ScopeHeaderFormat"),r=this,i={};r.render=function s(){var f=jQuery('<li class="ips_scope"></li>');j.append(f);sutra(f,"$Sutra.SkyDrive.InfoPaneSharingScope");if(!a.StringHelpers.caseInsensitiveStringEquals(c.id,d.id)&&!n)m(f);var h=jQuery("<ul></ul>");f.append(h);sutra(h,"$Sutra.SkyDrive.InfoPaneSharingEntities");var l=[],e=[];for(var i=0;i<d.entities.length;i++)o(l,e,h,d.entities[i]);for(var g=0;g<e.length;g++){var p=e[g][0];k(e[g][1],null)}$ic.ic.createICsFromCids(b,l,k,true);if(j.closest(".ModalDialog").length)jQuery(".ips_ic_remove:first").focus()};function o(g,e,f,a){var d=new wLive.Controls.PermissionEntityControl(a,c,l,f,q,p);d.render();var b=d.getIcId();if(b){i[b]=d;if(a.did!=null)g.push([a.did,b]);else e.push([a.id,b])}}function m(k){if(!FilesConfig.isWacSharing&&!((c.isQt("mru")||c.isQt("shared"))&&a.StringHelpers.caseInsensitiveStringEquals(g.callerCid,c.ownerCid))){var o=a.SkyDriveItem.getItemKey(d.id,c.ownerCid,c.group),b=g.dataModel.getItem(o,true),n=b?'<a href="#" class="ips_scope_link"></a>':'<span class="ips_scope_link"></span>',q='<div class="ips_scope_header t_ctc">'+h.format(n)+"</div>",e=jQuery(q),i=jQuery(".ips_scope_link",e);i.text(d.name);if(b)i.bind(f,function(){g.selectionManager.deselectAll()});k.append(e);sutra(e,"$Sutra.SkyDrive.InfoPaneSharingScopeHeader");if(b){var m=g.actionManager.getAction("ViewItem",b);g.actionManager.setATagAction(m,i,g.infoPaneBiciLoc)}}else{var j="/?cid="+c.ownerCid.encodeUrl()+"&id="+d.id.encodeUrl();if(c.group)j+="&group="+c.group;var l='<a href="'+j.encodeHtmlAttribute()+'">'+d.name.encodeHtml()+"</a>",p='<div class="ips_scope_header">'+h.format(l)+"</div>";k.append(jQuery(p))}}function k(c,b){var a=i[c];if(a)if(b)a.icReady(b);else a.loadDefaultIc()}}})();(function(){var b=wLive.Core,k=wLive.Controls,f=b.AleHelpers.getPCString,j=b.PageController,e=b.ImageStrip,d=b.PermissionsProvider,c=d.Role,i=d.GroupRole,a=d.EntityType,g=d.LinkType,h="SharingListTemplate",q="sharingListIc",n=FilesConfig.foldersImgBaseUrl+"/categoryIcon.png",o=e.getImage("openUp",null,null),p=e.getImage("darkPanelOpenUp",null,null),r=32,s=32,l="click";k.PermissionEntityControl=m;function m(d,M,E,Q,K,I){var y=this,L,u,m,v,B,t,z=false,x,D=j.getInstance()&&b.StringHelpers.caseInsensitiveStringEquals(j.getInstance().getViewContext().currentViewType,"selfView");y.getIcId=function(){return L};y.icReady=function(b){var a=b.html;v.html(a)};y.loadDefaultIc=function(){A(null,d.email,d.id,d.did,d.name,v)};y.render=function(){x=d.type==a.GroupOwned;m=jQuery('<li class="ips_entity"><div class="ips_ic"></div><a class="ips_ic_remove" href="#" onclick="return false;"></a><div class="ips_ic_details"><div class="ips_ic_name t_ctc"></div><div class="ips_ic_role t_cstc"></div></div><div class="c_clr"></div></li>');sutra(m,"$Sutra.SkyDrive.InfoPaneSharingEntity");Q.append(m);v=jQuery(".ips_ic",m);if(x)m.addClass("ips_group");else P(d);if(!x){if(K&&d.role!=c.Owner)R();V()}W()};function W(){var b=jQuery(".ips_ic_details .ips_ic_role",m);if(!G()){m.addClass("ips_link_entity");b.remove();return}var h=d.role;sutra(b,"$Sutra.SkyDrive.InfoPaneSharingEntityRole");if(!K||d.type==a.Public||h==c.Owner||!FilesConfig.isDependentOnNewStorageInterface&&d.type==a.Link){b.text(w(h));J(b,w(h))}else{var e=c;if(x)e=i;var g;t=jQuery('<div class="ips_choices"></div>');var s=D?p.outerHTML:o.outerHTML;g=jQuery('<a class="c_ml t_ctc ips_theme" href="#" onclick="return false;"></a>').text(w(h));g.append(jQuery('<span class="c_chev"></span>').append(s));t.append(g);t.append('<div class="c_clr"></div>');var f=jQuery('<ul class="c_m t_hovl"></ul>'),q=jQuery("<li></li>"),k=jQuery('<a href="#" target="_blank"></a>').text(w(e.View));k.bind(l,{choice:e.View},F);q.append(k);f.append(q);var n=jQuery("<li></li>"),j=jQuery('<a href="#" target="_blank"></a>').text(w(e.Edit));j.bind(l,{choice:e.Edit},F);n.append(j);f.append(n);t.append(f);var r=0;g.click(function(a){if(!r)$menu.create(a,0,{menuEl:f[0]});r=1});b.append(t)}}function F(c){var a=c.data.choice;if(a!=d.role){C();B=d.role;d.role=a;E.updatePermissions(M,d,{suppressNotification:true},b.PermissionsProvider.UserAction.Manage,O,N);jQuery(".c_ml",t).text(w(a))}$menu.closeCurrent();return false}function O(){I.render()}function N(){d.role=B;var a=jQuery('<div class="ips_error"></div>');m.prepend(a);H(a,f("Sharing.EditPermissionsFailure"));t.val(B)}function V(){var a=jQuery(".ips_ic_details .ips_ic_name",m);a.text(d.name);a.attr("type",d.type);if(G())J(a,d.name);sutra(a,"$Sutra.SkyDrive.InfoPaneSharingEntityName")}function J(a,b){a.attr("title",b)}function R(){var a=jQuery(".ips_ic_remove",m),b=f("Sharing.DeletePermission"),c=jQuery('<div class="ips_grey_remove"></div>').append(e.getImage("close",b,b));sutra(a,"$Sutra.SkyDrive.InfoPaneSharingEntityRemove");a.append(c);a.click(S)}function C(){jQuery(".ips_error",m).remove()}function S(){if(!z){z=true;C();E.deletePermission(M,d,U,T)}}function T(){z=false;C();var a=jQuery('<div class="ips_error"></div>');m.prepend(a);H(a,f("Sharing.EditPermissionsFailure"))}function U(){I.render()}function P(b){z=false;var i=b.name,d=b.type,j=b.did,h=b.icon;u=i;if(d==a.User)L=q+b.id;else if(d==a.Email)y.loadDefaultIc();else if(d==a.Group&&!b.icon)A(n,u,b.id,j,i,v);else if(d==a.Group)A(b.icon,u,b.id,j,i,v);else if(d==a.Link||d==a.Public||d==a.Friends){var c;if(h&&h.url){c=jQuery("<img/>");c.attr("src",h.url);c.attr("height",r);c.attr("width",s)}else{var f=d==a.Link?b.linkType!=g.Embed?b.linkType!=g.Form?"linkIcon":"formLinkIcon":"embedIcon":d==a.Friends?"friendsIcon":"publicIcon";f=D?f+"White":f;c=jQuery(e.getImage(f,u,u))}c.addClass("ips_ic_icon");c.attr("alt",u);c.attr("title",u);v.append(c)}}function A(e,c,i,f,g,a){var j=$ic.ic.createICFromTemplate(h,0,0,0,h,i,f,g,0,0,e,0,0,0,1,0),d=j.html;a.html(d);var b=jQuery(".c_ic_frame_clip",a);b.attr("title",c)}function G(){var b=d.type;return !(b==a.Link&&d.linkType!=g.Network)}function w(b){var a="CanView";if(x){if(b==i.Edit)a="CanEdit";a="GroupMembers"+a}else if(b==c.Edit)a="CanEdit";else if(b==c.Owner)a="Owner";return f("Sharing."+a)}function H(b,c){var a=new k.InlineError(b,c);a.render()}}})();(function(){var a=wLive.Core,d=wLive.Controls,c=a.AleHelpers.getPCString,b="SharingListExpandedTemplate",k="sharingListIc",e=100,f=1e3,h=5,j=12,i=a.PermissionsProvider;d.SharingList=g;function g(n,j,p,A){var o=this,i,k,l,m,g,h=false;o.render=function(b){b=b||g;var c=a.SkyDriveItem.areItemsSame(b,g,true);g=b;clearTimeout(m);clearTimeout(l);if(c)s();else m=setTimeout(s,e)};function s(){l=setTimeout(function(){y()},f);w()}o.dispose=function(){clearTimeout(l);clearTimeout(m);if(h){$ic.ic.removeICsFromNamespace(b);h=false}};function w(){p.fetchPermissions(g,x,u)}function y(){if(h){$ic.ic.removeICsFromNamespace(b);h=false}k=null;j.empty();var a=new wLive.Controls.LoadingSpinner(j);a.render()}function x(p,a){if(p.id!=g.id)return;clearTimeout(l);clearTimeout(m);if(z(a)){r(jQuery(".ips_commands",j));k=a;return}k=a;i=jQuery("<div></div>");i.insertAfter(j).hide();var o=jQuery('<div class="ips_commands"></div>');r(o);i.append(o);var u=FilesConfig.hcid,f=u==p.ownerCid||n.isSuper,d=a.permissionScopes;if(h){$ic.ic.removeICsFromNamespace(b);h=false}if(f&&d&&d.length==1&&d[0].entities&&d[0].entities.length==0){var s=g.folder?c("Sharing.PrivateFolder"):c("Sharing.PrivateFile");q(s);t();return}h=true;v(a,f);var e=a.sharingLevel;if(e)q(e);t()}function r(d){d.empty();var e=A.fs(g)&&g.folder?"Folder":"";b=function b(b){if(b.id==="Share"||b.id==="SendSurvey"){var f=a.ActionManager.setATagAction(b.action,null,n.infoPaneBiciLoc),h=c(b.stringId+e+"Command")||b.string;f.text(h);sutra(f,"$Sutra.SkyDrive."+b.id+"Command");var g=jQuery('<div class="ipc_container"></div>').append(f);d.append(g)}};a.CommandManager.processCommands(n,g,null,null,b,null,null,null)}function t(){i.show();j.remove();sutra(i,"$Sutra.SkyDrive.InfoPaneSharing");j=i}function z(a){if(!a||!k||a.permissionScopes.length!=k.permissionScopes.length)return false;if(a.permissionScopes.length&&a.permissionScopes[0].id==g.id&&a.permissionScopes[0].entities.length||a.permissionScopes.length==1&&a.permissionScopes[0].entities&&a.permissionScopes[0].entities.length==0)return false;for(var b=0;b<a.permissionScopes.length;b++)if(Object.toJSON(a.permissionScopes[b].entities)!=Object.toJSON(k.permissionScopes[b].entities))return false;return true}function v(h,k){var b=jQuery('<ul class="ips_list"></ul>');sutra(b,"$Sutra.SkyDrive.InfoPaneSharingScopes");b.addClass("ips_extended");i.append(b);var m=[],c=h.permissionScopes,f=c.length;for(var e=0;e<f;e++){var d=c[e],l=h.canChange&&a.StringHelpers.caseInsensitiveStringEquals(d.id,g.id);if(d.entities.length){var j=new wLive.Controls.PermissionScopeControl(n,p,b,g,d,!k,l,o);j.render()}}if(f>1&&c[0].entities&&c[0].entities.length==0)jQuery("li:first-child",b).addClass("ips_scope_first");b.append(jQuery('<div class="c_clr"></div>'))}function q(b){var a=jQuery('<div class="t_ctc ips_level"></div>').text(b);sutra(a,"$Sutra.SkyDrive.InfoPaneSharingSimpleSharingLevel");i.append(a)}function u(f){if(f.id!=g.id)return;if(h){$ic.ic.removeICsFromNamespace(b);h=false}j.empty();clearTimeout(l);var i=c("Sharing.GetPermissionsError"),a=jQuery('<div class="ips_error"></div>');j.append(a);var e=new d.InlineError(a,i);e.render()}}$Do.register("SharingList")})();(function(){var d=wLive.Core,b=wLive.Controls,c=d.AleHelpers.getPCString,f=3,h="keydown",a={Email:1,Network:2,Link:3};e.Panes=a;var g='<div class="sd_pop_body"><ul class="sd_menu"><li class="sd_menu_tab sd_menu_selected"><a href="#" class="sd_menu_sendemail" onclick="return false"></a></li><li class="sd_menu_tab"><span class="sd_menu_oh"><a href="#" class="sd_menu_postto" onclick="return false"></a></span></li><li class="sd_menu_tab"><a href="#" class="sd_menu_getlink" onclick="return false"></a></li><div class="sd_help"><a target="_blank" href="'+FilesConfig.sharingLearnMoreDestination+'" class="sd_help_link"></a></div>'+"</ul>"+'<div class="sd_contents">'+'<div class="sd_loading"></div>'+'<div class="sd_content"></div>'+"</div>"+'<div class="c_clr"></div>'+"</div>";b.ShareDialog=e;function e(z,p,s,F,D){var e=this,H,i,u=D,m=a.Email,w=new d.NetworksProvider,y=false,l,j,A,k,x,I,n,t,B,r,C,o="sd_menu_disabled",v="sd_menu_selected";e.render=function(){if(!y){var d=jQuery(g);sutra(d,"$Sutra.SkyDrive.ShareDialog");k=jQuery(".sd_menu",d);sutra(k,"$Sutra.SkyDrive.ShareDialogMenu");x=jQuery(".sd_menu_sendemail",k).text(c("Sharing.SendEmail")).parent().click(function(){q(this,a.Email)});_$getALinkTab=jQuery(".sd_menu_getlink",k).text(c("Sharing.GetALink")).parent().click(function(){q(this,a.Link)});n=jQuery(".sd_menu_postto",k).text(c("Sharing.PostToLink")+" ").parent().parent().click(function(){q(this,a.Network)});t=jQuery(".sd_menu_oh",n);B=jQuery(".sd_menu_tab",k);sutra(x,"$Sutra.SkyDrive.ShareDialogMenuEmailPaneTab");sutra(_$getALinkTab,"$Sutra.SkyDrive.ShareDialogMenuLinkPaneTab");sutra(n,"$Sutra.SkyDrive.ShareDialogMenuNetworkPaneTab");j=jQuery(".sd_loading",d);l=jQuery(".sd_content",d);j.hide();A=jQuery(".sd_help_link",d);A.text(c("Sharing.LearnMore"));d.bind(h,G);z.append(d);if(!FilesConfig.managedAccount)w.fetchNetworks(E);else{_$getALinkTab.hide();n.hide()}y=true}if(i)i.dispose();l.empty();if(m==a.Link)i=new b.LinkPane(l,p,s,e);else if(m==a.Network)i=new b.NetworkPane(l,p,w,s,e);else i=new b.EmailPane(l,p,s,e);i.render(r)};e.setVisiblePane=function(a){if(a!=m){r=i.getUserMessage&&i.getUserMessage()||r;m=a;e.render()}};e.updateLayout=function(){u&&u()};e.close=function(){i.dispose();F();z.empty();C=true};e.showLoading=function(c){j.empty();var b=new wLive.Controls.LoadingSpinner(j,c);b.render();j.show();var a=(l.height()-j.height())/2;j.css("padding-top",Math.ceil(a));j.css("padding-bottom",Math.floor(a));l.hide()};e.hideLoading=function(){j.hide();l.show()};e.enableMenuTabs=function(){k.removeClass(o)};e.disableMenuTabs=function(){k.addClass(o)};function q(a,b){if(!k.hasClass(o)){B.removeClass(v);jQuery(a).addClass(v);e.setVisiblePane(b)}}function G(b){var a=b.which;if(a==27){e.close();return false}else if(!d.DomHelpers.isTextInputElement(jQuery(b.target))&&(a==37||a==38||a==39||a==40))return false}function E(g){if(!C){var c=[];for(var h=0;h<g.length;h++){var l=g[h];if(l.status==d.NetworksProvider.Status.Connected)c.push(l)}var k=c.length>0?c:g,j=Math.min(k.length,f);if(j>0){var b=jQuery("<span></span>");sutra(b,"$Sutra.SkyDrive.NetworkIcons");for(var i=0;i<j;i++){var e=k[i],a=jQuery('<img width="16" height="16" />');sutra(a,"$Sutra.SkyDrive.NetworkIcon"+e.id);a.attr("src",e.iconSmall);a.attr("alt",e.name);b.append(a)}t.append(b)}}}}$Do.register("wLive.Controls.ShareDialog")})();(function(){var f=wLive.Core,c=wLive.Controls,a=f.AleHelpers.getPCString,e="disabled",i=0,k=3006,j=3009,g=20,l='<h2 class="sd_header"></h2><form><div><div class="sd_email_to_label"></div><div class="sd_email_to_line cpv2" id="sharingContactPicker"><textarea rows="1" cols="60" class="cp_textarea"></textarea></div><div class="c_clr"></div></div><div class="sd_email_error"></div><textarea class="sd_email_message"></textarea><div class="sd_email_can_edit"><input id="sd_email_can_edit" type="checkbox" checked="checked" /><label for="sd_email_can_edit"></label></div><div class="sd_email_signin_req"><input id="sd_email_signin_req" type="checkbox" /><label for="sd_email_signin_req"></label></div><div class="sd_btns"><input class="sd_email_share default" type="button" /><input class="sd_cancel" type="button" /></div></form>',d=a("Sharing.EmailPersonalMessagePlaceholder"),b,h;c.EmailPane=m;function m(m,A,t,o){var F,q,u,n,z,x,p,v,s,w=this;w.render=function(a){v=a;sutra(m,"$Sutra.SkyDrive.ShareDialogEmailPane");m.html(l);$Do.when("WLXContactPickerV2",0,function(){var a=new wLive.ContactPickerV2.ViewModels.FlatContactsDataModel;b=new wLive.ContactPickerV2.ViewModels.ContactPickerModel(a,{autoExpandCategories:true});h=new wLive.ContactPickerV2.Controls.ContactPicker(jQuery("#sharingContactPicker"),b,{excludeSelectedFromFrequentList:true,maxHeight:250,showContactListOnFocus:wLive.ContactPickerV2.Controls.ContactPicker.ListMode.none});setTimeout(D,0)})};w.getUserMessage=function(){var a=p&&p.val();return !a||a==d?null:a};w.dispose=function(){s=true};function D(){if(s)return;var f=jQuery(b);f.bind("selectedContacts",r);f.bind("deselectedContacts",r);f.bind("editedContact",r);var i=t.extension,j=jQuery(".sd_header",m);j.text(a("Sharing.EmailShareHeaderFormat").format(t.name+(i?i:"")));sutra(j,"$Sutra.SkyDrive.EmailPaneHeader");n=jQuery(".sd_email_error",m);var w=m.find(".sd_email_to_label").text(a("Sharing.ToLabel"));p=jQuery(".sd_email_message",m);var k=new c.PlaceholderInput(p,d);k.render();sutra(p,"$Sutra.SkyDrive.EmailPaneMessageInput");v&&p.val(v);var g=jQuery(".sd_email_can_edit",m),e=jQuery(".sd_email_signin_req",m);z=jQuery("#sd_email_can_edit",g);x=jQuery("#sd_email_signin_req",e);q=jQuery(".sd_email_share",m);u=jQuery(".sd_cancel",m);sutra(g,"$Sutra.SkyDrive.EmailPaneRecipientsCanEdit");sutra(e,"$Sutra.SkyDrive.EmailPaneRecipientsMustSignIn");sutra(q,"$Sutra.SkyDrive.EmailPaneShare");sutra(u,"$Sutra.SkyDrive.EmailPaneCancel");jQuery("label",g).text(a("Sharing.RecipientsCanEdit"));jQuery("label",e).text(a("Sharing.SignInRequired"));q.val(a("Sharing.Share"));q.click(E);u.val(a("Cancel"));var l=m.height();m.css("min-height",l);sutra(jQuery(".cp_inputContainer",m),"$Sutra.SkyDrive.EmailPaneToLine");o.hideLoading();h.setFocus(false);if(typeof o.updateLayout==="function")o.updateLayout()}function r(){var d=b.selectedContacts().length,c=d>g,f=c?a("Sharing.MaxContacts").format(g):"";if(c)q.attr(e,e);else q.removeAttr(e);y(f)}function y(a){n.empty();if(a){var b=new c.InlineError(n,a);b.render();n.show()}else n.hide()}function E(){y();o.showLoading(a("Sharing.SharingFormat").format(t.name));o.disableMenuTabs();var g=z.attr("checked")?f.PermissionsProvider.Role.Edit:f.PermissionsProvider.Role.View,e=!!x.attr("checked"),c=p.val();c=c==d?null:c;n.empty();n.hide();A.shareToContacts(t,b.selectedContacts(),g,e,c,C,B)}function B(E,d,l){if(s)return;var e=d.message,f=false;if(!e&&l){var y=0,A=0;for(var t=0;t<l.length;t++){var p=l[t],m=p.entity;if(p.status&&p.status!=i)y++;else{A++;var v=b.selectedContacts();for(var q=0;q<v.length;q++){var h=v[q],g=h.contact();if(m.email==h.email()||g&&(m.did==g.cid()||m.abId==g.id())){b.deselectContactBySelectedContactId(h.id());break}}}}if(A==0)e=a("Sharing.ShareErrorAllFailed");else e=a("Sharing.ShareErrorSomeFailed").format(y)}if(d&&d.code==k){var C=d.data,x=d.message;if(C&&x){var z=Object.fromJSON(C),w=z.displayAction,B=z.hipUrl;if(B&&w){e=x.encodeHtml()+' <a href="'+B.encodeHtmlAttribute()+'" target="_blank">'+w.encodeHtml()+"</a>";f=true}}}if(d&&d.code==j){var u=d.message;if(u){e=u.format('<a target="_top" href="http://'+FilesConfig.gLinkDomain+'/8SESkyDrive/VerifyAccount">',"</a>");f=true}}r();var D=new c.InlineError(n,e,f);D.render();n.show();o.hideLoading();o.enableMenuTabs()}function C(){if(s)return;o.close()}}})();(function(){var d=wLive.Core,c=wLive.Controls,a=d.AleHelpers.getPCString,i=0,g=3101,j=5,k=5,l=23,h=30,e=a("Sharing.PersonalMessagePlaceholder"),b="click",f=d.NetworksProvider.Status;c.NetworkPane=m;function m(x,J,A,C,n){var F=this,t,w=0,m={},z=-1,r,u,E,s,q,B,o,p,y;F.render=function(h){var i=C.extension;sutra(x,"$Sutra.SkyDrive.ShareDialogNetworkPane");var j=jQuery('<h2 class="sd_header"></h2>').text(a("Sharing.NetworkPostHeaderFormat").format(C.name+(i?i:"")));sutra(j,"$Sutra.SkyDrive.NetworkPaneHeader");s=jQuery('<div class="sd_post_error"></div>');s.hide();r=jQuery('<div class="sd_net_line"></div>');var d=jQuery('<div class="sd_message_cntr"><textarea class="sd_post_message"></textarea><div class="sd_char_cntr"></div></div>');o=d.find(".sd_post_message");p=d.find(".sd_char_cntr");var k=new c.PlaceholderInput(o,e);k.render();sutra(o,"$Sutra.SkyDrive.NetworkPaneMessageInput");o.bind("keyup",function(){G()});h&&o.val(h);var f=jQuery('<div class="sd_post_can_edit"><input id="sd_post_can_edit" type="checkbox" /><label for="sd_post_can_edit"></label></div>');E=jQuery("input",f);jQuery("label",f).text(a("Sharing.RecipientsCanEdit"));sutra(E,"$Sutra.SkyDrive.NetworkPaneRecipientsCanEdit");q=jQuery('<input class="sd_post_share default" type="button" />');q.val(a("Sharing.Post"));q.click(S);sutra(q,"$Sutra.SkyDrive.NetworkPanePost");B=jQuery('<input class="sd_cancel" type="button" />');B.val(a("Cancel"));var b=jQuery("<form></form>");b.append(s);b.append(r);b.append(d);b.append(f);var g=jQuery('<div class="sd_btns"></div>');b.append(g);g.append(q);g.append(B);sutra(B,"$Sutra.SkyDrive.NetworkPaneCancel");x.append(j);x.append(b);n.showLoading();A.fetchNetworks(Q,M)};F.getUserMessage=function(){var a=o&&o.val();return !a||a==e?null:a};F.dispose=function(){o.unbind("keyup");y=true};function S(){var c=[];for(var g in m)c.push(m[g]);n.showLoading(a("Sharing.PostingFormat").format(C.name));n.disableMenuTabs();var f=E.prop("checked")?d.PermissionsProvider.Role.Edit:d.PermissionsProvider.Role.View,b=o.val();b=b==e?null:b;s.empty();s.hide();J.shareToNetworks(C,c,f,b,P,O)}function O(A,z,k){if(y)return;var e=z.message,q=false;if(k){var r=0,u=0,h;for(var p=0;p<k.length;p++){var b=k[p],l=b.entity;if(b.status&&b.status!=i){r++;if(b.errorCode&&b.errorCode==g)for(var o=0;o<t.length;o++){var j=t[o];if(j.id==l.linkName){var d=b.uniqueError;h=d.message;q=true;j.status=f.Error;if(d&&d.data){var x=Object.fromJSON(d.data);j.connectLink=x.url}delete m[l.linkName];w--;break}}}else{u++;delete m[l.linkName];w--}}if(h)e=h;else if(u==0)e=a("Sharing.PostErrorAllFailed");else e=a("Sharing.PostErrorSomeFailed").format(r)}D();H();var v=new c.InlineError(s,e,q);v.render();s.show();n.hideLoading();n.enableMenuTabs()}function P(){if(y)return;n.close()}function Q(i){if(y)return;n.hideLoading();t=A.getConnectedNetworks(i);var d=A.getUpsellNetworks(i),c;if(t.length==0){var j=a("Sharing.NoneConnectedUpsellFormat").format('<a class="c_ml" href="#" onclick="return false;">',"</a>"),f=jQuery('<span class="sd_net_upsell"></span>').html(j);sutra(f,"$Sutra.SkyDrive.NetworkPaneNoNetworksUpsell");c=jQuery("a",f);r.append(f)}else{u=jQuery('<ul class="sd_post_netlist"></ul>');sutra(u,"$Sutra.SkyDrive.NetworkIcons");H();r.append(u);var g=jQuery('<div class="sd_post_uplink"></div>');if(d.length>0){c=jQuery('<a class="c_ml" href="#" onclick="return false;"></a>').text(a("Sharing.ConnectMenu"));c.append(jQuery('<span class="c_chev">&nbsp;&#9660;</span>'))}else{c=jQuery('<a class="c_ml" target="_blank"></a>').text(a("Sharing.ManageMyServices"));c.attr("href",FilesConfig.manageServicesUrl);c.bind(b,v)}g.append(c);r.append(g);r.append('<div class="c_clr"></div>')}if(d.length>0){var e=N(d);r.append(e);sutra(c,"$Sutra.SkyDrive.NetworkPaneConnectMenuLink");sutra(e,"$Sutra.SkyDrive.NetworkPaneConnectMenu");var h=0;c.click(function(a){if(!h)$menu.create(a,1,{menuEl:e[0]});h=1})}D();o.focus();if(typeof n.updateLayout==="function")n.updateLayout()}function v(){A.clearCache();n.close()}function H(){u.empty();var b=t.length,c=Math.min(j,b);for(var a=0;a<c;a++){var d=t[a],e=I(d);u.append(e)}u.append('<div class="c_clr"></div>')}function I(c){var g=jQuery('<li class="sd_post_netop"></li>'),d=jQuery('<input type="checkbox" />'),h=jQuery("<label></label>"),e=jQuery("<img />");e.attr("alt",c.name);e.attr("src",c.iconSmall);var i="sd_net_box_"+c.id;if(c.status==f.Error){d.prop("disabled",true);var j=a("Sharing.NetworkErrorTooltipFormat").format(c.name);e=jQuery('<a target="_blank" href="#" title="'+j.encodeHtmlAttribute()+'"></a>').append(e);e.bind(b,{msg:c.connectLink?c.connectLink:FilesConfig.manageServicesUrl},L)}else if(m[c.id])d.prop("checked",true);d.attr("id",i);h.attr("for",i);h.append(e);g.append(d);g.append(h);sutra(d,"$Sutra.SkyDrive.NetworkIcon"+c.id);d.click(function(){if(d.prop("checked")){if(!m[c.id]){m[c.id]=c;w++}}else if(m[c.id]){delete m[c.id];w--}D();R();G()});return g}function R(){var a=-1;for(var c in m){var b=m[c].postMax;if(a==-1||b<a)a=b}z=a}function G(){var b=o.val().length+l;if(z>0){if(b>z-h){p.show();sutra(p,"$Sutra.SkyDrive.CharacterCounter")}if(b>z){p.addClass("char_cnt_error");q.prop("disabled",true);sutra(p,"$Sutra.SkyDrive.CharacterCounterError")}else{p.removeClass("char_cnt_error");q.prop("disabled",false);sutra(p,"$Sutra.SkyDrive.CharacterCounter")}p.text(a("Sharing.NetworkCharacterCounterFormat").format(b,z))}else{unsutra(p);p.hide()}}function D(){var a=w==0;q.prop("disabled",a)}function N(h){var m=Math.min(k,h.length),c=jQuery('<ul class="c_m t_hovl"></ul>');for(var j=0;j<m;j++){var d=h[j],l=jQuery('<li class="sd_post_upsell"></li>'),e=jQuery('<a href="#" target="_blank"></a>'),i=jQuery('<img class="sd_post_upicon" />');i.attr("alt",d.name);i.attr("src",d.iconSmall);e.bind(b,{msg:d.addLink},K);e.append(i);e.append(jQuery("<span></span>").text(d.name));l.append(e);c.append(l)}var f=jQuery('<a target="_blank"></a>').text(a("Sharing.FindMoreServices")),g=jQuery('<a target="_blank"></a>').text(a("Sharing.ManageMyServices"));f.attr("href",FilesConfig.findServicesUrl);f.bind(b,v);g.attr("href",FilesConfig.manageServicesUrl);g.bind(b,v);if(h.length>0)c.append('<li class="c_ms"></li>');c.append(jQuery("<li></li>").append(f));c.append(jQuery("<li></li>").append(g));return c}function K(b){var a=b.data.msg+"&view=popup&brand=skydrive&scenarios=status_publish&biciid=skydrivepub&closenoredirect=true";window.open(a,"addNetwork","width=720px,height=520px,status=no,toolbar=no,resizeable=yes,menubar=no,scrollbars=yes",true);v();return false}function L(b){var a=b.data.msg;window.open(a,"fixNetwork","width=450px,height=525px,status=no,toolbar=no,resizeable=yes,menubar=no,scrollbars=yes",true);v();return false}function M(b){if(y)return;n.hideLoading();x.empty();var a=new c.InlineError(x,b.message);a.render()}}})();(function(){var c=wLive.Core,e=wLive.Controls,a=c.AleHelpers.getPCString,b=c.PermissionsProvider,d=b.Role,f=".sd_focusable",g="sd_link_notShort",h=$B.SF_iPhone&&!$B.Mobile;e.LinkPane=i;function i(l,n,i,k){var w=this,j,v,q,u,t,s,p,m;w.render=function(){var c=i.extension;sutra(l,"$Sutra.SkyDrive.ShareDialogLinkPane");var e=jQuery('<h2 class="sd_header"></h2>').text(a("Sharing.GetLinkHeaderFormat").format(i.name+(c?c:"")));l.append(e);sutra(e,"$Sutra.SkyDrive.LinkPaneHeader");j=jQuery("<div></div>");l.append(j);sutra(j,"$Sutra.SkyDrive.LinkSections");if(!n.hasCachedData(i))k.showLoading();var d=jQuery('<div class="sd_btns"></div>');l.append(d);var b=jQuery('<input class="sd_cancel" type="button" />');b.val(a("Office.Sharing.Done"));d.append(b);sutra(b,"$Sutra.SkyDrive.LinkPaneCancel");n.fetchPermissions(i,z,x)};w.dispose=function(){m=true};function z(k,j){if(m)return;var g=j.permissionScopes;for(var e=0;e<g.length;e++){var h=g[e],i=c.StringHelpers.caseInsensitiveStringEquals(h.id,k.id),f=h.entities;for(var d=0;d<f.length;d++){var a=f[d];if(i&&a.type==b.EntityType.Link){if(a.linkType==b.LinkType.View)t=a;else if(a.linkType==b.LinkType.Edit)s=a}else if(a.type==b.EntityType.Public)p=a}}y()}function y(){k.hideLoading();j.empty();v=r(d.View,t,a("Sharing.ViewLinkTitle"),a("Sharing.ViewLinkDescription"));q=r(d.Edit,s,a("Sharing.EditLinkTitle"),a("Sharing.EditLinkDescription"));u=r(-1,p,a("Sharing.PublicViewLinkTitle"),a("Sharing.PublicViewLinkDescription"));var b;if(t)b=v;else if(s&&q)b=q;else if(p)b=u;if(b){var c=jQuery(f,b);if(c.length>0){c[0].focus();c[0].select()}}if(typeof k.updateLayout==="function")k.updateLayout()}function x(){if(m)return;k.hideLoading();var b=jQuery("<div></div>");l.append(b);var c=new wLive.Controls.InlineError(b,a("Sharing.GetPermissionsError"));c.render()}function r(i,g,h,f){var b=jQuery("<div></div>");sutra(b,"$Sutra.SkyDrive.LinkSection");var c=jQuery("<div></div>");sutra(c,"$Sutra.SkyDrive.LinkHeader");var e=jQuery('<div class="sd_link_title"></div>').text(h),d=jQuery('<div class="sd_link_desc"></div>').text(f);c.append(e);sutra(e,"$Sutra.SkyDrive.LinkSectionTitle");c.append(d);sutra(d,"$Sutra.SkyDrive.LinkSectionDescription");b.append(c);var a=jQuery("<div></div>");sutra(a,"$Sutra.SkyDrive.LinkHolder");b.append(a);j.append(b);o(i,g,a);return a}function o(f,l,b,m){b.empty();if(m){var n=new e.InlineError(b,m);n.render()}if(!l){var o=f==-1?a("Sharing.PublicButton"):a("Sharing.CreateLink"),j=jQuery('<input class="sd_create_button sd_focusable" type="button" />').val(o);j.click(function(){A(f,b)});b.append(j);sutra(j,"$Sutra.SkyDrive.CreateLinkButton")}else{var k;if(f==-1)k=FilesConfig.sharingBaseUrl+"?resid="+i.id;else k=l.link;var c=jQuery('<input class="sd_link_display sd_focusable" type="text" '+(!h?'readonly="true" ':"")+'value="'+k.encodeHtmlAttribute()+'" />');b.append(c);sutra(c,"$Sutra.SkyDrive.LinkSectionLink");b.append('<div class="sd_error_section"></div>');var d=jQuery('<input class="sd_shorten_button" type="button"/>').val(a("Sharing.ShortenLink"));sutra(d,"$Sutra.SkyDrive.ShortenLinkButton");if(FilesConfig.urlShorteningEnabled){b.append(d);c.width(b.width()-d.outerWidth()-16);c.addClass(g);d.click(function(){B(f,b)})}else c.width(b.width());b.bind("click focus",function(){c.select()})}}function A(c,b){b.empty();var h=new e.LoadingSpinner(b,"");h.render();if(c==-1)n.makePublic(i,g,d);else n.createLink(i,c,g,d);function g(e,d){if(m)return;o(c,d,b);var a=jQuery(f,b);if(a.length>0){a[0].focus();a[0].select()}}function d(){if(m)return;o(c,0,b,a("Sharing.LinkGenerationError"))}}function B(g,f){var a={id:i.id};if(g==d.View){a.type=b.EntityType.Link;a.linkType=b.LinkType.View}else if(g==d.Edit){a.type=b.EntityType.Link;a.linkType=b.LinkType.Edit}else a.type=b.EntityType.Public;a.cid=i.ownerCid;if(c.SkyDriveItemHelper.isGroupItem(i))a.group=i.group;var h=FilesConfig.baseApiUrl+"Shorten?"+$Utility.serialize(a),j=new c.DataRequest(h,h,null,function(b){f.empty();var a=jQuery('<input class="sd_link_display" type="text" readonly="true" value="'+b.url+'" />');f.append(a);f.click(function(){a.select()});sutra(a,"$Sutra.SkyDrive.LinkSectionLink");a.focus();a.select()},function(b){jQuery("div.ine_error").remove();var a=new e.InlineError(jQuery(".sd_error_section",f),b.error.message);a.render()});j.start()}}window.wLive.Core.ShortenResponse=function(){};window.wLive.Core.ShortenResponse.prototype={url:""}})();(function(){var a=wLive.Core,d=a.AleHelpers.getPCString;a.RemoteSingleFileUpload=e;var g='<a target="_blank" href="{0}">',f="</a>",h=0,b=a.ProcessItemSet.State,c="RemoteUpload";function e(r,s,i){var e=this,q=false,n=false,m=0,k=a.RemoteUploadManager.getInstance();e.id=h++;e.file=r;e.aborted=false;e.executing=false;e.transactionId=null;e._processItemSet=new a.ProcessItemSet;e._parentSet=s;e._parentSet.add(e._processItemSet);e._processItemSet.type=a.ProcessItemSet.Type.RemoteUpload;e._processItemSet.state=b.Pending;e._processItemSet.data=r;e._processItemSet.operation=e;e._processItemSet.invalidate();e.start=function(){e._processItemSet.state=b.Pending;e._processItemSet.progress=0;e._processItemSet.invalidate();p()};e.restartUpload=function(){m++;e._processItemSet.setCompleted(false);e._processItemSet.setError(null);e._processItemSet.state=b.Pending;e._processItemSet.progress=0;e._processItemSet.invalidate();e.start()};e.abort=function(a){if(!e.aborted){if(e.transactionId){k._removeTransaction(e.transactionId,e._processItemSet.state==b.Completed);if(!a&&e._processItemSet.state!=b.Completed&&e._processItemSet.state!=b.Error)o()}j()}e.aborted=true};e.handleErrorResolution=function(c,b){e.executing=false;switch(b.id){case a.ProcessErrorActions.NameConflictRename.id:n=true;e.restartUpload();break;case a.ProcessErrorActions.NameConflictOverwrite.id:n=false;q=true;e.restartUpload();break;case a.ProcessErrorActions.Retry.id:e.restartUpload()}};e._updateProgress=function(a){if(!e.transactionId){e.transactionId=a.transactionId;e._processItemSet.state=b.Active;k._newTransaction(e.transactionId,e)}var c=false;if(a.error)l(a);else{e._processItemSet.progress=a.percentage;var d=a.status==1;c=!d;if(d){e._processItemSet.setCompleted(true);i.expire(true);i.invalidate()}e._processItemSet.invalidate()}return c};e._processErrorResponse=function(a,b){if(e.file.did==b&&e.transactionId)l(a)};function j(){if(e._processItemSet){e._parentSet.remove(e._processItemSet);e._parentSet.invalidate();e._processItemSet=null;e._parentSet=null}}function p(g){e.executing=true;var c=e.file,d=0;if(n)d=1;else if(q)d=2;var h=i.getDisplayName(a.PageController.getInstance().getViewContext()),j=i.id=="root"&&i.rootResourceId?i.rootResourceId:i.id,f=c.getDeviceBaseUrl()+"CopyItem?did="+c.did.encodeURIComponent()+"&id="+c.id.encodeURIComponent()+"&spi="+j.encodeURIComponent()+"&nc="+d+"&sfn="+h.encodeURIComponent(),r=f+"_"+e.id+"_"+m++,o=new a.DataRequest(r,f,null,function(a){e.transactionId=a.transactionId;k._newTransaction(e.transactionId,e);e._processItemSet.state=b.Active;e._processItemSet.progress=0;e._processItemSet.invalidate()},function(b){if(a.DeviceItem.hasNewBaseUrlError(b.error,c.did)&&!g)p(true);else l(b)},null,a.RequestPriorityEnum.RemoteUploadOperation);o.start()}function o(f){var c=e.file,d=c.getDeviceBaseUrl()+"CancelCopy?did="+c.did.encodeURIComponent()+"&tid="+e.transactionId,h=d+"_"+e.id+"_"+m++;e._processItemSet.state=b.Canceling;e._processItemSet.progress=0;e._processItemSet.invalidate();var g=new a.DataRequest(h,d,null,function(){e.transactionId=null;e.executing=false;j()},function(b){j();if(a.DeviceItem.hasNewBaseUrlError(b.error,c.did)&&!f)o(true);else $WebWatson.submit("Remote Upload Cancel error",e.file.key,0,"",b.error?b.error.code:"","",0,true)},null,a.RequestPriorityEnum.RemoteUploadOperation);g.start()}function l(i){var b=i.error?i.error.code:0,a=e._processItemSet;if(a){if(b==10032)b=10031;var h=d("RU.Error"+b),j=FilesConfig.manageStorageUrl;switch(b+""){case "10001":j=FilesConfig.skyDriveAnywhereAccessUrl;case "10022":a.setError(h,0,c,[g.format(j),f]);break;case "10002":case "10004":case "10005":case "10006":case "10011":case "10020":case "10021":case "10023":case "10024":case "10025":case "10027":case "10029":case "10031":a.setError(h,0,c);break;case "10026":a.setError(h,1e3,c);break;default:a.setError(d("RU.Error10030"),"rup_1",c)}a.invalidate();$WebWatson.submit("Remote Upload error",e.file.key,0,a.errorMessage,a.errorCode,"",0,true)}}}})();(function(){var a=wLive.Core;a.RemoteUploadGroup=b;function b(e){var b=this,d=e.item,c=[];b._processItemSet=new a.ProcessItemSet;b._parentSet=a.ProcessWindow.getProcessItemSet();b._processItemSet.type=a.ProcessItemSet.Type.RemoteUpload;b._processItemSet.data=d;b._processItemSet.operation=b;b._parentSet.add(b._processItemSet);b.start=function(i){var h=e.files;for(var f=0;f<h.length;f++){var g=new a.RemoteSingleFileUpload(h[f],b._processItemSet,d);c.push(g);if(i)g._updateProgress(i[f]);else g.start()}};b.abort=function(e){for(var a=0;a<c.length;a++){var d=c[a];d.abort(e)}b._parentSet.remove(b._processItemSet);b._parentSet.invalidate();b._processItemSet=null;b._parentSet=null};b.handleErrorResolution=function(b,e){for(var a=0;a<b.length;a++){var c=b[a],d=c.operation;d.handleErrorResolution([c],e)}}}})();(function(){var a=wLive.Core;a.RemoteUploadManager=d;var c;if(a.PageController&&a.PageController.getInstance())c=new d;var b=2e3,g=b,h=5e3,i=1e4,e=500*1024*1024,f=1*1024*1024*1024;a.RemoteUploadManager.getInstance=function(){return c};function d(){var d=this,j={},p={},k={},c={},u=0,r=a.PageController.getInstance().getViewContext(),m=r.dataModel,l=r.deviceItemSet,o={};m.addListener(a.DataModel.dataChangedEvent,t);l.addListener("change",n);d.startRemoteUpload=function(c){var b=new a.RemoteUploadGroup(c);b.start()};d._removeTransaction=function(a,b){if(b)p[a]=true;if(j[a])delete j[a]};d._newTransaction=function(b,a){j[b]=a;d._startDeviceProgressPing(a.file.did)};d._startDeviceProgressPing=function(m,r,n){if(!c[m]||!c[m].handler){if(!c[m])c[m]={};if(!c[m].handler){c[m].pending=false;var q=b;if(n&&n!=-1)if(n<e)q=g;else if(n<f)q=h;else q=i;c[m].handler=window.setTimeout(function(){var b=l.getByKey(m.toLowerCase());if(b){var e=b.baseUrl+"GetProgress?did="+m.encodeURIComponent(),g=e+"_"+u++,f=new a.DataRequest(g,e,null,function(l){o[m]=true;c[m].handler=null;c[m].pending=false;var i=l.trans,e=false,b=-1;for(var g=0;g<i.length;g++){var a=i[g],f=a.transactionId,h=j[f];if(h)e=h._updateProgress(a)||e;else if(!p[f]){if(!k[f])k[f]=a;e=true}if(a.size)if(b==-1)b=a.size;else b=Math.min(b,a.size)}if(e||c[m].pending){d._startDeviceProgressPing(m,false,b);s()}},function(b){c[m].handler=null;c[m].pending=false;if(a.DeviceItem.hasNewBaseUrlError(b.error,m)&&!r)d._startDeviceProgressPing(m,true);else for(var f in j){var e=j[f];e._processErrorResponse(b,m)}},null,a.RequestPriorityEnum.RemoteUploadOperation);f.start()}},q)}else c[m].pending=true}};function s(){var j=false;for(var f in k){var b=k[f],i=a.SkyDriveItem.getItemKey(b.skydriveParentId,FilesConfig.hcid,0,null,null),e=m.getItem(i,false),h=a.SkyDriveItem.getItemKey(null,FilesConfig.hcid,0,null,b.deviceId),c=m.getItem(h,false);if(c){var d={id:b.id,did:b.deviceId,name:b.fileName,iconType:"Default",key:"",getDeviceBaseUrl:function(){return c.getDeviceBaseUrl()},getDevice:function(){return c.getDevice()}};if(e&&d){var g=new a.RemoteUploadGroup({item:e,files:[d]});g.start([b]);delete k[f]}}}}function q(a){if(!o[a])d._startDeviceProgressPing(a)}function t(a){if(a&&a.did)q(a.did)}function n(){var c=l.getCount();for(var b=0;b<c;b++){var a=l.get(b);if(a&&a.baseUrl)q(a.did)}}n()}$Do.register("RemoteUploadManager",function(b){a.RemoteUploadManager.getInstance().startRemoteUpload(b)});a.OperationManager.Current.register("CopyToSkyDrive",function(c,b){a.RemoteUploadManager.getInstance().startRemoteUpload({item:b.targetItem,files:b.items})})})();(function(){defineSubClass("Shared.UI.TraceItem",JBase.UI.BaseControl,null,{onDataContextChanged:function(b){var a=b.item;mix(this,{timeStamp:(a.timeStamp?"+"+a.timeStamp.toDurationString():"0.000")+"s",category:a.category,message:a.message})}})})();Shared.UI.TraceItem.prototype.onRenderHtml=function(){return "<"+this.baseTag+""+sutraAttribute("Shared.TraceItem")+' id="'+htmlAttributeEncode(this.id+"_0")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="c-'+this.controlName+" "+this.baseClass+'">'+"<span"+sutraAttribute("Shared.TimeStamp")+' id="'+htmlAttributeEncode(this.id+"_1")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="timeStamp">'+htmlEncode(this.timeStamp)+"</span>"+"<span"+sutraAttribute("Shared.Category")+' id="'+htmlAttributeEncode(this.id+"_2")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="category">'+htmlEncode(this.category)+"</span>"+"<span"+sutraAttribute("Shared.Message")+' id="'+htmlAttributeEncode(this.id+"_3")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="message">'+htmlEncode(this.message)+"</span>"+"</"+this.baseTag+">"+""};processAnnotations(Shared.UI.TraceItem,[{id:0},{id:1,attr:["text","timeStamp"]},{id:2,attr:["text","category"]},{id:3,attr:["text","message"]}]);registerStyle(".c-TraceItem {border: 1px solid white;padding: 2px 0;white-space: nowrap;}.c-TraceItem:hover {background: #EEE;border: 1px solid #DDD;}.c-TraceItem * {cursor: default;}.c-TraceItem span {padding: 0 5px;overflow: hidden;text-truncate: ellipsis;}.c-TraceItem .category {float: left;display: inline-block;color: #888;width: 85px;}.c-TraceItem .timeStamp {float: left;display: inline-block;color: #88bb88;width: 80px;text-align: right;}.c-TraceItem .message {margin-left: 180px;display: block;white-space: normal;}");(function(){var a=10;defineSubClass("Shared.UI.RequestItem",JBase.UI.BaseControl,function(){var a=this;this.taskRepeater=this.createChild(JBase.UI.Repeater,{childControl:Shared.UI.RequestItem});this.taskRepeater.getChildContext=function(b){var c=a.dataContext;b.requestItem=c.requestItem;b.relativeBaseTime=(c.relativeBaseTime||0)+(c.relativeStartTime||0)+(b.relativeStartTime||0);b.depth=(c.depth||0)+1;return b}},{onActivate:function(){this.addElementListener(this.subElements.row,"click",this._onControlClick)},onDataContextChanged:function(d){var i=d.requestItem,j=d.tasks||d.storageCallStats||d.children,e,h=true,f=d.executionTimeMs===undefined,g=!f&&d.clientLength<d.executionTimeMs,l=i?i.clientLength:d.clientLength,k=Math.min(100,Math.round(100*((d.relativeBaseTime||0)+(d.relativeBaseTime||0))/(l||1)));this.isExpanded=!!this.isExpanded;if(d.clientLength!==undefined)e=g?"Cache hit":Number(d.clientLength).toDurationString()+"s";else if(typeof d.time==="number")e=d.time.toDurationString()+"s";else{e="n/a";h=false}mix(this,{hasChildren:!!(j&&j.length>0),hasError:!!d.isError,depthPadding:(d.depth||0)*a+"px",name:b(d.url||d.name),hasDuration:h,duration:e,startPercentage:h?k+"%":"0%",lengthPercentage:f?Math.min(100-k,Math.round(100*d.time/i.clientLength))+"%":"100%",hasServerPercentage:!f&&!g,serverPercentage:!f&&!g?Math.min(100,Math.round(100*d.executionTimeMs/d.clientLength))+"%":"100%",tooltip:c(d)});this.taskRepeater.setDataContext({items:j},true)},_onControlClick:function(){if(this.hasChildren){this.isExpanded=!this.isExpanded;this.change()}}});function c(a){var b="";b+=a.url||a.name;a.isError&&(b+=" (error)");b+=": ";a.clientLength&&(b+=" clientLength: "+a.clientLength);a.executionTimeMs&&(b+=" executionTime: "+a.executionTimeMs);a.schedulerTimeMs&&(b+=" schedulerTime: "+a.schedulerTimeMs);a.relativeStartTime&&(b+=" relativeStartTime: "+a.relativeStartTime);a.time&&(b+=" time: "+a.time);return b}function b(a){a=a||"";var c=a.indexOf("?");if(c>-1)a=a.substr(0,c);var b=a.lastIndexOf("/");if(b>-1&&b==a.length-1)a=a.substr(0,b);b=a.lastIndexOf("/");if(b>-1)a=a.substr(b+1);if(a.endsWith(".live-int.com"))a=a.substr(0,a.length-".live-int.com".length);else if(a.endsWith(".live.com"))a=a.substr(0,a.length-".live.com".length);return a}})();Shared.UI.RequestItem.prototype.onRenderHtml=function(){return "<"+this.baseTag+""+sutraAttribute("Shared.RequestItem")+' id="'+htmlAttributeEncode(this.id+"_0")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="c-'+this.controlName+" "+this.baseClass+'">'+'<div onselectstart="return false;"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+">"+'<div id="'+htmlAttributeEncode(this.id+"_1")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="row"'+generateAttributesString("title",this.tooltip)+">"+'<span id="'+htmlAttributeEncode(this.id+"_2")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="shortName fixed'+generateClassAttribute("error",this.hasError)+'">'+'<span id="'+htmlAttributeEncode(this.id+"_3")+'" style="'+this.baseStyle+" "+generateStyleAttribute("width",this.depthPadding)+'" class="padding">'+"</span>"+'<span id="'+htmlAttributeEncode(this.id+"_4")+'" style="'+this.baseStyle+" "+generateStyleAttribute("visibility",this.hasChildren)+'" class="expandIcon">'+"<span"+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="expandIconH">'+"</span>"+'<span id="'+htmlAttributeEncode(this.id+"_5")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="expandIconV'+generateClassAttribute("expanded",this.isExpanded)+'">'+"</span>"+"</span>"+'<span id="'+htmlAttributeEncode(this.id+"_6")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="name">'+htmlEncode(this.name)+"</span>"+"</span>"+'<span id="'+htmlAttributeEncode(this.id+"_7")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="browserTime fixed">'+htmlEncode(this.duration)+"</span>"+'<span id="'+htmlAttributeEncode(this.id+"_8")+'" style="'+this.baseStyle+" "+generateStyleAttribute("display",this.hasDuration)+'" class="latencyContainer">'+'<span id="'+htmlAttributeEncode(this.id+"_9")+'" style="'+this.baseStyle+" "+generateStyleAttribute("left",this.startPercentage,"width",this.lengthPercentage)+'" class="latencyLength">'+"<span"+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="latencyFill">'+"</span>"+"</span>"+'<span id="'+htmlAttributeEncode(this.id+"_10")+'" style="'+this.baseStyle+" "+generateStyleAttribute("display",this.hasServerPercentage,"width",this.serverPercentage)+'" class="latencyLength server">'+"<span"+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="latencyFill">'+"</span>"+"</span>"+"</span>"+"</div>"+'<div id="'+htmlAttributeEncode(this.id+"_11")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="childTasks'+generateClassAttribute("expanded",this.isExpanded)+'">'+this.taskRepeater.renderHtml()+"</div>"+"</div>"+"</"+this.baseTag+">"+""};processAnnotations(Shared.UI.RequestItem,[{id:0},{id:1,attr:["title","tooltip"],childId:"row"},{id:2,className:["error","hasError"]},{id:3,css:["width","depthPadding"]},{id:4,css:["visibility","hasChildren"]},{id:5,className:["expanded","isExpanded"]},{id:6,attr:["text","name"]},{id:7,attr:["text","duration"]},{id:8,css:["display","hasDuration"]},{id:9,css:["left","startPercentage","width","lengthPercentage"]},{id:10,css:["display","hasServerPercentage","width","serverPercentage"]},{id:11,className:["expanded","isExpanded"]}]);registerStyle(".c-RequestItem * {user-select: none;-moz-user-select: none;-webkit-user-select: none;vertical-align: middle;cursor: default;}.c-RequestItem .shortName.error {background-color: #f39379;}.c-RequestItem .row {border: 1px solid white;padding: 2px 0;}.c-RequestItem .row:hover {background: #EEE;border: 1px solid #DDD;}.c-RequestItem span {display: inline-block;}.c-RequestItem .row {position: relative;padding: 2px;}.c-RequestItem .expandIcon {position: relative;width: 8px;height: 8px;border: 2px solid #00709F;}.c-RequestItem .expandIcon span {position: absolute;background: #00709F;}.c-RequestItem .expandIconH {left: 1px;right: 1px;height: 2px;top: 50%;margin-top: -1px;}.c-RequestItem .expandIconV {top: 1px;bottom: 1px;width: 2px;left: 50%;margin-left: -1px;}.c-RequestItem .expandIconV.expanded {display: none;}.c-RequestItem .fixed {white-space: nowrap;overflow: hidden;text-truncate: ellipsis;padding: 0 5px;margin: 0;text-align: right;}.c-RequestItem .shortName {text-align: left;width: 200px;position: relative;}.c-RequestItem .name {padding-left: 5px;}.c-RequestItem .browserTime {width: 60px;}.c-RequestItem .latencyContainer {display: block;position: absolute;left: 285px;right: 10px;top: 5px;bottom: 5px;white-space: nowrap;}.c-RequestItem .latencyLength {position: absolute;top: 50%;width: 100%;margin-top: -5px;padding: 0;height: 10px;border-left: 2px solid #888;border-right: 2px solid #888;}.c-RequestItem .latencyLength.server {background: #9C9;}.c-RequestItem .latencyFill {background: #888;position: absolute;width: 100%;height: 2px;top: 50%;margin-top: -1px;left: 0;}.c-RequestItem .childTasks {display: none;}.c-RequestItem .childTasks.expanded {display: block;}");(function(){defineSubClass("Shared.UI.CategoryItem",JBase.UI.BaseControl,null,{onActivate:function(){this.addElementListener(this.element,"click",this._onControlClick)},onDataContextChanged:function(b){var a=b.item;this.name=a.name;this.isEnabled=a.isEnabled},_onControlClick:function(){this.dataContext.item.isEnabled=!this.dataContext.item.isEnabled;change(this.dataContext.item);raiseEvent(this,"categoriesChanged",null,true)}})})();Shared.UI.CategoryItem.prototype.onRenderHtml=function(){return "<"+this.baseTag+""+sutraAttribute("Shared.CategoryItem")+' id="'+htmlAttributeEncode(this.id+"_0")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="c-'+this.controlName+" "+this.baseClass+'">'+'<div onselectstart="return false;"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+">"+'<input type="checkbox" id="'+htmlAttributeEncode(this.id+"_1")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="checkbox"'+generateAttributesString("checked",this.isEnabled)+">"+"</input>"+"<label"+(this.baseStyle?' style="'+this.baseStyle+'"':"")+">"+"</label>"+'<span id="'+htmlAttributeEncode(this.id+"_2")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="message">'+htmlEncode(this.name)+"</span>"+"</div>"+"</"+this.baseTag+">"+""};processAnnotations(Shared.UI.CategoryItem,[{id:0},{id:1,attr:["checked","isEnabled"]},{id:2,attr:["text","name"]}]);registerStyle("/* Category item row. */.c-CategoryItem {border: 1px solid white;padding: 2px 0;}/* Category item hover effect. */.c-CategoryItem:hover {background: #EEE;border: 1px solid #DDD;}/* All elements in the row should not be user selectable and should use default cursor. */.c-CategoryItem * {user-select: none;-moz-user-select: none;-webkit-user-select: none;vertical-align: middle;cursor: default;}/* Checkbox sizing. */.c-CategoryItem .checkbox {margin: 0 10px;}");(function(){defineSubClass("Shared.UI.TraceMiniWindow",JBase.UI.BaseControl,null,{closeButtonText:"×",onActivate:function(){this.addElementListener(this.element,"click",this._onWindowClick);this.addElementListener(this.subElements.closeButton,"click",this._onClose)},onDataContextChanged:function(a){mix(this,{eventCount:a.eventCount,requestCount:a.requestCount})},_onClose:function(){raiseEvent(this,"closeTraceWindow",null,true);return false},_onWindowClick:function(){raiseEvent(this,"toggleTraceWindow",null,true)}})})();Shared.UI.TraceMiniWindow.prototype.onRenderHtml=function(){return "<"+this.baseTag+""+sutraAttribute("Shared.TraceMiniWindow")+' id="'+htmlAttributeEncode(this.id+"_0")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="c-'+this.controlName+" "+this.baseClass+'">'+"<div"+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="counters">'+"<span"+(this.baseStyle?' style="'+this.baseStyle+'"':"")+">"+"T:"+"</span>"+'<span id="'+htmlAttributeEncode(this.id+"_1")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+">"+htmlEncode(this.eventCount)+"</span>"+"<span"+(this.baseStyle?' style="'+this.baseStyle+'"':"")+">"+"R:"+"</span>"+'<span id="'+htmlAttributeEncode(this.id+"_2")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+">"+htmlEncode(this.requestCount)+"</span>"+"</div>"+'<button id="'+htmlAttributeEncode(this.id+"_3")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+">"+htmlEncode(this.closeButtonText)+"</button>"+"</"+this.baseTag+">"+""};processAnnotations(Shared.UI.TraceMiniWindow,[{id:0},{id:1,attr:["text","eventCount"]},{id:2,attr:["text","requestCount"]},{id:3,attr:["text","closeButtonText"],childId:"closeButton"}]);registerStyle(".c-TraceMiniWindow {z-index: 99999999;position: fixed;left: 5px;bottom: 5px;border: 2px solid #00709F;background: white;}.c-TraceMiniWindow .counters {display: inline-block;border-right: 1px solid #DDD;padding: 7px 5px;}.c-TraceMiniWindow * {cursor: default;}.c-TraceMiniWindow span {padding-right: 5px;vertical-align: baseline;}.c-TraceMiniWindow button {padding: 0;width: 30px;}");(function(){defineSubClass("Shared.UI.TraceEventsPage",JBase.UI.BaseControl,function(){this.traceRepeater=this.createChild(JBase.UI.Repeater,{childControl:Shared.UI.TraceItem})},{onActivate:function(){this.addElementListener(this.subElements.clearTracesButton,"click",this._onClearButtonClick);this.addElementListener(this.subElements.copyTracesButton,"click",this._onCopyTracesButtonClick)},onDataContextChanged:function(a){this.traceRepeater.setDataContext({items:a.events},true)},_onClearButtonClick:function(){Trace.clearEvents()},_onCopyTracesButtonClick:function(){var a="";this.dataContext.events.each(function(b){a+=b.timeStamp+"\t"+b.category+"\t"+b.message+"\n"});alert(a)}})})();Shared.UI.TraceEventsPage.prototype.onRenderHtml=function(){return "<"+this.baseTag+""+sutraAttribute("Shared.TraceEventsPage")+' id="'+htmlAttributeEncode(this.id+"_0")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="c-'+this.controlName+" "+this.baseClass+'">'+"<div"+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="tracesPage page">'+"<div"+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="pageHeader">'+'<button page-id="TraceCategoriesPage"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+">"+"Categories"+"</button>"+'<button id="'+htmlAttributeEncode(this.id+"_1")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+">"+"Clear"+"</button>"+'<button id="'+htmlAttributeEncode(this.id+"_2")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+">"+"Copy"+"</button>"+"</div>"+"<div"+sutraAttribute("Shared.TraceItems")+""+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="content">'+this.traceRepeater.renderHtml()+"</div>"+"</div>"+"</"+this.baseTag+">"+""};processAnnotations(Shared.UI.TraceEventsPage,[{id:0},{id:1,childId:"clearTracesButton"},{id:2,childId:"copyTracesButton"}]);(function(){defineSubClass("Shared.UI.TraceCategoriesPage",JBase.UI.BaseControl,function(){this.categoryRepeater=this.createChild(JBase.UI.Repeater,{childControl:Shared.UI.CategoryItem})},{onActivate:function(){this.addElementListener(this.subElements.selectAllCategories,"click",this._onSelectAllCategoriesClick)},onDataContextChanged:function(a){this.categoryRepeater.setDataContext({items:a.categories},true)},_onSelectAllCategoriesClick:function(){var a=Trace.categories.find(function(a){return !a.isEnabled})!==-1;Trace.categories.each(function(b){b.isEnabled=a?true:false;change(b)});change(this.dataContext.categories)}})})();Shared.UI.TraceCategoriesPage.prototype.onRenderHtml=function(){return "<"+this.baseTag+""+sutraAttribute("Shared.TraceCategoriesPage")+' id="'+htmlAttributeEncode(this.id+"_0")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="c-'+this.controlName+" "+this.baseClass+'">'+"<div"+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="categoriesPage page">'+"<div"+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="pageHeader">'+'<button page-id="TraceEventsPage"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+">"+"Back"+"</button>"+'<button id="'+htmlAttributeEncode(this.id+"_1")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+">"+"Toggle all"+"</button>"+"</div>"+"<div"+sutraAttribute("Shared.CategoryItems")+""+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="content">'+this.categoryRepeater.renderHtml()+"</div>"+"</div>"+"</"+this.baseTag+">"+""};processAnnotations(Shared.UI.TraceCategoriesPage,[{id:0},{id:1,childId:"selectAllCategories"}]);(function(){defineSubClass("Shared.UI.TraceRequestsPage",JBase.UI.BaseControl,function(){this.pageStatsRepeater=this.createChild(JBase.UI.Repeater,{childControl:Shared.UI.RequestItem});this.pageStatsRepeater.getChildContext=function(a){a.depth=0;a.requestItem=a;return a}},{onActivate:function(){this.addElementListener(this.subElements.clearRequestsButton,"click",this._onClearClicked)},onDataContextChanged:function(a){this.pageStatsRepeater.setDataContext({items:a.requests},true)},_onClearClicked:function(){this.dataContext.requests.clear();change(this.dataContext.requests)}})})();Shared.UI.TraceRequestsPage.prototype.onRenderHtml=function(){return "<"+this.baseTag+""+sutraAttribute("Shared.TraceRequestsPage")+' id="'+htmlAttributeEncode(this.id+"_0")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="c-'+this.controlName+" "+this.baseClass+'">'+"<div"+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="requestsPage page">'+"<div"+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="pageHeader">'+'<button id="'+htmlAttributeEncode(this.id+"_1")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+">"+"Clear"+"</button>"+"</div>"+"<div"+sutraAttribute("Shared.RequestItems")+""+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="content">'+this.pageStatsRepeater.renderHtml()+"</div>"+"</div>"+"</"+this.baseTag+">"+""};processAnnotations(Shared.UI.TraceRequestsPage,[{id:0},{id:1,childId:"clearRequestsButton"}]);(function(){var a="TraceEventsPage",b="TraceRequestsPage";defineSubClass("Shared.UI.TraceFullWindow",JBase.UI.BaseControl,function(){this.pageContent=this.createChild(JBase.UI.ContentControl,{getControlType:bind(this,this._getPageControlType)});this.selectedTabClass=a},{onActivate:function(){this.addElementListener(this.element,"click",this._onControlClick);this.addElementListener(this.subElements.minimizeButton,"click",this._onMinimizeButtonClick)},onDataContextChanged:function(c){mix(this,{eventCount:c.eventCount,requestCount:c.requestCount,tracesTabSelected:this.selectedTabClass===a,requestsTabSelected:this.selectedTabClass===b});this.pageContent.setDataContext(c)},_getPageControlType:function(){return Shared.UI[this.selectedTabClass]},_onControlClick:function(c){var a=c.srcElement||c.target,b=a.getAttribute("page-id");while(a&&!b){a=a.parentNode;a&&!a.getAttribute&&(a=null);a&&(b=a.getAttribute("page-id"))}if(b){this.selectedTabClass=b;this.change();this.pageContent.change();return false}},_onMinimizeButtonClick:function(){raiseEvent(this,"toggleTraceWindow",null,true)}})})();Shared.UI.TraceFullWindow.prototype.onRenderHtml=function(){return "<"+this.baseTag+""+sutraAttribute("Shared.TraceFullWindow")+' id="'+htmlAttributeEncode(this.id+"_0")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="c-'+this.controlName+" "+this.baseClass+'">'+"<div"+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="header">'+'<button page-id="TraceEventsPage" id="'+htmlAttributeEncode(this.id+"_1")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="tracesTab tab'+generateClassAttribute("selected",this.tracesTabSelected)+'">'+"<span"+(this.baseStyle?' style="'+this.baseStyle+'"':"")+">"+"Traces"+"</span>"+'<span id="'+htmlAttributeEncode(this.id+"_2")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="superText">'+htmlEncode(this.eventCount)+"</span>"+"</button>"+'<button page-id="TraceRequestsPage" id="'+htmlAttributeEncode(this.id+"_3")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="requestsTab tab'+generateClassAttribute("selected",this.requestsTabSelected)+'">'+"<span"+(this.baseStyle?' style="'+this.baseStyle+'"':"")+">"+"Requests"+"</span>"+'<span id="'+htmlAttributeEncode(this.id+"_4")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="superText">'+htmlEncode(this.requestCount)+"</span>"+"</button>"+'<button id="'+htmlAttributeEncode(this.id+"_5")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="minimizeButton tab">'+"<div"+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="minimize">'+"</div>"+"</button>"+"</div>"+this.pageContent.renderHtml()+"</"+this.baseTag+">"+""};processAnnotations(Shared.UI.TraceFullWindow,[{id:0},{id:1,className:["selected","tracesTabSelected"]},{id:2,attr:["text","eventCount"]},{id:3,className:["selected","requestsTabSelected"]},{id:4,attr:["text","requestCount"]},{id:5,childId:"minimizeButton"}]);registerStyle(".c-TraceFullWindow {z-index: 99999999;position: fixed;background: white;left: 5px;right: 5px;top: 50%;bottom: 5px;min-width: 200px;border: 2px solid #00709F;padding: 5px;}.c-TraceFullWindow.minimized {visibility: hidden;opacity: 0;left: -20px;right: 30px;}.c-TraceFullWindow .header {float: right;height: 30px;margin-top: -5px;}.c-TraceFullWindow .header button {vertical-align: top;}.c-TraceFullWindow .tab {margin: 0;font-weight: bold;text-transform: uppercase;font-family: Segoe UI, Verdana;font-size: 14px;background: none;border: none;}.c-TraceFullWindow .selected {background: #00709F !important;color: white;}.c-TraceFullWindow .pageHeader {border-bottom: 1px solid #eee;height: 30px;line-height: 30px;}.c-TraceFullWindow .page {overflow: hidden;top: 30px;left: 5px;right: 5px;bottom: 5px;position: absolute;}.c-TraceFullWindow .content {overflow: auto;position: absolute;top: 30px;bottom: 0px;left: 0px;right: 0px;padding: 5px 0;}");(function(){defineSubClass("Shared.UI.TraceWindow",JBase.UI.BaseControl,function(){var a=this.addChild(new Shared.UI.TraceWindowContext);this.setDataContext(a);this._isMinimized=b("isMinimized",true)==="false"?false:true;this._isHidden=b("isHidden",false)==="true";this.traceWindowContent=this.createChild(JBase.UI.ContentControl,{getControlType:bind(this,this._getControlType)});this.traceWindowContent.setDataContext(a)},{onActivate:function(){this.addElementListener(document,"keydown",this._onKeyDown);this.addObjectListener(this,"toggleTraceWindow",this._onToggleTraceWindow);this.addObjectListener(this,"closeTraceWindow",this._onCloseTraceWindow);this.addObjectListener(this,"categoriesChanged",this._onCategoriesChanged)},_getControlType:function(){return this._isHidden?null:this._isMinimized?Shared.UI.TraceMiniWindow:Shared.UI.TraceFullWindow},_onKeyDown:function(a){if(a.keyCode===192&&a.ctrlKey&&!a.shiftKey)this._onToggleTraceWindow()},_onCategoriesChanged:function(){change(this.dataContext.categories)},_onToggleTraceWindow:function(){var b=this;if(b._isHidden){b._isHidden=false;b._isMinimized=true}else b._isMinimized=!b._isMinimized;a("isHidden",b._isHidden);a("isMinimized",b._isMinimized);b.traceWindowContent.change();return false},_onCloseTraceWindow:function(){this._isHidden=true;a("isHidden",true);this.traceWindowContent.change();return false}});function b(c,a){var b=a;try{b=window.localStorage?localStorage.getItem("TraceWindow."+c)||a:a}catch(d){}return b}function a(b,a){try{if(window.localStorage)localStorage.setItem("TraceWindow."+b,a)}catch(c){}}})();Shared.UI.TraceWindow.prototype.onRenderHtml=function(){return "<"+this.baseTag+""+sutraAttribute("Shared.TraceWindow")+' id="'+htmlAttributeEncode(this.id+"_0")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="c-'+this.controlName+" "+this.baseClass+'">'+this.traceWindowContent.renderHtml()+"</"+this.baseTag+">"+""};processAnnotations(Shared.UI.TraceWindow,[{id:0}]);(function(){var a=window.wLive&&wLive.PageStats?wLive.PageStats:{d:[]};defineSubClass("Shared.UI.TraceWindowContext",JBase.DataContext,function(){this.setData({categories:Trace.categories});this._onTraceDataChanged();this._onRequestDataChanged();this.addChangeListener(Trace.events,this._onTraceDataChanged);this.addChangeListener(Trace.categories,this._onTraceDataChanged);this.addChangeListener(a.d,this._onRequestDataChanged);window.jQuery&&jQuery(a).bind("go."+this.__className,function(){change(a.d)})},{dispose:function(){window.jQuery&&jQuery(a).unbind("."+this.__className)},_onTraceDataChanged:function(){var a=b(Trace.events,this.categories);this.setData({events:a,eventCount:a.length+(a.length===Trace.events.length?"":" ("+Trace.events.length+")")})},_onRequestDataChanged:function(){this.setData({requestCount:String(a.d.length),requests:a.d});change(this)}});function b(d,c){var b=[],a={};c.each(function(b){b.isEnabled&&(a[b.name]=1)});d.each(function(c){a[c.category]&&b.push(c)});return b}})();registerStyle(".c-TraceWindow {color: #222;}.c-TraceWindow * {font-family: Segoe UI, Verdana;font-size: 12px;}.c-TraceWindow button {background: none;border: none;padding: 0px 5px;overflow: visible;height: 30px;min-width: 5px;}.c-TraceWindow button:active {color: #222;}.c-TraceWindow button:hover {background: #EEE;}.c-TraceWindow .superText {font-size: 80%;position: relative;top: -7px;padding-left: 2px;}.c-TraceWindow .content {overflow: auto;position: absolute;top: 30px;bottom: 0px;left: 0px;right: 0px;padding: 5px 0;}.c-TraceWindow .hidden {display: none;}.c-TraceWindow .minimizeButton {margin: 0 -5px 0 10px;}.c-TraceWindow .minimize {display: inline-block;width: 9px;height: 3px;background: #EEEEEE;margin: 3px 5px;border: 1px solid #565656;}");(function(){var b=new Shared.UI.TraceWindow;function a(){removeListener(window,"load",a);if(document.body){var c=ce("div");c.innerHTML=b.renderHtml();document.body.appendChild(c);b.activate()}else addListener(window,"load",a)}function c(){removeListener(window,"unload",c);b.dispose()}var d=window;if(d.$Config&&d.$Config.pageStats){addListener(window,"unload",c);a()}})();(function(){var c=wLive.Core,f=wLive.Controls,d="ArrangeView.",j="8",i=false,k=27,m=c.SkyDriveItemHelper,l=JBase.UI.ImageStripHelper,b=c.AleHelpers.getPCString,h=b(d+"GetItemsError"),g=b(d+"SaveSequenceError"),a;defineSubClass("SkyDrive.UI.ArrangeView",JBase.UI.BaseControl,function(){a=a||wLive.Core.PageController.getInstance().getViewContext();this.setListView=this.createChild(SkyDrive.UI.SetGridListView,{html5fileDropsEnabled:false,dropArrangeMode:true,contextMenuEnabled:false});this.notificationBar=this.createChild(SkyDrive.UI.SetNotificationBar);this._commandBarList=$CommandBar.getDataModel().list;this._saveLinkOptions={click:bind(this,this._onSaveClick),url:"#",html:htmlEncode(b(d+"Save"))};this._cancelLinkOptions={click:bind(this,this._onCancelClick),url:"#",html:htmlEncode(b("Cancel"))};this.isCanceling=false;this.isSaving=false;this._itemSet=null;this._lastItem=null;this._lastItemVersion=null;this.childrenDownloaded=false;this.loadingHtml=$f.createLoading(true,"spinning",60,60)},{onActivate:function(){this._togglePeripheralControls(true);this.addElementListener(this.element,"click",this._onClick);this.addElementListener(window,"keydown",this._onKeyDown);this.addObjectListener(c.BeforeUnloadManager,"beforehashchange",this._onBeforeHashChange);this.addObjectListener(c.BeforeUnloadManager,"beforeunload",this._onBeforeHashChange);a.selectionManager.deselectAll();a.selectionManager.setCrossGroupSelectEnabled(false)},onDataContextChanged:function(d){var b=this,e=a.dataModel,c=d.item;if(!b._lastItem&&!b._itemSet){b.setListView.setDataContext({itemSet:c.getChildren()});b._lastItem=c;b._lastItemVersion=c.getVersion();b.childrenDownloaded=false;e.ensureCompletelyDownloaded(c,bind(b,b._childrenCompletelyDownloaded),bind(b,b._failedDownloadingChildren))}b.isLoadingVisible=!b.childrenDownloaded||b.isSaving;b.isGridVisible=!b.isLoadingVisible;b._commandBarList.clear();if(!b.isSaving){if(b.childrenDownloaded)b._commandBarList.push(f.NavLink.create(b._saveLinkOptions));b._commandBarList.push(f.NavLink.create(b._cancelLinkOptions))}this.notificationBar.setDataContext(d)},onDeactivate:function(){this._togglePeripheralControls(false);this._commandBarList.clear();a.selectionManager.setGroupings(null);a.selectionManager.setCrossGroupSelectEnabled(true)},_onSaveClick:function(){var b=this,k=FilesConfig.baseApiUrl+"SaveSortSequence",d=this.dataContext.item,h=[],f=this._itemSet,m=f.getCount();for(var e=0;e<m;e++)h.push(f.get(e).id);var n={targetId:d.id,cid:d.ownerCid,group:d.group,items:h},l=new c.DataRequest(k+Math.random(),k,Object.toJSON(n),function(){a.sortBy(j,i);d.expire();d.invalidate();var c=a.actionManager;c.doAction(c.getAction("ViewItemWithoutView",b.dataContext.item));b.isSaving=false},function(){a.errorManager.add({$element:jQuery("<span>"+g.encodeHtml()+"</span>"),priority:2,type:0,code:"FailedLoadingChildren"});b.isSaving=false;b.change()});b.isSaving=true;b.change();l.start();return false},_onClick:function(b){!jQuery(b.srcTarget).closest("a,input,textarea,button,img").length&&a.selectionManager.deselectAll()},_onKeyDown:function(c){if(c.which===k){var b=a.selectionManager,d=this.dataContext,e=b.getSelection();if(e.selectionCount>0){b.deselectAll(d.item);return false}else return this._onCancelClick(c)}},_onBeforeHashChange:function(){if(this.setListView.arrangedItems&&!this.isSaving&&!this.isCanceling)return b(d+"NavWarning")},_onCancelClick:function(){this.isCanceling=true;var b=a.actionManager;b.doAction(b.getAction("ViewItemWithoutView",this.dataContext.item));return false},_togglePeripheralControls:function(b){byId("m_wh").style.display=b?"block":"none";var a=byId("m_wf");if(b){if(!this.subElements.footerContainer.childNodes.length){this.subElements.footerContainer.appendChild(a);a.style.display="block"}}else{a.style.display="none";byId("c_content").appendChild(a)}},_childrenCompletelyDownloaded:function(b){if(this.dataContext.item==b){var c=b.getChildren();this.childrenDownloaded=true;this._itemSet=c.clone();this._itemSet._filters.push(e);this._itemSet._headerItemsSet._filters.push(e);a.selectionManager.setGroupings(this._itemSet.getGroupings());this.setListView.setDataContext({itemSet:this._itemSet});this.change()}},_failedDownloadingChildren:function(){a.errorManager.add({$element:jQuery("<span>"+h.encodeHtml()+"</span>"),priority:2,type:0,code:"FailedLoadingChildren"});this.childrenDownloaded=false;this.change()}});function e(a){return !a.folder&&SkyDrive.FileTypeHelper.getFileType(a)!=SkyDrive.Constants.FileTypes.oneNote}defineSubClass("wLive.Controls.ArrangeView",SkyDrive.UI.NewControlAdapter,null,{controlType:SkyDrive.UI.ArrangeView});$Do.register("wLive.Controls.ArrangeView")})();SkyDrive.UI.ArrangeView.prototype.onRenderHtml=function(){return "<"+this.baseTag+""+sutraAttribute("SkyDrive.ArrangeView")+' id="'+htmlAttributeEncode(this.id+"_0")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="c-'+this.controlName+" "+this.baseClass+'">'+"<div"+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="mainContent listViewViewport">'+this.notificationBar.renderHtml()+"<div"+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="fillTable">'+"<table"+(this.baseStyle?' style="'+this.baseStyle+'"':"")+">"+'<tr valign="top"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+">"+"<td"+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="mainCell">'+'<div id="'+htmlAttributeEncode(this.id+"_1")+'" style="'+this.baseStyle+" "+generateStyleAttribute("display",this.isGridVisible)+'">'+this.setListView.renderHtml()+"</div>"+'<div id="'+htmlAttributeEncode(this.id+"_2")+'" style="'+this.baseStyle+" "+generateStyleAttribute("display",this.isLoadingVisible)+'" class="loadingSpinnerContainer">'+this.loadingHtml+"</div>"+"</td>"+"</tr>"+'<tr valign="bottom"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+">"+"<td"+(this.baseStyle?' style="'+this.baseStyle+'"':"")+">"+'<div id="'+htmlAttributeEncode(this.id+"_3")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="footerContainer">'+"</div>"+"</td>"+"</tr>"+"</table>"+"</div>"+"</div>"+"</"+this.baseTag+">"+""};processAnnotations(SkyDrive.UI.ArrangeView,[{id:0},{id:1,css:["display","isGridVisible"]},{id:2,css:["display","isLoadingVisible"],attr:["html","loadingHtml"]},{id:3,childId:"footerContainer"}]);(function(){defineSubClass("SkyDrive.UI.DragProxyDataContext",JBase.DataContext,null,{reset:function(){mix(this,{})}})})();(function(){var a=wLive.Core,d=wLive.Controls,f=a.SkyDriveItemHelper,c=JBase.UI.ImageStripHelper,e=a.AleHelpers.getPCString,b=50;defineSubClass("SkyDrive.UI.DragProxy",JBase.UI.BaseControl,function(){this.contentControl=this.createChild(JBase.UI.ContentControl,{getControlType:bind(this,this._getControlType),getControlOptions:bind(this,this._getControlOptions)});this.isVisible=false;this.height=0;this.width=0;this.itemCountText="";this.itemCountTextTop=0;this.isItemCountTextVisible=false},{baseDataContextType:SkyDrive.UI.DragProxyDataContext,onActivate:function(){},onDeactivate:function(){},onDataContextChanged:function(i){var a=i.dragData;if(a)switch(a.type){case wLive.Core.Html5FileDragProcessor.dragDataType:this.isVisible=false;break;case "SkyDriveItem":this.isVisible=true;this.width=a.location.width;this.height=a.location.height;var h=mix({item:a.item},a.controlDataContextExtensions||{});this.contentControl.setDataContext(h);var d=this.contentControl.currentControl;d&&d.setSize&&d.setSize({width:this.width,height:this.height});this.itemCountTextTop=this.height/2-b/2;var e=1,c,f=a.selectionManager;if(f){var g=f.getSelection();c=g.indexes;e=g.selectionCount}this.itemCountText=e+"";this.isItemCountTextVisible=e>1&&c&&c[a.index]!==undefined}},_getControlType:function(){return this.dataContext.dragData.controlType||SkyDrive.UI.ItemTile},_getControlOptions:function(){return this.dataContext.dragData.controlOptions||{imageAnimationDuration:0}}})})();SkyDrive.UI.DragProxy.prototype.onRenderHtml=function(){return "<"+this.baseTag+""+sutraAttribute("SkyDrive.DragProxy")+' id="'+htmlAttributeEncode(this.id+"_0")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="c-'+this.controlName+" "+this.baseClass+'">'+'<div id="'+htmlAttributeEncode(this.id+"_1")+'" style="'+this.baseStyle+" "+generateStyleAttribute("display",this.isVisible,"width.px",this.width,"height.px",this.height)+'" class="mainContainer">'+"<div"+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="itemCountTextContainer">'+'<div id="'+htmlAttributeEncode(this.id+"_2")+'" style="'+this.baseStyle+" "+generateStyleAttribute("display",this.isItemCountTextVisible,"top.px",this.itemCountTextTop)+'" class="itemCountText">'+htmlEncode(this.itemCountText)+"</div>"+"</div>"+this.contentControl.renderHtml()+"</div>"+"</"+this.baseTag+">"+""};processAnnotations(SkyDrive.UI.DragProxy,[{id:0},{id:1,css:["display","isVisible","width.px","width","height.px","height"]},{id:2,css:["display","isItemCountTextVisible","top.px","itemCountTextTop"],attr:["text","itemCountText"]}]);(function(){var b=wLive.Core,h=wLive.Controls,j=b.SkyDriveItemHelper,g=JBase.UI.ImageStripHelper,i=b.AleHelpers.getPCString,f="dragtarget",e="droptarget",a="Drag And Drop Controller",c=500,d=25;defineSubClass("SkyDrive.Core.DragAndDropController",JBase.UI.BaseControl,function(){this._dragProxyDC=new SkyDrive.UI.DragProxyDataContext;this.dragProxy=this.createChild(SkyDrive.UI.DragProxy,null,this._dragProxyDC);this._dragDataProcessor=null;this._dropLocationProcessor=null;this._dragDataProcessors=[];this._dropDataProcessors=[];this._dragging=false;this.isDragProxyVisible=false;this.dragProxyTop=0;this.dragProxyLeft=0;this._dragLeaveTimeout=null;SkyDrive.Core.DragAndDropController.Instance=this;$Do.register("wLive.Core.DragAndDropControllerCreated")},{onActivate:function(){this._addEvents(document.body);this._addEvents(document)},onDeactivate:function(){},registerDragDataProcessor:function(a){this._dragDataProcessors.push(a)},registerDropDataProcessor:function(a){this._dropDataProcessors.push(a)},_displayDragProxy:function(a,b){this.isDragProxyVisible=a;this._updateDragProxy(b)},_addEvents:function(a){this.addElementListener(a,"selectstart",this._selectStartEvent);this.addElementListener(a,"dragstart",this._dragStartEvent);this.addElementListener(a,"dragover",this._dragOverEvent);this.addElementListener(a,"dragenter",this._dragEnterEvent);this.addElementListener(a,"dragleave",this._dragLeaveEvent);this.addElementListener(a,"drop",this._dropEvent);this.addElementListener(a,"dragend",this._dragEndEvent);this.addElementListener(a,"mouseup",this._mouseUpEvent);this.addElementListener(a,"mousedown",this._mouseDownEvent);this.addElementListener(a,"mousemove",this._mouseMoveEvent)},_processDragStart:function(g,d){this._dragging=false;this._dragDataProcessor=null;for(var e=0;e<this._dragDataProcessors.length;e++){var c=this._dragDataProcessors[e],f=c.processDrag(g,d);if(f){Trace.log("Processed Drag",a);this._dragDataProcessor=c;this._dragging=true;var b=c.getData(d);if(b.offset){this._offsetX=b.offset.x;this._offsetY=b.offset.y}else this._offsetX=this._offsetY=0;this.dragProxy.setDataContext({dragData:b});break}}this._displayDragProxy(this._dragging,d);this._mouseDownDraggableElement=null;this._mouseDownEventData=null},_processDropLocation:function(c,e){if(this._dragDataProcessor){var a=0;for(;a<this._dropDataProcessors.length;a++){var b=this._dropDataProcessors[a],d=b.processDropLocation(c,e,this._dragDataProcessor);if(d){if(this._dropLocationProcessor&&this._dropLocationProcessor!=b)this._dropLocationProcessor.removeDropLocation();this._dropLocationProcessor=b;break}}if(this._dropLocationProcessor&&a==this._dropDataProcessors.length)this._dropLocationProcessor.removeDropLocation()}},_processDrop:function(e,f){var g;if(this._dragDataProcessor)for(var b=0;b<this._dropDataProcessors.length;b++){var d=this._dropDataProcessors[b],c=d.processDrop(e,f,this._dragDataProcessor);if(c){Trace.log("Processed Drop",a);break}}this._handleDrop(c)},_handleDrop:function(a){if(this._dragDataProcessor)this._dragDataProcessor.handleDragEnd(a);if(this._dropLocationProcessor)this._dropLocationProcessor.removeDropLocation();this._mouseDownDraggableElement=null;this._mouseDownEventData=null;this._dropLocationProcessor=null;this._dragDataProcessor=null;this._dragging=false;this._displayDragProxy(false)},_findDragAbleElement:function(a){var b=null;if(a&&a.nodeName!="INPUT")while(a&&a!=window){if(a.dragTarget){b=a;break}a=a.parentNode}return b},_findDropTargetElement:function(d){var e=this.isDragProxyVisible;this.isDragProxyVisible=false;this.change();var b,a=b=document.elementFromPoint(d.originalEvent.clientX,d.originalEvent.clientY),c=null;while(a&&a!=window){if(a.dropTarget){c=a;break}a=a.parentNode}this.isDragProxyVisible=e;this.change();return {processorElement:c,dropSourceElement:b}},_selectStartEvent:function(c){Trace.log("Select Start",a);var b=this._findDragAbleElement(c.srcElement);return $B.IE||!!!b},_dragStartEvent:function(c){Trace.log("Drag Start",a);if(!this._dragging)if(this._mouseDownEventData){Trace.log("Drag Start with Mouse Down Data",a);this._processDragStart(this._mouseDownDraggableElement,this._mouseDownEventData)}else{var b=this._findDragAbleElement(c.srcElement);if(b)this._processDragStart(b,c)}return !this._dragging},_dragEnterEvent:function(a){if(!this._dragging){this._dragging=true;this._processDragStart(null,a)}return false},_dragOverEvent:function(a){if(this._dragLeaveTimeout){clearTimeout(this._dragLeaveTimeout);this._dragLeaveTimeout=null}this._updateDragProxy(a);var b=this._findDropTargetElement(a);if(b.processorElement)this._processDropLocation(b,a);else if(this._dropLocationProcessor)this._dropLocationProcessor.removeDropLocation();return false},_dropEvent:function(c){Trace.log("Drop",a);var b=this._findDropTargetElement(c);if(b.processorElement)this._processDrop(b,c);this._handleDrop();return false},_dragEndEvent:function(c){Trace.log("Drag End",a);var b=this._findDropTargetElement(c);if(b.processorElement)this._processDrop(b,c);this._handleDrop();return false},_cancelEvent:function(){return false},_mouseUpEvent:function(c){if(this._dragging){Trace.log("Drag End - From Mouse Up",a);var b=this._findDropTargetElement(c);if(b.processorElement)this._processDrop(b,c);this._handleDrop()}else{this._mouseDownEventData=null;this._mouseDownDraggableElement=null}},_copyEvent:function(b){var a=b.originalEvent,c={srcElement:b.srcElement,originalEvent:{clientX:a.clientX,clientY:a.clientY}};return c},_mouseDownEvent:function(c){Trace.log("Drag Mouse Down",a);var b=this._findDragAbleElement(c.srcElement);if(b&&c.which!=2){this._mouseDownEventData=this._copyEvent(c);this._mouseDownDraggableElement=b}else{this._mouseDownEventData=null;this._mouseDownDraggableElement=null}return !$B.Firefox||$B.Firefox&&!b},_mouseMoveEvent:function(b){var a=this;if(a._dragging){a._updateDragProxy(b);var g=(new Date).getTime();if(!this._lastProcessDropLocation||g-this._lastProcessDropLocation>100){this._lastProcessDropLocation=g;var c=a._findDropTargetElement(b);if(c.processorElement)a._processDropLocation(c,b);else if(this._dropLocationProcessor)a._dropLocationProcessor.removeDropLocation()}}else if(a._mouseDownEventData){var e=a._mouseDownEventData.originalEvent.clientX-b.originalEvent.clientX,f=a._mouseDownEventData.originalEvent.clientY-b.originalEvent.clientY;if(e*e+f*f>=d)a._processDragStart(a._mouseDownDraggableElement,a._mouseDownEventData)}},_dragLeaveEvent:function(){if(this._dragging){if(this._dragLeaveTimeout)clearTimeout(this._dragLeaveTimeout);this._dragLeaveTimeout=setTimeout(bind(this,this._dragOutWindowEvent),c)}return false},_dragOutWindowEvent:function(){Trace.log("Drag Left Window",a);this._handleDrop()},_updateDragProxy:function(a){if(a){this.dragProxyTop=a.originalEvent.clientY-this._offsetY;this.dragProxyLeft=a.originalEvent.clientX-this._offsetX}else{this.dragProxyTop=0;this.dragProxyLeft=0}if(this.isActive)this.subElements.dragProxyContainer.style.cssText=generateStyleAttribute("display",this.isDragProxyVisible,"top",this.dragProxyTop+"px","left",this.dragProxyLeft+"px");else this.change()}});defineSubClass("wLive.Core.DragAndDropController",SkyDrive.UI.NewControlAdapter,null,{controlType:SkyDrive.Core.DragAndDropController});$Do.register("wLive.Core.DragAndDropController")})();SkyDrive.Core.DragAndDropController.prototype.onRenderHtml=function(){return "<"+this.baseTag+""+sutraAttribute("SkyDrive.DragAndDropController")+' id="'+htmlAttributeEncode(this.id+"_0")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="c-'+this.controlName+" "+this.baseClass+'">'+'<div id="'+htmlAttributeEncode(this.id+"_1")+'" style="'+this.baseStyle+" "+generateStyleAttribute("display",this.isDragProxyVisible,"top.px",this.dragProxyTop,"left.px",this.dragProxyLeft)+'" class="dragProxy">'+this.dragProxy.renderHtml()+"</div>"+"</"+this.baseTag+">"+""};processAnnotations(SkyDrive.Core.DragAndDropController,[{id:0},{id:1,css:["display","isDragProxyVisible","top.px","dragProxyTop","left.px","dragProxyLeft"],childId:"dragProxyContainer"}]);(function(){wLive.Core.GenericDragProcessorData=function(){};wLive.Core.GenericDragProcessorData.prototype={type:"",el:null};window.wLive.Core.GenericDragProcessor=a;function a(){var b=this,a=null;b.processDrag=function(c,d){b.handleDragEnd();if(c&&c.control&&c.control.onProcessDrag){a=c.control;return a.onProcessDrag(c,d)}else{a=null;return false}};b.handleDragEnd=function(b){if(a){a.onHandleDragEnd(b);a=null}};b.getData=function(b){return a.onGetDragData(b)}}})();(function(){var b="dropping";window.wLive.Core.GenericDropProcessor=a;function a(){var b=this,a=null,c=null,d=null;b.processDrop=function(g,h,f){var e=g.processorElement;b.removeDropLocation();if(e.control&&e.control.onProcessDrop){d=f.getData(h);c=e;a=e.control;return a.onProcessDrop(g,h,f)}else return false};b.processDropLocation=function(j,k,i){var h=false,f=j.processorElement,g;if(f.control&&f.control.onProcessDropLocation){g=f.control;h=g.onProcessDropLocation(j,k,i)}if(g!==a)b.removeDropLocation();if(h){d=i.getData(k);c=f;var l=a;a=f.control;if(g!==l)e(true)}return h};b.removeDropLocation=function(){if(a){e(false);a.onRemoveDropLocation();a=null;d=null;c=null}};function e(a){toggleClass(c,"dropping",a);toggleClass(c,"dropping-"+d.type,a)}}})();(function(){window.wLive.Core.Html5FileDragProcessor=a;function a(){var b=this,c;function d(a){var b=false;if(a.originalEvent&&a.originalEvent.dataTransfer)if(a.originalEvent.dataTransfer.files&&a.originalEvent.dataTransfer.files.length>0)b=true;else{var c=a.originalEvent.dataTransfer.types;if(c)for(var d=0;d<c.length;d++)if(c[d].toLowerCase()=="files"){b=true;break}}return b}b.processDrag=function(f,e){var a=false;if(d(e)){c=e.originalEvent.dataTransfer.files;a=true}else b.handleDragEnd();return a};b.handleDragEnd=function(){c=null};b.getData=function(b){var c=[{name:wLive.Core.AleHelpers.getPCString("FileType.Folder"),isFolder:true}];if(b.originalEvent&&b.originalEvent.dataTransfer&&b.originalEvent.dataTransfer.files&&b.originalEvent.dataTransfer.files.length>0)c=b.originalEvent.dataTransfer.files;return {type:a.dragDataType,files:c}}}a.dragDataType="html5file"})();(function(){wLive.Core.jQuerySkyDragProcessor=function(){};wLive.Core.jQuerySkyDragProcessor.prototype={type:"",skyDriveItemKey:"",skyDriveItem:null};window.wLive.Core.jQuerySkyDragProcessor=a;function a(){var d=this,b,c;d.processDrag=function(k,j){var e=false,f=jQuery(j.srcElement).closest(".up_drag");if(f.length>0){var i=f.data("itemKey");if(!b||b!=i){b=i;c=wLive.Core.PageController.getInstance().getViewContext().dataModel.getItem(b,true);var h=j.originalEvent;if(h.dataTransfer){var a=h.dataTransfer;a.effectAllowed="all";if(c.thumbnailSet){var g="https://"+wLive.Core.SkyDriveItemHelper.pickThumbnail(c.thumbnailSet,999999,999999).url;a.setData("image/jpeg",g);a.setData("text/uri-list",g)}a.setData("Text",c.getDisplayName(wLive.Core.PageController.getInstance().getViewContext()))}}e=true}else d.handleDragEnd();return e};d.handleDragEnd=function(){b=null;c=null};d.getData=function(){return {type:a.dragDataType,skyDriveItemKey:b,skyDriveItem:c}}}a.dragDataType="jquerydrag"})();(function(){var a="up_currentdrop",d="jQuery Sky Drop Processor";window.wLive.Core.jQuerySkyDropProcessor=c;var b=wLive.Core.SkyDriveItemHelper.isHtml5DropEnabled;function c(){var e=this,c=null;e.processDrop=function(c,m,j){var a=false,k=c.processorElement;if(!k.control){var g=f(jQuery(c.dropSourceElement));if(g.length>0){var i=j.getData(m);switch(i.type){case wLive.Core.Html5FileDragProcessor.dragDataType:var l=g.data("itemKey"),h=wLive.Core.PageController.getInstance().getViewContext().dataModel.getItem(l,true);a=b(h,wLive.Core.PageController.getInstance().getViewContext());if(a){Trace.log("Processed Drop",d);$Do.when("Bucket4.js",0,function(){$Do.when("FileUploadManager",0,{files:i.files,wasDragAndDropped:true,item:h})})}}e.removeDropLocation()}}return a};e.processDropLocation=function(g,m,h){var e=false,i=g.processorElement;if(!i.control){var d=f(jQuery(g.dropSourceElement));if(d.length>0){var l=h.getData(m);switch(l.type){case wLive.Core.Html5FileDragProcessor.dragDataType:var j=d.data("itemKey"),k=wLive.Core.PageController.getInstance().getViewContext().dataModel.getItem(j,true);e=b(k,wLive.Core.PageController.getInstance().getViewContext());if(e){if(c)c.removeClass(a);d.addClass(a);c=d}}}}return e};e.removeDropLocation=function(){if(c)c.removeClass(a);c=null};function f(a){return a.closest(".up_folderdrop")}}})();$Do.when("wLive.Core.DragAndDropControllerCreated",0,function(){var a=wLive.Core,b=SkyDrive.Core.DragAndDropController.Instance;if(a.skyMode.html5UploadEnabled)b.registerDragDataProcessor(new a.Html5FileDragProcessor);b.registerDragDataProcessor(new a.GenericDragProcessor);b.registerDropDataProcessor(new a.jQuerySkyDropProcessor);b.registerDropDataProcessor(new a.GenericDropProcessor)})