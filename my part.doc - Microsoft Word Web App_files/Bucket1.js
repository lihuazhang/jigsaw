/* Copyright (C) 2012 Microsoft Corporation */(function(){var c=0;a(window,{defineNamespace:function(g,f){var c=g.split("."),b=window;for(var e=0;e<c.length-1;e++)b=b[c[e]]=b[c[e]]||{};var d=c[c.length-1];if(b[d])a(b[d],f);else b[d]=f;return d},defineClass:function(d,b,e,f){var c=b.prototype,g=defineNamespace(d,b);c.__fullName=d;c.__className=g;e&&a(c,e);f&&a(b,f)},defineSubClass:function(e,c,b,f,g){var d=b||function(){};b=function(){c.apply(this,arguments);d.apply(this,arguments)};a(b.prototype,c.prototype);b.prototype._base=c.prototype;defineClass(e,b,f,g)},appendFunction:b,mix:a,bind:function(b,a){return function(){return a.apply(b,arguments)}},createId:function(){return "id-"+c++}});function b(b,a,d){if(!b[a])b[a]=d;else{var c=b.__appendedFunctions=b.__appendedFunctions||{};if(c[a])c[a].push(d);else{var e=c[a]=[];c[a].push(b[a]);c[a].push(d);b[a]=function(){for(var a=0;a<e.length;a++)e[a].apply(this,arguments)}}}}function a(d,c){for(var a in c)if(c.hasOwnProperty(a))if(a!=="dispose")d[a]=c[a];else b(d,a,c[a]);return d}})();(function(){var e=80,l=200,j="",g="default",h=1e3,k=0,f={},c=[],a=[],d=0,b=-1;defineNamespace("Trace",{events:a,categories:c,register:function(b,d){if(!f[b]){var a={name:b,isEnabled:true,__isObservable:true};d&&mix(a,d);f[b]=a;c.push(a);window.change&&change(c)}},log:function(e,c){c=c||g;b==-1&&(b=new Date);a.splice(0,0,{id:k++,message:e||j,category:c,timeStamp:new Date-b});Trace.register(c);!d&&(d=setTimeout(function(){i()},h))},clearEvents:function(){this.events.length=0;change(this.events);b=-1}});function i(){d=0;a.length>l&&a.splice(e,a.length-e);window.change&&change(window.Trace.events)}})();(function(){defineNamespace("Debug",{throwOnAssert:false,log:Trace.log,"assert":function(b,c){if(!b)if(Debug.throwOnAssert)throw{};else if(a(c));}});function a(b){var a=(b||"")+"\n\n";return !window.confirm||!confirm("Debug assert failed!\n\n"+a+'\n\nPress "Cancel" to debug.')}})();(function(){defineNamespace("JBase",{disposables:[],dispose:function(){var b=disposables.length;for(var a=0;a<b;a++)this.disposables[a].dispose();this.disposables=[]}})})();(function(){mix(Number.prototype,{zeroPad:function(b){var a=this+"";while(a.length<b)a="0"+a;return a},toDurationString:function(){var d=this,c=Math.floor(d/(60*60*1e3)),b=Math.floor(d/(60*1e3))%60,e=d/1e3%60,a=(e<10&&b?"0":"")+e.toFixed(3);if(b||c)a=(c?b.zeroPad(2):b)+":"+a;if(c)a=c+":"+a;return a}})})();(function(){mix(Array.prototype,{each:function(c){var b=this.length,d,a;for(a=0;a<b;a++)if(c(this[a],a)===false)break},find:function(c,b){var a;for(a=b||0;a<this.length;a++)if(c(this[a]))return a;return -1},indexOf:Array.prototype.indexOf||a});window.isArray=function(a){return a&&typeof a==="object"&&typeof a["length"]==="number"};function a(b){var a=-1;this.each(function(d,c){if(d===b){a=c;return false}});return a}})();(function(){var c=!!window.addEventListener;defineNamespace("JBase.ElementEventing",{addElementListener:function(f,h,c,g){var d=c,a=this;c=function(b){b.currentTarget=f;var c=d.apply(a,arguments);if(c===false&&b.preventDefault){b.preventDefault();b.returnValue=false}return c};var e={element:f,eventName:h,captureMouse:g,originalCallback:d,callback:c,callbackInstance:a};b(e);a.__elementListeners=a.__elementListeners||[];a.__elementListeners.push(e)},removeElementListener:function(g,e,f){var d=this,c=d.__elementListeners||[],b=c.find(function(a){return a.element===g&&a.eventName===e&&a.originalCallback===f&&a.callbackInstance===d});if(b!==-1){a(c[b]);c.splice(b,1)}},clearElementListeners:function(){var b=this.__elementListeners;if(b&&b.length)for(var c=0;c<b.length;c++){var d=b[c];a(d)}delete this.__elementListeners},dispose:function(){this.clearElementListeners()}});function b(a){if(a)jQuery(a.element).bind(a.eventName,a.callback)}function a(a){if(a)jQuery(a.element).unbind(a.eventName,a.callback)}})();(function(){var a="change";defineNamespace("JBase.ObjectEventing",{addObjectListener:function(e,b,d){var a={object:e,eventName:b,callback:d,parent:this};c(a);this.__objectListeners=this.__objectListeners||[];this.__objectListeners.push(a)},removeObjectListener:function(g,e,f){var d=this,a=d.__objectListeners;if(a){var c=a.find(function(a){return a.object===g&&a.eventName===e&&a.callback===f&&a.parent===d});if(c>=0){b(a[c]);a.splice(c,1)}}},addChangeListener:function(c,b){this.addObjectListener(c,a,b)},removeChangeListener:function(c,b){this.removeObjectListener(c,a,b)},clearObjectListeners:function(){var a=this.__objectListeners;if(a){a.each(function(a){b(a)});delete this.__objectListeners}},dispose:function(){this.clearObjectListeners()}});function c(a){var c=a.object,b=c.__eventCallbacks=c.__eventCallbacks||{},d=b[a.eventName]=b[a.eventName]||[];d.push(a)}function b(a){var e=a.object,d=e.__eventCallbacks||{},c=d[a.eventName],b=c.find(function(b){return b.callback===a.callback&&b.parent===a.parent});b>=0&&c.splice(b,1)}mix(window,{raiseEvent:function(a,c,g,f){var b=a.__eventCallbacks&&a.__eventCallbacks[c]?a.__eventCallbacks[c]:null;if(b)for(var d=0;d<b.length;d++){var e=b[d];if(e.callback.call(e.parent||window,g)===false)return}if(f&&a.parent)raiseEvent(a.parent,c,g,f)},raiseEventWithProcessing:function(a,d,f,c,h){var b=a.__eventCallbacks&&a.__eventCallbacks[d]?a.__eventCallbacks[d]:null;if(b)for(var e=0;e<b.length;e++){var g=b[e],i=g.callback.call(g.parent||window,c);if(f(i,c)===false)return}if(h&&a.parent)raiseEventWithProcessing(a.parent,d,f,c,h)},change:function(c,b){raiseEvent(c,a,b)}})})();(function(){var e=!!document.querySelector,s=/[^\w .,-]/g,r=/[^\w.,-]/g,c=typeof document.textContent==="undefined";mix(window,{setText:c?o:q,getText:c?m:p,byClass:e?f:b,byId:function(b,a){a=a&&a.getElementById?a:document;return a.getElementById(b)},ce:function(c,a){var b=document.createElement(c);a&&(b.innerHTML=a);return b},generateAttributesString:function(){var e=arguments.length,c="";for(var b=1;b<e;b+=2){var a=arguments[b-1],d=arguments[b];switch(a){case "checked":case "disabled":if(d)d=a;else a=null}a&&(c+=a+'="'+htmlAttributeEncode(d)+'" ')}return c?" "+c:""},generateClassAttribute:function(){var b="",c=arguments.length;for(var a=1;a<c;a+=2){var e=arguments[a-1],d=arguments[a];d&&(b+=" "+e)}return b},generateStyleAttribute:function(){var d=arguments.length,c="";for(var a=1;a<d;a+=2){var b=processStyleAttribute(arguments[a-1],arguments[a]);b&&(c+=b)}return c},processStyleAttribute:function(b,a){var c="";switch(b){case "display":if(a)a="block";else a="none";break;case "display.inline":if(a===true)a="inline";else if(a===false)a="none";b=null;c="display: "+a+";";break;case "display.inlineblock":if(a===true)a="inline-block";else if(a===false)a="none";b=null;c="display: "+a+";";break;case "visibility":if(a===true)a="visible";else if(a===false)a="hidden";break;case "opacity":c="filter: alpha(opacity="+Math.round(a*100)+");";break;case "width":case "height":case "left":case "right":case "top":case "bottom":a===undefined&&(b=null);break;case "width.px":case "height.px":case "left.px":case "right.px":case "top.px":case "bottom.px":b=b.replace(".px","");a===undefined&&(b=null);a+="px"}b&&(c+=b+":"+a+";");return c},addListener:k,removeListener:i,registerStyle:j,closestWithClass:h,hasClass:d,toggleClass:l,htmlEncode:n,htmlAttributeEncode:g});var a="";addListener(window,"load",function(){if(a&&document.body){var b=a;a="";registerStyle(b)}});function j(c){if(c){var d=document.head||document.body;if(d){var b=ce("style");b.type="text/css";if(b.styleSheet)b.styleSheet.cssText=c;else b.appendChild(document.createTextNode(c));d.appendChild(b)}else a+=c}}function h(a,b){while(a&&a!=window){if(d(a,b))break;a=a.parentNode}return a}function d(a,b){return a&&a.className&&a.className.split(" ").indexOf(b)!==-1}function l(a,e,b){if(a){if(!a._classNames){a._classNames={};var d=a.className&&a.className.split(" ")||[];for(var g=0;g<d.length;g++)a._classNames[d[g]]=true}var c=a._classNames;isEnabled=c[e];b===undefined&&(b=!isEnabled);var f=false;if(!isEnabled&&b){c[e]=true;f=true}else if(isEnabled&&!b){delete c[e];f=true}if(f){var d=[];for(var h in c)d.push(h);a.className=d.join(" ")}}}function q(a,b){a.textContent=b}function o(a,b){a.innerText=b}function p(a){return a.textContent}function m(a){return a.innerText}function g(a){return a?String(a).encodeHtmlAttribute():""}function n(a){return a?String(a).encodeHtml():""}function k(a,b,c,d){if(!a.addEventListener)a.attachEvent("on"+b,c);else a.addEventListener(b,c,!!d)}function i(a,b,c,d){if(!a.removeEventListener)a.detachEvent("on"+b,c);else a.removeEventListener(b,c,!!d)}function f(b,a){a=a||document;return a.querySelector("."+b)}function b(g,f){f=f||document.body;var e,i=new RegExp("(^|\\s)"+g+"(\\s|$)"),d=null,c=f.childNodes,a;for(a=0;a<c.length;a++){e=c[a];if(i.test(e.className)){d=e;break}}for(a=0;a<c.length;a++){var h=b(c[a],g);if(h){d=h;break}}return d}})();(function(){var a=window;a.sutraAttribute=function(c){var b="";if(a.$Sutra)b=' sutra="'+getSutraValue(c)+'"';return b};a.getSutraValue=function(e){var b=a.$Sutra;if(b){var d=e.split(".");for(var c=0,f=d.length;c<f;c++)b=b[d[c]]}return b||""}})();(function(){var a=0;defineClass("JBase.DataContext",function(b){this.__dataContextId=a++;this.reset();this.setData(b)},{__isDataContext:true,__isObservable:true,reset:function(){},setData:function(e,f){var a=false;for(var d in e)if(e.hasOwnProperty(d)){var c=this[d],b=e[d];if(c!=b){c&&c.__isObservable&&this.removeChangeListener(c,this._onChildChange);this[d]=b;a=true;b&&b.__isObservable&&this.addChangeListener(b,this._onChildChange)}}a=a||f;a&&change(this);return a},_onChildChange:function(a){change(this,a)}});mix(JBase.DataContext.prototype,JBase.ObjectEventing)})();(function(){var d="changed",c=0,e=0;defineClass("JBase.UI.BaseControl",function(){mix(this,{subElements:{},children:[],__lastValues:[],__subElementsByIndex:null,__dataContextHasChanged:false})},{isActive:false,baseTag:"div",baseDataContextType:JBase.DataContext,baseClass:"",baseStyle:"",element:null,setDataContext:function(a,b){if(a)if(a.__isDataContext){if(!this.dataContext||a!==this.dataContext){if(this.onDataContextChanged&&this.dataContext)this.removeChangeListener(this.dataContext,this.change,this);this.dataContext=a;if(this.onDataContextChanged&&this.dataContext)this.addChangeListener(this.dataContext,this.change,this);this.change()}else if(b)this.change()}else{this._createDataContextIfNull();this.dataContext.setData(a,b)}else{this._createDataContextIfNull();this.dataContext.reset();this.change()}},renderHtml:function(){this.controlName=this.controlName||this.__className;this.id=this.id||this.controlName+"-"+c++;this.__dataContextHasChanged&&this.change(true);this._clearElementReferences();return this.baseTag?this.onRenderHtml():""},onRenderHtml:function(){return this.defaultRenderHtml("")},defaultRenderHtml:function(a){return "<"+this.baseTag+' id="'+this.id+'_0" class="c-'+this.controlName+(this.baseClass?" "+this.baseClass:"")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+(this.sutraLabel?sutraAttribute(this.sutraLabel):"")+">"+(a?a:"")+"</"+this.baseTag+">"},activate:function(){var a=this,b,d;d=a.children.length;for(b=0;b<d;b++){var c=a.children[b];c.activate&&c.activate()}if(!a.isActive){a._findSubElements();if(!a.element&&a.baseTag)a.element=a.__subElementsByIndex[0]||byId(a.id+"_0");if(a.element)a.element.control=a;a.isActive=true;a.onActivate&&a.onActivate();a.__dataContextHasChanged&&a.change()}},resize:function(){var d=this,a,c;if(this.isActive){c=d.children.length;for(a=0;a<c;a++){var b=d.children[a];b.resize&&b.resize()}this.onResize&&this.onResize()}},deactivate:function(){var a=this,b,d;if(a.isActive){a.clearElementListeners();d=a.children.length;for(b=0;b<d;b++){var c=a.children[b];c.deactivate&&c.deactivate()}a.isActive=false;a.onDeactivate&&a.onDeactivate()}},dispose:function(){var a=this;a.isActive&&a.deactivate();a.children.each(function(a){a.dispose&&a.dispose()});a.onDispose&&a.onDispose();a._clearElementReferences();a.removeChangeListener(a.dataContext,a.change,a);a.dataContext=null},createChild:function(d,c,b){var a=new d;c&&mix(a,c);b&&a.setDataContext(b);this.addChild(a);return a},addChild:function(a){this.children.push(a);a.parent=this;return a},removeChild:function(b,a){a=a===undefined?this.children.indexOf(b):a;if(a!==-1){this.children.splice(a,1);b.parent=null}return b},clearChildren:function(){this.children.each(function(a){a.dispose&&a.dispose();a.parent=null});this.children.length=0},change:function(a){if(this.isActive||a){if(!this._changingDataContext){this._changingDataContext=true;try{this.__dataContextHasChanged=false;this.onDataContextChanged&&this.onDataContextChanged(this.dataContext);this._updateBindings()}finally{this._changingDataContext=false}}}else this.__dataContextHasChanged=true},_createDataContextIfNull:function(){if(!this.dataContext){this.dataContext=new this.baseDataContextType;if(this.onDataContextChanged&&this.dataContext)this.addChangeListener(this.dataContext,this.change,this)}},_clearElementReferences:function(){var a=this;if(a.element){a.element.control=null;a.element=null;a.subElements={};a.__subElementsByIndex=null}},_findSubElements:function(){var a=this;if(!a.__subElementsByIndex&&a.baseTag){var g=a.id+"_",i=0,h,e=a.__annotations?a.__annotations.length:0;a.__subElementsByIndex=[];a.subElements={};for(var c=0;c<e;c++){var b=a.__annotations[c],f=this.id+"_"+b.id,d=byId(f);a.__subElementsByIndex[b.id]=d;if(b.childId)a.subElements[b.childId]=d}}},_updateBindings:function(){var a=this;if(a.__bindings)if(a.isActive){var h=a.__bindings.length,i=a.__bindings,g=a.__subElementsByIndex;for(var c=0;c<h;c++){var d=i[c],e=g[d.id];if(e){var f=a.__lastValues[c]=a.__lastValues[c]===undefined?d.handler.get(e,d.destinationProperty):a.__lastValues[c],b=a[d.sourceProperty];switch(typeof f){case "string":b=b||"";break;case "boolean":b=!!b;break;case "number":b=Number(b||0)}if(b!=f){d.handler.set(e,d.destinationProperty,b);a.__lastValues[c]=b}}}a.__shouldUpdateBindings=false}else a.__shouldUpdateBindings=true}});mix(JBase.UI.BaseControl.prototype,JBase.ElementEventing);mix(JBase.UI.BaseControl.prototype,JBase.ObjectEventing);var b=["attr","className","css"],a={attr:{"get":function(a,b){return a.getAttribute(b)},"set":function(b,c,a){if(a!==null&&a!==undefined&&a!==false)b.setAttribute(c,String(a));else b.removeAttribute(c)}},"attr.style":{"get":function(a){return a.style.cssText},"set":function(a,c,b){a.style.cssText=b}},"attr.class":{"get":function(a){return a.className},"set":function(a,c,b){a.className=b}},"attr.checked":{"get":function(a,b){return a.getAttribute(b)==="checked"},"set":function(a,c,b){a.checked=!!b}},"attr.disabled":{"get":function(a,b){return a.getAttribute(b)==="disabled"},"set":function(a,c,b){a.disabled=!!b}},"attr.html":{"get":function(a){return a.innerHTML},"set":function(a,c,b){a.innerHTML=b}},"attr.text":{"get":function(a){return getText(a)},"set":function(a,c,b){setText(a,b)}},className:{"get":function(a,b){return a.className.indexOf(b)!==-1},"set":function(a,c,b){toggleClass(a,c,b)}},css:{"get":function(a,b){return a.style[b]},"set":function(a,c,b){a.style[c]=b}},"css.display":{"get":function(a,b){return a.style[b]!=="none"},"set":function(a,c,b){a.style[c]=!!b?"block":"none"}},"css.display.inline":{"get":function(a){return a.style.display!=="none"},"set":function(a,c,b){a.style.display=!!b?"inline":"none"}},"css.display.inlineBlock":{"get":function(a){return a.style.display!=="none"},"set":function(a,c,b){a.style.display=!!b?"inline-block":"none"}},"css.visibility":{"get":function(a,b){return a.style[b]==="visible"},"set":function(a,c,b){a.style[c]=!!b?"visible":"hidden"}},"css.width.px":{"get":function(a){return parseInt(a.style.width)},"set":function(a,c,b){a.style.width=b+"px"}},"css.height.px":{"get":function(a){return parseInt(a.style.height)},"set":function(a,c,b){a.style.height=b+"px"}},"css.left.px":{"get":function(a){return parseInt(a.style.left)},"set":function(a,c,b){a.style.left=b+"px"}},"css.right.px":{"get":function(a){return parseInt(a.style.right)},"set":function(a,c,b){a.style.right=b+"px"}},"css.top.px":{"get":function(a){return parseInt(a.style.top)},"set":function(a,c,b){a.style.top=b+"px"}},"css.bottom.px":{"get":function(a){return parseInt(a.style.bottom)},"set":function(a,c,b){a.style.bottom=b+"px"}}};window.processAnnotations=function(f,c){var h=c.length,g,i=f.prototype.__bindings=[];f.prototype.__annotations=c;for(var d=0;d<h;d++){var e=c[d];b.each(function(d){var b=e[d];g=b?b.length:0;for(var c=1;c<g;c+=2){var h=b[c],f=b[c-1];i.push({id:e.id,handler:a[d+"."+f]||a[d],sourceProperty:h,destinationProperty:f})}})}}})();(function(){defineSubClass("JBase.UI.Repeater",JBase.UI.BaseControl,null,{childControl:JBase.UI.ContentControl,onRenderHtml:function(){var a=this,e="",d=a.dataContext.items;a.clearChildren();if(d&&a.childControl){var c;for(var b=0;b<d.length;b++){c=a.createChild(a.childControl);c.setDataContext(a.getChildContext(d[b],b));e+=c.renderHtml()}}return this.defaultRenderHtml(e)},onDataContextChanged:function(){var a=this;if(a.element)if(!a.element.childNodes.length){a.element.innerHTML=a.onRenderHtml();a.activate();a._updateKeyToElementMap()}else a._update()},getChildContext:function(a){var b=a;if(!a.__isDataContext)b={item:a};return b},getKeyFromChildContext:function(a){return a.key||(a.item?a.item.key:null)},_updateKeyToElementMap:function(){var b=this,d=b.element.childNodes;b._keyToElement={};for(var c=0;c<d.length;c++){var e=d[c],a=e.control,f=a&&a.dataContext&&a.dataContext.key?a.dataContext.key:null;f&&(b._keyToElement[a.dataContext.key]=e)}},_update:function(){var a=this;if(a.element){var e=a.dataContext.items,j=a._keyToElement||{},h=a.element.childNodes,f={};if(!e||!e.length){a.clearChildren();a.element.innerHTML=""}else{for(var b=0;b<e.length;b++){var l=e[b],g=this.getChildContext(l,b),d=this.getKeyFromChildContext(g),c=h[b];if(!c)f[d]=a._insertCell(b,g);else{var i=c.control&&c.control.dataContext?this.getKeyFromChildContext(c.control.dataContext):null;if(i!=d)if(j[d]===undefined)f[d]=a._insertCell(b,g);else{var k=e.find(function(a){return a.key===i});if(k===-1){a._removeCell(c);b--}else f[d]=a._insertCell(b,g)}else{f[d]=c;c.control&&c.control.setDataContext(g)}}}while(h.length>e.length)this._removeCell(h[h.length-1]);this._keyToElement=f}}},_insertCell:function(f,g){var d=this,b=d.element,a=new d.childControl,e=ce("div"),h=d.dataContext.items;a.setDataContext(g);e.innerHTML=a.renderHtml();var c=a.element=e.firstChild;if(f>=b.childNodes.length)b.appendChild(c);else b.insertBefore(c,b.childNodes[f]);a.activate();this.addChild(a);return c},_removeCell:function(b){var a=b.control;if(a){a.dispose();this.removeChild(a)}this.element&&this.element.removeChild(b)}})})();(function(){defineSubClass("JBase.UI.ContentControl",JBase.UI.BaseControl,function(){mix(this,{_contentControlType:null,_controlTable:{}})},{currentControl:null,disposeOnSwap:false,getControlType:function(){return JBase.UI.BaseControl},getControlOptions:function(){return null},onRenderHtml:function(){return this.defaultRenderHtml(this.currentControl?this.currentControl.renderHtml():"")},onDataContextChanged:function(c){var b=this.getControlType(c),a=this.currentControl;if(this._contentControlType!==b){if(a){this.removeChild(a);if(this.disposeOnSwap){a.dispose();this.element&&(this.element.innerHTML="");delete this._controlTable[this._contentControlType.prototype.__fullName]}else{a.deactivate();if(this.element&&a.element){a.__originalDisplay=a.__originalDisplay||a.element.style.display;if(!a.__originalDisplay&&window.getComputedStyle){var f=window.getComputedStyle(a.element);a.__originalDisplay=f.display}a.element.style.display="none"}}this.currentControl=null}this._contentControlType=b;if(b){var d=b.prototype.__fullName;a=this._controlTable[d];if(a)this.addChild(a);else a=this._controlTable[d]=this.createChild(b,this.getControlOptions(c));this.currentControl=a;a.setDataContext(c,true);if(this.element){if(a.element)if(a.element.style.display==="none")a.element.style.display=a.__originalDisplay||"block";else this.element.appendChild(a.element);else{var e=ce("div");e.innerHTML=a.renderHtml();this.element.appendChild(e.firstChild)}this.isActive&&a.activate()}}if(this.element&&!a&&this.disposeOnSwap)this.element&&(this.element.innerHTML="")}else this.currentControl&&this.currentControl.setDataContext(this.dataContext)},onDispose:function(){for(var a in this._controlTable)if(this._controlTable.hasOwnProperty(a))this._controlTable[a].dispose();this._controlTable={}}})})();var c_maxSimultaneousImages=10,_pendingLoadCount=0,_visitedUrls={},_urlsToLoad={},_urlQueue=[];(function(){defineNamespace("JBase.UI.ImageLoader",{loadImage:function(a,b,d){b=b||ce("img");if(_visitedUrls[a]){b.src=a;d(a,b)}else{var c=_urlsToLoad[a];if(!c){c=_urlsToLoad[a]={url:a,elements:[b],callbacks:[d]};_urlQueue.push(a);this.processQueue()}else{c.elements.push(b);c.callbacks.push(d)}}},isIdle:function(){return _pendingLoadCount===0},isLoaded:function(a){return !!_visitedUrls[a]},isDomainAccessible:function(){return true},onError:function(){},processQueue:function(){var b=0;while(b<_urlQueue.length&&_pendingLoadCount<c_maxSimultaneousImages)if(JBase.UI.ImageLoader.isDomainAccessible(_urlQueue[b])){var c=_urlQueue.shift(),d=_urlsToLoad[c],a=d.elements[0];this._addImageEventHandlers(a);_pendingLoadCount++;a.src=a.s=c}else b++},_addImageEventHandlers:function(a){this.addElementListener(a,"load",this._onImageLoad);this.addElementListener(a,"error",this._onImageError);this.addElementListener(a,"abort",this._onImageAbort);return a},_removeImageEventHandlers:function(a){this.removeElementListener(a,"load",this._onImageLoad);this.removeElementListener(a,"error",this._onImageError);this.removeElementListener(a,"abort",this._onImageAbort)},_onImageLoad:function(e,c){var d=e.currentTarget,a=d.s,b=_urlsToLoad[a];this._removeImageEventHandlers(d);_pendingLoadCount--;if(!c){_visitedUrls[a]=true;for(i=0;i<b.callbacks.length;i++)try{i>0&&(b.elements[i].src=a);b.callbacks[i](a,b.elements[i])}catch(f){}}else if(c===1)JBase.UI.ImageLoader.onError(a);delete _urlsToLoad[a];this.processQueue()},_onImageError:function(a){this._onImageLoad(a,1)},_onImageAbort:function(a){this._onImageLoad(a,2)}});mix(JBase.UI.ImageLoader,JBase.ElementEventing);JBase.disposables.push(JBase.UI.ImageLoader)})();(function(){var c=[],a=[],b={};defineNamespace("JBase.UI.ImageStripHelper",{registerStrip:function(d,b){c.push(d);a.push(b)},getImageInfo:function(e,i,h){var d;if(e){d=b[e];if(!d){var g=a.find(function(a){return a.hasOwnProperty(e)});if(g>=0){var f=a[g][e];d=b[e]={url:c[g],containerSize:{width:f.w,height:f.h},imagePosition:{left:-f.x,top:-f.y}}}}}return d?{url:d.url,containerSize:d.containerSize,imagePosition:d.imagePosition,alt:i,title:h}:null}})})();(function(){var a=.5;defineNamespace("JBase.UI.ImageSizeHelper",{scaleToContainer:function(g,a,b,e){var d={},c=g.width/g.height,f=a.width/a.height;if(!e&&c>f||e&&c<f){var i=b?Math.min(b.width,a.width):a.width;d={width:i,height:Math.ceil(i*(1/c))}}else{var h=b?Math.min(b.height,a.height):a.height;d={width:Math.ceil(h*c),height:h}}return d},centerPosition:function(b,e,c,d){var h=b.width>e.width,f=b.height>e.height;c=!h||c===undefined?a:c;d=!f||d===undefined?a:d;var i=e.height*.5-b.height*d,g=e.width*.5-b.width*c,j={left:h?Math.min(0,g):g,top:f?Math.min(0,i):i,width:b.width,height:b.height};return j}})})();(function(){var c="visible",h="animated",e={url:""},i="ImageTile",d=.5,b=JBase.UI.ImageLoader,a="keyframes imageTileFadeIn {0% { opacity: 0; }100% { opacity: 1; }}";registerStyle(".c-ImageTile > img { filter: alpha(opacity=0); }.c-ImageTile > img.visible { filter: alpha(opacity=100); }@"+a+"@-ms-"+a+"@-moz-"+a+"@-webkit-"+a);var g=!($B.IE&&$B.V<10);defineSubClass("JBase.UI.ImageTile",JBase.UI.BaseControl,null,{baseTag:"span",imageAnimationDuration:null,horizontalCenterRatio:d,verticalCenterRatio:d,onRenderHtml:function(){var d="",a=this.dataContext||e;if(a.url)if(b.isLoaded(a.url))d='<img alt="'+htmlAttributeEncode(a.alt||"")+'"  title="'+htmlAttributeEncode(a.title||"")+'" src="'+htmlAttributeEncode(a.url)+'"'+' s="'+htmlAttributeEncode(a.url)+'" class="'+c+'" style="'+this.thumbnailStyle+'" />';else b.loadImage(a.url,null,bind(this,this._onImageAvailable));return this.defaultRenderHtml(d)},onActivate:function(){var a=this.element.children.length>0?this.element.children[this.element.children.length-1]:null,c=a?a.getAttribute("s"):null;if(c&&c===this._currentUrl)this._currentImage=a;else if(this._lastLoadedImage){this._onImageAvailable(this._lastLoadedUrl,this._lastLoadedImage);this._lastLoadedImage=this._lastLoadedUrl=null}else{var d=this.dataContext;this._currentUrl&&b.loadImage(this._currentUrl,null,bind(this,this._onImageAvailable))}},onDataContextChanged:function(a){a=a||e;if(a.url!==this._currentUrl){this._currentUrl=a.url;this._currentImage=null;if(!this.imageAnimationDuration||!a.url)this.element&&(this.element.innerHTML="");if(this.isActive)a.url&&b.loadImage(a.url,null,bind(this,this._onImageAvailable))}this._updateContentSize()},_onImageAvailable:function(d,b){var a=this,e=this.dataContext;if(d===a._currentUrl)if(a.isActive){if(a.element&&!a._currentImage){a._currentImage=b;b.setAttribute("s",d);b.alt=e.alt||"";b.title=e.title||"";!a.imageAnimationDuration&&(b.className=c);a._updateContentSize();a.element.appendChild(b);a.imageAnimationDuration&&a._fadeInImage()}}else{a._lastLoadedImage=b;a._lastLoadedUrl=d}},_fadeInImage:function(){var a=this;if(a.imageAnimationDuration){if(g)setTimeout(function(){if(a._currentImage){var b=a._currentImage.style;b.animationDuration=b.msAnimationDuration=b.webkitAnimationDuration=b.MozAnimationDuration=a.imageAnimationDuration/1e3+"s";a._currentImage.className=h}},20);else jQuery(a._currentImage).css("opacity",0).animate({opacity:1},a.imageAnimationDuration,function(){if(a._currentImage)a._currentImage.className=c});clearTimeout(a._purgeTimeout);a._purgeTimeout=setTimeout(function(){a._purgeHiddenImages()},a.imageAnimationDuration+20)}},_updateContentSize:function(){var c=this.dataContext||{},b=c.containerSize,a=c.imagePosition,d=c.originalSize;if(a&&a.left===undefined&&a.top===undefined){a=JBase.UI.ImageSizeHelper.scaleToContainer(a,b,d,!this.scaleToFit);a=JBase.UI.ImageSizeHelper.centerPosition(a,b,this.horizontalCenterRatio,this.verticalCenterRatio)}this.baseStyle=f(b);this.thumbnailStyle=f(a);this.element&&(this.element.style.cssText=this.baseStyle);this._currentImage&&(this._currentImage.style.cssText=this.thumbnailStyle)},_purgeHiddenImages:function(){if(this.element)while(this.element.childNodes.length>1)this.element.removeChild(this.element.children[0])}});function f(a){return a?generateStyleAttribute("width.px",a.width,"height.px",a.height,"left.px",a.left,"right.px",a.right,"top.px",a.top):""}})();registerStyle("/* Root image tile style. */.c-ImageTile {display: inline-block;position: relative;overflow: hidden;}/* Image within the tile container. */.c-ImageTile img {position: absolute;opacity: 0;}/* Visible state. */.c-ImageTile img.visible {opacity: 1;}/* Visible animated state. */.c-ImageTile img.animated {opacity: 1;animation-name: imageTileFadeIn;-ms-animation-name: imageTileFadeIn;-webkit-animation-name: imageTileFadeIn;-moz-animation-name: imageTileFadeIn;}");(function(){defineSubClass("SkyDrive.UI.LegacyControlAdapter",JBase.UI.BaseControl,function(){this._controlInstance=null},{controlType:null,constructorOption:null,renderOption:null,onResize:function(){if(this._controlInstance&&this._controlInstance.resize)this._controlInstance.resize()},onActivate:function(){this._updateControl(true)},onDataContextChanged:function(){this._updateControl()},_updateControl:function(a){if((this.isActive||a)&&this.dataContext&&this.dataContext.item){if(!this._controlInstance)this._controlInstance=new this.controlType(jQuery(this.element),wLive.Core.PageController.getInstance().getViewContext(),this.constructorOption);this._controlInstance.render(this.dataContext.item,this.renderOption)}else if(this._controlInstance){this._controlInstance.dispose();this._controlInstance=null}},onDispose:function(){if(this._controlInstance){this._controlInstance.dispose();this._controlInstance=null}}})})();(function(){defineClass("SkyDrive.UI.NewControlAdapter",function(a,b){this.element=a?a[0]:null;this._viewContext=b;this._controlInstance=null},{initialize:function(){if(!this._controlInstance&&this.controlType)this._controlInstance=new this.controlType},render:function(a){var b=a?{item:a}:{};this.initialize();this._controlInstance.setDataContext(b);if(!this._controlInstance.isActive){this.element.innerHTML=this._controlInstance.renderHtml();this._controlInstance.activate()}},isLoaded:function(){return !this._controlInstance||!this._controlInstance.isLoaded||this._controlInstance.isLoaded()},resize:function(){this._controlInstance&&this._controlInstance.resize&&this._controlInstance.resize()},dispose:function(){if(this._controlInstance){this._controlInstance.dispose();this._controlInstance=null}}})})();History={};(function(){var d=_innerWindow=window,a=History,o=$Utility,c=d;try{if(d.top.location.href)c=d.top}catch(X){}var H=d["$Config"],m=H&&H.AjaxHistory;function B(b){a.disableBookmarking=b&&b.db;a.configState=b&&b.state||{};a.configHash=g("",a.configState);a.sessionId=a.disableBookmarking&&Math.floor(Math.random()*1e3+1)||""}a.initInstance=B;jQuery(d).bind("unload",u);function u(){c.$Do.iff("$History.detachAll");if(d==c)G();else c.$Do.remove("$History",0,y);jQuery(d).unbind("unload",u)}a.dispose=u;function y(){_innerWindow.History=c.History;c.History.initInstance(m);_innerWindow.$Do.register("$History",0,true);_innerWindow.$Do.register("$History.attach",c.History.attach,true);_innerWindow.$Do.register("$History.attachPF",c.History.attachPF,true);_innerWindow.$Do.register("$History.navigateTo",c.History.navigateTo,true)}if(_innerWindow!=c){c.$Do.when("$History",0,y);return}else B(m);var x="ajhs",k="NavigateEvent",s="PFEvent",R=document.documentMode,Q=m&&m.id,i=a.configState,K=i,q=$B.BB_M5?"#":"",b=p(),C=b,t,e,l,r=$B.IE&&($B.V<8||R<8),L="onhashchange" in window&&!r,h=false;a.forceNextNavigate=O;a.attach=I;a.attachPF=F;a.detachPF=G;a.detach=V;a.detachAll=E;a.addNavigationStep=S;a.addPFState=U;a.navigateTo=D;j();if(L)d.onhashchange=j;else setInterval(j,100);function I(b){jQuery(a).bind(k,b)}function F(b){jQuery(a).bind(s,b)}function G(b){jQuery(a).unbind(s,b)}function V(b){jQuery(a).unbind(k,b)}function E(){jQuery(a).unbind(k)}function j(){if(!l){l=1;try{var a=p();if(a!=b||h)w(a)}finally{l=0;h=0}}}function w(c){if(r&&l&&(b!=c||h))z(c);var d=n(b),a=n(c);if(d.pf!=a.pf)P(a.pf,a.app);else if(!J(d.app,a.app)||h)M(a.app);b=p()}function M(b){b=b?b:a.configHash;i=f(b).app;if(a.disableBookmarking&&i[x]!=a.sessionId)i=a.configState;e=1;jQuery(a).trigger(k,i);e=0}function P(d,c){e=1;var b=jQuery.Event(s);b.pfState=c?[d,"#",c].join(""):d;jQuery(a).trigger(b);if(b.result)T(g(b.result,{}));e=0}function O(a){h=!!a}function D(a){if(typeof a==="string")a=f(a).app;var c=f(b).pf;v(q+g(c,a));j()}function A(a){var c=b;b=a;if(c!=b){v(q+b,true);if(r)z(b)}}function S(c,i){if(!e){if(typeof c==="string")c=f(c).app;if(a.disableBookmarking)c[x]=a.sessionId;var d=f(b);if(i)d.app={};for(var h in c)d.app[h]=c[h];var j=g(d.pf,d.app);A(j)}}function U(c){if(!e){var d=f(b).pf,a=g(c,{});A(a)}}function W(b,a){if(!t){v(q+(a?C:b));w(a?g(n(C).pf,K):b)}}function z(c){var b=_ge(Q).contentWindow.document;t=1;setTimeout(function(){a.Inform=W},0);b.open();b.write(["<s","cript>","function _a(){",$Config.dl?"document.domain='"+$Config.d+"';":"","window['stateStr']='",escape(c),"';var ph=parent.History;if(ph&&ph.Inform){ph.Inform(unescape(window['stateStr']))}","}","</s","cript>","<body onload='_a()'></body>"].join(""));b.close();t=0}function p(){var b=c.document.location.href,a=b.indexOf("#"),d=a==-1?"":b.substr(a+1);return d}function v(c,a){document.location.hash=c;if(a)b=p()}function T(b){var a=d.top.document.location;a.replace([a.protocol,"//",a.host,a.pathname,a.search,"#",b].join(""))}function g(c,d){var a=o.serialize(d),b=a;if(c)b=["!",c,a!=""?"!":"",a].join("");return b}function f(c){var a=n(c),b=a.app!=""?o.deserialize(a.app):{};return {pf:a.pf,app:b}}function n(a){var d,b;if(a.indexOf("!")==0){a=a.substr(1);var c=a.indexOf("!");if(c>-1){d=a.substr(0,c);b=a.substr(c+1)}else{d=a;b=""}}else b=a;return {pf:d,app:b}}function J(a,b){var c=o.deserialize(a),d=o.deserialize(b);return N(c,d)}function N(a,b){for(var c in a)if((a[c]||0)!==(b[c]||0))return false;for(var d in b)if((b[d]||0)!==(a[d]||0))return false;return true}$Do.register("$History",0,true);$Do.register("$History.attach",I,true);$Do.register("$History.attachPF",F,true);$Do.register("$History.detachAll",E,true);$Do.register("$History.navigateTo",D,true)})();var FilesIS32={mobileUpsell:{x:1,y:1,w:77,h:42},nextHover:{x:1,y:45,w:69,h:40},previousRest:{x:80,y:1,w:69,h:40},nextRest:{x:72,y:45,w:69,h:40},previousHover:{x:1,y:87,w:69,h:40},ft_48_Notebook:{x:1,y:129,w:48,h:48},ft_48_Pptx:{x:72,y:87,w:48,h:48},ft_48_Docx:{x:151,y:1,w:48,h:48},video_48:{x:143,y:51,w:48,h:48},processingVideo_48:{x:122,y:101,w:48,h:48},ft_48_Xlsx:{x:1,y:179,w:48,h:48},skydrive:{x:51,y:137,w:45,h:40},ft_32_Pptx:{x:51,y:179,w:32,h:32},embedIcon:{x:85,y:179,w:32,h:32},friendsIcon:{x:119,y:151,w:32,h:32},publicIconWhite:{x:153,y:151,w:32,h:32},publicIcon:{x:119,y:185,w:32,h:32},mailIcon:{x:153,y:185,w:32,h:32},friendsIconWhite:{x:201,y:1,w:32,h:32},formLinkIconWhite:{x:201,y:35,w:32,h:32},formLinkIcon:{x:193,y:69,w:32,h:32},embedIconWhite:{x:172,y:103,w:32,h:32},linkIconWhite:{x:187,y:137,w:32,h:32},linkIcon:{x:187,y:171,w:32,h:32},ft_32_Docx:{x:1,y:229,w:32,h:32},ft_32_Notebook:{x:51,y:213,w:32,h:32},processingVideo_32:{x:85,y:213,w:32,h:32},ft_32_Xlsx:{x:119,y:219,w:32,h:32},video_32:{x:153,y:219,w:30,h:30},uploadIconDark:{x:206,y:103,w:26,h:26},uploadIconLight:{x:187,y:205,w:26,h:26},createIconLight:{x:185,y:233,w:26,h:26},createIconDark:{x:235,y:1,w:26,h:26},cancelActive:{x:235,y:29,w:20,h:20},cancelRest:{x:235,y:51,w:20,h:20},cancelHover:{x:227,y:73,w:20,h:20},goBackNormal:{x:98,y:137,w:18,h:18},skydrive_16Selected:{x:98,y:157,w:18,h:18},goBackHover:{x:234,y:95,w:18,h:18},skydrive_16:{x:234,y:115,w:18,h:18},zoomOutRest:{x:221,y:135,w:16,h:16},zoomOutHover:{x:239,y:135,w:16,h:16},ft_16_EmptyDocumentFolder:{x:221,y:153,w:16,h:16},ft_16_EmptyAlbum:{x:239,y:153,w:16,h:16},ft_16_NonEmptyFavoriteFolderSelected:{x:221,y:171,w:16,h:16},info_16:{x:239,y:171,w:16,h:16},info_gray_16:{x:221,y:189,w:16,h:16},ft_16_EmptyDocumentFolderSelected:{x:239,y:189,w:16,h:16},ft_16_Docx:{x:215,y:207,w:16,h:16},ft_16_Pptx:{x:233,y:207,w:16,h:16},ft_16_EmptyAlbumSelected:{x:215,y:225,w:16,h:16},centerHover:{x:233,y:225,w:16,h:16},centerRest:{x:213,y:243,w:16,h:16},zoomInRest:{x:231,y:243,w:16,h:16},zoomInHover:{x:263,y:1,w:16,h:16},ft_16_Notebook:{x:263,y:19,w:16,h:16},ft_16_Xlsx:{x:257,y:37,w:16,h:16},ft_16_NonEmptyAlbumSelected:{x:257,y:55,w:16,h:16},blocked16:{x:249,y:73,w:16,h:16},ft_16_NonEmptyDocumentFolderSelected:{x:254,y:91,w:16,h:16},ft_16_EmptyFavoriteFolderSelected:{x:254,y:109,w:16,h:16},ft_16_NonEmptyAlbum:{x:257,y:127,w:16,h:16},ft_16_NonEmptyDocumentFolder:{x:257,y:145,w:16,h:16},ft_16_EmptyFavoriteFolder:{x:257,y:163,w:16,h:16},ft_16_NonEmptyFavoriteFolder:{x:257,y:181,w:16,h:16},warning:{x:122,y:87,w:12,h:12},restoreRest:{x:35,y:229,w:10,h:10},privateIcon:{x:35,y:241,w:8,h:10},privateIconWhite:{x:45,y:247,w:10,h:10},restoreHover:{x:57,y:247,w:10,h:10},darkPanelClosedUp:{x:193,y:51,w:6,h:8},darkPanelOpenUp:{x:51,y:129,w:8,h:6},whiteClosedUp:{x:35,y:253,w:6,h:8},whiteOpenUp:{x:61,y:129,w:8,h:6},closedUp:{x:172,y:137,w:6,h:8},openUp:{x:69,y:247,w:8,h:6},sortMenuBullet:{x:79,y:247,w:8,h:8},chevronRightGray:{x:89,y:247,w:6,h:8},chevronRightBlack:{x:267,y:73,w:6,h:8}},FilesIS8={ft_48_Blank:{x:1,y:1,w:48,h:48},ft_48_NonEmptyFavoriteFolder:{x:51,y:1,w:48,h:48},ft_48_Zip:{x:1,y:51,w:48,h:48},ft_48_NonEmptyDocumentFolder:{x:51,y:51,w:48,h:48},ft_48_Video:{x:101,y:1,w:48,h:48},ft_48_Txt:{x:101,y:51,w:48,h:48},ft_48_Photo:{x:1,y:101,w:48,h:48},ft_48_NonEmptyAlbum:{x:51,y:101,w:48,h:48},ft_48_EmptyAlbum:{x:101,y:101,w:48,h:48},ft_48_EmptyDocumentFolder:{x:151,y:1,w:48,h:48},ft_48_Audio:{x:151,y:51,w:48,h:48},ft_32_Blank:{x:151,y:101,w:32,h:32},ft_32_Audio:{x:1,y:151,w:32,h:32},ft_32_NonEmptyDocumentFolder:{x:35,y:151,w:32,h:32},ft_32_EmptyDocumentFolder:{x:69,y:151,w:32,h:32},ft_32_NonEmptyFavoriteFolder:{x:103,y:151,w:32,h:32},ft_32_Zip:{x:151,y:135,w:32,h:32},ft_32_Photo:{x:1,y:185,w:32,h:32},ft_32_Video:{x:35,y:185,w:32,h:32},ft_32_Txt:{x:69,y:185,w:32,h:32},ft_32_NonEmptyAlbum:{x:103,y:185,w:32,h:32},ft_32_EmptyAlbum:{x:137,y:169,w:32,h:32},groups:{x:201,y:1,w:32,h:32},gridIconSelected:{x:201,y:35,w:26,h:26},listIconSelected:{x:201,y:63,w:26,h:26},infoPaneIconSelected:{x:185,y:101,w:26,h:26},infoPaneIcon:{x:185,y:129,w:26,h:26},listIcon:{x:171,y:169,w:26,h:26},gridIcon:{x:199,y:157,w:26,h:26},lightPanelOpen:{x:213,y:91,w:20,h:25},darkPanelOpen:{x:213,y:118,w:20,h:25},panelClose:{x:199,y:185,w:20,h:25},ft_16_Video:{x:171,y:197,w:16,h:16},error:{x:1,y:219,w:16,h:16},ft_16_Audio:{x:19,y:219,w:16,h:16},ft_16_Blank:{x:37,y:219,w:16,h:16},ft_16_Zip:{x:55,y:219,w:16,h:16},ft_16_Txt:{x:73,y:219,w:16,h:16},ft_16_Photo:{x:91,y:219,w:16,h:16},redX:{x:109,y:219,w:16,h:16},ppSearch:{x:137,y:203,w:13,h:13},ppRedX:{x:127,y:219,w:13,h:13},ppGreyX:{x:152,y:203,w:13,h:13},close:{x:137,y:151,w:10,h:10}};if(!window.Silverlight)window.Silverlight={};Silverlight.isInstalled=function(b){if(b==undefined)b=null;var a=false,l=null;try{var i=null,j=false;if(window.ActiveXObject)try{i=new ActiveXObject("AgControl.AgControl");if(b===null)a=true;else if(i.IsVersionSupported(b))a=true;i=null}catch(m){j=true}else j=true;if(j){var k=navigator.plugins["Silverlight Plug-In"];if(k)if(b===null)a=true;else{var h=k.description;if(h==="1.0.30226.2")h="2.0.30226.2";var g=h.split(".");while(g.length>4)g.pop();var d=b.split(".");while(d.length>4)d.pop();var c,f,e=0;do{c=parseInt(d[e]);f=parseInt(g[e]);e++}while(e<d.length&&c===f);if(c<=f&&!isNaN(c))a=true}}}catch(m){a=false}return a};Silverlight.supportedUserAgent=function(g,f){try{var b=null;if(f)b=f;else b=window.navigator.userAgent;var a={OS:"Unsupported",Browser:"Unsupported"};if(b.indexOf("Windows NT")>=0||b.indexOf("Mozilla/4.0 (compatible; MSIE 6.0)")>=0)a.OS="Windows";else if(b.indexOf("PPC Mac OS X")>=0)a.OS="MacPPC";else if(b.indexOf("Intel Mac OS X")>=0)a.OS="MacIntel";else if(b.indexOf("Linux")>=0)a.OS="Linux";if(a.OS!="Unsupported")if(b.indexOf("MSIE")>=0){if(navigator.userAgent.indexOf("Win64")==-1)if(parseInt(b.split("MSIE")[1])>=6)a.Browser="MSIE"}else if(b.indexOf("Firefox")>=0){var e=b.split("Firefox/")[1].split("."),h=parseInt(e[0]);if(h>=2)a.Browser="Firefox";else{var i=parseInt(e[1]);if(h==1&&i>=5)a.Browser="Firefox"}}else if(b.indexOf("Chrome")>=0)a.Browser="Chrome";else if(b.indexOf("Safari")>=0)a.Browser="Safari";var d=parseInt(g),c=!(a.OS=="Unsupported"||a.Browser=="Unsupported"||a.OS=="Windows"&&a.Browser=="Safari"||a.OS.indexOf("Mac")>=0&&a.Browser=="MSIE"||a.OS.indexOf("Mac")>=0&&a.Browser=="Chrome");if(a.OS.indexOf("Windows")>=0&&a.Browser=="Chrome"&&d<4)return false;if(a.OS=="MacPPC"&&d>1)return c&&a.OS!="MacPPC";if(a.OS=="Linux"&&d>2)return c&&a.OS!="Linux";if(g=="1.0")return c&&b.indexOf("Windows NT 5.0")<0;else return c}catch(j){return false}};(function(){window.getSilverlightVersion=function(){var b=f;b=Silverlight.isInstalled("1.0")?"1.0":b;b=Silverlight.isInstalled("2.0")?"2.0":b;b=Silverlight.isInstalled("3.0")?"3.0":b;b=Silverlight.isInstalled(a)?a:b;return b};function e(){function j(e,d,b,a,c){document.cookie=e+"="+escape(d)+(b?";path="+b:"")+(a?";domain="+a:"")+(c?";secure":"")}function i(e){var d=e+"=",c=document.cookie.split(";");for(var b=0;b<c.length;b++){var a=c[b];while(a.charAt(0)==" ")a=a.substring(1,a.length);if(a.indexOf(d)==0)return a.substring(d.length,a.length)}return null}function g(a){return a===undefined||a===null||a.length===0}var f=i(b),l=i(c),e=getSilverlightVersion(),h=Silverlight.supportedUserAgent(),d=location.hostname.split("."),k=d[d.length-2]+"."+d[d.length-1];j(b,e,"/",k);j(c,h,"/",k);if(!window.skipSLReload&&(g(f)&&e!=a)||g(l)&&!h||!g(f)&&f!=e)location.reload(true)}var b="SLVersion",c="SLSupportedAgent",f="0.0",a="4.0.50401";e();var d="4.0";if(window["wLive"]){wLive.Core.SilverlightSupported=Silverlight.supportedUserAgent(d);wLive.Core.SilverlightInstalled=Silverlight.isInstalled(d)&&wLive.Core.SilverlightSupported}})();(function(){var a={},b=$Config&&$Config.hcid?"."+$Config.hcid:"";wLive.Core.BrowserStorage={setSessionValue:function(c,b){try{if(window.sessionStorage)sessionStorage[c]=Object.toJSON(b);else a[c]=Object.toJSON(b)}catch(d){}},getSessionValue:function(b){try{if(window.sessionStorage)return Object.fromJSON(sessionStorage[b]);else return Object.fromJSON(a[b])}catch(c){}return undefined},setLocalValue:function(c,a){try{if(window.localStorage)localStorage[c+b]=Object.toJSON(a)}catch(d){}},getLocalValue:function(a){try{if(window.localStorage)return Object.fromJSON(localStorage[a+b])}catch(c){}return undefined}}})();(function(){var a="live.shared.skydrive.",b="live.shared.marketinfo.";wLive.Core.AleHelpers={getString:function(b){return GetString(a+"shared."+b)},getPCString:function(b){return GetString(a+"pc."+b)},getMobileString:function(b){return GetString(a+"mobile."+b)},getMarketInfoValue:function(a){return GetString(b+a)}}})();(function(){wLive.Core.StringHelpers={caseInsensitiveStringEquals:function(a,b){if(a==b)return true;if(a==null||b==null)return false;return a.toLowerCase()==b.toLowerCase()}}})();(function(){wLive.Core.BiciHelpers={reportClickAction:function(g,f,b){if(!b){var e=wLive.Core.PageController,d=e&&e.getInstance(),a=d&&d.getViewContext();if(a){b=a&&a.biciPageId;var c=a&&a.biciSetViewContentType;if(c)b+=c}}$BSI.reportEvent("ClickedSelected.Command.SkyDrive",{SkyCmnd:g,ClickLoc:f,TypeOfPage:b})},prependBiciReportClickAction:function(a,c,b){return function(){wLive.Core.BiciHelpers.reportClickAction(c,b);return a&&a.apply(this,arguments)}}}})();(function(){var n=wLive.Core,l=3,h=5,g=20,d=100,i=0,f="root",k=2,a=0,b=1,c=2,e=3,j=4;n.PriorityQueue=m;function m(G,F,L){var n=this,u=G||h,E=F||{},B=L||l,s=0,o=0,p=[];for(var D=0;D<=B;D++)p.push(0);var v=0,M=0,m={},q=[],r=[],O={},A={},y=false,x=false;n.enqueue=function(j,i,c,e,d){var g=false;if(!y){d=d||f;e=e||String(M++);c=c!==undefined?c:k;var h=m[d]=m[d]||{},a=h[e];if(!a||a.state==b&&(a.next||a.pri!=c)){if(a){C(a);a.pri=c}else{g=true;a=h[e]=I(j,i,c,e,d)}N(a);t()}}return g};n.abortAll=function(){y=true;for(queueId in m)n.abort(queueId);y=false};n.abort=function(b){b=b||f;var d=m[b];if(d){for(taskId in d){var a=d[taskId];if(a.state==c){z(a);a.abort&&a.abort()}else if(a.state==e){a.timeoutId&&clearTimeout(a.timeoutId);w(a)}else C(a)}m[b]={}}};n.getActiveTaskCount=function(){return o};n.getActiveTasks=function(){return A};function I(c,b,d,f,e){var g={id:f,queueId:e,exec:c,abort:b,pri:d,timeoutId:0,next:null,prev:null,state:a};return g}function C(c){if(c&&c.state==b){c.prev&&(c.prev.next=c.next);c.next&&(c.next.prev=c.prev);var d=c.pri;q[d]==c&&(q[d]=c.next);r[d]==c&&(r[d]=c.prev);c.state=a;c.prev=c.next=null;s--}return c}function N(c){if(c&&c.state==a){var e=c.pri,d=r[e];if(d){d.next=c;c.prev=d}else q[e]=c;r[e]=c;c.state=b;s++}}function t(){if(!x&&!v&&s&&o<u)v=window.setTimeout(J,i)}function H(e,b){var a=true;if(b>0){var c=Math.max(g,d-d*(b/B));a=(new Date).getTime()-e<c}return a}function J(){var c=(new Date).getTime(),b=0;v=0;x=true;while(s>0&&b<=B&&o<u){var a=q[b];if(a&&p[a.pri]<(E[a.pri]||u))a=K(C(a));else a=null;if(!a)b++;else if(!H(c,b))break}x=false;t()}function K(a){if(a){o++;A[a.id]=a;a.startTime=(new Date).getTime();p[a.pri]++;a.state=c;var b=a.exec(function(b){z(a,b)});if(!b)z(a)}return a}function z(a,b){if(a.state===c){o--;delete A[a.id];p[a.pri]--;if(!b||typeof b!=="number")w(a);else{a.state=e;a.timeoutId=window.setTimeout(function(){w(a)},b)}}}function w(a){var b=m[a.queueId];a.state=j;delete b[a.id];t()}}})();(function(){var c=wLive.Core,e=9,d=5,b=c.RequestPriorityEnum={FetchData:0,FetchImages:1,DefaultGet:2,DefaultPost:3,MoveOperation:4,CopyOperation:5,DeleteOperation:6,UploadOperation:7,RemoteUploadOperation:8,UpdateStatusOperation:9},a={};a[b.CopyOperation]=1;a[b.DeleteOperation]=1;a[b.MoveOperation]=1;a[b.UploadOperation]=3;a[b.RemoteUploadOperation]=1;window.requests=new c.PriorityQueue(d,a,e);window.domUpdates=new c.PriorityQueue})();(function(){var a={},b={};wLive.throttle=function(c,g,d,e){if(e&&a[c]){b[c]=d;return}else if(a[c])clearTimeout(a[c]);function f(){a[c]=setTimeout(function(){d();delete a[c];if(e&&b[c]){d=b[c];delete b[c];f()}},g)}f()}})();(function(){var a=wLive.Core,e=a.AleHelpers.getString,k="fetch",l="write",j=3e4,d=8e3,c=8002,i=1,f=a.RequestPriorityEnum.DefaultPost,h=a.RequestPriorityEnum.DefaultGet,b="DataRequest",g=0,o=0;a.DataRequest=m;var n=a.DataRequest.Errors=[];function m(x,q,s,A,z,v,F,D){var m=this,t,p,w=D!==undefined?D:i;v=v||j;var C,r=E(q);x=x||"key"+o++;m.priority=F||(s?f:h);m.queueId=s?l:k;m.originId=null;m.jsonpParameterName=undefined;m.successReentranceDelay=0;m.failureReentranceDelay=0;if(s)s=s.replace(/\?/g,"\\u003F");m.start=function(){return window.requests.enqueue(function(j){p=j;C=(new Date).getTime();var f=null,h=q,c;if(!r){f={canary:FilesConfig.canary,Accept:"application/json",AppId:FilesConfig.appId};if(m.originId)f["X-SkyApiOriginId"]=m.originId;if(FilesConfig.oauthToken)f["X-Auth"]=FilesConfig.oauthToken}else{h+=q.indexOf("?")===-1?"?":"&";h+="canary="+FilesConfig.canary.encodeUrl();c="dataRequestCallback_"+g++;var e=false,i=setTimeout(function(){if(!e){e=true;u(B(t,"timeout",d))}},v);a.DataRequest[c]=function(b){if(!e){clearTimeout(i);e=true;u(b)}delete a.DataRequest[c]}}t=jQuery.ajax({url:h,dataType:r?"jsonp":"json",jsonp:m.jsonpParameterName,jsonpCallback:c?"wLive.Core.DataRequest."+c:undefined,data:s,processData:false,type:s?"POST":"GET",headers:f,timeout:v,success:r?undefined:function(a){u(a)},error:r?undefined:function(c,b,a){u(B(c,b,a))}});Trace.log("Request: "+q,b);return true},function(){if(!r)m.abort()},m.priority,x,m.queueId)};m.abort=function(){if(t&&!r){Trace.log("Abort: "+q,b);t.abort();t=null}if(p){p();p=null}};function E(b){var a=false;if(b.indexOf("/")!=0)a=y(b)!=y(window.location.host);return a}function y(a){var b=a.indexOf("://");b!==-1&&(a=a.substr(b+3));b=a.indexOf("?");b!==-1&&(a=a.substr(0,b));b=a.indexOf("/");b!==-1&&(a=a.substr(0,b));return a.toLowerCase()}function B(b,f){var a={};if(b.status==500)try{a=Object.fromJSON(b.responseText)||{}}catch(k){}if(!a.error&&!a.items){var h=true,g=d,i=e("LoadGenericError");a.pageStats={url:q,error:f,tasks:[],executionTimeMs:0,schedulerTimeMs:0};switch(f){case "timeout":g=8001;i=e("LoadTimeoutError");break;case "abort":g=c;h=false;a.pageStats.info=f;a.pageStats.error=null}a.error={isRetriable:h,code:g,message:i,debugMessage:"(xhr status "+b.status+") xhr.responseText: "+b.responseText,stackTrace:""}}return a}function u(a){a=a||{};wLive.PageStats.add(a.pageStats,C);if(a.error){var d=a.error.stackTrace;d=d&&d.encodeJson?d.encodeJson():"";var e='{"code": "'+a.error.code+'", '+'"message": "'+a.error.message+'", '+'"debug": "'+a.error.debugMessage+'", '+'"stacktrace": "'+d+'", '+'"retriesLeft": "'+w+'", '+'"requestUrl": "'+q+'"}';n.push(e)}if(a.error&&a.error.isRetriable&&w>0){Trace.log("Retrying request: "+q,b);p&&p();w--;m.start()}else if(a.error){Trace.log("Failed response: "+q,b);p&&p(m.failureReentranceDelay);a.error.code!=c&&z&&z(a)}else{Trace.log("Response: "+q,b);p&&p(m.successReentranceDelay);r&&m.originId&&(a.originId=m.originId);A&&A(a)}}}})();(function(){var a=wLive.Core;a.Events={addListener:function(a,d,c){var b=this._skyEv=this._skyEv||{};b[a]=b[a]||{recursionCount:0,isSweepNeeded:false,listeners:[]};b[a].listeners.push({fn:d,obj:c});return this},removeListener:function(e,g,f){var a,d,c,b;if(this._skyEv){b=this._skyEv[e];if(b){a=b.listeners;for(c=a.length;c--;){d=a[c];if(Boolean(d)&&d.fn===g&&d.obj===f){if(b.recursionCount!==0){a[c]=null;b.isSweepNeeded=true}else a.splice(c,1);return this}}}}return this},disposeEvents:function(){if(this._skyEv)this._skyEv=null},raiseEvent:function(f,h){if(window["raiseEvent"])raiseEvent(this,f,h,false);var c,d,a,g,b,e=this._skyEv;if(e){b=e[f];if(b){c=b.listeners;++b.recursionCount;for(a=0,g=c.length;a<g;++a){d=c[a];if(d)try{d.fn.call(d.obj,h)}catch(i){}}if(--b.recursionCount===0&&b.isSweepNeeded){for(a=c.length;a--;)if(!c[a])c.splice(a,1);b.isSweepNeeded=false}}}return this}}})();(function(){var b=wLive.Core;b.ItemSet=e;function e(){this._filters=[d];this.clear()}var a=b.ItemSet.prototype;a.clear=function(){var a=this;a._filteredCount=0;a._filteredIndexToActualIndex={};a._keyToFilteredIndex={};a._childCount=0;a._materializedCount=0;if(a._indexToItem)for(var c in a._indexToItem){var b=a._indexToItem[c];if(b&&b.removeListener){b.removeListener("change",a._invalidateHandler,a);b.removeListener("removeItem",a._removeItemHandler,a)}}a._indexToItem={};a._keyToIndex={};a._requiresFilter=false};a.get=function(a,b){var c=this;c._updateFilteredSet(b);!b&&(a=c._filteredIndexToActualIndex[a]);return this._indexToItem[a]};a.getByKey=function(c,b){var a=this;a._updateFilteredSet(b);var d=b?a._keyToIndex[c]:a._filteredIndexToActualIndex[a._keyToFilteredIndex[c]];return this._indexToItem[d]};a.set=function(d,b){var a=this,e=false,c=a._indexToItem[d];if(c!=b){if(c&&c.removeListener){c.removeListener("change",a._invalidateHandler,a);c.removeListener("removeItem",a._removeItemHandler,a)}e=true;a._indexToItem[d]=b;if(b){b.key&&(a._keyToIndex[b.key]=d);a._childCount=Math.max(a._childCount,d+1);if(b.addListener){b.addListener("change",a._invalidateHandler,a);b.addListener("removeItem",a._removeItemHandler,a)}}if(!c&&b)a._materializedCount++;else if(c&&!b)a._materializedCount--;a._requiresFilter=true}return e};a.insert=function(b,c,a){this.insertWithGroupHint(b,c,true,a)};a.insertWithGroupHint=function(a,k,i,g){var b=this;b._updateFilteredSet(g);!g&&(a=a<b._filteredCount?b._filteredIndexToActualIndex[a]:b._childCount);a=Math.max(0,Math.min(a,b._childCount));var d=b._indexToItem[a];b._indexToItem[a]=null;if(b.groupings){var h=b.groupings;for(var f=0;f<h.length;f++){var c=h[f],e=c.startIndex+c.count-1;if(i){if(e>=a){c.startIndex>a&&c.startIndex++;if(c.startIndex<=a)c.count++}else if(a==b._childCount&&e+1==b._childCount)c.count++}else if(e+1>=a){if(c.startIndex==a&&c.startIndex!=0||c.startIndex>a)c.startIndex++;if(c.startIndex<=a)c.count++}}}b.set(a,k);while(d){var j=b._indexToItem[++a];b._indexToItem[a]=d;b._keyToIndex[d.key]=a;d=j;a==b._childCount&&b._childCount++}b._requiresFilter=true};a.add=function(b){var a=this;a.insert(a._childCount,b,true)};a.indexOf=function(d,c){var b=this,a;b._updateFilteredSet(c);a=c?b._keyToIndex[d.key]:b._keyToFilteredIndex[d.key];if(a===undefined)a=-1;return a};a.removeAt=function(b,g){var a=this;a._updateFilteredSet(g);!g&&(b=a._filteredIndexToActualIndex[b]);var c=a._indexToItem[b];if(c){if(c.removeListener){c.removeListener("change",a._invalidateHandler,a);c.removeListener("removeItem",a._removeItemHandler,a)}delete a._keyToIndex[c.key]}if(a.groupings){var f=a.groupings;for(var e=0;e<f.length;e++){var d=f[e],h=d.startIndex+d.count-1;if(h>=b)if(d.startIndex<=b){d.count--;if(d.count==0){f.splice(e,1);e--}}else d.startIndex--}}var i=a._childCount-1;while(b<i){c=a._indexToItem[b+1];if(c){a._keyToIndex[c.key]=b;a._indexToItem[b]=c}b++}delete a._indexToItem[a._childCount-1];a._childCount--;a._requiresFilter=true};a.remove=function(c){var b=this,a=b.indexOf(c,true);if(a!=-1)b.removeAt(a,true)};a.invalidate=function(){var a=this;a._requiresFilter=true;a.raiseEvent("change")};a.getCount=function(b){var a=this;a._updateFilteredSet(b);return b?a._childCount:a._filteredCount};a.getGroupings=function(d){var c=this,b=c.groupings,a;if(!b){var g=c.getCount(d);a=[{groupingId:"other",startIndex:0,endIndex:g-1,count:g}]}else{c._updateFilteredSet(d);if(d){for(var f=0;f<b.length;f++){var e=b[f];e.endIndex=e.startIndex+e.count-1}a=b}else a=c._filteredGroups}return a};a.setCount=function(b){var a=this;if(a._childCount!=b){a.clear();a._childCount=a._filteredCount=b;a._requiresFilter=true}};a.setFilters=function(b){var a=this;a._filters=b||[];a._requiresFilter=true};a._updateFilteredSet=function(j){var a=this;if(a._requiresFilter&&!j){a._filteredGroups=[];a._filteredIndexToActualIndex={};a._keyToFilteredIndex={};var d=0,k=a._childCount,e=0,h=a._filters,b,i=0,c;if(a.groupings&&a.groupings.length){b=a.groupings[0];b.endIndex=b.startIndex+b.count-1;c={groupingId:b.groupingId,name:b.name,startIndex:0,endIndex:0,count:0}}for(a._filteredCount=0;d<k;d++){var f=a._indexToItem[d],g=true;for(e=0;g&&e<h.length;e++)g=h[e](f);if(g){a._filteredIndexToActualIndex[a._filteredCount]=d;f&&f.key&&(a._keyToFilteredIndex[f.key]=a._filteredCount);b&&c.count++;a._filteredCount++}if(b&&d==b.endIndex){if(c.count>0){c.endIndex=c.startIndex+c.count-1;a._filteredGroups.push(c)}b=a.groupings[++i];b&&(b.endIndex=b.startIndex+b.count-1);var l=a._filteredCount;c={groupingId:b?b.groupingId:"other",name:b?b.name:null,startIndex:l,count:0}}}a._requiresFilter=false}};a._invalidateHandler=function(){this.invalidate()};a._removeItemHandler=function(a){this.remove(a)};a.__isObservable=true;a.groupings=null;var c=b.Events;a.addListener=b.Events.addListener;a.removeListener=c.removeListener;a.disposeEvents=c.disposeEvents;a.raiseEvent=c.raiseEvent;function d(a){return !a||a.isVisible===undefined||a.isVisible}})();wLive.Core.JSONConstants={SortField:{Default:"0",Name:"1",ModifiedDate:"2",CreatedDate:"3",Size:"4",Type:"5",DateTaken:"6",Owner:"7",UserArranged:"8",LastOpened:"9",Relevancy:"10"},SortDirection:{Default:"0",Ascending:"1",Descending:"2"},FilterType:{Albums:"1",Folder:"2",Favorites:"4",AllFolders:"7",PhotosAndVideos:"8",Documents:"16"}};(function(){var b=wLive.Core;b.SkyDriveItemSet=f;var d=[],e="SkyDriveItemSet";function f(g,f,c){var a=this;b.ItemSet.apply(this);a.modifiedDate=-1;a.groupings=null;a._dataModel=g;a._parentItemKey=f;a._setKey=c;a.setKeyParts=b.SkyDriveItem.getSetKeyParts(c);a._headerItemsSet=null;a._filters.push(e);a._type="SkyDriveItemSet";function e(b){var c=a._headerItemsSet&&b&&a._headerItemsSet.indexOf(b)!==-1;if(c)d.push({"set":a,headerSet:a._headerItemsSet,item:b});return !c}}var a=f.prototype=new b.ItemSet,c=b.ItemSet.prototype;a.setHeaderItemsSet=function(b){var a=this;if(a._headerItemsSet)a._headerItemsSet.removeListener("change",a._invalidateHandler,a);a._headerItemsSet=b;b.addListener("change",a._invalidateHandler,a)};a.isOutOfDate=function(){var b=this,a=b.getParent(true),c=a&&(a.hasExpired()||a.modifiedDate!=b.modifiedDate);return c};a.get=function(b,p,i){var d=this,a=null,j=false,h=false,o=d._dataModel,m=d._parentItemKey,k=d._setKey,f=d._headerItemsSet,n=d.getCount(i),q=d._filteredIndexToActualIndex,g=d.isOutOfDate();if(f&&f.getCount()>0)if(f.getCount()>b){a=f.get(b);j=true}else b-=f.getCount();if(!j){a=c.get.call(d,b,i);h=!a&&b>=0&&b<n}if(a)if(a.hasExpired()){g=true;var l=a.getParent(true);if(l)l.expire(false)}if(!p&&(h||g))if(o.fetchItem(m,k,null,b))Trace.log("get miss - index: "+b+", exists: "+!!a+", setExpired: "+g+", setKey: "+k,e);a&&(a.parentKey=m);return a};a.getCount=function(e){var d=this,a=d._headerItemsSet,b=c.getCount.call(d,e);if(a)b+=a.getCount();return b};a.setCount=function(g){var a=this,d=a.getParent(true);if(d&&(d.hasMoreResults===true||d.hasMoreResults===false)){var b=d.folder.totalCount,e=a._childCount;if(d.hasMoreResults&&b<e)b=e;a._childCount=a._filteredCount=b;a._requiresFilter=true;if(b<e)for(var f=e-1;f>=b;f--){if(a._indexToItem[f])a._materializedCount--;delete a._indexToItem[f]}}else c.setCount.call(a,g)};a.getGroupings=function(h){var j=this,i=j._headerItemsSet,a,b=c.getGroupings.call(j,h);if(i){var d=i.getCount(h);if(d){var e=[];if(b.length==0||b[0].groupingId!="folder"){e.push({groupingId:"folder",startIndex:0,endIndex:d-1,count:d});for(var f=0;f<b.length;f++){a=b[f];e.push({groupingId:a.groupingId,startIndex:a.startIndex+d,endIndex:a.endIndex+d,count:a.count})}}else for(var g=0;g<b.length;g++){a=b[g];e.push({groupingId:a.groupingId,name:a.name,startIndex:a.startIndex?a.startIndex+d:0,endIndex:a.endIndex+d,count:a.groupingId=="folder"?a.count+d:a.count})}b=e}}return b};a.getParent=function(c){var b=this,a=b._dataModel;return a?a.getItem(b._parentItemKey,c):null};a.indexOf=function(f,g,k){var b=this,d=b._headerItemsSet,j=b._dataModel,l=b._parentItemKey,h=b._setKey,i=b.isOutOfDate(),a=-1;if(d)a=d.indexOf(f,g);if(a==-1){a=c.indexOf.call(b,f,g);if(!k&&(a===-1||i))if(j.fetchItem(l,h,f.id,0))Trace.log("indexOf miss - id: "+f.id+", setExpired: "+i+", setKey: "+h,e);if(d)if(a!==-1)a+=d.getCount(g)}return a};a.remove=function(c){var b=this,a=b.indexOf(c,true,true);if(a!=-1)b.removeAt(a,true)};a.clone=function(){var d=this,e=new b.SkyDriveItemSet(d._dataModel,d._parentItemKey,d._setKey),j=c.get;e.groupings=this.groupings;for(var a=0;a<d.getCount();a++){var i=j.call(d,a);if(i)e.set(a,i)}e.modifiedDate=d.modifiedDate;var g=d._headerItemsSet,f=new b.ItemSet;for(a=0;a<g.getCount();a++){var h=g.get(a,true);if(h)f.set(a,h)}e.setHeaderItemsSet(f);return e};a.isComplete=function(){var a=this;return a._materializedCount===a._childCount};a.sort=function(){var d=this,c=b.SkyDriveItem.getSetKeyParts(d._setKey),f=[];for(var a=0;a<d.getCount();a++){var g=d.get(a,true);f.push(g)}var e=f.sort(function(a,d){var f=c.sr;if(c.sd)f=c.sd==b.JSONConstants.SortDirection.Default;var i=f?e(a,c.sb):e(d,c.sb),h=f?e(d,c.sb):e(a,c.sb),g=i-h;if(a.folder&&!d.folder)return -1;else if(!a.folder&&d.folder)return 1;else if((a.video||a.photo)&&!d.photo&&!d.video)return 1;else if((d.video||d.photo)&&!a.photo&&!a.video)return -1;return g;function e(c,d){var a=b.JSONConstants.SortField;switch(d){case a.ModifiedDate:return c.dateModifiedOnClient||0;case a.CreatedDate:return c.creationDate||0;case a.Size:return c.size||0}}});for(a=0;a<e.length;a++)d.set(a,e[a])};b.SkyDriveItemSet.removeMarkedHeaderItems=function(){while(d.length>0){var a=d.pop(),e=a.set,b=a.headerSet,c=a.item;b.remove(c);e._requiresFilter=true}}})();(function(){var a=wLive.Core,A=a.AleHelpers.getPCString,i=a.AleHelpers.getString,n=a.BrowserStorage,x="root",l="default",q="NonEmptyDocumentFolder",v=wLive.Core.AleHelpers.getPCString("SkyDriveProductName"),z=0,r="SkyDriveItem",k="SkyDrive.AbdicatedItems",w=0,p="rd,1",o=2*60*1e3,j={},f={},e=null,c=null;d.DocumentFormat={Default:0,ODF:1};d.ExtendedProperty={Default:0,MoSkyDocProperties:1,QuotaInfo:2};a.SkyDriveItem=d;function d(f,e,c){e==c&&(c=null);var b=this;b.key=e;b.instance=z++;b.keyParts=a.SkyDriveItem.getItemKeyParts(e);b.parentKey=c;b.id=b.keyParts["id"];b.did=b.keyParts["did"];b.commands=null;b.modifiedDate=-1;b.name=null;b.extension=null;b.ownerName=null;b.ownerCid=null;b.iconType=null;b.isUnknownFileType=false;b.folder=null;b.sharingLevel=null;b.group=null;b.partialData=null;b.hasMoreResults=null;b.estimatedResultCount=null;b.directlyShared=null;b.snippet=null;b.highlights=null;b.tokenNeedsRedeeming=false;b._isLoadingItem=false;b._missingName=false;b._expirationDate=0;b._dataModel=f;b._isNewFolder=false;b._childSets=null;b._headerItemsSet=null;b._dataContext=null;b._version=0;b.documentFormat=d.DocumentFormat.Default}var b=a.SkyDriveItem.prototype;b.processItem=function(c){var b=this,h=false;this._isNewFolder=false;if(c.modifiedDate===undefined||c.modifiedDate>=b.modifiedDate){s(c);if(this.parentKey){var e=a.SkyDriveItem.getItemKeyParts(this.parentKey);if(!e.qt&&!e.did)this.parentKey=a.SkyDriveItem.getItemKey(c.parentId,e.cid,e.group,e.qt,e.did,e.q)}var i=this.folder?this.folder.totalCount:-1,j=c.folder?c.folder.totalCount:-1;if(c.modifiedDate!=b.modifiedDate||j!=i||c.sharingLevel!=b.sharingLevel){b._version++;h=true}var f=null;if(c.folder){f=c.folder.children;delete c.folder.children}g(b,c,1);f&&(c.folder.children=f);if(c.folder){!b._childSets&&(b._childSets={});!b._headerItemsSet&&(b._headerItemsSet=new a.ItemSet)}!c.name&&(b._missingName=true);var k=b.isViewerOwner();!b.ownerName&&(b.ownerName=k?FilesConfig.userDisplayName:"");!b.ownerCid&&(b.ownerCid=b.keyParts["cid"]);!b.iconType&&(b.iconType=c.folder?q:l);b.isUnknownFileType=a.StringHelpers.caseInsensitiveStringEquals(b.iconType,l);if(!!c.docFormat&&c.docFormat==1)b.documentFormat=d.DocumentFormat.ODF}b._commands=null;if(!!b.did)b.commands=p+(b.commands?","+b.commands:"");b._expirationDate=(new Date).getTime()+o;return h};b.updateItemProperties=function(d,c,b){var a=this;a._dataModel.updateItemProperties(a,d,c,b)};b.updateItemProperty=function(d,e,c,b,f){var a=this;if(this._isNewFolder&&d=="name"){a.name=(e||"").trim();a.invalidate();a._dataModel.createSubfolder(a.getParent(),a,c,b)}else a._dataModel.updateItemProperty(a,d,e,c,b,f)};b.getExtendedInfo=function(f,e,c){var b;switch(c){case d.ExtendedProperty.MoSkyDocProperties:b="&with=davUrl,mimetype";break;case d.ExtendedProperty.QuotaInfo:b=""}this._dataModel.fetchItem(this.key,a.SkyDriveItem.getSetKey(),null,0,true,this.modifiedDate,f,e,0,b)};b.hasExpired=function(){return this._expirationDate<(new Date).getTime()};b.getVersion=function(){return this._version};b.getDisplayName=function(c){var a=this,b=a.name;if(c&&!a.parentKey)if(a.did){var e=c.deviceItemSet.getByKey(a.did.toLowerCase());b=e?e.name:""}else if(a.isQt("search"))b=i("SearchResults").format(a.getSearchQuery());else if(a.isQt("recyclebin"))b=i("RecycleBin");else b=a.ownerName?i("UsersSkyDrive").format(a.ownerName):v;else{var d=a.extension;if(a.isUnknownFileType&&d)b+=d}return b};b.isViewerOwner=function(){var a=this;return !a.ownerCid||a.ownerCid.toLowerCase()==FilesConfig.hcid.toLowerCase()};b.isLoading=function(){return this._isLoadingItem};b.isQt=function(b){return a.StringHelpers.caseInsensitiveStringEquals(this.keyParts["qt"],b)};b.getSearchQuery=function(){return this.keyParts["q"]||""};b.extendPartialData=function(e){var b=this;if(b.partialData){var c=a.SkyDriveItem.getItemKeyParts(b.key),f=a.SkyDriveItem.getItemKey(c.id,c.cid,parseInt(c.group),undefined,c.did,undefined),d=b._dataModel.getItem(f,true);if(d&&!d.hasExpired()){m(b,d);e(b)}else b._dataModel.fetchItem(f,a.SkyDriveItem.getSetKey("0"),null,0,false,b.modifiedDate,function(a){m(b,a);e(b)})}};function m(a,e){var d=a.parentKey,h=a.key,f=a.snippet,c=a.highlights,b={};g(b,a.keyParts,1);g(a,e,1);delete a.partialData;a.parentKey=d;a.key=h;a.keyParts=b;a.snippet=f;a.highlights=c}b.getParent=function(b){var a=this;return a._dataModel.getItem(a.parentKey,b)};b.getChildren=function(c){var g=this,d=this._childSets,b=null;if(d){c=c||e;b=d[c];if(!b){for(var i in d)if(a.SkyDriveItem.getSetKeyParts(c).ft===a.SkyDriveItem.getSetKeyParts(i).ft){var f=d[i],j=a.SkyDriveItem.getSetKeyParts(c);if(a.ClientSortableFields[j.sb]&&j.sd!=a.JSONConstants.SortDirection.Default||f._childCount===1)if(f.isComplete()&&false){b=d[c]=f.clone();b._setKey=c;b.setKeyParts=$Utility.deserialize(c,"&",false,false);if(f._childCount>1)b.sort();break}}if(!b){b=d[c]=new a.SkyDriveItemSet(g._dataModel,g.key,c);var h=a.SkyDriveItem.getSetKeyParts(c);if(!h||!h.ft||h.ft!==a.JSONConstants.FilterType.PhotosAndVideos)b.setHeaderItemsSet(g._headerItemsSet);y(b,this.keyParts)}}if(b.modifiedDate===-1)b.setCount(t(g.folder,c))}return b};b.remove=function(){this.raiseEvent("removeItem",this)};b.setVisibility=function(b){var a=this;a.isVisible=b;a.raiseEvent("change")};b.getVisibility=function(){var a=this;return a.isVisible===undefined||a.isVisible};b.invalidate=function(c){var a=this;if(!c)a._version++;var b=a;a.raiseEvent("change");while(b){a._dataModel._fireDataChanged(b);b=b.getParent(true)}};b.expire=function(c){var a=this;a._expirationDate=-1;if(c){var b=a.getParent(true);b&&b.expire(true)}a._dataModel.abortPendingRequests(a.key)};b.getHasSubfolders=function(){var a=this.folder&&this.folder.hasSubfolders;return a||this._headerItemsSet&&this._headerItemsSet.getCount()>0};b.createPinnedSubfolder=function(){var b=this,c=null;if(b._headerItemsSet){var e="NewFolder"+w++;c=new d(this._dataModel,a.SkyDriveItem.getItemKey(e),this.key);c.processItem({folder:{totalCount:0,childCount:0},name:FilesConfig.defaultFolderString,commands:"rn,1",group:b.group,cid:b.ownerCid,ownerName:b.ownerName,sharingLevel:b.sharingLevel,_isNewFolder:true});Trace.log("Creating a pinned subfolder under: "+this.key,r);b._headerItemsSet.insert(0,c);b._headerItemsSet.invalidate()}return c};b.removePinnedSubfolder=function(b){var c=this,a=c._headerItemsSet;if(a){a.remove(b);a.invalidate()}};b.updatePinnedSubfolderKey=function(b){var c=this,d=false;if(c._headerItemsSet){var e=c._headerItemsSet.indexOf(b);if(e>=0){c._headerItemsSet.remove(b);b.key=a.SkyDriveItem.getItemKey(b.id,b.ownerCid,b.group,null,null);b.keyParts=a.SkyDriveItem.getItemKeyParts(b.key);b.clearItemSets();c._headerItemsSet.insert(e,b);c._headerItemsSet.invalidate();d=true}}if(!d){b.key=a.SkyDriveItem.getItemKey(b.id,b.ownerCid,b.group,null,null);b.keyParts=a.SkyDriveItem.getItemKeyParts(b.key);b.clearItemSets()}};b.clearItemSets=function(){var a=this;if(a._childSets!==null){for(var b in a._childSets)a._childSets[b].clear();a._childSets={}}};b.getDevice=function(){var c=this,b=null;if(c.keyParts.did){var d=a.PageController.getInstance().getViewContext().deviceItemSet;b=d.getByKey(c.keyParts.did.toLowerCase())}return b};b.getDeviceBaseUrl=function(){var c=this,a=null,b=c.getDevice();if(b)a=b.baseUrl;return a||FilesConfig.devicesBaseUrl};b.__isObservable=true;function g(c,d,e){for(var b in d){var a=d[b];if(a&&typeof a=="object"&&!Object.isArray(a)&&e>0){var f=c[b]=c[b]||{};g(f,a,e-1)}else c[b]=a}}function u(b){if(c&&b)for(var a=0;a<c.length;a++)if(b.id===c[a].id)return false;return true}function y(d,b){if(b.qt=="shared"){if(!c){c=n.getLocalValue(k);if(c){var f=new Date;for(var a=0;a<c.length;a++){var e=c[a];if(new Date(e.expire)<f){c.splice(a,1);a--}}n.setLocalValue(k,c)}}d._filters.push(u)}}function s(b){var a=b.folder;if(a){a.covers=a.covers||null;a.hasSubfolders=a.hasSubfolders?true:false}b.isProcessingVideo=b.isProcessingVideo||false}function t(b,g){var e=a.JSONConstants.FilterType,c=b.totalCount,f=a.SkyDriveItem.getSetKeyParts(g),d=f?f["ft"]:"";if(d==e.AllFolders)c=b.folderCount!==undefined?b.folderCount:b.hasSubfolders?1:0;else if(d==e.PhotosAndVideos&&b.photoCount!==undefined)c=b.photoCount;return c!==undefined?c:1}a.SkyDriveItem.getItemKey=function(h,f,g,e,c,d){var a={id:h||x,cid:(f||""+FilesConfig.hcid).toLowerCase(),group:Number(g)?"1":"0",qt:(e||"").toLowerCase(),did:c||"",q:d||""};if(!c)a.id=a.id.toLowerCase();var b="id="+a.id.encodeUrl()+"&cid="+a.cid.encodeUrl()+"&group="+a.group.encodeUrl()+"&qt="+a.qt.encodeUrl();if(c)b+="&did="+a.did.encodeUrl();if(d)b+="&q="+a.q.encodeUrl();j[b]=a;return b};a.SkyDriveItem.getItemKeyParts=function(d){var c=j[d];if(!c){var b=$Utility.deserialize(d,"&",false,false);a.SkyDriveItem.getItemKey(b.id,b.cid,parseInt(b.group),b.qt,b.did,b.q);c=j[d]}return c};a.SkyDriveItem.getSetKey=function(m,g,l,c,b){var i=f[e]||{},k=m||i.sb||"0",a=g!==null&&g!==undefined,h=a?g:i.sr,n=Number(h)?"1":"0",j=l||"";c=c||"0,1,2";b=b||"0";var d="ft="+j.encodeUrl()+"&sb="+k.encodeUrl()+(a?"&sr="+n:"")+(!a?"&sd="+b:"")+"&gb="+c.encodeUrl();f[d]={ft:j,sb:k,gb:c};if(a)f[d].sr=h;else f[d].sd=b;return d};a.SkyDriveItem.getSetKeyParts=function(a){a=a||e;return f[a]};a.SkyDriveItem.setDefaultSetKey=function(a){e=a};a.SkyDriveItem.getDefaultSetKey=function(){return e};a.SkyDriveItem.areItemsSame=function(a,b,d){if(a&&b){var c=!d||a.commands===b.commands&&a.name===b.name;return a.key===b.key&&a.modifiedDate===b.modifiedDate&&c}else return false};a.SkyDriveItem.IsFolderWithCovers=function(a){return a&&a.folder&&a.folder.covers};a.ClientSortableFields={2:true,3:true,4:true};a.QuotaStatus={Normal:0,Nearing:1,Exceeded:2};e=a.SkyDriveItem.getSetKey();var h=a.Events;b.addListener=a.Events.addListener;b.removeListener=h.removeListener;b.disposeEvents=h.disposeEvents;b.raiseEvent=h.raiseEvent})();(function(){var a=wLive.Core,f=a.AleHelpers.getPCString;a.DeviceItemSet=e;var b="DeviceItemSet",h="DeleteRemove.Device",d=FilesConfig.baseApiUrl+"GetDevices",g=true;function e(){var b=this;a.ItemSet.apply(this);b.isLoaded=false;$Do.when("getDevicesResponse",0,function(){b.parseResponse(window.getDevicesResponse)})}var c=e.prototype=new a.ItemSet,i=a.ItemSet.prototype;c.retryRequest=function(){var e=this;Trace.log("DeviceItemSet.js retryRequest()",b);var c=new a.DataRequest(d,d,null,function(a){Trace.log("DeviceItemSet.js retryRequest() successCallback - devices count"+a.devices&&a.devices.length,b);if(a.devices)e.parseResponse(a)});c.start()};c.parseResponse=function(c){var d=this;Trace.log("DeviceItemSet.js parseResponse()",b);if(c&&(c.devices&&c.devices.length<=0||c.error))if(g){g=false;d.retryRequest()}else{d.error=c.error;Trace.log("DeviceItemSet.js parseResponse() - error set",b)}else{Trace.log("DeviceItemSet.js parseResponse() - devices === "+!!(c&&c.devices),b);if(c&&c.devices){var f=c.devices;d.setCount(f.length);for(var e=0;e<f.length;e++){var h=f[e];h.key=h.did.toLowerCase();var i=new a.DeviceItem(h);i.addListener("change",function(){d.invalidate()});d.set(e,i)}d.isLoaded=true;d.invalidate()}}};c.remove=function(b){var j=this,d=FilesConfig.baseApiUrl+"RemoveDevice";$BSI.reportEvent(h,{});var c=a.PageController.getInstance().getViewContext();b.setVisibility(false);$BSI.navigateTo("#cid="+FilesConfig.hcid.encodeUrl());var e={did:b.did},g=new a.DataRequest(d,d,Object.toJSON(e),function(){i.remove.call(j,b);var a=jQuery("<span>"+f("RemoveDevice.SuccessNotification").format(b.name).encodeHtml()+"</span>");sutra(a,"$Sutra.SkyDrive.RemoveDeviceSuccess");c.errorManager.add({$element:a,priority:1,type:2})},function(){b.setVisibility(true);var a=jQuery("<span>"+f("RemoveDevice.ErrorNotification").format(b.name).encodeHtml()+"</span>");sutra(a,"$Sutra.SkyDrive.RemoveDeviceError");c.errorManager.add({$element:a,priority:0,type:0,code:"deviceRemove"})});g.start()}})();(function(){var b=wLive.Core;b.DeviceItem=d;function d(a){this.processItem(a)}var a=b.DeviceItem.prototype;a.processItem=function(b){var a=this;a.isVisible=true;jQuery.extend(a,b);a.id="root";a.folder={};a.commands="defc,1";a.baseUrl=null};a.setVisibility=function(a){this.isVisible=a;this.raiseEvent("change")};b.DeviceItem.hasNewBaseUrlError=function(d,e){var a=false;if((!d||d.isRetriable)&&e){var f=b.PageController.getInstance().getViewContext().deviceItemSet,c=f.getByKey(e.toLowerCase());if(c){c.baseUrl=null;a=true}}return a};a.isQt=function(){return false};var c=b.Events;a.addListener=b.Events.addListener;a.removeListener=c.removeListener;a.disposeEvents=c.disposeEvents;a.raiseEvent=c.raiseEvent})();(function(){var f=wLive.Core,b=f.AleHelpers.getPCString,c='<a href="{0}">{1}</a>',a="GroupInfo",g="",e="IPR",p=FilesConfig.groupMailUrl,h=FilesConfig.groupsDomain+"{0}/options",j=b(a+".ViewGroupOptions"),k=FilesConfig.groupMailSearchUrl,o=b(a+".ViewEmail"),n=b(a+".EmailTurnedOff"),m=b(a+".TurnOnEmailLinkText"),l=h+"/email",i=FilesConfig.groupsDomain+"{0}/membership/",r="TagListTemplate",d=f.BiciHelpers.prependBiciReportClickAction;f.GroupInfo=q;function q(s,y){var q=this,x=$Utility.deserialize(y,"&",false,false),v=s.groupAlias,A=s.displayName,r=s.email,f=s.membershipState,u=s.permissions,w=s.membership,z=x["cid"];q.emailHtml=function(){var a;if(r&&r!==g){var i=p.format(r.encodeUrl());a=c.format(i.encodeHtmlAttribute(),r.encodeHtmlAttribute());var b=jQuery(a);b.click(d(null,"EG",e));a=b}else if(f&&f>5){var h=l.format(t().encodeUrl());a=n+'<br /><a href="'+h.encodeHtmlAttribute()+'">'+m+"</a>"}return a};q.emailTitle=function(){return r};q.emailHistoryHtml=function(){var a;if(r&&r!==g){var f=k.format(r.encodeUrl());a=c.format(f.encodeHtmlAttribute(),o);var b=jQuery(a);b.click(d(null,"VGE",e));a=b}return a};q.membershipHtml=function(){var c;if(f&&f>3)c=b(a+".Membership"+f);return c};q.permissionsHtml=function(){var c;if(u!=null)c=b(a+".Permissions"+u);return c};q.groupOptionsLink=function(){var a;if(f&&f>4){var g=h.format(t().encodeUrl());a=c.format(g.encodeHtmlAttribute(),j);var b=jQuery(a);b.click(d(null,"VGO",e));a=b}return a};q.canInvite=function(){return f&&f>5};q.groupMembership=function(){return w};q.membershipPageLink=function(a){var b=i.format(t().encodeUrl());return c.format(b.encodeHtmlAttribute(),a)};function t(){var a;if(v)a=v;else a="cid-"+z;return a}}})();(function(){var a=wLive.Core,e=a.JSONConstants.SortField,c=a.JSONConstants.SortDirection,u="root",r="id",q="cid",v="sb",t="sr",j="lct=1",i="rset",h=$B.Mobile?"web_mobile":"web",d="DataModel",b=a.SkyDriveItem,p=3e4,o=1.5e5,l=2e3,m=3,s=3e4;a.DataModel=f;a.DataModel.dataChangedEvent="dataChanged";a.DataModel.groupInfoChangedEvent="groupInfoChanged";a.DataModel.errorEvent="error";function f(N,P,R,L,Q,M){var g=this;g.extraGetItemsParams="";var v=N||null,K=L||"",S=P||"",O=Q||"",u=M||100,T=R||"",w=[],J=1,E=[],s={},t=null;g.hasPendingRequests=function(a){return !!s[a]};g.abortPendingRequests=function(b){var a=s[b];if(a){for(var c in a)if(c!=="count"){var d=a[c];d.abort()}delete s[b]}};g.getItem=function(c,i,h,j){var a=null;if(c){a=w[c]||null;if(!i){var f=A(a),e=C(a,c);if(f||!e&&!a.id==="root")if(g.fetchItem(c,j||b.getDefaultSetKey(),null,0,false,a?null:h))Trace.log("getItem miss - exists: "+!!a+", expired: "+f+", hasAncestors: "+e+", key: "+c,d)}}return a};g.getChildCount=function(a,d){var b=0;if(a&&a.folder){var c=a.getChildren(d);b=c?c.getCount():1}return b};g.getChildByIndex=function(b,f,d,e){var a=b.getChildren(e),c=(a?a.get(f,d):null)||null;return c};g.getIndexOfChild=function(e,f,b){var d=-1,a=g.getItem(e,b),c=a?a.getChildren():null;if(c)d=c.indexOf(f,false,b);return d};g.processResponse=function(d,l,h){var i=false;h=h||b.getDefaultSetKey();var v=h;if(d&&d.items&&!d.error){var n=k(l,"did"),f=a.SkyDriveItem.getSetKeyParts(h);if(f.sb==e.Default||f.sd==c.Default)if(n){var t=f.sb==e.Default?e.Name:f.sb,j=f.sd;if(j==c.Default)j=t!=e.Name?c.Descending:c.Ascending;h=a.SkyDriveItem.getSetKey(t+"",null,f.ft,f.gb,j+"")}else h=a.SkyDriveItem.getSetKey(d.sortOrder+"",null,f.ft,f.gb,d.sortDirection+"");var u=d.items;F(d);var r=d.baseUrl;if(n&&r){var s=x(n);if(s)s.baseUrl=r}for(var o=0;o<u.length;o++)i=y(u[o],l,h,null,i,v)||i;var m=g.getItem(l,true);if(d.lastVersion!==undefined||m&&a.SkyDriveItemHelper.isSkyDriveRoot(m)&&a.SkyDriveItemHelper.isViewerOwner(m)){var q=FilesConfig.lastVersion||d.lastVersion,p=q?q.split(","):[];FilesConfig.lastVersion=p[0]||"0";FilesConfig.freRenderIndex===undefined&&(FilesConfig.freRenderIndex=Number(p[1]||"0"))}}return i};g._fireDataChanged=function(a){if(!t)g.raiseEvent(f.dataChangedEvent,a);else t.push(a)};g.suspendChangeEvents=function(){if(!t)t=[]};g.resumeChangeEvents=function(){if(t){var a=t;t=null;while(a.length)g._fireDataChanged(a.pop())}};g.createSubfolder=function(b,c,e,d){var g=v+"AddFolder?"+j,f={parentId:b.id,cid:b.ownerCid,group:b.group,name:c.name};if(a.SkyDriveItemHelper.isRootItem(b)&&a.PageController&&a.PageController.getInstance().getViewContext().viewParams.sc=="photos")f.category=1;var h=new a.DataRequest(g,g,Object.toJSON(f),function(a){var d=a?a.item:null;c.processItem(d);b.updatePinnedSubfolderKey(c);w[c.key]=c;b.expire();b.invalidate();e&&e(a,c)},function(a){d&&d(a,c)});h.start()};g.updateItem=function(e,i,k,d,c){var f=v+i+"?"+j,h=new a.DataRequest(f+Math.random(),f,k,function(c){var a=c&&c.item;if(a){var f=b.getItemKey(a.id,a.ownerCid,a.group);if(y(a,f))g.getItem(f).invalidate()}d&&d(c,e)},function(b){if(c){var a=g.getItem(e.key,true);c(b,a)}});h.start()};g.updateItemProperties=function(b,a,e,d){var c=b.parentId;a.id=b.id;if(c&&c!=="root")a.lid=b.parentId;a[i]=h;g.updateItem(b,"UpdateItem",Object.toJSON(a),e,d)};g.updateItemProperty=function(a,b,e,l,k,n){var o={},j="";if(n)j=', "overrideLock":"true"';var m=a[b],d=a[b]=e,f=a.extension;if(b==="name"&&f)d+=f;a.invalidate();var c=a.parentId;g.updateItem(a,"UpdateItem",'{"id":"'+a.id+'","'+b+'":"'+d.encodeJson()+(c&&c!=="root"?'","lid":"'+c.encodeJson():"")+'","'+i+'":"'+h+'"'+j+"}",l,function(c,a){k(c,a);if(a[b]===e){a[b]=m;a.invalidate()}})};g.getPlaceholderItem=function(c,h,e,f){var b=new a.SkyDriveItem(g,c,null),d=e?1:0;b.processItem({name:h,folder:{totalCount:d,childCount:d},id:k(c,r),ownerName:"",ownerCid:k(c,q).toUpperCase()});mix(b,f);return b};g.getLoadingItem=function(a){return g.getPlaceholderItem(a,"",true,{_isLoadingItem:true})};g.getGroupInformation=function(e,f,d){var b="cid="+e.toLowerCase().encodeUrl(),a=d.viewParams;if(a.authkey)b+="&authkey="+(a.authkey||"").encodeUrl();if(a.ticket)b+="&ticket="+(a.ticket||"").encodeUrl();var c=E[b];if(!c)G(b,f,J);return c};g.ensureCompletelyDownloaded=function(a,l,k,c,h){c=c||b.getDefaultSetKey();var i=a.key,e=0,f=a.modifiedDate;j();function n(a){Trace.log("EnsureCompletelyDownloaded fetch error: itemKey - "+i+" setKey - "+c,d);k(a)}function j(){var b=true,p=0;if(f!=a.modifiedDate){Trace.log("EnsureCompletelyDownloaded refresh loop detected: modifiedDateChanges - "+e+" itemModifiedDate - "+f+" item.modifiedDate - "+a.modifiedDate,d);e++;f=a.modifiedDate}if(e>m){Trace.log("EnsureCompletelyDownloaded refresh loop hit: modifiedDateChanges - "+e+" itemModifiedDate - "+f+" item.modifiedDate - "+a.modifiedDate,d);k(null)}else{var o=a.getChildren(c);if(o)if(o.isComplete())b=true;else if(h)for(var r=0;r<h.length;r++){var s=h[r];if(!o.get(s,true)){b=false;p=s;break}}else{var t=o.getCount();for(var q=0;q<t;q++)if(!o.get(q,true)){b=false;p=q;break}}else b=false;if(b)l(a);else{Trace.log("EnsureCompletelyDownloaded fetch item: itemKey - "+i+" setKey - "+c+" fetchIndex - "+p,d);g.fetchItem(i,c,null,p,false,null,j,n)}}}};g.fetchItem=function(b,h,f,c,j,w,q,n,D,A){var x=u;if(!f){c-=c%u;if(c){c-=u;x=u*2}}var r=H(b,h,f,c,x,D,A),t=g.getItem(b,true),d=Math.random(),y=g.getItem(b,true);if(y&&y.hasExpired())j=true;var m;if(a.Search&&B(b)&&!j)m=a.Search.getSearchOrigin(k(b,"q"));else m=(t||w)&&!j?w||t.modifiedDate:d;var E=r+"&v="+m+(FilesConfig.authKey?"&authkey="+FilesConfig.authKey.encodeUrl():""),C=!!a.SkyDriveItem.getItemKeyParts(b).did,e=new a.DataRequest(r,E,null,function F(a){z(a,b,h,f,c,d);q&&q(g.getItem(b,true))},function G(a){z(a,b,h,f,c,d);n&&n(a?a.error:null)},C?o:p);e.originId=d;e.failureReentranceDelay=l;var v=e.start();if(v){var i=s[b]=s[b]||{};i[h]=e;i["count"]=(i["count"]||0)+1}return v};g.dispose=function(){for(var a in s)s[a].abort();g.disposeEvents()};function z(c,b,i,q,o,p){var h=s[b];if(h){delete h[i];h["count"]--;if(!h["count"])delete s[b]}if(c&&c.items&&!c.error){var m=p&&p!=c.originId,l=m&&A(g.getItem(b,true)),n=g.processResponse(c,b,i);Trace.log("Received response: (fromCache: "+m+", revalidating: "+l+", itemsChanged: "+n+")",d);var t=g.getItem(b,true);if(t)if(n)t.invalidate(true);if(l)g.fetchItem(b,i,q,o,true)}else{var e=c?c.error:{debugMessage:"Server returned no success or failure"},j=k(b,"did");if(j){var r=x(j);if(r&&r.baseUrl&&a.DeviceItem.hasNewBaseUrlError(e,j))g.fetchItem(b,i,q,o,true)}$WebWatson.submit("JSON error",b,0,e.debugMessage,e.code,e.stackTrace,0,true);e.key=b;g.raiseEvent(f.errorEvent,e)}}function x(c){var b=a.PageController.getInstance().getViewContext().deviceItemSet;return b.getByKey(c.toLowerCase())}function I(d,c){keyComponents=b.getItemKeyParts(d);return a.StringHelpers.caseInsensitiveStringEquals(keyComponents.id,c)||!c&&!keyComponents.id}function k(d,c){var a=b.getItemKeyParts(d);return a[c]}function y(d,i,r,q,e,o){var l,j=b.getItemKeyParts(i);if(i&&I(i,d.id))l=i;else l=b.getItemKey(d.id,d.ownerCid,d.group,j["qt"],j["did"],j["q"]);var f=g.getItem(l,true),c=d.folder;if(!q&&d.parentId)q=b.getItemKey(d.parentId,d.ownerCid,d.group,j["qt"],j["did"],j["q"]);if(!f){e=true;f=w[l]=new a.SkyDriveItem(g,l,q);if(d.isSpecialFolder&&l!=i){var x=b.getItemKey(d.specialFolderCanonicalName.toLowerCase(),d.ownerCid,d.group,null,j["did"]);w[x]=f}}e=f.processItem(d)||e;if(c){var h=f.getChildren(r);if(o&&r!=o){e=e||f._childSets[o]!==h;f._childSets[o]=h}a.SkyDriveItemHelper.isDeviceRoot(f)&&n(c);if(h.modifiedDate!=f.modifiedDate&&c.childCount!=undefined){c.groupings&&(h.groupings=c.groupings);h.modifiedDate=f.modifiedDate;h.setCount(c.childCount);h._requiresFilter=true;e=true}c.photoCount!==undefined&&(f.folder.photoCount=c.photoCount);var z=k(i,"qt"),A=k(i,"q");if(c.children){var p=c.startIndex||0;if(p+c.children.length>c.totalCount){var u=c.totalCount-p;c.children.length=u>0?u:0}for(var s=0,v=p;s<c.children.length;s++,v++){var m=c.children[s],t=b.getItemKey(m.id,m.ownerCid,m.group,z,f.did,A);e=y(m,t,r,l,e)||e;e=h.set(v,g.getItem(t,true))||e}}}return e}function F(e){var i=e.items,c=e.tokenNeedsRedeeming,d=e.tokenType;for(var f=0;f<i.length;f++){var b=i[f];if(b.id!="root"&&c&&d!=null){b.tokenNeedsRedeeming=c;b.tokenType=d;var a=b.folder;if(a&&a.children)for(var g=0,j=a.startIndex||0;g<a.children.length;g++){var h=a.children[g];h.tokenNeedsRedeeming=c;h.tokenType=d}}}}function H(d,f,w,A,B,n,o){var y=g.getItem(d,true),u=D(y),z=o?o:g.extraGetItemsParams,q=a.PageController&&a.PageController.getInstance(),r=q&&q.getViewContext(),s=r&&r.viewParams,p=(n===undefined?"&d=1":"&d="+n)+"&iabch=1"+"&lid="+(u?u.id:"")+"&caller="+K+"&path="+(n===0||C(y,d)?"0":"1")+(w?"&sid="+w:"&si="+A)+"&ps="+B+"&pi=5"+"&m="+O+"&"+i+"="+h+"&"+j+(s&&s.v==FilesConfig.filePickerViewParam?"&urlType=2":"")+z;if($B.Mobile)p+="&isMobile=1";var t=v;if(d.indexOf("&did=")!==-1){var m=x(k(d,"did"));t=m&&m.baseUrl?m.baseUrl:FilesConfig.devicesBaseUrl;var b=a.SkyDriveItem.getSetKeyParts(f);if(b.sd!==undefined){var l="0";if(b.sb==e.Default||b.sb==e.Name)l=b.sd==c.Descending?"1":"0";else l=b.sd==c.Ascending?"0":"1";f=f.replace("sd="+b.sd,"sr="+l)}}return t+"GetItems?"+d+"&"+f+p}function D(b){var a=b?b.getParent(true):null;while(a&&a.parentKey){b=a;a=a.getParent(true)}return a?b:null}function A(a){return !a||a.hasExpired()}function B(a){return a&&k(a,"qt")==="search"&&k(a,"id")==="root"}function C(a,c){var b=D(a);return B(c)?false:!!(a&&!a.parentKey||b&&g.getItem(b.parentKey,true))}function G(b){var c=v+"GetGroupInfo?"+b+"&retrieveMembership=true",d=new a.DataRequest(c,c,null,function(c){var d=new a.GroupInfo(c.groupInfo,b);E[b]=d;g.raiseEvent(f.groupInfoChangedEvent)});d.start()}}function n(c){if(c.childCount!==undefined){var g=c.childCount,b=[],d=[],a=null;for(var f=0;f<g;f++){var e=c.children[f];if(e.isHeader){a&&a.count&&d.push(a);a={groupingId:"folder",name:e.name,startIndex:b.length,endIndex:b.length,count:0}}else{a.endIndex=b.length;b.push(e);a.count++}}a&&a.count&&d.push(a);c.groupings=d;c.children=b;c.totalCount=b.length;c.childCount=b.length}}var g=f.prototype,k=a.Events;g.addListener=a.Events.addListener;g.removeListener=k.removeListener;g.disposeEvents=k.disposeEvents;g.raiseEvent=k.raiseEvent})();(function(){var b=wLive.Core,n=b.AleHelpers.getPCString,l="",k=":",t=1e3,m=6e4,h=3.6e6,p=.85,A="live.shared.skydrive.pc.",z="live.shared.skydrive.mobile.",q="&videoplayer=skysl",y="root",r="photomail_",C="Folder",e="Doc",i="One",a="Ppt",c="Xls",f="Lib",o="Drive",x="CDDrive",w="USBDrive",u="ExtDrive",v="NetDrive",B="BrDrive",j={WinDocuments:f,WinLibrary:f,WinMusic:f,WinPictures:f,WinPodcastLibrary:f,WinVideos:f,WinDrive:o,CDDrive:x,GenericDrive:o,UsbDrive:w,ExternalDrive:u,NetworkStorage:v,Doc:e,Docm:e,Docx:e,Dot:e,Dotm:e,Dotx:e,Exe:"Exe",Html:"Html",Mdb:"Mdb",Mpp:"Mpp",Odp:a,Ods:c,Odt:e,One:i,Onepkg:i,Onetoc2:i,Notebook:"OneNotebook",Pot:a,Potm:a,Potx:a,Ppa:a,Ppam:a,Pps:a,Ppsm:a,Ppsx:a,Ppt:a,Pptm:a,Pptx:a,Pub:"Pub",Rtf:"Rtf",Txt:"Txt",Vsd:"Vsd",Xaml:"Xaml",Xla:c,Xlam:c,Xls:c,Xlsb:c,Xlsm:c,Xlsx:c,Xlt:c,Xltm:c,Xltx:c,Xml:"Xml",Xps:"Xps",Xsn:"Xsn",Zip:"Zip"};wLive.Core.SkyDriveItemHelper={duration:function(a){var b=l,c=false;if(a>=h){var f=Math.floor(a/h);a=a%h;b+=f+k;c=true}var d=Math.floor(a/m);a=a%m;if(d<10&&c)b+="0";b+=d+k;var e=Math.floor(a/t);if(e<10)b+="0";b+=e;return b},getThumbnail:function(e,f){var a=e.thumbnails;if(a){var d=a.length,b=0;for(;b<d;b++){var c=a[b];if(c.name==f)return c}}},pickThumbnail:function(b,g,f){var d=null,c=null,i=g*f*p;if(b&&b.thumbnails&&b.thumbnails.length>0)for(var e=0;e<b.thumbnails.length;e++){var a=b.thumbnails[e];a.totalPixels=a.width*a.height;var h=a.coverage=Math.min(a.width,g)*Math.min(a.height,f);if(h>=i){if(!d||a.totalPixels<d.totalPixels)d=a}else if(!c||a.totalPixels>c.totalPixels)c=a}return d||c},isHtml5DropEnabled:function(a,b){return a&&a.folder&&!a.did&&b.viewParams.qt!="mru"&&b.viewParams.qt!="shared"},isRootItem:function(a){return a.id===y},isSkyDriveRoot:function(a){return b.SkyDriveItemHelper.isRootItem(a)&&!a.group&&!a.did&&!s(a)},isDeviceRoot:function(a){return a&&b.SkyDriveItemHelper.isRootItem(a)&&a.did},isGroupRoot:function(a){return b.SkyDriveItemHelper.isRootItem(a)&&d(a,"group")==="1"&&a.ownerCid!=null},isGroupItem:function(a){return d(a,"group")==="1"},isLegacyPhotomail:function(a){return a.id&&a.id.startsWith(r)},isTopLevelItem:function(c){if(b.SkyDriveItemHelper.isRootItem(c))return false;var a=c.getParent(true);return a&&b.SkyDriveItemHelper.isRootItem(a)},getTopLevelItem:function(a){while(a&&!b.SkyDriveItemHelper.isTopLevelItem(a))a=a.getParent(true);return a},isViewerOwner:function(a){return !a.ownerCid||a.ownerCid.toLowerCase()==FilesConfig.hcid.toLowerCase()},isMruQuery:function(b){var a=d(b,"qt");return a&&a.toLowerCase()==="mru"},isRecycleBinQuery:function(b){var a=d(b,"qt");return a&&a.toLowerCase()==="recyclebin"},isSharedQuery:function(b){var a=d(b,"qt");return a&&a.toLowerCase()==="shared"},isSearchQuery:function(a){var c=d(a,"qt");return c&&c.toLowerCase()==="search"&&b.SkyDriveItemHelper.isRootItem(a)},getSearchQuery:function(a){return d(a,"q")||""},isSearchResult:function(a){var c=a&&a.getParent&&a.getParent(true);return b.SkyDriveItemHelper.isSearchQuery(c)},isSearchOrDescendent:function(a){while(a){if(b.SkyDriveItemHelper.isSearchQuery(a))return true;a=a.getParent&&a.getParent(true)}return false},highlightAndEncodeField:function(e,f){if(e&&e[f]){var c=e[f],d=[],a=e.highlights;if(a)for(var b=a.length-1;b>=0;b--)if(a[b].fieldName==f&&a[b].startIndex<c.length){d.unshift(c.substring(a[b].endIndex).encodeHtml());var g=jQuery(_ce("span")).addClass("highlight").html(c.substring(a[b].startIndex,a[b].endIndex).encodeHtml());sutra(g,"$Sutra.SkyDrive.SearchHighlight");var h=jQuery(_ce("span")).append(g);d.unshift(h.html());c=c.substring(0,a[b].startIndex)}d.unshift(c.encodeHtml());return d.join("")}else return ""},clearFieldHighlights:function(c,d){if(c&&c.highlights){var b=c.highlights;for(var a=0;a<b.length;)if(b[a].fieldName==d)b.splice(a,1);else a++}},getSongForPlayer:function(a){var d,b=a.audio;if(b){var c=null;if(a.thumbnailSet)c=a.thumbnailSet.baseUrl+wLive.Core.SkyDriveItemHelper.getThumbnail(a.thumbnailSet,"height128").url;d={songUrl:a.urls.download+q,songTitle:b.title||a.name||l,artistName:b.artist||n("InfoPane.Information.UnknownArtist"),albumArtUrl:c,mimeType:a.mimeType,error:0}}return d},getNormalizedExtension:function(a){return a&&j[a.iconType]},getFriendlyFileType:function(a){var f=a.getVersion(),e="friendlyFileTypeVersion";if(a[e]!==f){var h=a.extension,c=h&&h.substring(1).toUpperCase(),d=j[a.iconType],b=g("NoExtension");if(!d&&a.folder)b=g("Folder");else if(a.photo&&!a.video)b=g("Image").format(c||"").trim();else if(d)b=g(d);else if(c)b=g("Unknown").format(c);a.friendlyFileType=b;a[e]=f}return a.friendlyFileType}};function s(b){var a=d(b,"qt");return a&&a!==""}function d(a,b){if(!a)return undefined;if(!a.keyParts)a.keyParts=$Utility.deserialize(a.key,"&",false,false);return a.keyParts[b]}function g(a){return n("FileType."+a)}})();(function(){var b=wLive.Core,a=b.AleHelpers.getString,c=wLive.Controls,e=c.Notifications;b.ErrorManager=d;function d(){var b=this;b._errors=[];b.errorReceivedEventName="errorreceived";b.errorClearedEventName="errorcleared";function c(){var d=window.FilesConfig,a=d.notificationBarMessages;if(a)for(var e in a){var c=a[e];if(typeof c==="object")b.add(c)}}function d(a,b){if(a.priority!=b.priority)return a.priority-b.priority;else return a.type-b.type}b.add=function(c){c.priority|=0;c.type|=0;if(c.type==0&&$Config.hc&&c.$element){var f="Help",g=c.$element.children("a").length>0;if(!g)if(c.code){var e=null;if($Config.hc.slcList&&$Config.hc.slcList[c.code]){f="SLC";var i="&nbsp;"+a("ErrorStatusMessage"),h='<a href="'+$Config.hc.slcUrl+'" target="_blank">'+a("ErrorStatusLinkLabel")+"</a>";e=jQuery("<span/>",{"class":"errorHelpLink",html:i.format(h)});e.click(function(){$BSI.reportEvent("ClickSelected.SLC.SkyDriveInProductLink",{CMXErrorCodeSD:c.code})});$BSI.reportEvent("Action.SLC.SkyDriveOutageError",{CMXErrorCodeSD:c.code})}else{e=jQuery('<span class="errorHelpLink">&nbsp;<a target="_blank">'+$Config.hc.label+"</a></span>");$HelpContext.attachContextTo(e.children("a"),c.code,c.$element.text())}c.$element.append(e)}else{c.code="noCode";f="None"}else f="Other";$BSI.reportEvent("Log.WL.ErrorDisplayed",{WLErrorProduct:$Config.prop,WLErrorCode:c.code,WLErrorLinkType:f})}b._errors.push(c);b._errors.sort(d);jQuery(b).trigger(b.errorReceivedEventName)};b.removeAt=function(a){var c=b._errors&&b._errors.length;if(c>0&&a>=0&&a<c){b._errors.splice(a,1);if(b._errors.length===0)jQuery(b).trigger(b.errorClearedEventName)}};b.clear=function(){if(b._errors.length>0){b._errors=[];jQuery(b).trigger(b.errorClearedEventName)}};b.dismiss=function(){var a=b._errors;if(a.length>0)a[0].dismissCallback&&a[0].dismissCallback();b.clear()};b.getErrors=function(){return b._errors};c()}})();(function(){wLive.Core.DomHelpers={isTextInputElement:function(a){return a.is("textarea")||a.is("input")&&(a.attr("type")=="text"||a.attr("type")=="password")},setTimeoutZero:function(a){if(window.msSetImmediate){window.msSetImmediate(a);return null}else return window.setTimeout(a,0)}}})();(function(){var b=wLive.Core,c=$B.IE&&$B.V==10,a=window["File"]&&(window["File"].prototype.slice||window["File"].prototype.mozSlice||window["File"].prototype.webkitSlice);b.skyMode={html5UploadEnabled:a,useSilverlightForUpload:!a&&b["SilverlightInstalled"]&&!$B.Firefox&&!c&&FilesConfig.slEnabledMarket}})();(function(){var e=".ModalDialog",a="popoverHelpers",d=false,f=jQuery(window),c=function(){Trace.log("PopoverHelpers: dialog up",a);d=true},b=function(){Trace.log("PopoverHelpers: dialog closed",a);d=false};$Do.when("Notifications.js",0,function(){Trace.log("PopoverHelpers: creating bindings",a);jQuery(wLive.Controls.Notifications).bind({"afterdialogshow.notifications":c,"beforedialogdismiss.notifications":b,"afterflyoutshow.notifications":c,"beforeflyoutdismiss.notifications":b});var d={};d.cleanupBindings=function(){Trace.log("PopoverHelpers: clearing bindings",a);jQuery(wLive.Controls.Notifications).unbind({"afterdialogshow.notifications":c,"beforedialogdismiss.notifications":b,"afterflyoutshow.notifications":c,"beforeflyoutdismiss.notifications":b})};$Do.when("$PF.attach",d,d.cleanupBindings)});wLive.Core.PopoverHelpers={popoverSelector:e,isPopoverVisible:function(){return d}}})();(function(){window.FilesIS32=window.FilesIS32||{};window.FilesIS8=window.FilesIS8||{};var a=[FilesIS32,FilesIS8],c=[FilesConfig.imageStripUrl_32,FilesConfig.imageStripUrl_8],d=wLive.Core.ImageStrip={};d.getImage=function(h,g,f){g=g||"";f=f||"";var i,e=b(h);if(e>-1){var j=a[e],k=c[e],d=j[h];i=$IS.Create(d.x,d.y,d.w,d.h,FilesConfig.imgBaseUrl,k,g,f)}return i};function b(d){var c=-1;for(var b=0;b<a.length;b++)if(a[b].hasOwnProperty(d)){c=b;break}return c}})();(function(){var b=window,d=new RegExp("^http(?:s)?://(?:[A-Za-z0-9]*[.])*livefilestore(?:-int)?[.]com/","i"),a=wLive.Core.CookieToss={complete:true,eventName:"cookieToss",requiresCookieToss:function(a){return d.test(a)}};if(_ge("cookieToss")&&!b.cookieToss.e){a.complete=false;b.cookieToss.c=c}function c(){a.complete=true;jQuery(a).trigger(a.eventName)}})();(function(){var a=wLive.Core,b=a.SkyDriveItemHelper;b.getLoadedThumbnailUrl=function(d){var f,b=d.thumbnails;if(b){var g=b.length,c=0;for(;c<g;c++){var h=b[c],e=d.baseUrl+h.url;if(a.Images.isComplete(e)){f=e;break}}}return f};b.isFavoritesLib=function(b,a){return c(b,a,2)};b.isPhotoAlbum=function(b,a){return c(b,a,1)};b.getIcon=function(b,c){var f="ft_"+c+"_"+b.iconType,d="icon"+c+f;if(!b[d]){if(this.isRootItem(b)&&c===16)return a.ImageStrip.getImage("skydrive_16",b.ownerName);if(this.isGroupRoot(b))return a.ImageStrip.getImage("groups",b.ownerName);var g=b.name,e=a.ImageStrip.getImage(f,g);if(!e){var i=c===16?"tiny":c===32?"smaller":"small",h=(FilesConfig.foldersImgBaseUrl+"/icons/{0}/{1}.png").format(i,b.iconType);e=$IS.Create(0,0,c,c,FilesConfig.imgBaseUrl,h,g,"")}b[d]=e}return b[d].cloneNode(true)};function c(a,c,d){var b=false;while(!b&&a&&a.parentKey!=null){b=a.folder&&a.folder.category===d;a=c.dataModel.getItem(a.parentKey,true)}return b}})();(function(){var a="",c=null,b=wLive.Core.SkyDriveItemHelper;function f(){if(!c)c=wLive.Core.PageController.getInstance().getViewContext();return c}function d(b){return b?b.encodeURIComponent():a}function e(a,d,e,b){var c=a?a.ownerCid:null;return b?b:c||d.callerCid}wLive.Core.ItemActionHelper={itemStringFormat:function(j,g,i,h){var c=f();return j.itemFormat({item:g,$Config:window.$Config,FilesConfig:window.FilesConfig,ViewContext:c},{encodeUrl:function(b){return b?b.encodeUrl():a},encodeURIComponent:d,cid:e,cidQueryString:function(c,j,h,l,k){var i=k||c&&c.group,g=c&&b.isSearchQuery(c)&&c.id=="root",f=c&&b.isRecycleBinQuery(c)&&c.id=="root";if(g)return "qt=search&q="+b.getSearchQuery(c);else return "cid="+d(e(c,j,h,l))+(i?"&group=1":a)+(f?"&qt=recyclebin":a)},profileDomain:function(c,e,b,f,a){var d=a===true||a===false?a:c&&c.group;return d?b.groupsDomain:b.profileDomain},groupsDomain:function(){return FilesConfig.groupsDomain},groupEmail:function(a){return a&&b.isGroupRoot(a)&&a.groupEmail?a.groupEmail:""},deviceIdQueryString:function(b){return !!b.did?"&did="+b.did.encodeURIComponent():a},resIdQueryString:function(b){return b.id=="root"?a:"&resid="+b.id.encodeURIComponent()},appQueryString:function(d){var c=wLive.Core.SkyDriveItemHelper.getNormalizedExtension(d),b=null;switch(c){case "Doc":b="Word";break;case "Xls":b="Excel";break;case "Ppt":b="PowerPoint";break;case "One":case "OneNotebook":b="OneNote"}return b?"&app="+b:a},idQueryString:function(b){return b.id=="root"?a:"&id="+b.id.encodeURIComponent()},parentIdQueryString:function(b){if(b.parentId&&!b.directlyShared)return b.parentId=="root"?a:"&id="+b.parentId.encodeURIComponent();else return a},parentId:function(b){return (b.parentId||a).encodeURIComponent()},isFolder:function(a){return a.folder?1:0},scenario:function(c,b){return b.viewParams.sc?"&sc="+b.viewParams.sc:a},queryType:function(c,b){return b.viewParams.qt?"&qt="+b.viewParams.qt:a},searchParams:function(c,f){var e=c&&b.isSearchResult(c),d=c&&(c.photo||c.video||c.isProcessingVideo||f.currentViewType==="SelfView");return e&&d?"&qt=search&q="+b.getSearchQuery(c):a},viewQueryString:function(c,b){return b.viewParams.v?"&v="+b.viewParams.v:a}},[g,c,window.FilesConfig,i,h])}}})();(function(){var c=wLive.Core;c.ActionManager=b;function b(){this._actions={}}var a=b.prototype;a.registerAction=function(b,a){this._actions[b]=a};a.isActionRegistered=function(a){return this._actions[a]?true:false};a.getAction=function(b){var a=this._actions[b];if(!a)return null;return a.getAction.apply(a,arguments)};a.doAction=function(a){if(a){if(a.click)a.click();if(a.url)$BSI.navigateTo(a.url,a.target)}};b.getATagAction=a.getATagAction=function(a,d,e){var b=a.click||function(){$BSI.navigateTo(a.url);return false},f=a.skyCmd;if(d&&f)b=a.click=c.BiciHelpers.prependBiciReportClickAction(b,f,d);if(e)a.click=function(a){return e(a,b)};return a};b.setATagAction=a.setATagAction=function(a,c,d,e){c=c||jQuery(_ce("a"));a=b.getATagAction(a,d,e);if(a.click)c.bind("click.action",a.click);c.attr("href",a.url||"#");if(a.target)c.attr("target",a.target);return c}})();(function(){var b=wLive.Core;b.OperationManager=a;var d=new a,c="Operation_";b.OperationManager.getInstance=function(){return d};function a(){var a=this;a.execute=function(b,a){$Do.when("Bucket4.js",0,function(){$Do.when(c+b,0,a)})};a.register=function(a,b){$Do.register(c+a,function(c){b(a,c)})}}b.OperationManager.Current=new a})();(function(){var k=wLive.Core,d=k.CookieToss,m="imgPool",r="unload",l=29001,f=wLive.Core.Images={},j=10,b=[],c=[],a={},t={},g={},s=0,i=0,h=false;(function(){for(var a=0;a<j;a++)b.push(jQuery(document.createElement("img")).bind({error:o,abort:n,load:q}));jQuery(window).bind(r,p);if(!d.complete)jQuery(d).bind(d.eventName,c);function c(){e()}})();f.getId=function(){return m+s++};f.isComplete=function(a){return g[a]};f.isIdle=function(){return c.length==0&&b.length==j};f.hasLoadedImage=function(a){return g[a]};f.loadImage=function(b,d){if(g[b])d&&(d.src=b);else if(a[b])a[b].push(d);else{c.push(b);a[b]=[d];e()}};function p(){h=true}function e(a){var f;if(!a&&b.length>0)a=b.pop();if(a)if(!h&&c.length>0&&(d.complete||!d.requiresCookieToss(c[0]))){f=c.splice(0,1)[0];if(c.length>0&&b.length>0)e();i++;if(i%10)g();else k.DomHelpers.setTimeoutZero(g)}else b.push(a);function g(){a[0].s=f;a[0].src=f}}function o(){var b=this,d=jQuery(b),c=b.s;$WebWatson.submit("Image failed to download.",c,0,null,l,null,null,true);delete a[c];e(d)}function n(){var c=this,d=jQuery(c),e=c.s;delete a[e];b.push(d)}function q(){var f=this,i=jQuery(f),b=f.s,d=a[b],c=0,h=d.length;g[b]=true;for(;c<h;c++)d[c]&&(d[c].src=b);delete a[b];e(i)}})();(function(){var c=wLive.Core,b=c.SkyDriveItem.areItemsSame,h=38,g=40,d=0,f=1,e=2;a.SelectionChangedEvent="selectionChanged";a.ResolveFailed=-1;a.ResolveWaiting=1;a.ResolveSuccess=2;wLive.Core.SelectionManager=a;function a(P){var i=this,S=jQuery(i),k,F,w,t=[],y=false,s={},C={},j={},n={},r=false,m=-1,l=-1,v=true,u=true;i.dispose=function(){o()};i.setMultiSelectEnabled=function(a){v=a};i.setCrossGroupSelectEnabled=function(a){u=a};i.registerList=function(b,a){s[b]=a;C[a.key]=b};i.unregisterList=function(){C={};s={}};i.clickSelect=function(b,c,a){a=D(a);q(function(){E(c,a);r=a&&a.preselect},b)};i.keyboardSelect=function(b,c,a){a=D(a);if(B(b))return true;return q(function(){var b=m,d=a.shift;switch(c){case h:if(b!==-1){var e=d?b-1:G(b);b=Math.max(0,e)}else{x(s[0]);b=w-1}break;case g:if(b!==-1){var f=d?b+1:I(b);b=Math.min(w-1,f)}else{x(s[0]);b=0}break;default:return true}if(b!==m){a.ctrl=false;E(b,a)}else return true;return false},b)};i.resolveSelection=function(d){var b=a.ResolveSuccess,c=d?d.getChildren():null;if(!c||c.getCount()===0)i.deselectAll();else{var g={},r=i.getSelection();if(!x(d))if(c.get(0))for(var l in j){var e=n[l],h=e?c.indexOf(e,false,true):-1;if(h>-1)g[h]=e;else b=a.ResolveFailed}else b=a.ResolveWaiting;else b=a.ResolveFailed;if(b===a.ResolveSuccess){var f=n[m],k=f?c.indexOf(f,false,true):-1;q(function(){o();for(var a in g)p(a);m=k},d)}else if(b===a.ResolveFailed)i.deselectAll()}return b};i.selectAll=function(a){if(B(a)||!v)return true;q(function(){o();for(var a=0;a<w;a++)p(a)},a)};i.deselectAll=function(b,a){if(a)o();else q(function(){o()},b)};i.getSingleSelectedItem=function(b){var c,a=this.getSelection();if(b&&a.selectionCount===1)for(var d in a.indexes){c=b.getChildren().get(d);break}return c};i.anySelected=function(){var a=false;for(var b in j)if(j.hasOwnProperty(b)){a=true;break}return a};i.getSelection=function(){var a=0;for(var c in j)a++;var b={parent:k,inPreselectionMode:r,indexes:j,selectionCount:a,lastInteractedIndex:m};return b};i.getSelectedItems=function(e){var f=c.PageController.getInstance().getViewContext(),h=f.dataModel,a=i.getSelection(),b=a.parent,d=[];for(var j in a.indexes)d.push(j);var g=c.SkyDriveItem.getDefaultSetKey();h.ensureCompletelyDownloaded(b,function(){var c=[];for(var f in a.indexes){var d=b.getChildren(g).get(f);c.push(d)}e(c)},function(){Trace.log("Failed to get the selected items for: "+b.key,"Selection Manager")},null,d)};i.isSelected=function(c,a){return b(c,k)&&j[a]===a};i.hasPreselectedChild=function(a){return b(a,k)&&r};i.resetPreselectionFlag=function(){r=false};i.setGroupings=function(a){if(a){t=a;y=true}else{t=k?k.getChildren().getGroupings():[];y=false}};function E(a,b){var c=K(b);switch(c){case f:O(a);l=a;break;case e:N(a,b);break;case d:M(a);l=a}var g=i.getSelection();m=g.selectionCount===0?-1:a}function O(a){if(!u&&A(a))o();L(a)}function N(b,h){if(!h.ctrl){j={};n={};p(l)}var d=i.isSelected(k,l),c=Math.min(Math.min(l,m),b),e=Math.max(Math.max(l,m),b),f=Math.max(Math.min(l,b),0),g=Math.max(Math.max(l,b),0);for(var a=c;a<=e;a++)if(a>=f&&a<=g){if(a!==l)d&&(!u&&!A(a)||u)?R(a):Q(a)}else{delete j[a];delete n[a]}}function D(a){a=a||{};a.ctrl=v&&a.ctrl;a.shift=v&&a.shift;return a}function M(b){var a=i.getSelection(),c=a&&a.selectionCount===1&&i.isSelected(k,b);o();if(!c)p(b)}function o(){j={};n={};r=false;m=-1;l=-1}function R(a){p(a)}function Q(a){delete j[a];delete n[a]}function L(a){if(i.isSelected(k,a)){delete j[a];delete n[a]}else p(a)}function G(b){var a=b;while(j[a]!=null)a--;return a}function I(b){var a=b;while(j[a]!=null)a++;return a}function x(a){var d=false;if(!a)d=true;if(!b(a,k)&&a){d=true;k=a}var e=c.SkyDriveItem.getDefaultSetKey();if(F!==e)F=e;if(a){if(!y)t=k.getChildren().getGroupings();w=P.getChildCount(a)}return d}function K(a){var c=a&&a.ctrl,b=a&&a.shift;return b?e:c?f:d}function B(c){var a=0;for(var d in s)a++;if(a>1&&!b(c,k))return true;return false}function J(a,c){var d=b(a.parent,c.parent)&&a.relationshipsKey===c.relationshipsKey&&a.inPreselectionMode===c.inPreselectionMode&&a.selectionCount===c.selectionCount;if(d){var e=a.indexes,g=c.indexes;for(var f in e)if(e[f]!==g[f]){d=false;break}}return d}function z(b){for(var a=0;a<t.length;a++){var c=t[a];if(c.startIndex<=b&&c.endIndex>=b)return a}return -1}function A(a){for(var b in j)if(z(a)!=z(b))return true;else break;return false}function p(a){j[a]=parseInt(a);var b=k.getChildren().get(a,true);if(b)n[a]=b}function q(b,d){var a=i.getSelection();if(x(d))o();var c=b();if(!J(a,i.getSelection()))H();return c}function H(){S.trigger(a.SelectionChangedEvent,[i.getSelection()])}}})();(function(){var b=wLive.Core,a=wLive.Controls;b.PopoverManager={showPopover:function(c,d){$Do.when("Bucket3.js",0,function(){var e=new a[c](b.PageController.getInstance().getViewContext());e.show(d)});if(!a[c]);}}})();(function(){var a=wLive.Core,j=a.AleHelpers.getPCString,q="title";function f(i,q,s,c,h,n,g,e,d){var u=s.length;for(var l=0;l<u;l++){var a=mix({},s[l]),b=a.command,p=a.commandGroup;if(b){var k=q.getAction(b,c),t=a.alias||b,o=h&&h[t];if(k&&(!a.isEnabled||a.isEnabled(i,c))&&(!o||o(i,c))){a.action=k;a.id=b;var r=a.getStringId;a.stringId=r&&r(c)||b;a.string=k.string||j(a.stringId+"Command");n(a,d)}}else if(p){var m=function m(b){f(i,q,a.members,c,h,n,g,e,b)};if(g)g(p,d,m);else m(d)}else e&&e(d)}}function c(c,d){var a=c.currentItem,b=a.key;if(c.currentViewType==="SetView"&&!a.folder)b=a.parentKey;return b===d.key}function b(a,b){return !c(a,b)}function i(c,b){return a.SkyDriveItemHelper.isGroupRoot(b)}function k(c,b){return !a.SkyDriveItemHelper.isRootItem(b)}function h(c,d){var a=c.actionManager.getAction("DefaultClick",d),e=a&&a.name,f=e==="ViewItem";return b(c,d)&&f}function e(a,b){return !d(a)&&(c(a,b)||!a.actionManager.getAction("Abdicate",b))}function g(b,a){return !a.form}function d(a){return a.viewParams.qt=="recyclebin"}a.CommandManager={processCommands:function(b,e,l,j,i,h,g,k){var d=e,c=b.actionManager;if(!e){d=l;c=b.multiselectActionManager}f(b,c,a.CommandManager._commands,d,j,i,h,g,k)},commandDisabled:function n(){return false},isCurrentItem:function p(a,b){return c(a,b)},isNotCurrentItem:function l(a,c){return b(a,c)},isDeleteEnabled:function o(a,b){return e(a,b)},isRecycleBinItem:function m(a){return d(a)},_commands:[{commandGroup:"Survey",members:[{command:"SendSurvey"},{command:"PreviewSurvey"},{command:"EditSurvey"}]},{command:"SlideShow"},{isEnabled:h,command:"ViewItem"},{commandGroup:"Open",members:[{getStringId:function(b){var a=b;if(a.form)return "OpenWorkbookInExcelWebApp"},command:"OpenInExcelWebApp"},{command:"OpenInOneNoteWebApp"},{isEnabled:b,command:"OpenInPdfWebApp"},{command:"OpenInPowerPointWebApp"},{command:"OpenInWordWebApp"},{isEnabled:g,command:"OpenInExcel"},{command:"OpenInOneNote"},{command:"OpenInPowerPoint"},{command:"OpenInWord"},{command:"OpenInVisio"},{command:"OpenInProject"},{command:"OpenInPublisher"},{command:"OpenInExpo"}]},{alias:"TopLevelDownload",command:"Download"},{command:"Play"},{command:"Restore"},{isEnabled:d,command:"Delete"},{command:"CopyToSkyDrive"},{command:"ViewOrginal"},{getStringId:function(b){var a=b;if(a.form)return "ShareWorkbook"},command:"Share"},{alias:"TopLevelEmbed",command:"Embed"},{commandGroup:"Manage",members:[{alias:"NestedDownload",command:"Download"},{alias:"NestedEmbed",command:"Embed"},{isEnabled:c,command:"OrderPrints"},{},{isEnabled:b,command:"Rename"},{alias:"NestedDelete",isEnabled:e,command:"Delete"},{command:"Abdicate"},{command:"ReportAbuse"},{command:"Move"},{command:"Copy"},{},{command:"ViewVersions"},{},{command:"OpenFileLocation"},{command:"ViewInFolder"},{isEnabled:k,command:"Properties"}]},{commandGroup:"Group",members:[{command:"GroupSendMail"},{command:"GroupViewMail"},{},{command:"GroupInvite"},{command:"GroupMembership"},{},{isEnabled:i,command:"Properties"}]},{command:"GroupProfile"},{command:"GroupOptions"},{command:"Deselect"}]}})();(function(){var b=wLive.Core,a=wLive.Controls,c=b.AleHelpers.getPCString;a.CommandBarHelper={populateSharedCommands:function d(k,m,l,j,i,d){d=d||"";var e,h=function h(b,h){e=e||b;var g=b.id,f=c(b.stringId+d+"Command")||b.string,i=a.CommandBarHelper.createNavLink(b.action,g,f,h,"CB")},g=function g(m,r,p){var q=r,i=[];p(i);var k=i.length;if(k){var g;if(k===1)g=i[0];else{var o=m+d+"Menu",n=a.CommandBarHelper.createNavLinkElement(c(o)),b,f;if(m==="Open"){b=a.SplitMenu.create();f=b.getMenu()}else f=a.Menu.create({html:n});for(var l=0;l<k;l++)f.push(i[l]);if(b){var h=e.action,j=b.getLink();j.setHtml(n);j.setUrl(h.url);if(h.click)j.addClick(h.click,h.url);g=b}else g=f;sutra(f._$a,"$Sutra.SkyDrive."+o)}q.push(g)}},f=function f(d){var c=d["array"]||d,b=c.length;if(b){var a=c[b-1];a.removeSeparator();a.addSeparator()}};b.CommandManager.processCommands(k,m,l,i,h,g,f,j)},initializeCommandBar:function f(b,c){if(window.$CommandBar){sutra($CommandBar["$obj"],c);var a=b.actionManager.getAction("SkyDriveRoot");if(a){var d=$CommandBar.getDataModel().logo;d.setProperty("url",a.url)}return $CommandBar}},createNavLink:function g(c,h,l,i,j,g){var d=null,e=c.skyCmd;if(e)c.click=b.BiciHelpers.prependBiciReportClickAction(c.click,e,j);c.html=a.CommandBarHelper.createNavLinkElement(l,g);d=a.NavLink.create(c);var f=c.url;if(f&&f.indexOf("http")===0){var k=c.target||"_top";d._$a.attr("target",k)}sutra(d._$a,"$Sutra.SkyDrive."+h+"Command");i.push(d);return d},createNavLinkElement:function e(c,b){var a=jQuery(_ce("span"));if(b){a.append(wLive.Core.ImageStrip.getImage(b));a.append("&nbsp;"+c.encodeHtml())}else a.text(c);return a}}})();(function(){var b=wLive.Core,a=b.CommandManager,c=b.SkyDriveItemHelper,o=b.AleHelpers.getPCString,h='<ul class="c_m t_hovl"></ul>',i='<div class="c_mp co_me" style="position:absolute;"></div>',d='<span class="c_ms"></span>',k="contextmenu",n="visibility",p="visible",m=27;function e(d,b){return a.isCurrentItem(d,b)||c.isSearchResult(b)}function f(b,a){return c.isMruQuery(a)}function j(a){return a.currentViewType==="SetView"}var g={NestedDownload:a.commandDisabled,NestedShare:a.commandDisabled,NestedEmbed:a.commandDisabled,OpenFileLocation:e,Properties:a.isNotCurrentItem,Rename:j,SlideShow:a.commandDisabled,ViewInFolder:f,NestedDelete:a.isDeleteEnabled};wLive.Controls.ContextMenu=l;function l(r,j){var e=this,c,a,l=false,o,f;if(j){f=jQuery(j.selectionManager);f.bind(b.SelectionManager.SelectionChangedEvent,n)}e.render=function(t,m,n){o=n.ev;l=true;var x=m&&m.selectionCount;if(x===1)for(var z in m.indexes){var y=m.parent;t=y.getChildren().get(z);break}if(a){a.dispose();a=null}else j.itemScopedDisposables.push(e);if(c)c.remove();c=jQuery(i).appendTo(document.body);var s=n.pos;c.css({left:s.x,top:s.y});var f=jQuery(h).bind("keydown",q).bind(k,function(){return false});sutra(f,"$Sutra.SkyDrive.ContextMenu");function v(c,e){var d=e,a=b.ActionManager.setATagAction(c.action,null,n.bici,p);a.html(c.string.encodeHtml());sutra(a,"$Sutra.SkyDrive."+c.id+"Command");if(!$B.IE&&a instanceof jQuery)a.attr("tabindex",1);var f=jQuery("<li></li>").append(a).appendTo(d)}function u(h,g,f){var c=g,e=jQuery("<ul></ul>");f(e);var a=e.children(),b=c.children();if(a.length>1){if(b.length>0&&b.last().find(".c_ms").length===0)b.last().append(d);a.last().append(d)}c.append(a);c.append(a)}b.CommandManager.processCommands(j,t,m,g,v,u,null,f);var w=f.children();w.last().find(".c_ms").remove();c.append(f);var r=c.get(0);window.$menu.create(o,0,{menuEl:f.get(0),sourceEl:r,parentEl:document.body});a=r.menu};e.hide=function(){if(l){a&&a.hide();l=false}};e.dispose=function(){if(a){a.dispose();a=null}if(c)c.empty();f&&f.unbind(b.SelectionManager.SelectionChangedEvent,n)};function p(b,a){e.hide();return a(null,null,null,null,b.target)}function q(b){var a=b.which;if(a===m||a>36&&a<41){e.hide();return false}}function n(){e.hide()}}})();(function(){var g=wLive.Core.AleHelpers.getPCString;wLive.Controls.NotificationBar=e;var f=".NotificationBar",h=0,i='<div class="setNBContainer"><a class="setNBDismiss" href="#"></a><div class="setNBContent"></div></div>',c="setNBInfo",a="setNBWarning",b="setNBError",d=g("PPickerClosePicker");function e(m){var j=this,n=f+h++,e;m.html(i);var g=m.find(".setNBContainer").hide(),q=g.find(".setNBContent"),o=g.find(".setNBDismiss");o.bind("click"+n,p).html(wLive.Core.ImageStrip.getImage("close",d));j.dispose=function(){k();o.unbind(n)};j.bind=function(a){k();e=a;if(e)e.addListener("change",l)};j.render=function(e){if(e.getCount()){var d=e.get(0),f=d.type===0?b:d.type===1?a:c;q.html(d.content);g.removeClass(c+" "+a+" "+b).addClass(f).show()}else g.hide()};function k(){if(e)e.removeListener("change",l)}function l(){j.render(e)}function p(){if(e){e.clear();e.invalidate()}return false}}})();(function(){var a=window.wLive;a.Controls.EditableTextOptions=function(){};a.Controls.EditableTextOptions.prototype={n:"name",gdt:function(){},snp:false,v:function(){return "defaultValue"},g:true,c:false,ml:0,de:false,ca:"ClickAction",ac:"actionClass",ic:"inputClass",ec:"editClass",gem:function(){},"get":function(){},sc:function(){},aa:"authAction",ea:"editAction"}})();(function(){wLive.Core.ActionManager.Action=a;function a(){}wLive.Core.ActionManager.Action.prototype={skyCmd:"",target:"",string:"",click:function(){},getActionTemplate:function(){},url:"",name:"",altNames:[],requiresRedemption:true,officeUpsell:true}})();(function(){wLive.Core.ActionManager.ActionCreator=a;function a(){}wLive.Core.ActionManager.ActionCreator.prototype={getAction:function(){}}})();(function(){window.wLive.Core.OfficeAccess=function(){};window.wLive.Core.OfficeAccess.prototype={CanUpsellTo:true}})();wLive.Core.SoftBlockEnum={MoveAction:0,RenameAction:1,DeleteAction:2};(function(){var a=wLive.Core,b;a.ActionHelpers={canPlayHtml5Audio:function(){var a=a||document.createElement("audio");return a.canPlayType},showMusicError:function(){var a=wLive.Controls.Notifications,b;$Do.when("Bucket3.js",0,function(){var d={buttons:{action:wLive.Core.AleHelpers.getPCString("CloseCommand")},title:GetString("Live.Shared.Skydrive.Music.PopoverHeader"),content:GetString("Live.Shared.Skydrive.Music.PopoverBody")},c=a.createModalDialog(d),b=jQuery(c);b.bind({"aftershow._dlg":function(){sutra(jQuery(".ModalDialog"),"$Sutra.SkyDrive.MusicErrorPopover");sutra(jQuery("button[name='action']"),"$Sutra.SkyDrive.MusicErrorCloseButton")},"afterdismiss._dlg":function(){b&&b.unbind("._dlg");b=null;c=null},"buttonclick._dlg":function(){c.dismiss()}});c.show()})}}})();(function(){var c=wLive.Core,l=wLive.Controls,a=c.AleHelpers.getPCString,db=c.AleHelpers.getString,I="m_wh",h=c.ItemActionHelper,r=c.SkyDriveItemHelper,fb=$B.SF_iPhone&&!$B.Mobile,Sb="SelfView",bc="click",G="/upload.aspx/?{cidQueryString}&ref=1{resIdQueryString}",Vb="/redir.aspx?{cidQueryString}{resIdQueryString}",X="/view.aspx?{cidQueryString}{resIdQueryString}{appQueryString}",W="/edit.aspx?{cidQueryString}{resIdQueryString}{appQueryString}",Hb="/edit.aspx?{cidQueryString}{resIdQueryString}{appQueryString}&nd=1",Bb="/edit.aspx?{cidQueryString}{resIdQueryString}{appQueryString}&formAction=1",qb="/edit.aspx?{cidQueryString}{resIdQueryString}{appQueryString}&formAction=2",ob="/edit.aspx?{cidQueryString}{resIdQueryString}{appQueryString}&formAction=3",s="{item.urls.download}",v=".aspx?{cidQueryString}{resIdQueryString}&canary={FilesConfig.canary:encodeURIComponent}",nb="/downloadfolder"+v,Nb="/download"+v,j="https://"+location.host,ac="http://"+location.host,u="/feed.aspx?{cidQueryString}{resIdQueryString}",gb="/changefolderexpiration.aspx?cid={item.ownerCid}{resIdQueryString}",S="/choosefolder.aspx?{cidQueryString}&ref=5",ab="",ub="FilePickerView",F=null,E=null;function b(){if(!F)F=c.PageController.getInstance().getViewContext();return F}function g(){if(!E)E=l.Notifications;return E}var z,C,x=true,Mb=!!(navigator.mimeTypes&&navigator.mimeTypes["application/x-wlpg3-detect"]||window.$WlpgWave3Installed),Lb=!!(navigator.mimeTypes&&navigator.mimeTypes["application/x-wlpg-detect"]||window.$WlpgWave2Installed),Jb=a("PhotoGalleryUpgradeTextPart1"),Kb=a("PhotoGalleryUpgradeTextPart2"),O=FilesConfig.wlpgDownloadGlinkUrl,t="DO",Y="RA",n="DEL",d="OO",Ub="C",pb="CTS",bb="M",e="DC",Gb="NW",Ab="NE",lb="NX",jb="NP",tb="NO",y="NF",U="AF",R="AP",xb="RD",vb="Excel",w="OneNote",ib="PowerPoint",Db="Word",wb="Visio",rb="Project",kb="Publisher",Cb="Moorea",Ib=".one",Q="w",N="x",mb="f",K="p",M="n";function V(){return jQuery('<iframe src="'+FilesConfig.iFrameEmptyUrl.encodeHtmlAttribute()+'"></iframe>').hide().appendTo(document.body)}function k(c,b,e,d){Eb(b);var a=h.itemStringFormat(c,b,e,d);if($B.Mobile)$BSI.navigateTo(a,"_top");else{if(!C)C=V();C.attr("src",a)}}function Qb(d){if(d.isSpecialFolder&&d.sharingLevelValue!==0){var e={buttons:{action:a("Sharing.SpecialFolder.Button")},content:jQuery("<p>"+a("Sharing.SpecialFolder.Msg1")+"</p><p>"+a("Sharing.SpecialFolder.Msg2").format('<a class="sdi_s" href="#" onclick="return false">',"</a>")+"</p>"),title:a("Sharing.SpecialFolder.Header")},b=(new g).createModalDialog(e),c=jQuery(b);c.bind({"aftershow._dlg":function(){jQuery("div.ModalDialog .sdi_s").click(function(){L(d);b.dismiss()})},"afterdismiss._dlg":function(){c&&c.unbind("._dlg");c=null;b=null},"buttonclick._dlg":function(){b.dismiss()}});b.show()}else L(d)}function L(i){var e=jQuery('<div class="sd_pop_wrapper"></div>'),a=g().createModalDialog({content:e[0]});function f(){a&&a.dismiss();a=null}function h(){a&&a.reposition()}var d=jQuery(a);d.bind({"aftershow._dlg":function(){var d=new c.PermissionsProvider(b().callerCid),g=new l.ShareDialog(e,d,i,f,h);g.render();jQuery(".UserArea").on("click",".sd_cancel",function(){f()});a.reposition()},"afterdismiss._dlg":function(){jQuery(".ModalDialog").unbind("onclose._dlg");d&&d.unbind("._dlg");d=null;a=null}});a.show()}function p(b,c){$Do.wE("Bucket3.js",0,function(){var e=window.FilesConfig.recycleBinEnabled,f=e&&!r.isViewerOwner(b),i=e&&!!r.isRecycleBinQuery(b);if(e&&!i&&!f)Z(b);else{_dlg=g().createFlyout({buttons:{action:a("DeleteCommand")},title:a(f?"DeleteSharedSingleItemPromptTitle":"DeletePromptTitle"),content:a(f?"DeleteSharedSingleItem":"DeletePromptSingleItem").format(b.name.encodeHtml()),anchor:c||_ge(I)});var d=jQuery(_dlg);d.bind({"aftershow._dlg":function(){var a=jQuery(_dlg.content());sutra(a,"$Sutra.SkyDrive.DeleteMsgBoxContainer");var b=_dlg.getButton({buttonName:"action"});sutra(b,"$Sutra.SkyDrive.DeleteMsgBoxOkBtn");sutra(jQuery(".UserArea",a),"$Sutra.SkyDrive.DeleteMsgBoxBody");a.find(".UserContent").css({"text-overflow":"ellipsis",width:"456px"})},"afterdismiss._dlg":function(){d&&d.unbind("._dlg");d=null;_dlg=null},"buttonclick._dlg":h});_dlg.show()}function h(d,c,a){if(a==="action")Z(b)}})}function J(f){var h=b(),a=h.dataModel,e=null,k=true,l=h.currentViewType==Sb,d=a.getIndexOfChild(f.parentKey,f,true);if(d>=0){var c=a.getItem(f.parentKey,true);if(c){k=false;e=c;var i=a.getChildCount(c);if(i>1&&l){var g=d<i-1?d+1:d-1;if(g>=0){var j=a.getChildByIndex(c,g,true);if(j)e=j}}}}return e}function Z(d){var a=J(d),e={};if(r.isRecycleBinQuery(d))e.deleteModifier=3;else e.deleteModifier=2;c.OperationManager.Current.execute("Delete",{items:[d],targetItem:d.getParent(true),options:e});var g=b();if(a&&g.viewParams.id!=a.id){var f=h.itemStringFormat("#{cidQueryString}"+(a?"{idQueryString}":"")+"{scenario}",a);$BSI.navigateTo(f)}}function Tb(p,r){var k=415,i=210,b=_ce("iframe"),f=jQuery(b).attr({id:"orderPrints_iframe",scrolling:"auto",frameborder:"0",width:k,height:i,src:p}).addClass("op_hidden"),j,s,a={width:k,height:i},h=false,n=jQuery('<div id="op_host"/>'),d=jQuery('<div id="op_loading"/>');if(b.attachEvent)b.attachEvent("onload",m);else b.onload=m;var c=g().createFlyout({content:n,anchor:r||_ge(I)}),e=jQuery(c),o=jQuery(document);function m(){d.empty();f.removeClass("op_hidden").slideDown();jQuery("button",f).focus();if(b&&b.contentWindow){var e=b.contentWindow.$f;if(e){a.height=e.docHeight()||a.height;a.width=e.docWidth()||a.width;b.height=a.height.toString();b.width=a.width.toString();c&&c.reposition();h=true}}}var q=new l.LoadingSpinner(d);q.render();d.show();n.append(d).append(f);e.bind({"aftershow.fly":function(){$Do.when("$f",0,function(){j=setInterval(function(){if(b&&b.contentWindow&&h){var e=a.height,f=a.width,d=b.contentWindow.$f;if(d&&typeof d.docHeight==="function")e=d.docHeight();if(d&&typeof d.docWidth==="function")f=d.docWidth();if(a.height!==e||a.width!==f){a.height=e;a.width=f;b.height=a.height.toString();b.width=a.width.toString();c&&c.reposition()}}},200)});o.bind("onFlyoutClose",function(){clearInterval(j);c.dismiss()})},"afterdismiss.fly":function(){o.unbind("onFlyoutClose");e&&e.unbind("._dlg");e=null;c=null}});c.show();$menu.closeAll()}function Fb(b,j){var f=' checked="checked"',e=b&&b.folder&&b.folder.category==1,k='<div><div><input type="radio" name="folderType" id="folderTypeDocuments"'+(!e?f:"")+'/><label for="folderTypeDocuments">'+a("InfoPane.Information.FolderTypeDocuments").encodeHtml()+"</label>"+"</div>"+"<div>"+'<input type="radio" name="folderType" id="folderTypePhotos"'+(e?f:"")+'/><label for="folderTypePhotos">'+a("InfoPane.Information.FolderTypePhotos").encodeHtml()+"</label>"+"</div>"+ +"</div>",h=jQuery(k),d=g().createFlyout({buttons:{action:a("SaveCommand")},title:a("ChangeFolder.Title").encodeHtml(),content:h,anchor:j||_ge(I)}),c=jQuery(d),i=jQuery(document);c.bind({"aftershow.fly":function(){i.bind("onFlyoutClose",function(){d.dismiss()})},"afterdismiss.fly":function(){i.unbind("onFlyoutClose");c&&c.unbind("._dlg");c=null;d=null},"buttonclick._dlg":function(f,e,d){if(d==="action"){var c=b.folder.category,a=h.find("#folderTypeDocuments").attr("checked")?0:1;if(c!=a){b.folder.category=a;b.invalidate();b.updateItemProperties({cid:b.ownerCid,category:a},function(){b.folder.category=a;b.invalidate();b.expire()},function(){b.folder.category=c;b.invalidate()})}}}});d.show();$menu.closeAll()}function i(a,j,d,c,i){var e=h.itemStringFormat("/ResourceToUrl/?{cidQueryString}{resIdQueryString}&oc={item.ownerCid}&ct="+(d||a.group?"Group":"None"),a,j,d),f={url:e,isDavUrl:false,fileName:a.name,appType:c,extension:c==w?Ib:a.extension,item:a,notifications:g()};if(!i)$Do.wE("Bucket3.js",0,function(){window.OfficeClient.executeOpenInClient(f,b().errorManager)});else $Network.fetchXML(e+"&r="+Math.random(),function(a){var b;if(a==null||a.responseText==null||(b=Object.fromJSON(a.responseText))==null)$WebWatson.submit("Failed fetching dav url on mobile client","Mobile Skydrive Files Page","0");else $BSI.navigateTo("onenote:"+decodeURIComponent(b.Url))},"GET",null)}function Rb(a){$Do.wE("Bucket3.js",0,function(){var d,c=b().actionManager,e=c.getAction("OpenInOffice",a);if(window.OfficeClient.isOfficeInstalled())d=e;else d=c.getAction("EditBrowser",a)||c.getAction("ViewBrowser",a)||e;c.doAction(d)})}function m(f,e,g,h){var d=b(),a="",i=g?" at the root level":" in a subfolder",j=e.group?" for a group":"";switch(f){case Q:a="Word doc";break;case N:a="Excel spreadsheet";break;case K:a="PowerPoint presentation";break;case M:a="OneNote notebook"}$Do.wE("Bucket3.js",0,function(){var a=new c.NewDocumentCommand(d,e);d.itemScopedDisposables.push(a);a.execute(f,h)})}function T(d,e){if(!c.ActionHelpers.canPlayHtml5Audio()){c.ActionHelpers.showMusicError();return false}var a=c.SkyDriveItemHelper.getSongForPlayer(d);if(a){var b=[a];$Do.wE("MusicPlayer",0,function(){var a=wLive.Controls.MusicPlayer;a.display();a.getPlaylist().append(b,e)})}return false}function H(d,e){$Do.wE("Bucket3.js",0,function(){$Do.wE("Bucket4.js",0,function(){var i;try{var j=new c.PermissionsProvider(b().callerCid);i=new l["Embed"](j)}catch(n){var k=a("Embed.PopoverError");b().errorManager.add({$element:jQuery("<span>"+k.encodeHtml()+"</span>"),priority:1,type:0,error:"embedPopover"})}if(d.isSpecialFolder&&d.sharingLevelValue!==0){var m={buttons:{action:a("Embed.SpecialFolder.Button")},content:jQuery("<p>"+a("Embed.SpecialFolder.Msg1")+"</p><p>"+a("Embed.SpecialFolder.Msg2").format('<a class="edi_e" href="#" onclick="return false">',"</a>")+"</p>"),title:a("Embed.SpecialFolder.Header")},f=(new g).createModalDialog(m),h=jQuery(f);h.bind({"aftershow._dlg":function(){jQuery("div.ModalDialog .edi_e").click(function(){i["show"](d,true,e);f.dismiss()})},"afterdismiss._dlg":function(){h&&h.unbind("._dlg");h=null;f=null},"buttonclick._dlg":function(){f.dismiss()}});f.show()}else i["show"](d,true,e)})});return false}function eb(c,a){$Do.wE("Bucket3.js",0,function(){var c=l["PdfViewPluginCheck"];c.notifications=g();c(a,false,function(){var c=b().actionManager;c.doAction(c.getAction("ViewItem",a))})});return false}function cb(c,b,e,d,a){return B(c,b,"Move",a)}function Wb(c,b,e,d,a){return B(c,b,"Copy",a)}function zb(c,b,e,d,a){return B(c,b,"CopyToSkyDrive",a)}function B(f,e,a,d){$Do.wE("Bucket3.js",0,function(){var f=b(),g=new c.MoveCopyCommand(f,a,d);f.itemScopedDisposables.push(g);g.execute(e)});return false}function Pb(d,a){$Do.wE("Bucket3.js",0,function(){jQuery(b()).trigger(Y);var d=b(),e=new c.ReportAbuseCommand(d,a);d.itemScopedDisposables.push(e);e.execute()});return false}function Ob(c){$Do.when("Bucket3.js",0,function(){var f=b().deviceItemSet,e=f.getByKey(c.did.toLowerCase()),j=b(),i={buttons:{action:a("RemoveDevice.DisconnectButtonText"),close:a("CancelCommand")},title:a("RemoveDevice.ConfirmTitle").format(e.name).encodeHtml(),content:a("RemoveDevice.ConfirmText1").format(e.name).encodeHtml()+"<br/><br/>"+a("RemoveDevice.ConfirmText2").encodeHtml()};_dlg=g().createModalDialog(i);var d=jQuery(_dlg);d.bind({"aftershow._dlg":function(){var a=jQuery(_dlg.content());sutra(a,"$Sutra.SkyDrive.RemoveDeviceConfirmation");sutra(_dlg.getButton({buttonName:"action"}),"$Sutra.SkyDrive.RemoveDeviceOKButton");sutra(_dlg.getButton({buttonName:"close"}),"$Sutra.SkyDrive.RemoveDeviceCancelButton")},"afterdismiss._dlg":function(){d&&d.unbind("._dlg");d=null;_dlg=null},"buttonclick._dlg":h});_dlg.show();function h(c,b,a){if(a==="action")f.remove(e)}})}function A(f,d){var c=b();if(!c.pendingFolderToCreate){var a=c.pendingFolderToCreate=d.createPinnedSubfolder();a._fromCreateFolderAction=true;d.invalidate();jQuery(b()).trigger("Rename",{key:a.key,isNewFolder:true})}return false}function q(b,a){return function c(g,d,e,c,f){if(b)$BSI.navigateTo(h.itemStringFormat(b,d,e,c));else if(a)a(g,d,e,c,f);return false}}function o(){var a=fb&&$B.V<6;return !a}function f(c,a){return !(b().currentViewType==ub&&!a.folder)}function P(b,e,f,d){var a=j+"?{cidQueryString}{idQueryString}&action="+b;a=h.itemStringFormat(a,e,f,d);var c=FilesConfig.signInUrl+"&ru="+a.encodeUrl()+"&wreply="+a.encodeUrl();$BSI.navigateTo(c,"_top")}var D={Abdicate:{name:"ab",1:{skyCmd:"AB",click:function(d,a){c.PopoverManager.showPopover("AbdicatePopover",{items:[a]});return false}}},ViewVersions:{name:"vv",1:{skyCmd:"VRS",url:Vb+"&page=versions",requiresRedemption:true}},Share:{name:"sh",1:{skyCmd:"SH",click:function(b,a){$Do.wE("Bucket3.js",0,function(){$Do.wE("wLive.Controls.ShareDialog",0,function(){$Do.wE("Bucket3.css",0,function(){Qb(a)})})});return false},check:function(){return !b().viewParams.group}}},SendSurvey:{name:"sf",1:{skyCmd:"FS",click:function(e,d){var a;$Do.wE("Bucket3.js",0,function(){$Do.wE("Bucket4.js",0,function(){var e=new c.PermissionsProvider(b().callerCid);a=new l.SendForm(e);a.show(d)})});return false}}},PreviewSurvey:{name:"pf",1:{skyCmd:"FP",url:qb}},EditSurvey:{name:"ef",1:{skyCmd:"FE",url:ob}},ChangeExpiration:{name:"ce",1:{url:gb}},Feed:{name:"fe",1:{url:j+u+ab},2:{url:j+u},3:{url:j+u+ab},4:{url:j+u}},Embed:{name:"em",1:{skyCmd:"EM",click:function(b,a){return H(a,false)}},2:{skyCmd:"EM",click:function(b,a){return H(a,true)}},3:{skyCmd:"EM",click:function(b,a){return H(a,false)}}},Download:{name:"dl",1:{skyCmd:t,click:function(d,a){b().operationManager.execute("DownloadAsZip",{items:[a]});return false}},2:{skyCmd:t,click:function(d,b,c,a){k(Nb,b,c,a);return false}},3:{skyCmd:t,click:function(d,b,c,a){k(s,b,c,a);return false}},4:{skyCmd:t,click:function(d,b,c,a){P("Download",b,c,a);return false}}},ReportAbuse:{name:"ra",1:{skyCmd:"RA",click:function(e,a){var c="showReportAbusePopover",b="hideReportAbusePopover";Pb("reportAbuse",a);return false}}},Delete:{name:"de",1:{skyCmd:n,click:function(d,b,e,c,a){p(b,a);return false}},2:{skyCmd:n,click:function(d,b,e,c,a){p(b,a);return false},requiresRedemption:true},3:{skyCmd:n,click:function(d,b,e,c,a){p(b,a);return false}},4:{skyCmd:n,click:function(d,b,e,c,a){p(b,a);return false},requiresRedemption:true},5:{skyCmd:n,click:function(d,b,e,c,a){p(b,a);return false},requiresRedemption:true}},SaveSort:{name:"sds",1:{skyCmd:"SS",click:function(){return false}}},Arrange:{name:"ar",1:{skyCmd:"R",url:"#{cidQueryString}{idQueryString}{deviceIdQueryString}{scenario}&v=arrange",check:function(){return !fb}}},ViewOrginal:{name:"vo",1:{skyCmd:"VO",url:"{item.urls.open}",target:"_blank"}},ViewBrowser:{name:"vb",1:{skyCmd:"VB",url:X,officeUpsell:true}},PdfViewBrowser:{name:"vb",2:{skyCmd:"VB",click:eb}},EditBrowser:{name:"eb",1:{skyCmd:"EB",url:W,requiresRedemption:true,officeUpsell:true}},EditBrowserNew:{name:"eb",1:{skyCmd:"EB",url:Hb}},EditFormNew:{name:"eb",1:{skyCmd:"FE",url:Bb}},FileAbuseReport:{name:"fab",1:{skyCmd:Y,click:function(){alert("Make API call to /2/ReportAbuse");return false}}},OpenInExcel:{name:"oo",1:{skyCmd:d,click:function(d,b,c,a){i(b,c,a,vb);return false},requiresRedemption:true}},OpenInOneNote:{name:"oo",2:{skyCmd:d,click:function(d,b,c,a){i(b,c,a,w);return false},requiresRedemption:true}},OpenInPowerPoint:{name:"oo",3:{skyCmd:d,click:function(d,b,c,a){i(b,c,a,ib);return false},requiresRedemption:true}},OpenInWord:{name:"oo",4:{skyCmd:d,click:function(d,b,c,a){i(b,c,a,Db);return false},requiresRedemption:true}},OpenInVisio:{name:"oo",5:{skyCmd:d,click:function(d,b,c,a){i(b,c,a,wb);return false},requiresRedemption:true}},OpenInProject:{name:"oo",6:{skyCmd:d,click:function(d,b,c,a){i(b,c,a,rb);return false},requiresRedemption:true}},OpenInPublisher:{name:"oo",7:{skyCmd:d,click:function(d,b,c,a){i(b,c,a,kb);return false},requiresRedemption:true}},OpenInExpo:{name:"oo",8:{skyCmd:d,click:function(d,b,c,a){i(b,c,a,Cb);return false},requiresRedemption:true}},OpenInOffice:{name:"oo",1:{skyCmd:d,click:function(e,c,d,a){return b().actionManager.getAction("OpenInExcel",c,d,a).click()},requiresRedemption:true},2:{skyCmd:d,click:function(e,c,d,a){return b().actionManager.getAction("OpenInOneNote",c,d,a).click()},requiresRedemption:true},3:{skyCmd:d,click:function(e,c,d,a){return b().actionManager.getAction("OpenInPowerPoint",c,d,a).click()},requiresRedemption:true},4:{skyCmd:d,click:function(e,c,d,a){return b().actionManager.getAction("OpenInWord",c,d,a).click()},requiresRedemption:true},5:{skyCmd:d,click:function(e,c,d,a){return b().actionManager.getAction("OpenInVisio",c,d,a).click()},requiresRedemption:true},6:{skyCmd:d,click:function(e,c,d,a){return b().actionManager.getAction("OpenInProject",c,d,a).click()},requiresRedemption:true},7:{skyCmd:d,click:function(e,c,d,a){return b().actionManager.getAction("OpenInPublisher",c,d,a).click()},requiresRedemption:true},8:{skyCmd:d,click:function(e,c,d,a){return b().actionManager.getAction("OpenInExpo",c,d,a).click()},requiresRedemption:true}},OrderPrints:{name:"op",1:{skyCmd:"OP",click:function(d,b,e,c,a){Tb(h.itemStringFormat(j+"/orderprints.aspx?{cidQueryString}{resIdQueryString}",b),a);return false}}},AddTag:{name:"at",1:{click:function(d,c){var a=b();jQuery(a).trigger("enableTagging",[c.key]);return false},requiresRedemption:true}},Rename:{name:"rn",1:{skyCmd:"RN",click:function(d,c){var a=b();jQuery(a).trigger("Rename",{key:c.key});return false},requiresRedemption:true}},ModifyCaption:{name:"mc",1:{click:function(){return false}}},ChangeFolderType:{name:"cft",1:{click:function(d,b,e,c,a){Fb(b,a);return false}}},Copy:{name:"cp",1:{skyCmd:Ub,click:q(null,Wb)},"-2":{click:function(){$Do.wE("Bucket3.js",0,function(){$Do.wE("Bucket3.css",0,function(){var c={buttons:{action:a("Close")},title:a("CopyFileSizeLimitError.Header"),content:a("CopyFileSizeLimitError.BodyLine1").format(FilesConfig.maxCopyFileSize).encodeHtml()+"<br/><br/>"+a("CopyFileSizeLimitError.BodyLine2").encodeHtml()};_dlg=g().createModalDialog(c);var b=jQuery(_dlg);b.bind({"aftershow._dlg":function(){jQuery(".InnerContainer").width(400)},"afterdismiss._dlg":function(){b&&b.unbind("._dlg");b=null;_dlg=null}});_dlg.show()})});return false}}},Move:{name:"mv",1:{skyCmd:bb,click:q(null,cb)},3:{skyCmd:bb,click:q(null,cb)}},CopyToSkyDrive:{name:"cts",1:{skyCmd:pb,click:q(null,zb)}},DefaultClick:{name:"defc",1:{skyCmd:e,url:"#{cidQueryString}{idQueryString}{deviceIdQueryString}{scenario}{searchParams}{viewQueryString}",name:"ViewItem",check:f},2:{skyCmd:e,url:W,name:"EditBrowser",requiresRedemption:true,officeUpsell:true,check:f},3:{skyCmd:e,url:X,name:"ViewBrowser",officeUpsell:true,check:f},4:{skyCmd:e,click:function(i,c,f,e){if(c.isProcessingVideo&&$B.Full){var d=g().createModalDialog({title:db("Video.BeingProcessedHeader"),buttons:{action:a("DownloadCommand"),close:a("Cancel")},content:db("Video.BeingProcessedMessage")}),b=jQuery(d);b.bind({"afterdismiss._dlg":function(){b&&b.unbind("._dlg");b=null;d=null},"buttonclick._dlg":function(d,b,a){if(a=="action")k(s,c,f,e);return true}});d.show()}else k(s,c,f,e);return false},name:"Download",check:f},5:{skyCmd:e,click:function(c,a){$BSI.navigateTo(a.urls.favorite,"_blank");return false}},6:{skyCmd:e,click:function(d,b,c,a){i(b,c,a,w,true);return false},requiresRedemption:true,check:f},7:{skyCmd:e,click:function(d,b,c,a){k(nb,b,c,a);return false},check:f},8:{skyCmd:e,click:function(c,a){T(a,true);return false},name:"Play",check:f},9:{skyCmd:e,click:function(c,a,d,b){if($B.Mobile)k(s,a,d,b);else eb(c,a);return false},url:"#{cidQueryString}{idQueryString}{deviceIdQueryString}{scenario}",name:"PdfViewBrowser",check:f},10:{skyCmd:e,click:function(c,a){Rb(a);return false},name:"OpenInOffice",altNames:["OpenInExcel","OpenInOneNote","OpenInPowerPoint","OpenInWord","OpenInVisio","OpenInProject","OpenInPublisher","OpenInExpo"],check:f},11:{skyCmd:e,click:function(d,b,c,a){P("DefaultClick",b,c,a);return false},name:"Download",check:f},12:{skyCmd:e,click:function(){return false},name:"Select",check:f}},CreateWord:{name:"cdoc",1:{skyCmd:Gb,click:function(d,b,e,c,a){m(Q,b,true,a);return false},requiresRedemption:true}},CreateExcel:{name:"cxls",1:{skyCmd:Ab,click:function(d,b,e,c,a){m(N,b,true,a);return false},requiresRedemption:true}},CreateExcelForm:{name:"cxlsf",1:{skyCmd:lb,click:function(d,b,e,c,a){m(mb,b,false,a);return false},requiresRedemption:true}},CreatePowerPoint:{name:"cppt",1:{skyCmd:jb,click:function(d,b,e,c,a){m(K,b,true,a);return false},requiresRedemption:true}},CreateOneNote:{name:"con",1:{skyCmd:tb,click:function(d,b,e,c,a){m(M,b,true,a);return false},requiresRedemption:true}},CreateFolder:{name:"cf",1:{skyCmd:y,requiresRedemption:true,click:A}},CreateAlbum:{name:"cf",1:{skyCmd:y,requiresRedemption:true,click:A},2:{skyCmd:y,requiresRedemption:true,click:A}},AddFiles:{name:"up",1:{skyCmd:U,url:S,requiresRedemption:true,check:o},2:{skyCmd:U,url:G,requiresRedemption:true,check:o}},AddPhotos:{name:"up",1:{skyCmd:R,url:S+"&sc=photos",requiresRedemption:true,check:o},2:{skyCmd:R,url:G+"&IsPhotoUpload=1",requiresRedemption:true,check:o}},Upload:{name:"up",1:{url:G,requiresRedemption:true,check:o}},RemoveDevice:{name:"rd",1:{skyCmd:xb,click:function(b,a){Ob(a);return false}}},AddComment:{name:"cm",2:{url:"#"}},EmailPublishing:{name:"epb",1:{url:"emailpublishing?cid={item.ownerCid}"}},GroupInvite:{name:"ginv",1:{skyCmd:"GIP",url:"{profileDomain}cid-{cid:encodeURIComponent}/invite"}},GroupMembership:{name:"gmv",1:{url:"{profileDomain}cid-{cid:encodeURIComponent}/membership"}},GroupOptions:{name:"gop",1:{url:"{profileDomain}cid-{cid:encodeURIComponent}/options"}},GroupProfile:{name:"gpr",1:{skyCmd:"GVP",url:"{profileDomain}cid-{cid:encodeURIComponent}"}},GroupSendMail:{name:"gsem",1:{url:FilesConfig.groupMailUrl.format("{groupEmail}")}},GroupViewMail:{name:"geh",1:{url:FilesConfig.groupMailSearchUrl.format("{groupEmail}")}},Play:{name:"pl",1:{click:function(c,a){T(a,true);return false}}},Restore:{name:"rst",1:{click:function(){return false}}}};function Eb(a){var b="Document",c=a&&a.did?"Devices":"SkyDrive";if(a)if(a.video)b="Movie";else if(a.photo)b="Photo";$BSI.reportEvent("Download.Content.File."+b,{DocsContentSource:c})}function hb(d,a){if(!a._commands)if(a.commands){var c=a.commands.split(",");a._commands={};for(var b=0;b<c.length;b+=2)a._commands[c[b]]=c[b+1]}else return null;return a._commands[d]}var yb={getAction:function(f,d,k,j,i){var a=null,m=D[f],n=m.name,l=hb(n,d);if(l){var g=m[l];if(g&&(!g.check||g.check(f,d,k,j))){a=jQuery.extend({},g);a.name=a.name||f;if(a.url)a.url=h.itemStringFormat(a.url,d,k,j);var e=a.click;a.click=function(m){var g=true,l;if(arguments&&arguments.length===5)l=arguments[4];i=i||m?m.target:l;function h(){var b=e&&e(f,d,k,j,i)||!e;if(b&&a.url)$BSI.navigateTo(a.url)}var n=window["officeAccess"];if(!$B.Mobile&&a.requiresRedemption&&d.tokenNeedsRedeeming&&!b().tokenHasBeenRedeemed){c.PopoverManager.showPopover("TicketRedeemer",{authkey:FilesConfig.authKey,item:d,action:a,callback:h});g=false}else if(!$B.Mobile&&a.officeUpsell&&r.isViewerOwner(d)&&(n.CanUpsellTo&&FilesConfig.enableOfficeBetaUpsell||FilesConfig.testFeatures)){c.PopoverManager.showPopover("OfficeUpsell",{callback:h});g=false}else if(e)g=e(f,d,k,j,i);return g}}}return a}};c.SkyDriveItemHelper._jsonApiActions=D;c.SkyDriveItemHelper.registerJsonApiActions=sb;function sb(b,a){a=a||D;for(var c in a)b.actionManager.registerAction(c,yb)}})();(function(){var c=wLive.Core,i=c.SkyDriveItemHelper,b=null;function a(){if(!b)b=c.PageController.getInstance().getViewContext();return b}var d="#{cidQueryString}{idQueryString}{scenario}{deviceIdQueryString}{searchParams}",e=d+"{viewQueryString}",f={SkyDriveRoot:{url:"#{cidQueryString}"},DevicesView:{url:"#v=DevicesView"},OpenInExcelWebApp:{getTemplate:function(e,c){var b=a().actionManager;return b.getAction("OpenInExcel",c)&&b.getAction("DefaultClick",c)}},OpenInOneNoteWebApp:{getTemplate:function(e,c){var b=a().actionManager;return b.getAction("OpenInOneNote",c)&&b.getAction("DefaultClick",c)}},OpenInPowerPointWebApp:{getTemplate:function(e,c){var b=a().actionManager;return b.getAction("OpenInPowerPoint",c)&&b.getAction("DefaultClick",c)}},OpenInWordWebApp:{getTemplate:function(e,c){var b=a().actionManager;return b.getAction("OpenInWord",c)&&b.getAction("DefaultClick",c)}},OpenInPdfWebApp:{getTemplate:function(d,b){return a().actionManager.getAction("PdfViewBrowser",b)}},SlideShow:{click:function(){jQuery(a()).trigger("slideshow");return false}},ViewItem:{url:e},ViewItemWithoutView:{url:d},ViewInFolder:{check:function(c,a){return a.isQt("mru")},url:e},OpenFileLocation:{url:"#{cidQueryString}{parentIdQueryString}"},CreatorProfileUrl:{url:"{profileDomain}cid-{item.creatorCid:encodeURIComponent}"},CreateGroup:{skyCmd:"gcr",url:"{groupsDomain}home/create/"},TwoFactorAuth:{skyCmd:"TFA",target:"_top",url:"#"},OfficeLearnMore:{skyCmd:"LM",url:"http://g.live.com/8SESkydrive/DocsLearnMore"},Properties:{check:function(c,a){return a&&!a._isLoadingItem},click:function(){wLive.Controls.InfoPane.clickOrigin="property";jQuery(a()).trigger("toggleProperties");wLive.Controls.InfoPane.clickOrigin=null;return false}},Deselect:{check:function(){return a().selectionManager.getSelection().selectionCount!==0},click:function(){var b=a().selectionManager;b.deselectAll(b.getSelection().parent);return false}},ViewMyDocs:{url:"#sc=documents"},ViewMyPhotos:{url:"#sc=photos"},ViewRecentDocs:{url:"#qt=mru"},ViewSharedDocs:{url:"#qt=shared"},ViewRecycleBin:{url:"#qt=recyclebin"},ViewGroup:{url:"#{cidQueryString}"},GroupView:{url:"#v=GroupView"}},h={getAction:function(e,d,g,c){var a=f[e];if(a&&a.getTemplate)a=a.getTemplate(e,d,g,c);if(a&&(!a.check||a.check(e,d,g,c))){var b=jQuery.extend({},a);if(b.url)b.url=wLive.Core.ItemActionHelper.itemStringFormat(b.url,d,g,c);var h=b.click;b.click=function(){if(h)return h(e,d,g,c)};return b}else return null}};c.SkyDriveItemHelper.registerLinkActions=g;function g(a){for(var b in f)a.actionManager.registerAction(b,h)}})();(function(){var a=wLive.Core,g=a.AleHelpers.getPCString,n=a.SkyDriveItemHelper,f=null,l=a.ItemActionHelper;function b(){if(!f)f=a.PageController.getInstance().getViewContext();return f}var e=null;function k(){if(!e)e=wLive.Controls.Notifications;return e}function h(d,j){if(!a.ActionHelpers.canPlayHtml5Audio()){a.ActionHelpers.showMusicError();return false}var f,h=b(),g=false,e=[],c;for(var l in d.indexes){var m=d.indexes[l],i=h.dataModel.getChildByIndex(d.parent,m);if(i){var k=a.SkyDriveItemHelper.getSongForPlayer(i);if(k)e.push(k)}else{f=l;g=true;break}}$Do.when("MusicPlayer",0,function(){var a=wLive.Controls.MusicPlayer;if(e.length>0){a.display();a.getPlaylist().append(e,j);c=true}});if(g)h.selectionManager.getSelectedItems(function(d){var b=[];for(var g in d)if(g>=f){var h=d[g],e=a.SkyDriveItemHelper.getSongForPlayer(h);if(e)b.push(e)}$Do.when("MusicPlayer",0,function(){var a=wLive.Controls.MusicPlayer;if(!c)a.display();a.getPlaylist().append(b,!c&&j)})});return false}var d={Abdicate:{name:"ab",click:function(){var c=b();c.selectionManager.getSelectedItems(function(b){a.PopoverManager.showPopover("AbdicatePopover",{items:b});return false});return false}},Deselect:{name:"ds",click:function(a){b().selectionManager.deselectAll(a.parent);return false},check:function(){return true}},Download:{click:function(){var a=b();a.selectionManager.getSelectedItems(function(c){var f=c[0].getParent(),e=0;for(var d=0;d<c.length;d++)e+=parseInt(c[d].size);if(FilesConfig.hcid=="UnAuth"&&e>FilesConfig.maxAnonDownloadSize){var b="https://"+location.host+"?{cidQueryString}{idQueryString}";b=l.itemStringFormat(b,f);var g=FilesConfig.signInUrl+"&ru="+b.encodeUrl()+"&wreply="+b.encodeUrl();$BSI.navigateTo(g,"_top")}else a.operationManager.execute("DownloadAsZip",{items:c})});return false},check:function(a){return c("Download",a,function(a){return !a.did})}},Play:{name:"pl",click:function(a){h(a,true);return false}},AddToQueue:{name:"atq",click:function(a){h(a,false);return false}},Move:{click:function(c,d){$Do.when("Bucket3.js",0,function(){var e=b(),f=new a.MoveCopyCommand(e,"Move",d);e.itemScopedDisposables.push(f);f.execute(null,c)});return false},check:function(d){var b=a.SkyDriveItemHelper;return c("Move",d,function(a){return !b.isMruQuery(a)&&!b.isSharedQuery(a)&&!b.isSearchQuery(a.getParent(true))})}},Properties:{click:function(){jQuery(b()).trigger("toggleProperties");return false}},Delete:{click:function(m,n){var d,i,c=b(),j=a.SkyDriveItemHelper,e=window.FilesConfig.recycleBinEnabled,f=e&&!j.isViewerOwner(c.currentItem),l=e&&!!j.isRecycleBinQuery(c.currentItem);function h(){if(i&&d){var a={};if(l)a.deleteModifier=3;else a.deleteModifier=2;c.operationManager.execute("Delete",{items:d,targetItem:d[0].getParent(),options:a})}}c.selectionManager.getSelectedItems(function(a){d=a;h()});var o;if(e&&!l&&!f){i=true;h()}else $Do.when("Bucket3.js",0,function(){var c=n||_ge("c_cb0"),d={buttons:{action:g("DeleteCommand")},title:g(f?"DeleteSharedMultipleItemPromptTitle":"DeletePromptTitle"),content:g(f?"DeleteSharedMultipleItems":"DeletePromptMultipleItems").format(m.selectionCount),anchor:c},a=k().createFlyout(d),b=jQuery(a);b.bind({"aftershow._dlg":function(){var b=jQuery(a.content());sutra(b,"$Sutra.SkyDrive.DeleteMsgBoxContainer");sutra(jQuery(".UserArea",b),"$Sutra.SkyDrive.DeleteMsgBoxBody");sutra(a.getButton({buttonName:"action"}),"$Sutra.SkyDrive.DeleteMsgBoxOkBtn")},"afterdismiss._dlg":function(){b&&b.unbind("._dlg");b=null;a=null},"buttonclick._dlg":function(d,c,b){if(b=="action"){i=true;h()}a.dismiss()}});a.show()});return false},check:function(d){var b=a.SkyDriveItemHelper;return c("Delete",d,function(a){return !b.isMruQuery(a)&&!b.isSharedQuery(a)&&!b.isSearchQuery(a.getParent(true))})}},Restore:{name:"rst",click:function(){return false}}},i={getAction:function(e,c){var b=d[e],a=null;if(b&&m(b,e,c)){a=jQuery.extend({},b);if(a.click){var f=a.click;a.click=function(e,d,g,b,a){return f(c,a||arguments[0]&&arguments[0].type==="click"&&arguments[0].target)}}}return a}};function c(h,e,c){var d=false,f=e.indexes;for(var i in f){var g=f[i],a=b().dataModel.getChildByIndex(e.parent,g,true);if(a)if(b().actionManager.getAction(h,a)&&(!c||c(a))){d=true;break}}return d}function m(d,e,b){var a=false,f=b.indexes;if(d&&d.check)a=d.check(b);else a=c(e,b);return a}a.SkyDriveItemHelper._multiselectionActions=d;a.SkyDriveItemHelper.registerMultiselectActions=j;function j(b,a){a=a||d;for(var c in a)b.multiselectActionManager.registerAction(c,i)}})();(function(){var b=wLive.Core,a=b.AleHelpers.getString,c=b.AleHelpers.getMarketInfoValue,j=6.21355968e13,s=a("Dates.Yesterday"),w=a("Dates.DaysAgo"),x=a("Dates.HourAgo"),t=a("Dates.HoursAgo"),q=a("Dates.MinuteAgo"),p=a("Dates.MinutesAgo"),r=a("Dates.MomentAgo"),l=a("Dates.MomentAgoLowerCase"),k=c("DateFormat.DayMonthYearPattern"),o=c("DateFormat.DayAndSuffixPattern"),m=c("DateFormat.AppendAfterDay"),A="_t",g=60*1e3,e=[],n=10;b.DateFactory={getDate:function(a,b,f){var c=jQuery(_ce("span"));if(a>0)e.push({el:c.text(d(a,b,f)),ticks:a,localizedDate:b});return c},getDateString:d,getFormattedDate:function(i){var c=f(i),b=new Date(c),g=(b.getMonth()+1).toString(),h=b.getDate(),d=a("Dates.AbbreviatedMonth_{0}".format(g)),j=o.format(h,m),e=k.format(d,j,b.getFullYear());return e}};function f(b){var a=b/1e4-j;return a}function d(h,g,j){var k=new Date,i=f(h),c=k.getTime()-i,a=z(c),e=y(c),d=u(c);if(a>0)if(a<7)return (a==1?s:w).format(a);else return g?g:b.DateFactory.getFormattedDate(h);else if(e>0)return (e==1?x:t).format(e);else if(d>0)return (d==1?q:p).format(d);else return j?l:r}function z(a){if(a==0)return 0;return Math.floor(a/1e3/60/60/24)}function y(a){if(a==0)return 0;return Math.floor(a/1e3/60/60)}function u(a){if(a==0)return 0;return Math.floor(a/1e3/60)}setTimeout(i,g);function i(){var a=[];h(e,a,0)}function h(a,b,j){var c=Math.min(j+n,a.length);for(var d=j;d<c;d++){var f=a[d];if(v(f))b.push(f)}if(c<a.length)setTimeout(function(){h(a,b,c)},10);else{e=b;setTimeout(i,g)}}function v(a){var c=false,b=a["el"],e=a["ticks"],f=a["localizedDate"];if(b&&b.closest("body").size()!==0&&e){b.text(d(e,f));c=true}return c}})();(function(){var a=wLive.Core,p=wLive.Controls,c=a.Images,Q=a.AleHelpers.getString,X=a.CommandManager,F=128,J=64,n=48,e=32,l=$B.Mobile?5:12,i=".",g="itemTos",Y="",z="alt",V="title",f="src",x="w",w="h",v="p",N="contextmenu",k="img",d="load",j="error",T="abort",q="margin-top",r="opacity",S="z-index",b="itemTl",y="linear",D=c_pulseFadeInSpeed=1e3,C=0,u=500,G=9500,Z=0,h=$B.Full?128:64,W="height"+h,U=$B.rtl?"left":"right",t=$B.rtl?"right":"left",P="margin-"+t,O="visibility",R="hidden",m='<span class="itemTp"><img alt="{0}" title="" /></span>',o=($B.Mobile?"":'<span class="itemTs"></span>')+m,M='<span class="itemTo"><span class="itemTvo"></span></span><span class="itemTos">'+o+"</span>",K='<span class="itemTo itemTag"><span class="itemTa"><span class="itemTan"><span class="itemName"></span></span></span><span class="itemTac">{1}</span></span><span class="itemTos">'+m+'</span><span class="itemTos">'+m+"</span>",H=$B.Mobile?"/mobile_folder_gradient.png":"/folder_gradient.png",L=$B.Mobile?"/mobile_folder_overlay.png":"/folder_overlay.png",I='<span class="itemTo itemTf"><span class="itemTfhov"><span class="itemTfg"><span class="itemTfi"><img src="'+(FilesConfig.foldersImgBaseUrl+H).encodeHtmlAttribute()+'" class="itemTgrad" width="100%" height="100%" /></span><img class="itemTfo" src="'+(FilesConfig.foldersImgBaseUrl+L).encodeHtmlAttribute()+'" /></span></span><span class="itemTa"><span class="itemTan"><span class="itemName"></span></span></span><span class="itemTac">{0}</span></span>',E='<span class="itemTd"><span class="itemTdc"><span class="itemTdio"><span class="itemTdi"></span></span><span class="itemTdt"><span class="itemTdn"><span class="itemName"></span></span><span class="itemTdm"></span></span></span></span>',B='<span class="itemTo"><span class="itemTvo"></span></span><span class="itemTos"><img class="itemTnv" src="{0}" alt="{1}" title="" /></span>',A='<span class="itemTnp"></span>';wLive.Controls.ItemTile=s;function s(kb,ib,W){var jb=this;W=W||{};var H=jQuery('<span class="itemT"></span>'),m,yb,L,db,lb,Z,fb,nb,cb,bb,Y=0,X=0,rb,qb,gb=false,pb,ob,mb,hb,eb,ab;sutra(H,"$Sutra.SkyDrive.ItemTile");kb.append(H);if($B.Full)H.bind(N,function(a){if(W.sm&&!a.shiftKey){Bb(a);return false}});jb.render=function(f,g,h){var e=a.SkyDriveItem.areItemsSame(m,f,true)&&yb===f.getVersion();W=h||W;if(e)jb.resize();if(!e||pb!=g){pb=g;if(e){if(db&&!pb)if(!nb){if(!eb){eb=setTimeout(Eb,u);if(ab){clearTimeout(ab);ab=null}}db.bind(d,ub);c.loadImage(Z,db[0])}}else{nb=false;m=f;yb=m.getVersion();Y=0;X=0;cb=0;bb=0;rb=0;qb=0;Ab();Db();H.empty();H.removeClass(b);zb();xb();mb=false;Qb();tb()}}};jb.isLoaded=function(){return nb};function Qb(){if(Z)if(m.video)Ob();else if(m.photo||m.audio)Nb();else Mb();else{if(!W.df&&m.folder)Kb();else if(m.photo||m.video||m.isProcessingVideo)Gb();else Hb();nb=true}}function Ob(){var a=W.dv?o:M,b=a.format(m.name.encodeHtmlAttribute());H.html(b);L=jQuery(k,H);L.bind(j,wb);vb()}function vb(){if(c.isComplete(Z)){L.attr(f,Z);H.addClass(b);nb=true}else{var a=c.isComplete(fb);if(a){L.attr(f,fb);H.addClass(b)}else L.hide();if(!a||fb!=Z){db=jQuery("<img />").attr(V,"").attr(z,L.attr(z)).css(r,0).css(S,1);db.insertBefore(L);if(!pb){if(!eb){eb=setTimeout(Eb,u);if(ab){clearTimeout(ab);ab=null}}db.bind(d,ub);c.loadImage(Z,db[0])}}}}function Nb(){var a=o.format(m.name.encodeHtmlAttribute());H.html(a);L=jQuery(k,H);L.bind(j,wb);vb()}function wb(){L.css(O,R)}function Mb(){var b=K.format("",m.getChildren().getCount());H.html(b);sb();var a=jQuery(i+g,H);jQuery(a[0]).css(r,1);jQuery(a[1]).css(r,0);L=jQuery(k,jQuery(a[0]));L.bind(j,wb);L.bind(d,Rb);c.loadImage(Z,L[0])}function Gb(){var a;if(m.photo)a=A;else{var b=FilesConfig.foldersImgBaseUrl+"/videoNoThumbnail.png";a=B.format(b.encodeHtmlAttribute(),m.name.encodeHtmlAttribute())}H.html(a)}function Hb(){H.html(E);if(m.did)jQuery(".itemTdm",H).append(a.SkyDriveItemHelper.getFriendlyFileType(m).encodeHtml());else jQuery(".itemTdm",H).append(a.DateFactory.getDate(m.dateModifiedOnClient,m.displayModifiedDate));sb()}function Kb(){H.html(I.format(m.did?"":m.getChildren().getCount()));sb()}function sb(){var a=jQuery(".itemName",H);if(W.de||!p.EditableText)a.text(m.name);else{if(hb){a.replaceWith(hb.getContainer());hb.bindAll()}else hb=new p.EditableText(a,ib,jQuery.extend({},p.EditableText.RenameOptions,{de:true,ec:"itemNameEdit",hc:true}));if(!hb.isEditing())hb.render(m)}}function zb(){var c=false,b,a;if(W.w>0)b=W.w;else b=kb.width();if(W.h>0)a=W.h;else a=kb.height();if(b!=cb||a!=bb){cb=b;bb=a;c=true}return c}jb.resize=function(){if(zb()){if(rb<cb||qb<bb){rb=cb;qb=bb;if(xb()&&m.photo)vb()}tb()}};function tb(){H.width(cb);H.height(bb);if(L){Cb(cb,bb);Pb(cb,bb)}else if(m.video||m.isProcessingVideo)Cb(cb,bb);else if((W.df||!m.folder)&&!m.photo)Ib(cb,bb)}function Ib(j,c){var g=H.find(".itemTd"),i=H.find(".itemTdc"),h=H.find(".itemTdi"),d=H.find(".itemTdt"),b=n;if(c==J||c==e)b=e;if(c==b)g.removeClass("itemTdb");else g.addClass("itemTdb");var f=c==n||c==e;h.empty().height(b).width(b).css(t,f?0:l).css("margin-top",-b/2).append(jQuery(a.SkyDriveItemHelper.getIcon(m,b)));d.css(t,l*2+b).css(U,l);if(f)d.hide();else d.show()}function Cb(g,c){var b=jQuery(".itemTo",H);if(b[0]){var f=jQuery(jQuery(".itemTos",H)[mb?1:0]);f.width(g);f.height(c);b.width(g);b.height(c);if(c<e||gb&&W.dt)b.hide();else{b.show();if(!gb){var i=b.find(".itemTvo"),d=n;if(c<F)d=e;var h=(!m.video&&m.isProcessingVideo?"processingVideo_":"video_")+d;i.empty().width(d).append(jQuery(a.ImageStrip.getImage(h))).css(q,(c-d)/2)}}}}function Pb(d,c){var b,a;if(Y==0||X==0){b=0;a=0}else if(gb||W.as)if(d==0||c==0){b=0;a=0}else if(Y/X<d/c){b=d;a=X/Y*d}else{a=c;b=Y/X*c}else if(W.iw&&W.ih){a=X;b=Y}else if(W.iw)if(X<c){a=X;b=Y}else{a=c;b=Y/X*c}else if(W.ih)if(X<d){a=X;b=Y}else{b=d;a=X/Y*d}else if(d==0||c==0){b=0;a=0}else if(Y<d&&X<c){a=X;b=Y}else if(Y/X>d/c){b=d;a=X/Y*d}else{a=c;b=Y/X*c}b=Math.ceil(b);a=Math.ceil(a);var e=L.parent();e.width(b).height(a);if($B.IE&&$B.V<9)L.width(b).height(a);e.css(P,Math.floor((d-b)/2));if(gb)e.css(q,Math.floor((c-a)/4));else e.css(q,Math.floor((c-a)/2))}jb.dispose=function(){Ab();H.unbind();hb&&hb.dispose()};function Ab(){jQuery(i+g,kb).stop(true,true);if(lb){lb.unbind();lb=null}if(db){db.stop(true);db.unbind(d,ub);db=null}if(L){L.unbind();L=null}clearTimeout(eb);eb=null;clearTimeout(ab);ab=null}function xb(){var j=Z;Z=fb=null;gb=false;var c,b,d,g=cb,e=bb;if(m){if(m.thumbnailSet&&(!m.audio||W.ap)){c=m.thumbnailSet;b=a.SkyDriveItemHelper.pickThumbnail(c,g,e);d=m.photo||m.video||b;if(e>h){var f=a.SkyDriveItemHelper.pickThumbnail(c,h,h);if(f.width!=b.width||f.height!=b.height)fb=c.baseUrl+f.url}}else if(a.SkyDriveItem.IsFolderWithCovers(m)){var i=m.folder.covers,l=0,k=i.length;if(k>0){ob=0;c=i[ob];b=a.SkyDriveItemHelper.pickThumbnail(c,g,e);d=b;gb=true}}if(b){Y=d.width;X=d.height;Z=c.baseUrl+b.url;if(!fb)fb=Z}}return j!=Z}jb.canPulse=function(){return gb&&m.folder.covers.length>1};jb.pulse=function(n){var e=false;if(gb&&c.isIdle()){var h=m.folder.covers.length;if(h>1){ob=(ob+1)%h;var k=cb,i=bb,g=m.folder.covers[ob],b=a.SkyDriveItemHelper.pickThumbnail(g,k,i);e=true;var l=g.baseUrl+b.url;if(!lb)lb=jQuery("<img/>").bind(d+" "+j+" "+T,Jb);lb.data(w,b.height).data(x,b.width).data(v,n);lb.attr(f,l)}}return e};function Jb(j){var h=this,a=jQuery(h);kb.trigger(s.pulseEventName,a.data(v));if(j.type==d){var e=jQuery(jQuery(i+g,kb)[mb?1:0]);e.animate({opacity:C},D,y);mb=!mb;var c=jQuery(jQuery(i+g,kb)[mb?1:0]);L=jQuery(k,c);Y=a.data(x);X=a.data(w);Z=a.attr(f);fb=Z;L.attr(f,Z);H.addClass(b);tb();c.animate({opacity:1},c_pulseFadeInSpeed,y)}}function Rb(){var a=this;H.addClass(b);if(fb==Z)Fb()}jb.showContextMenu=Bb;function Bb(a){var b={pos:{x:a.pageX,y:a.pageY},ev:a,bici:"CM"};ib.contextMenu.render(m,null,b)}function Fb(){nb=true;if($BSI.isLoading())jQuery(ib).trigger("perfLoad");Db();var b=ib.errorManager.getErrors(),c=b&&b.length;if(c>0)for(var a=0;a<c;a++)if(b[a].code==="imageLoad"){ib.errorManager.removeAt(a);break}clearTimeout(eb);eb=null;clearTimeout(ab);ab=null}function ub(){var a=this;H.addClass(b);db.animate({opacity:1},c_pulseFadeInSpeed);Fb()}function Eb(){clearTimeout(eb);eb=null;if("undefined"!=typeof $header)$header.showLoading();ab=setTimeout(Lb,G)}function Db(){if("undefined"!=typeof $header)$header.hideLoading()}function Lb(){clearTimeout(ab);ab=null;if(ib&&a.StringHelpers.caseInsensitiveStringEquals(ib.viewParams.id,m.id)&&m.photo)ib.errorManager.add({$element:jQuery("<span>"+Q("image.loaderror").encodeHtml()+"</span>"),priority:2,type:4,code:"imageLoad"})}}s.pulseEventName="pulse"})();(function(){var a=wLive.Core,g=a.AleHelpers.getPCString,c="quickView_event",n="SelfView";wLive.Controls.QuickView=b;var k='<div class="quickview_header"><span class="quickview_header_anchor"></span></div>',i='<div class="quickview_header quickview_header_indented"></div>',j='<span class="quickview_header_anchor_container"><a class="quickview_chevron" href="#"><span class="quickview_chevron_open"></span><span class="quickview_chevron_closed"></span></a></span>',l='<a class="quickview_header_text"><span class="t_ctc"></span></a>',d='<div class="quickview_element_indented"></div>',m='<div class="quickview_element"></div>',f=g("expandicontooltip"),e=g("collapseicontooltip"),h=b.EventNames={Collapse:"collapse",Expand:"expand",Show:"show",Hide:"hide"};function b(C,s){var q=this,g,r;q.render=function(D,L){var p;if(g)for(var G=0;G<g.entries.length;G++){p=g.entries[G];p._internal.disposing=true}var o,I=false;for(var F=0;F<D.entries.length;F++){o=D.entries[F];if(!g)p=null;else{p=y(g.entries,o.id);if(p)p._internal.disposing=false}var h={};h.disposing=false;t(o,p);if(o.collapsible)I=true;h.$quickView=jQuery('<div class="quickview"></div>');var N;if(o.action||o.collapsible){h.$headerHitTarget=jQuery(k);h.$headerAnchor=h.$hover=jQuery(".quickview_header_anchor",h.$headerHitTarget);if(o.action)h.$headerContainer=h.$headerAnchor.addClass("quickview_header_indented");if(o.collapsible){h.$headerAnchor.append(j).addClass("quickview_header_anchor_withchevron");if(a.StringHelpers.caseInsensitiveStringEquals(s.currentViewType,n)){h.$chevronClosed=jQuery(".quickview_chevron_closed",h.$headerHitTarget).append(a.ImageStrip.getImage("darkPanelClosedUp",f));h.$chevronOpen=jQuery(".quickview_chevron_open",h.$headerHitTarget).append(a.ImageStrip.getImage("darkPanelOpenUp",e))}else{h.$chevronClosed=jQuery(".quickview_chevron_closed",h.$headerHitTarget).append(a.ImageStrip.getImage("closedUp",f));h.$chevronOpen=jQuery(".quickview_chevron_open",h.$headerHitTarget).append(a.ImageStrip.getImage("openUp",e))}h.$headerContainer=jQuery(".quickview_header_anchor_container",h.$headerHitTarget);(o.expanded?h.$chevronClosed:h.$chevronOpen).hide()}}else{h.$headerHitTarget=jQuery(i);h.$hover=h.$headerContainer=h.$headerHitTarget}h.$headerHitTarget.bind("click",B);if(p&&p._internal.$header){p._internal.$header.appendTo(h.$headerContainer);h.$hover=h.$header=p._internal.$header;p._internal.$header=null}else h.$hover=h.$header=jQuery(l).appendTo(h.$headerContainer);if(o.action){var J=h.$headerContainer.find(".quickview_header_text");s.actionManager.setATagAction(o.action,J,null,function(a){return function b(c,b){if(a)wLive.Core.BiciHelpers.reportClickAction(a.SkyCmnd,a.ClickLoc);b(c);r=true}}(o.bici))}h.$subheader=jQuery(d);h.$headerHitTarget.bind("dragstart",function(a){a.preventDefault()}).bind("selectstart",function(a){a.preventDefault()}).appendTo(h.$quickView);h.$subheader.appendTo(h.$quickView);h.$elementContainer=jQuery(d);if(p){h.$element=p._internal.$element;h.$element.detach()}else h.$element=jQuery(m).bind(b.EventNames.Expand,w).bind(b.EventNames.Collapse,u).bind(b.EventNames.Show,A).bind(b.EventNames.Hide,z).bind("select",x).bind("unselect",v);h.$elementContainer.append(h.$element);h.$quickView.append(h.$elementContainer);h.$element.toggle(o.expanded);h.$quickView.toggle(!o.hidden);if(o.selected)h.$headerContainer.addClass("quickview_sel");else h.$headerContainer.removeClass("quickview_sel");var M={item:D,index:F};h.$quickView.data(c,M);var K=o.control;if(p)h.$control=p._internal.$control;else{o._internal=h;h.$control=new K(h.$element,s,{$header:h.$header.find("span"),$headerA:h.$headerAnchor,$subheader:h.$subheader,$chevron:h.$headerContainer.find(".quickview_chevron"),options:o.cstrOptions})}C.append(h.$quickView);p&&p._internal.$quickView.remove();o._internal=h;h.$control.render(o.data,L)}if(!I)for(var H=0;H<D.entries.length;H++){o=D.entries[H];var E=o._internal;E.$headerAnchor&&E.$headerAnchor.removeClass("quickview_header_indented");E.$headerHitTarget.removeClass("quickview_header_indented");E.$subheader.removeClass("quickview_element_indented");E.$elementContainer.removeClass("quickview_element_indented")}q.disposeCore(true);g=D};q.disposeCore=function(b){if(g){var a=[];(function(){for(var d=0;d<g.entries.length;d++){var c=g.entries[d];if(!b||c._internal.disposing){c._internal.$quickView.remove();c._internal.$control.dispose()}else a[a.length]=c}})();g={entries:a}}};q.dispose=function(){q.disposeCore(false)};function y(c,e){for(var b=0;b<c.length;b++){var d=c[b];if(a.StringHelpers.caseInsensitiveStringEquals(d.id,e))return d}return null}function t(a,b){if(typeof a.url!="undefined"&&a.url!=null)a.collapsible=false;if(p(a.collapsible))if(b)a.collapsible=b.collapsible;else a.collapsible=true;else if(a.collapsible==false)a.expanded=true;if(p(a.expanded))if(b)a.expanded=b.expanded;else a.expanded=true;if(p(a.selected))if(b)a.selected=b.selected;else a.selected=false;if(p(a.hidden))if(b)a.hidden=b.hidden;else a.hidden=false;if(p(a.hoverable))if(b)a.hoverable=b.hoverable;else a.hoverable=true}function p(a){return typeof a=="undefined"||a==null}function o(b){var a=jQuery(b).parents(".quickview").data(c);return a.item.entries[a.index]}function w(){var b=o(this),a=b._internal;b.expanded=true;a.$element.show();a.$chevronOpen.show();a.$chevronClosed.hide()}function u(){var b=o(this),a=b._internal;b.expanded=false;a.$element.hide();a.$chevronOpen.hide();a.$chevronClosed.show()}function A(){var a=o(this);a._internal.$quickView.show();a.hidden=false}function z(){var a=o(this);a._internal.$quickView.hide();a.hidden=true}function x(f){if(!a.DomHelpers.isTextInputElement(jQuery(f.target))){var b=jQuery(this).parents(".quickview").data(c),e=b.item.entries[b.index];for(var d=0;d<b.item.entries.length;d++)b.item.entries[d]._internal.$headerContainer.removeClass("quickview_sel");e._internal.$headerContainer.addClass("quickview_sel");e.selected=true}}function v(){var a=o(this);a._internal.$headerContainer.removeClass("quickview_sel");a.selected=false}function B(b){var a=o(this);if(a.collapsible){if(!r){if(!a.expanded)a._internal.$element.trigger(h.Expand);else a._internal.$element.trigger(h.Collapse);a.onChevronToggle&&a.onChevronToggle()}if(!a.action)b.preventDefault()}r=false}}})();(function(){var c=wLive.Core,f=wLive.Controls,b=c.AleHelpers.getPCString,s=c.SkyDriveItemHelper,t=9001,a="et_",E=a+"main",F=a+"text",k=a+"primary",l=a+"snippet",j=a+"textContainer",g=a+"empty",o=a+"inactive",n=a+"editable",D=a+"edit",p=a+"editing",A=a+"outline",q=a+"error",y=a+"growable",x=a+"centered",v=a+"hinput",r=a+"input",z=a+"textarea",m=a+"processing",d=".",P="#",i="click",M="resize",N="scroll",C="mousewheel",O="blur",K="mouseup",J="keydown",H=27,L=13,e=jQuery(window),I=jQuery(document),B=c.SoftBlockEnum,w=0,G=function(){return a+w++},u=jQuery(["<div>",":","*","?","\\","/",";",'"',"<",">","|","&#xff0f;","&#xff1b;","&#xff0a;","</div>"].join("")).text();f.EditableText=h;h.RenameOptions={n:"name",gdt:function(a,b){return b.getDisplayName(a)},g:false,gem:function(g,a){var c;if(!a)c=b("NameRequiredError");else if(a.startsWith(".")||!g.extension&&a.endsWith("."))c=b("CantStartOrEndWithDotError");else{var d;for(var e=0;e<a.length;e++){var f=a.charAt(e);if(u.indexOf(f)!==-1){d=f;break}}if(d)c=b("InvalidTextFormatError").format(d)}return c},"get":function(a){return a._isNewFolder?b("NewFolderErrorTitle"):b("RenameErrorTitleFormat").format(a.name)},aa:"Rename",ea:"Rename"};h.CaptionOptions={n:"caption",aa:"ModifyCaption","get":function(a){return a.photo?b("CaptionErrorTitle"):b("DescriptionErrorTitle")},ml:255,v:function(a){return a.photo?b("AddCaption"):b("AddDescription")}};function h(T,R,w){var S=this,cc=R.errorManager,db=R.dataModel,Nb=R.$rootElement,Ob=jQuery(R),a,xb,rb,ab,bb,cb=w.n,Jb=w.gdt,vb=w.ca,Ab=w.ac,Db=w.ic,Fb=w.ec,ic=w.aa,nb=w.ea,Zb=w.g,Y=w.c,Xb=w.ml,mb=w.de,Gb=w.gem,Kb=w.get,hc=w.snp,Hb=w.sc,Tb=false,ac=G(),jb=d+ac,Mb={top:0,left:0},gb,Q=false,wb=false,zb=" "+z+(Db?" "+Db:""),dc=Xb?' maxlength="'+Xb+'"':"",ec='<textarea class="'+v+zb+'" disabled="disabled" + textareaAdditionalAttributes></textarea>';T.html('<span class="'+j+'"></span>');T.addClass(E).addClass(Zb?y:"");var W=jQuery(d+j,T),h,Z,Yb,U,u,V=jQuery('<div id="'+ac+'" class="'+D+(mb?" "+A:"")+(Fb?" "+Fb:"")+'">'+'<textarea class="'+r+zb+'"'+dc+"></textarea>"+"</div>"),X;sutra(T,"$Sutra.SkyDrive.EditableText");db.addListener(c.DataModel.dataChangedEvent,Bb);function Bb(b){if(a&&a.key===b.key)S.render(b)}function Pb(c,b){if(a&&b&&a.key===b["key"])Eb()}if(nb)Ob.bind(nb,Pb);if(Y)hb(x);function lb(){if(Q){ab=rb;Sb()}}function Wb(){var a;if(Y)a=h.height();else a=W.height();Vb(true);tb("height",a);setTimeout(function(){S.resize(function(){u.focus().select()})},0)}function qb(a){var b=Jb&&Jb(R,a);return b||ub(a)}function ub(a){return a[cb]}function fc(a){var b=a.snippet||"";if(b)Yb.html("..."+s.highlightAndEncodeField(a,"snippet")+"...")}function kb(b,j){var e=vb||gb&&!mb;if(!h||e!==(h[0].nodeName==="A")){h&&h.remove();var f=e?"a":"span";h=jQuery("<"+f+' class="'+F+(Ab?" "+Ab:"")+'">'+'<span class="'+k+'"></span>'+(hc?'<span class="'+l+'"></span>':"")+"</"+f+">");ob(h,i,Ib);Z=jQuery("."+k,h);sutra(Z,"$Sutra.SkyDrive.EditableTextCurrentText");Yb=jQuery("."+l,h);W.append(h)}b=b&&b.trim();if(b)h.removeClass(g);else if(gb){h.addClass(g);if(w.v)b=w.v(a)}b=b||"";if(j)Z.html(b);else Z.text(b);var d;if(vb)d=R.actionManager.getAction(vb,a);if(d){c.ActionManager.setATagAction(d,h);h.removeClass(o)}else{if(h[0].nodeName==="A")h.attr("href",P).bind(i,function(a){a.preventDefault()});h.addClass(o)}}function ib(){cc.clear();rb=false;u&&u.removeClass(q)}function Eb(){if(gb&&!Q){Wb();u.val(ub(a))}}function bc(d){ib();if(ab)ab=false;else{var c=Kb?Kb(a):b("UpdateItemErrorTitle"),e=jQuery("<span>"+c+" "+d+"</span>");cc.add({$element:e,priority:0,type:0});rb=true;Wb();u&&u.addClass(q)}}function Ib(){if(!mb){Eb();return false}}function gc(b){if(Q){ib();ab=false;var a,c=b.which;if(c===H)a=Lb;else if(c===L)a=Sb;if(a){a();b.preventDefault()}else if(Zb)U.text(u.val()+String.fromCharCode(c));var e=U[0].scrollHeight,d=U[0].scrollHeight;if(u.innerHeight()<d)tb("height",d);b.stopPropagation()}}function sb(a){if(a){X&&X.hide();pb(m)}}function Sb(){var d=u.val();d=d.trim();var e=a._isNewFolder;if(e){if(!X){X=$f&&jQuery($f.createLoading({returnMarkup:true,useTransparentFallback:true}));W.prepend(X)}else X.show();hb(m)}var k=Gb&&Gb(a,d);if(k){sb(e);bc(k)}else{var i=ub(a);if(d!==(h.hasClass(g)?"":i)||a._isNewFolder){kb(d);fb(true);eb(false);a.updateItemProperty(cb,d,l,j)}else Lb()}function l(){if(e){R.pendingFolderToCreate=false;a.invalidate();sb(e);if(R.selectionManager.getSelection().selectionCount===0){var b=a.getParent();if(b){var c=b.getChildren().indexOf(a,true);if(c>-1)R.selectionManager.clickSelect(b,c)}}}if(Hb)Hb(a);if(cb=="caption")R.tokenHasBeenRedeemed=true;fb(false);ab=false}function j(g,h){if(c.StringHelpers.caseInsensitiveStringEquals(a.id,h.id))if(g&&g.error&&g.error.code===t)$Do.when("Bucket3.js",0,function(){if(c.StringHelpers.caseInsensitiveStringEquals(a.id,h.id)){var b=g.error.data,e=b&&jQuery.parseJSON(b);bb=new f.SoftBlock(B.RenameAction,R.callerCid,a,e,f.Notifications);bb.show(function(){fb(true);db.updateItemProperty(a,cb,d,function(){fb(false)},j,true)},function(){kb(i);eb(true)})}});else{u.val(d);kb(i);sb(e);bc(g.error.message||b("UpdateItemError"))}fb(false)}return false}function Lb(){eb(true);return false}function Qb(){ob(u,O,lb);ob(u,J,gc)}function Rb(){u&&u.unbind();I.unbind(K,lb)}S.bindAll=function(){ob(h,i,Ib);if(Q)Qb()};S.isEditing=function(){return Q};S.getContainer=function(){return T};S.focus=function(){if(Q)u.focus();else h.focus()};S.render=function(b){if((!c.SkyDriveItem.areItemsSame(a,b)||xb!==qb(b))&&!(Q&&a.key===b.key)){eb(true);a=b;xb=qb(a);gb=!!R.actionManager.getAction(ic,a);if(!mb&&gb)hb(n);else pb(n);var d=qb(a)||"";kb(s.highlightAndEncodeField(a,cb),true);fc(b)}if(Y)S.resize()};S.resize=function(b){var a;if(Y)a=T.width()-2;else a=W.width()-2;if(Y&&!Q){if(Z){W.width("auto");W.width(Math.min(Z.width()+21,a))}}else tb("width",a);setTimeout(function(){Cb();b&&b()},0)};S.dispose=function(){if(!Tb){Tb=true;eb(true);ib();db.removeListener(c.DataModel.dataChangedEvent,Bb);if(nb)Ob.unbind(nb,Pb);e.unbind(jb);h&&h.unbind();Rb()}if(bb){bb.dispose();bb=null}};function Cb(){if(Q){var c=Y?T:W,a=c.offset();if(!a.top||!a.left)a=Mb;if(a.top&&a.left){Mb=a;var b=$B.rtl?3:0;a.left=a.left-Nb.offset().left-b;V.show();V.offset(a)}}}e.bind(M+jb,function(){S.resize()});e.bind(N+jb,Cb);e.bind(C+jb,lb);function eb(c){if(Q&&c&&a&&a._isNewFolder){Ub();R.pendingFolderToCreate=false;var b=a.getParent();if(b){b.removePinnedSubfolder(a);b.invalidate()}}else Ub()}function Vb(a){if(Q!=a){Q=a;if(Q){U=jQuery(ec);u=jQuery(d+r,V);T.append(U);hb(p);sutra(u,"$Sutra.SkyDrive.EditableTextInput");V.hide().appendTo(Nb);Qb()}else{Rb();V.remove();unsutra(u);pb(p);U&&U.remove()}yb()}}function fb(a){if(wb!=a){wb=a;yb()}}function Ub(){if(Q)ib();Vb(false)}function yb(){if(wb||Q)db.suspendChangeEvents();else db.resumeChangeEvents()}function hb(a){T.addClass(a);V.addClass(a)}function pb(a){T.removeClass(a);V.removeClass(a)}function tb(b,a){if(a){u&&u[b](a);var c=$B.IE?a-1:a;U&&U[b](c)}}function ob(b,a,c){b&&b.unbind(a,c).bind(a,c)}S.bindAll()}})();(function(){var b=wLive.Core,a=wLive.Controls,u=b.AleHelpers.getPCString,h=b.SkyDriveItemHelper,v="position",w="relative",z="fixed",B="left",C="top",x="bottom",A="auto",y="scroll",q="padding-top",c=".",t=200,n=20,g="ip_pl",j="infopane",e="ip_col",l="ip_content",m="ip_header",k="ip_caption",i="ip_quickview",f=".infopane",p='<div class="'+g+'"></div>'+'<div class="'+j+' t_cbgc">'+'<div class="'+l+'" tabindex="-1">'+'<div class="'+m+'"></div>'+'<div class="c_clr">'+'<div class="ip_scrollp">'+'<div class="'+k+'"></div>'+'<div class="'+i+'"></div>'+"</div>"+"</div>"+"</div>"+"</div>",o=jQuery.extend({},a.EditableText.CaptionOptions,{ec:"infoPaneCaptionEdit",g:true}),s=jQuery(window),r=jQuery(document);a.InfoPane=d;function d(v,t,u){var A=this,x,y,w,P,K,R,O=t.selectionManager,S=t.dataModel,ab,Z,X=0,hb,L,cb,gb,fb,db,eb;function U(){return x===w}u=u||{};var Y=jQuery.extend({tm:false,at:false},u.to);v.html(p);var J=jQuery(c+g,v);if(u.fh)J.hide();else J.height(0);var E=jQuery(c+j,v);A.toggle=T;function T(){var c=t.infoPaneClosed,a;if(c){E.removeClass(e);a="IPE"}else{E.addClass(e);jQuery(t).trigger("disableTagging");a="IPC"}b.BiciHelpers.reportClickAction(a,t.infoPaneBiciLoc);H();t.infoPaneClosed=!c;v.trigger(d.EventNames.resize);if(!t.infoPaneClosed&&!K)z(w,P);return false}var D=jQuery(c+k,v),bb=jQuery(c+l,v),G=jQuery(c+m,v),C=true;if(t.infoPaneClosed)E.addClass(e);sutra(G,"$Sutra.SkyDrive.InfoPaneHeader");sutra(v,"$Sutra.SkyDrive.InfoPane");var I=new a.QuickView(jQuery(c+i,v),t),M=new a.InfoPaneHeader(G,t,u.h),F=[M],B;if(!u.fh)B=new a.EditableText(D,t,o);S.addListener(b.DataModel.dataChangedEvent,Q);jQuery(O).bind(b.SelectionManager.SelectionChangedEvent+f,N);A.render=function(a){var b=t.selectionManager.getSelection();if(b&&b.selectionCount>0){x=a;N(null,b)}else if(!(x&&w&&x.key===a.key&&x.key!==w.key)&&!y){x=a;z(a,u.bici)}if(d.clickOrigin==="property")u.pc=true};A.resize=function(){if(u.fh)bb.height(v.height());else{ab=s.height();var a=jQuery("#m_wf");Z=a.height()+parseInt(a.css(q));H()}};A.dispose=function(){clearTimeout(L);L=null;for(var a=0;a<F.length;a++)F[a].dispose();if(B)B.dispose();I.dispose();t.infoPaneBiciLoc="";S.removeListener(b.DataModel.dataChangedEvent,Q);jQuery(O).unbind(b.SelectionManager.SelectionChangedEvent+f);R=true};function z(c,g,j){var i=b.SkyDriveItem.areItemsSame(w,c);w=c;P=g;K=false;if(t.infoPaneClosed||!c)return;t.infoPaneBiciLoc=g||t.infoPaneBiciLoc;var k=h.isGroupRoot(c),e=false;G.show();if(c.isPlaceholder||c._isLoadingItem||c._isNewFolder){if(C){C=false;v.hide();e=true}}else{if(c.partialData&&!i)c.extendPartialData(W);if(!C){C=true;v.show();e=true}if(k){D.hide();t.infoPaneBiciLoc="IPR"}else{if(B)B.render(c);D.show()}for(var f=0;f<F.length;f++)F[f].render(c);$Do.when("Bucket3.js",0,function(){if(c.key===w.key&&!R){I.render({entries:[{id:"ip_location",control:a.InfoPaneLocation,data:c,hoverable:false},{id:"ip_taglist",control:a.InfoPaneTagList,data:c,hoverable:false,cstrOptions:Y},{id:"ip_sharing",control:a.InfoPaneSharing,data:c,hoverable:false,cstrOptions:{fs:U,col:u.cs}},{id:"ip_information",control:a.InfoPaneInformation,data:c,hoverable:false,cstrOptions:{open:u.oi||u.pc,i:u.i}},{id:"ip_comments",control:a.InfoPaneComments,hoverable:false,data:c},{id:"ip_groupMembership",control:a.InfoPaneGroupMembership,hoverable:false,data:c,expanded:h.isGroupRoot(c)}]},j);u.pc=false}})}if(u.fh)D.hide();A.resize();v.parent().scrollTop(0);if(e)v.trigger(d.EventNames.resize);K=true}function V(a){C=true;v.show();D.hide();G.show();M.renderSelection(a);I.render({entries:[]});A.resize();v.trigger(d.EventNames.resize)}function H(a){if(!u.fh&&!($B.IE&&$B.V<7)){if(a)X=r.scrollTop()+n;J.width(E.width())}}function Q(a){if(w&&w.key===a.key&&!y)z(a)}function W(a){if(w&&w.key===a.key&&!y)if(u.fh)z(a,undefined,true);else a.invalidate()}function N(b,a){wLive.throttle("infoPaneSelection",100,function(){var c=a.selectionCount;if(c==1){var b;for(var e in a.indexes){var d=a.parent;b=d.getChildren().get(e);break}if(b){z(b,"IPS");t.infoPaneClosed&&T();H(true)}y=null}else if(c>1){V(a);y=a}else{z(x,u.bici);y=null}})}}d.EventNames={resize:"ipResize"};defineSubClass("SkyDrive.UI.InfoPane",SkyDrive.UI.LegacyControlAdapter,null,{controlType:wLive.Controls.InfoPane})})();(function(){var d="leftNavBarItem_event",c="leftNavBar_",a=".leftNavBarItem",b="quickview_sel";wLive.Controls.LeftNavBarItem=e;function e(f,n,g){var i=this,e;f.bind("select"+a,function(){if(e)e.$quickViewContainer.trigger("unselectAll",e.$quickViewContainer)});i.render=function(j){var n;if(e&&e.entries)for(n=0;n<e.entries.length;n++){var p=e.entries[n];if(p.$el)p.$el.unbind(a)}g.$header.empty();g.$header.append(j.header);var q=j.tooltip;if(q)g.$header.attr("title",q);f.empty();j.$quickViewContainer=f;j.$quickViewHeader=g.$header;j.$quickViewChevron=g.$chevron;var o=jQuery('<div class="t_hovl"></div>'),r;for(n=0;n<j.entries.length;n++){var h=j.entries[n],s=h.text||"";h.$a=jQuery('<a class="'+c+'anchor"><span class="t_ctc">'+h.text.encodeHtml()+"</span></a>");if(h.selected)h.$a.addClass(b);if(h.tooltip)h.$a.attr("title",h.tooltip);if(h.action)wLive.Core.ActionManager.setATagAction(h.action,h.$a);else h.$a.attr("href","#");h.$el=jQuery('<div class="'+c+'item"></div>').append(h.$a).data(d,{index:n,item:j}).bind("click"+a,l).bind("select"+a,k).bind("unselect"+a,m).appendTo(o)}f.append(o);jQuery(e).unbind(a);jQuery(j).bind("render"+a,function(){i.render(e)});e=j};i.dispose=function(){for(var b=0;b<e.entries.length;b++){var c=e.entries[b];c.$el.unbind(a)}f.unbind(a).empty()};function l(c){var b=h(this),a=b.bici;if(a)wLive.Core.BiciHelpers.reportClickAction(a.SkyCmnd,a.ClickLoc);k(c)}function k(f){var c=f.currentTarget,e=j(c),a=h(c),d=e.item.$quickViewContainer;d.trigger("unselectAll");a.$a.addClass(b);a.selected=true;return false}function m(){var a=h(this);a.$a.removeClass(b);a.selected=false;return false}function j(a){return jQuery(a).data(d)}function h(b){var a=j(b);return a.item.entries[a.index]}}})();(function(){var a=window,b=a;try{if(a.parent.location.href)b=a.parent}catch(e){}if(!b.MusicConfig){b.MusicConfig={imgBaseUrl:a.FilesConfig.foldersImgBaseUrl,aleJSUrl:a.FilesConfig.musicAleJSLocation,cssUrl:a.FilesConfig.musicCssLocation,liveContextBaseUrl:a.FilesConfig.liveContextBaseUrl};if(a.$Sutra)jQuery.extend(b.$Sutra,a.$Sutra,{});if(a.FilesConfig.musicJSLocation&&a.FilesConfig.musicCssLocation&&a.FilesConfig.musicAleJSLocation){b.$Network.fetchCSS(a.FilesConfig.musicCssLocation,function(){});b.$Network.fetchScript(a.FilesConfig.musicJSLocation,function(){});b.$Network.fetchScript(a.FilesConfig.musicAleJSLocation,function(){})}}if(!b.wLive||!b.wLive.Controls||!b.wLive.Controls.MusicPlayer){b.MusicConfig.innerPageInit=c;jQuery(a).bind("unload",d)}else c();function d(){b.MusicConfig.innerPageInit=null}function c(){window.wLive.Controls.MusicPlayer=b.wLive.Controls.MusicPlayer;$Do.register("MusicPlayer")}})();(function(){var c=wLive.Core,d=c.QuotaStatus,b=c.AleHelpers.getPCString,a="leftnavbar.",f=b(a+"QuotaAvailable.Format"),e=b(a+"QuotaUsageExceeded.Format");defineSubClass("SkyDrive.UI.QuotaPane",JBase.UI.BaseControl,function(){mix(this,{manageStorageUrl:FilesConfig.manageStorageUrl,getAppsUrl:FilesConfig.getSkyDriveAppsUrl,manageStorageText:b(a+"managestorage.text"),getAppsText:b(a+"getapps.text")})},{onActivate:function(){this.addElementListener(this.subElements.manageLink,"click",c.BiciHelpers.prependBiciReportClickAction(null,"MS","LN"))},onDataContextChanged:function(a){this.quotaHtml=g(a.item);this.hasExceededQuota=a.quotaStatus===d.Exceeded}});function g(a){var b="";if(a&&a.displayQuotaRemaining&&a.displayQuotaTotal&&!a.group){var g="<span>"+a.displayQuotaRemaining+"</span>",c="<span>"+a.displayQuotaExceeded.encodeHtml()+"</span>",h=a.quotaStatus===d.Exceeded;b='<div id="quotaHeader">'+f.format(g)+"</div>";if(h&&c)b+="<div>"+e.format(c)+"</div>"}return b}})();SkyDrive.UI.QuotaPane.prototype.onRenderHtml=function(){return "<"+this.baseTag+""+sutraAttribute("SkyDrive.QuotaPane")+' id="'+htmlAttributeEncode(this.id+"_0")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="c-'+this.controlName+" "+this.baseClass+'">'+"<div"+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="leftNavBar_extraLinks">'+'<div id="'+htmlAttributeEncode(this.id+"_1")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="leftNavBar_quota'+generateClassAttribute("leftNavBar_quotaExceeded",this.hasExceededQuota)+'">'+'<div id="'+htmlAttributeEncode(this.id+"_2")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+">"+this.quotaHtml+"</div>"+"</div>"+"<a"+sutraAttribute("SkyDrive.ManageStorageLink")+' id="'+htmlAttributeEncode(this.id+"_3")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+""+generateAttributesString("href",this.manageStorageUrl)+">"+htmlEncode(this.manageStorageText)+"</a>"+"<a"+sutraAttribute("SkyDrive.GetAppsLink")+' id="'+htmlAttributeEncode(this.id+"_4")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+""+generateAttributesString("href",this.getAppsUrl)+">"+htmlEncode(this.getAppsText)+"</a>"+"</div>"+"</"+this.baseTag+">"+""};processAnnotations(SkyDrive.UI.QuotaPane,[{id:0},{id:1,className:["leftNavBar_quotaExceeded","hasExceededQuota"]},{id:2,attr:["html","quotaHtml"]},{id:3,attr:["text","manageStorageText","href","manageStorageUrl"],childId:"manageLink"},{id:4,attr:["text","getAppsText","href","getAppsUrl"],childId:"getAppsLink"}]);(function(){var j=wLive.Core,f=wLive.Controls,e=j.AleHelpers.getPCString,m=j.BrowserStorage,r="DevicesView",U=3,V=3e4,M="/API/2/GetGroups",w="select",k="leftnavbar.",q=k+"myfiles.",J=q+"docs.",G=q+"photos.",p=k+"quickviews.",H=p+"mru.",E=p+"shareddocs.",D=p+"recyclebin.",L=k+"groups.",d="text",O="shared",N="search",K="recyclebin",l="LeftNavBar",B="GroupView",z="groupsCollapsed",y="devicesCollapsed",x="noDevicesCollapsed",R=e(J+d),Q=e(G+d),v=e(q+d),u=e(H+d),t=e(E+d),s=e(D+d),A=e(k+"devices."+d),F=e(k+"getdeviceserror."+d),T=e(k+"getapps."+d),S=e(k+"managestorage."+d),W=j.SkyDriveItemHelper,C=false,g={id:"myfiles",control:f.LeftNavBarItem,collapsible:false,selected:false,bici:{SkyCmnd:"MF",ClickLoc:"LN"},data:{header:v,tooltip:v,entries:[],$quickViewContainer:null,$quickViewHeader:null}},i={id:"mru",control:f.LeftNavBarItem,collapsible:false,selected:false,bici:{SkyCmnd:"RD",ClickLoc:"LN"},data:{header:u,tooltip:u,entries:[],$quickViewContainer:null,$quickViewHeader:null}},h={id:"shared",control:f.LeftNavBarItem,collapsible:false,selected:false,bici:{SkyCmnd:"DS",ClickLoc:"LN"},data:{header:t,tooltip:t,entries:[],$quickViewContainer:null,$quickViewHeader:null}},o={id:"recyclebin",control:f.LeftNavBarItem,collapsible:false,selected:false,data:{header:s,tooltip:s,entries:[],$quickViewContainer:null,$quickViewHeader:null}},b={id:"groups",collapsible:true,control:f.LeftNavBarItem,expanded:!!!m.getLocalValue(z),hidden:true,selected:false,data:{header:e(L+d),entries:[],$quickViewChevron:null,$quickViewContainer:null,$quickViewHeader:null}},c={id:"devices",collapsible:true,control:f.LeftNavBarItem,expanded:!!!m.getLocalValue(y),hidden:true,selected:false,data:{header:A,entries:[],$quickViewChevron:null,$quickViewContainer:null,$quickViewHeader:null}},I={id:"getDevicesError",text:F,selected:false,bici:{},$el:null,$a:null},a={id:"noDevices",control:f.LeftNavBarItem,expanded:!!!m.getLocalValue(x),collapsible:false,hidden:true,selected:false,data:{header:A,collapsible:false,entries:[I],$quickViewContainer:null,$quickViewHeader:null}},n;if(window.FilesConfig.recycleBinEnabled)n={entries:[g,i,h,o,b,c,a]};else n={entries:[g,i,h,b,c,a]};f.LeftNavBar=P;function P(k,d){var D=this,e=d.actionManager,A=d.callerCid;g.action=e.getAction("SkyDriveRoot",null);i.action=e.getAction("ViewRecentDocs",null);h.action=e.getAction("ViewSharedDocs",null);c.action=e.getAction(r,null);c.onChevronToggle=s;a.action=e.getAction(r,null);o.action=e.getAction("ViewRecycleBin",null);b.action=e.getAction(B,null);b.onChevronToggle=s;var v=true,E=new f.QuickView(k,d);k.bind("unselectAll",function(g,a){if(!a)a=[];for(var c=0;c<n.entries.length;c++){var f=n.entries[c],b=f.data;if(b.$quickViewContainer)b.$quickViewContainer.not(a).trigger("unselect");for(var d=0;d<b.entries.length;d++){var e=b.entries[d];if(e.$el)e.$el.not(a).trigger("unselect")}}});function s(){Trace.log("LeftNavBar.js storeHeaderExpandedState() called",l);m.setLocalValue(z,!b.expanded);m.setLocalValue(y,!c.expanded);m.setLocalValue(x,!a.expanded)}D.dispose=function(){s();k.unbind("unselectAll");if(d.deviceItemSet&&d.deviceItemSet.isLoaded&&d.deviceItemSet.isListening){d.deviceItemSet.removeListener("change",t);d.deviceItemSet.isListening=false}g.$quickViewContainer=g.$quickViewHeader=i.$el=i.$a=h.$el=h.$a=o.$e1=o.$a=b.$quickViewContainer=b.$quickViewHeader=null;k.empty()};D.render=function(p){if(p){if(!C){F();C=true}if(v){v=false;E.render(n);for(var m=0;m<a.data.entries.length;m++)a.data.entries[m].$el.hide();var f=a.data.entries[0];f.$a.removeClass("leftNavBar_anchor");if(d.deviceItemSet){Trace.log("LeftNavBar.js render(): Adding 'change' listener to deviceItemSet",l);d.deviceItemSet.addListener("change",t);d.deviceItemSet.isListening=true;if(d.deviceItemSet.isLoaded){Trace.log("LeftNavBar.js render(): calling loadDevices()",l);t()}else{Trace.log("LeftNavBar.js render(): deviceItemSet.isLoaded === false, show 'PCs' header",l);f.$a.addClass("leftNavBar_anchor_err");a.data.$quickViewContainer.trigger("show");if(window.getDevicesResponse&&window.getDevicesResponse.error)a.data.entries[0].$a.addClass("leftNavBar_anchor_err")}}else if(FilesConfig.devicesLeftNavEnabled){f.$a.addClass("leftNavBar_anchor_err");a.data.$quickViewContainer.trigger("show");if(window.getDevicesResponse&&window.getDevicesResponse.error)a.data.entries[0].$a.addClass("leftNavBar_anchor_err");else{Trace.log("LeftNavBar.js render(): window.getDevicesResponse && window.getDevicesResponse.error == "+!!(window.getDevicesResponse&&window.getDevicesResponse.error),l);Trace.log("LeftNavBar.js render(): sending DataRequest to try again to fetch devices",l);d.deviceItemSet&&d.deviceItemSet.retryRequest()}}sutra(i.data.$quickViewHeader,"$Sutra.SkyDrive.QuickViewsMru");sutra(h.data.$quickViewHeader,"$Sutra.SkyDrive.QuickViewsSharedDocs");sutra(k,"$Sutra.SkyDrive.LeftNavBar");sutra(g.data.$quickViewHeader,"$Sutra.SkyDrive.MyFiles");sutra(b.data.$quickViewHeader,"$Sutra.SkyDrive.Groups");sutra(b.data.$quickViewContainer,"$Sutra.SkyDrive.GroupItems");sutra(b.data.$quickViewChevron,"$Sutra.SkyDrive.GroupChevron");sutra(c.data.$quickViewHeader,"$Sutra.SkyDrive.Devices");sutra(c.data.$quickViewContainer,"$Sutra.SkyDrive.DeviceItems");sutra(c.data.$quickViewChevron,"$Sutra.SkyDrive.DeviceChevron");sutra(a.data.$quickViewHeader,"$Sutra.SkyDrive.NoDevices");sutra(k.find(".leftNavBar_anchor_err"),"$Sutra.SkyDrive.ErrorMessage");var e=b.data,o=e.entries;e.$quickViewContainer.trigger("show");if(o.length<1)e.$quickViewHeader.prev().hide();else e.$quickViewHeader.prev().show();k.find(".quickview:lt(2)").addClass("topGroup");if(j.StringHelpers.caseInsensitiveStringEquals($Config.mkt,"ML-IN"))k.find(".quickview_header_text > span").addClass("ml-in")}u()}};function q(b){b.selected=true;var a=b.data;if(a.$quickViewContainer)a.$quickViewContainer.trigger(w)}function p(a){a.selected=true;var b=a.$el||(a._internal?a._internal.$element:null);if(b)b.trigger(w)}function u(){var f=false,e=d.viewParams,l,s=j.StringHelpers.caseInsensitiveStringEquals(e.cid,A);if(e.did){var v=d.deviceItemSet.getByKey(e.did.toLowerCase());if(v){var t=c.data.entries;for(l=0;l<t.length;l++){var m=t[l];if(j.StringHelpers.caseInsensitiveStringEquals(m.id,e.did)){m.selected=f=true;p(m)}}}}else if(e.group&&e.group==1){var u=b.data.entries;for(l=0;l<u.length;l++){var n=u[l];if(j.StringHelpers.caseInsensitiveStringEquals(n.id,e.cid)){n.selected=f=true;p(n);break}}}else if(e.qt==N)f=false;else if(e.cid&&s){if(e.sc!="documents"&&e.sc!="photos"){q(g);f=true}}else if(e.qt=="mru"){p(i);f=true}else if(e.qt==O){p(h);f=true}else if(e.v==r){if(d.deviceItemSet.getCount())q(c);else q(a);f=true}else if(e.qt==K){p(o);f=true}else if(e.v==B){q(b);f=true}else if(e.cid&&!s)f=false;else{q(g);f=true}!f&&k.trigger("unselectAll");return f}function F(){var b=M+"?cid="+A,a=new j.DataRequest(b,b+"&v="+Math.random(),null,G);a.queueId=null;a.start()}function G(l){var k=l.groups;if(k){var d=b.data;d.entries=[];for(var a=0;a<k.length;a++){var f=k[a];d.entries[a]={id:f.groupId,text:f.displayName,tooltip:f.displayName,bici:{SkyCmnd:"G",ClickLoc:"LN"},action:e.getAction("ViewGroup",null,f.groupId,true)}}var j=d.entries;if(j.length>0){var m=g.selected||i.selected||h.selected||b.selected||c.selected;if(!m&&u())d.$quickViewContainer.trigger(wLive.Controls.QuickView.EventNames.Expand);d.$quickViewHeader.prev().show();jQuery(d).trigger("render");for(a=0;a<j.length;a++){var n=j[a];sutra(n.$el,"$Sutra.SkyDrive.GroupItem")}}else d.$quickViewChevron.hide()}}function t(){if(!FilesConfig.devicesLeftNavEnabled)return;var m=a.data.$quickViewContainer,h=d.deviceItemSet,f=c.data,g=f.entries=[],i=h.getCount();Trace.log("LeftNavBar.js: loadDevices() - deviceCount == "+i,l);if(i>0){for(var b=0;b<i;b++){var j=h.get(b);g[b]={id:j.did,text:j.name,tooltip:null,bici:{SkyCmnd:"D",ClickLoc:"LN"},action:e.getAction("DefaultClick",j)}}f.$quickViewContainer.trigger("show");m.trigger("hide")}else{var k=a.data.entries[0];k.$a.addClass("leftNavBar_anchor_err");if(h.error)k.$el.show();else k.$el.hide();f.$quickViewContainer.trigger("hide");m.trigger("show")}jQuery(f).trigger("render");for(b=0;b<g.length;b++){var n=g[b];sutra(n.$el,"$Sutra.SkyDrive.DeviceItem")}}}defineSubClass("SkyDrive.UI.LeftNavBar",SkyDrive.UI.LegacyControlAdapter,null,{controlType:wLive.Controls.LeftNavBar})})();(function(){var b=wLive.Core,q=wLive.Controls,c=b.AleHelpers.getPCString,f=b.SkyDriveItemHelper;q.InfoPaneHeader=w;var m="iph_bc",j="iph_bctxt",k="iph_fakebc",r="iph_title",h="iph_nomar",o="iph_bit",g="iph_vf",e="iph_rts",d="iph_rtsw",p="iph_io",a=".",s="visibility",z="visible",A="hidden",C="click",B="title",y="search",u={width:260,height:130},v={width:260,height:90},i='<span class="c_clr"></span>',x='<div class="'+o+'"></div>'+'<div class="'+r+'"></div>',n='<div class="iph_tl"><a class="'+g+'"></a></div>',l='<div class="iph_tl '+d+'"><a class="'+e+'"></a></div>',t='<a class="'+m+'">'+'<span class="'+j+' t_ctc"></span>'+i+"</a>"+'<div class="'+k+'">'+i+"</div>"+'<div class="'+p+' t_cstc"></div>'+n+l;function w(w,E,N){var O=this,I=E.dataModel,Q=N&&N.sp,S=N&&N.vf,D,J,F,H,P,C,L,M,G;if(Q){w.html(t);F=jQuery(a+m,w);L=jQuery(a+j,F);P=jQuery(a+k,w);_$viewFolder=jQuery(a+g,w);_$returnToSearchWrapper=jQuery(a+d,w);_$returnToSearch=jQuery(a+e,_$returnToSearchWrapper);M=jQuery(a+p,w);sutra(F,"$Sutra.SkyDrive.InfoPaneBreadcrumb");sutra(_$viewFolder,"$Sutra.SkyDrive.InfoPaneViewFolder");sutra(_$returnToSearch,"$Sutra.SkyDrive.InfoPaneReturnToSearch");sutra(M,"$Sutra.SkyDrive.InfoPaneIndexOf");I.addListener(b.DataModel.dataChangedEvent,R)}else{var T=x;if(S)T+=i+n+l;w.html(T);H=jQuery(a+o,w);C=jQuery(a+r,w);_$viewFolder=jQuery(a+g,w);_$returnToSearch=jQuery(a+e,w);_$returnToSearchWrapper=jQuery(a+d,w);G=new q.NewItemTile(H,E);sutra(C,"$Sutra.SkyDrive.ItemName");sutra(_$viewFolder,"$Sutra.SkyDrive.InfoPaneViewFolder");sutra(_$returnToSearch,"$Sutra.SkyDrive.InfoPaneReturnToSearch")}O.render=function(d){D=d;if(f.isRootItem(d)&&!f.isGroupRoot(D)){var g=d.getChildren().getCount();if(f.isSearchQuery(d))g=d.estimatedResultCount;var k=g==1?"ItemCountSingle":"ItemCountMultiple";K(C,c(k).format(g));H.hide();C.addClass(h);C.show()}else{var a=d.getParent();if(Q){if(a.isPlaceholder){F.hide();P.prepend(L).show()}else{P.hide();F.html(L).show();b.ActionManager.setATagAction(E.actionManager.getAction("ViewItem",a),F)}var i=a&&a.name||"";K(L,i,i);J=d.parentKey;var e=I.getItem(J);if(e.folder.photoCount!==I.getChildCount(e)||E.viewParams.qt==y)M.text(".").css(s,A);else{var l=I.getIndexOfChild(J,d);M.text(c("InfoPaneHeader.IndexOf").format(l+1,e.folder.photoCount)).css(s,z)}}else{U();var j=D.name||"";K(C,j,j)}if(S){_$viewFolder.text(c("openfilelocationcommand"));if(a&&b.SkyDriveItemHelper.isSearchQuery(a)){_$returnToSearch.text(c("returntosearchcommand"));_$returnToSearchWrapper.show();b.ActionManager.setATagAction(E.actionManager.getAction("OpenFileLocation",D),_$viewFolder);b.ActionManager.setATagAction(E.actionManager.getAction("ViewItem",a),_$returnToSearch)}else{_$returnToSearchWrapper.hide();b.ActionManager.setATagAction(E.actionManager.getAction("ViewItem",a),_$viewFolder)}if(a.isPlaceholder)_$viewFolder.attr("href","#cid="+d.ownerCid)}if(C)C.removeClass(h)}};O.renderSelection=function(a){K(C,c("SelectionCount").format(a.selectionCount));H.hide();C.addClass(h);C.show()};function U(){if(D){var a=D.photo,b=!D.folder&&!a?v:u;if(a&&a.height)b=JBase.UI.ImageSizeHelper.scaleToContainer(a,b);H.css(b).show();G.initialize();G._controlInstance.setSize(b);G.render(D);C.hide()}}O.dispose=function(){if(G)G.dispose();if(Q)I.removeListener(b.DataModel.dataChangedEvent,R)};function K(b,c,a){b.text(c).attr(B,a===undefined?"":a)}function R(a){if(J==a.key)O.render(D)}}})();(function(){var d=wLive.Core,b=d.AleHelpers.getPCString,a=b("ReportAbuse.PopoverError");wLive.Controls.InlineError=c;function c(d,b,c){var e=this;e.render=function(){var f=jQuery('<div class="ine_error"></div>');d.append(f);sutra(f,"$Sutra.SkyDrive.InlineError");var e=jQuery('<div class="ine_text"></div>');if(c&&b)e.html(b);else if(b)e.text(b);else e.text(a);f.append(e);f.append(jQuery('<div class="c_clr"></div>'))}}})();(function(){wLive.Controls.PlaceholderInput=a;function a(a,b){var e=this;e.render=function(){if("placeholder" in a[0]){a.attr("placeholder",b);return}a.focus(d);a.blur(c);c()};function d(){if(a.val()==b){a.removeClass("pi_placeholder");a.val("")}}function c(){if(a.val()==""){a.addClass("pi_placeholder");a.val(b)}}}})();(function(){var a=wLive.Core.AleHelpers.getString("Loading");wLive.Controls.LoadingSpinner=b;function b(c,b){var d=this;d.render=function(){b=b==null?a:b;var e=$f&&$f.createLoading({returnMarkup:true,useTransparentFallback:true,text:b}),d=jQuery(e);c.append(d);$f.showLoading(d);d.find(".c_loadingText").addClass("t_ctc");sutra(d,"$Sutra.SkyDrive.LoadingSpinner")}}})();(function(){var a=wLive.Controls,c='<div class="lcCenter"><div class="lcWrapper"></div></div>',b=250,f=jQuery.support.opacity,d=$B.ltr?"left":"right";a.LoadingCue=e;function e(g){g.html(c);var k=jQuery(".lcCenter",g),e=jQuery(".lcWrapper",g).hide(),j=new a.LoadingSpinner(e);j.render();e.css("margin-"+d,-(e.width()/2));sutra(e,"$Sutra.SkyDrive.LoadingCue");var i=this,h=false;i.setVisibility=function(a){if(!a)e.stop(true).hide();else{if(!h)if(f)e.stop(true).delay(b).css("opacity",0).show().animate({opacity:1},500);else e.show();if(k.offset().top>=jQuery(window).scrollTop())e.css({position:"absolute"});else e.css({position:"fixed"})}h=a};i.update=function(){i.setVisibility(h)}}})();(function(){var b=wLive.Core,h=b.AleHelpers.getPCString,k=[],d={},a=false,e="navigate",i={},f=jQuery(i);b.BeforeUnloadManager={registerHandler:function(b,a){this.addObjectListener(this,a?"beforehashchange":"beforeunload",b)},unRegisterHandler:function(a){this.removeObjectListener(this,"beforehashchange",a);this.removeObjectListener(this,"beforeunload",a)}};mix(b.BeforeUnloadManager,JBase.ObjectEventing);function j(a){f.bind(e,a)}function g(c,b,a){$Do.when("Bucket3.js",0,function(){var e=wLive.Controls.Notifications.createModalDialog({buttons:{action:h("ContinueStr"),close:h("Cancel")},title:"",content:c}),d=jQuery(e);d.bind({"aftershow._dlg":function(c,a){var b=jQuery(a.content());sutra(b,"$Sutra.SkyDrive.BeforeUnloadDialog");sutra(a.getButton({buttonName:"action"}),"$Sutra.SkyDrive.BeforeUnloadContinueButton");sutra(a.getButton({buttonName:"close"}),"$Sutra.SkyDrive.BeforeUnloadCancelButton")},"afterdismiss._dlg":function(b,a){d&&d.unbind("._dlg");d=null;a=null},"buttonclick._dlg":function(e,d,c){if(c==="action")b();else a&&a()}});e.show()})}function c(c){var a="";raiseEventWithProcessing(b.BeforeUnloadManager,c?"beforehashchange":"beforeunload",function(b){return !(a=b)},{},false);return a}$Do.when("$History.attach",0,function(i,b){var h=c(true);if(h&&!a){$BSI.navigateTo("#"+$Utility.serialize(d));g(h,function(){setTimeout(function(){a=true;$BSI.navigateTo("#"+$Utility.serialize(b))},0)},function(){a=false})}else{a=false;d=b;f.trigger(e,b)}});$Do.when("$PF.attachPreMerge",0,function(){var a=c(false);if(a)g(a,function(){$PF.allowMerge()});else $PF.allowMerge()});window.onbeforeunload=function(){var a=c(false);if(a)return a};$Do.register("BeforeUnloadManager.attach",j,true)})();(function(){var a=wLive.Core,j=wLive.Controls,x=a.BrowserStorage,g=a.AleHelpers.getPCString,c=a.AleHelpers.getString,b=a.SkyDriveItemHelper,e=a.SkyDriveItem,v=JBase.UI.ImageStripHelper;v.registerStrip(FilesConfig.imageStripUrl_8,FilesIS8);v.registerStrip(FilesConfig.imageStripUrl_32,FilesIS32);var Hb="1",Gb="7",Nb="BestFitGrid",u="photos",r="documents",V="recyclebin",Bb="mru",ub="shared",n="search",B="root",f=".PageController",o="/favicon.ico",Lb=".pdf",i="SelfView",y="SetView",m="PdfView",s="ArrangeView",D="arrange",t="DevicesView",q="FolderPickerView",l="FilePickerView",w="GroupView",Y="Folder",jb="Root",Z="Search",qb="Recent",ab="Shared",L="GRoot",S="Remote",rb="PDF",kb="1UP",p="SkyDrive.Sort.",Cb=46,Ib=113,Jb=65,Db=27,lb="fetch",A="resize",Fb="keydown",nb="9",wb="22",H="8",Mb=6,hb=101,gb=102,bb=103,pb=152,ib=200,Q=201,eb=202,mb=3e3,cb=10001,db=10002,T=10004,F=10005,J=10006,K=10009,G=10011,sb=10012,M=10013,tb=10027,N=c("FilesPageTitle"),Ab=c("AllFilesRootTitle"),Eb=c("AllDocsRootTitle"),zb=c("AllPhotosRootTitle"),R=c("AllFilesVisitorRootTitle"),X=c("AllDocsVisitorRootTitle"),O=c("AllPhotosVisitorRootTitle"),P=c("DocsSharedWithMe"),Kb=c("GroupDocuments"),U=c("RecentDocuments"),yb=c("RecycleBin"),W=c("SharedWithGroup"),fb=c("SearchResults"),E="<span>"+c("NotificationBar.SignInToDownload").format("<a href='#'>","</a>")+"</span>",xb=8*60*60*1e3,vb=new RegExp("wreply=[^&]*"),d="PageController",h=jQuery(window),z=jQuery(document);a.PageController=ob;function ob(Vb,Jc,Kc,Nc,Qb,Lc,Ic,ac){Trace.log("Creating page controller",d);var ob=this,tc=false,Tb="",Xb=true,Wb,kc,Mb,Nb=null,mc,Yb=false,gc=false,hc=false,ec={w:h.width(),h:h.height()},Lb=j.Notifications,Kb,C,Ob,v,Pb,Ub,Dc=(new Date).getTime()+xb;if(Qb=="UnAuth")Qb="";var cc=false,I=new a.DataModel(Jc,Kc,Nc,Qb,Lc,Ic);$Do.when("Bucket3.js",0,function(){Lb&&Lb.getQueue().start()});var Rb=null;$Do.when("wLive.Core.DragAndDropController",0,function(){var b=jQuery(_ce("div"));jQuery(document.body).append(b);Rb=new a.DragAndDropController(b,k);Rb.render(null)});var k={callerCid:Qb,viewParams:null,dataModel:I,deviceItemSet:new a.DeviceItemSet,actionManager:new a.ActionManager,multiselectActionManager:new a.ActionManager,operationManager:a.OperationManager.getInstance(),errorManager:new a.ErrorManager,selectionManager:new a.SelectionManager(I),contextMenu:null,authenticateUser:Sb,$rootElement:Vb,sortBy:Mc,sortField:null,sortDirection:null,tokenHasBeenRedeemed:false,itemScopedDisposables:[]};k.contextMenu=new j.ContextMenu(null,k);var rc=jQuery(k),sc=false;b.registerJsonApiActions(k);b.registerLinkActions(k);b.registerMultiselectActions(k);$Do.when("wLive.Core.Super",0,function(){ob.setupSuper()});var Pc=jQuery(I);function Oc(){if(!sc){sc=true;I.addListener(a.DataModel.dataChangedEvent,qc);I.addListener(a.DataModel.errorEvent,vc);k.viewParams=$Config.AjaxHistory&&$Config.AjaxHistory.state?$Config.AjaxHistory.state:{};jc();if(k.viewParams.id&&k.viewParams.id!=B&&k.viewParams.qt==n){var d=k.viewParams.cid?"cid="+k.viewParams.cid:"";$BSI.navigateTo("?"+d+"&id="+k.viewParams.id,"_top")}if(wLive.Core.Search)a.Search.setSearchQuery(k.viewParams.q);if(k.viewParams.clearLocalStorage)window["localStorage"]&&window["localStorage"].clear();if(ac){var b=k.viewParams;C=e.getItemKey(b.id,b.cid,b.group,b.qt,b.did,b.q);fc();var c=e.getSetKey("0",null,Ob,bc(),"0");e.setDefaultSetKey(c);I.processResponse(ac,C);wLive.PageStats.add(ac.pageStats)}$Do.when("BeforeUnloadManager.attach",0,Gc);h.bind(A+f,pc);h.bind("orientationchange"+f,pc);Vb.bind(A+f,function(){return false});rc.bind("perfLoad"+f,nc);Cc();z.bind(Fb+f,Bc)}}function Bc(b){var c=b.which,j=jQuery(b.target),d=k.selectionManager;if(!a.PopoverHelpers.isPopoverVisible()&&!a.DomHelpers.isTextInputElement(j))if(c==Cb&&!(b.shiftKey||b.ctrlKey)){ob.doActionOnSelectionOrSingleItem("Delete");return false}else if(b.ctrlKey&&c==Jb&&v&&v.folder){d.selectAll(v);return false}else if(c===Ib&&k.currentViewType!==l){var h=d.getSingleSelectedItem(v);if(h){ob.doActionOnSelectionOrSingleItem("Rename");return false}}else if(c===Db&&v){var i=d.getSelection();if(i.selectionCount>0){d.deselectAll(v);return false}else{var e=v.getParent();if(e&&!e.isPlaceholder){var f=k.actionManager;f.doAction(f.getAction("ViewItem",e));return false}}}else if((b.ctrlKey||b.metaKey)&&b.altKey&&c==79)$Do.when("Bucket3.js",0,function(){if(Lb){var b=Lb.createModalDialog({buttons:{action:g("Office.Sharing.Done")},title:g("DebugHeader"),content:'<textarea style="width: 360px; height: 150px;">['+a.DataRequest.Errors.join(",\n")+"]</textarea>"}),c=jQuery(b);c.bind({"aftershow.dlg":function(){b.getButton({buttonName:"action"}).focus()},"afterdismiss.dlg":function(){c&&c.unbind("._dlg");c=null;b=null},"buttonclick.dlg":function(){b.dismiss();return true}});b.show()}})}ob.doActionOnSelectionOrSingleItem=function(c){var a,b=k.selectionManager.getSelection();if(b.selectionCount==0)a=k.actionManager.getAction(c,v);else if(b.selectionCount==1){var d;for(var e in b.indexes){d=k.dataModel.getChildByIndex(b.parent,e);break}a=k.actionManager.getAction(c,d)}else a=k.multiselectActionManager.getAction(c,b);if(a)k.actionManager.doAction(a)};function Cc(){var d=window,a=d.external;try{if(a&&typeof a.msAddSiteMode!="undefined"&&a.msIsSiteMode()){var b=k.actionManager;a.msSiteModeCreateJumplist(c("IE9JumpList.View"));a.msSiteModeAddJumpListItem(g("LeftNavBar.QuickViews.SharedDocs.Text"),"/"+b.getAction("ViewSharedDocs",null).url,o);a.msSiteModeAddJumpListItem(g("LeftNavBar.QuickViews.Mru.Text"),"/"+b.getAction("ViewRecentDocs",null).url,o);a.msSiteModeAddJumpListItem(c("IE9JumpList.MyFiles"),"/",o);a.msSiteModeShowJumplist()}}catch(e){}}ob.dispose=function(){if(!tc){tc=true;Trace.log("Disposing page controller",d);$Do.when("Bucket3.js",0,function(){Lb&&Lb.getQueue().reset()});if(Rb){Rb.dispose();Rb=null}if(Kb){Kb.dispose();Kb=null}if(k.contextMenu)k.contextMenu.dispose();I.removeListener(a.DataModel.dataChangedEvent,qc);I.removeListener(a.DataModel.errorEvent,vc);h.unbind(f);z.unbind(f);Vb.unbind(f);rc.unbind(f);window.requests.abortAll();document.body.removeAttribute("view");Vb.hide()}};ob.render=function(){Trace.log("Render called",d);Oc();var b=k.viewParams,i=C,c=v;C=e.getItemKey(b.id,b.cid,b.group,b.qt,b.did,b.q);if(!Qb&&!b.id&&!b.cid)Sb();else{v=I.getItem(C,true);if(i!==C||b.sc!==mc){Mb=null;Nb=null;fc();a.SkyDriveItemSet.removeMarkedHeaderItems();for(var f=0;f<k.itemScopedDisposables.length;f++)k.itemScopedDisposables[f]["dispose"]();k.itemScopedDisposables=[]}var h=e.getSetKey(yc(C,v),null,Ob,bc(),wc(C,v));e.setDefaultSetKey(h);v=I.getItem(C);var g=v?v.getChildren():null;if(Pb!=g){Pb&&Pb.removeListener("change",ic,ob);Pb=g;Pb&&Pb.addListener("change",ic,ob)}if(!v){Trace.log("Item being requested not in cache, showing loading item",d);v=I.getLoadingItem(C)}else{Trace.log("Item found in cache (hasExpired: "+v.hasExpired()+")",d);if(c&&c!=v&&c.getParent(false)!=v.getParent(false))window.requests.abort(lb);if(c&&c.id==="root"&&c.did&&v.id!=="root"&&v.did===c.did)$BSI.reportEvent("SelectClick.RemoteLocation.Load",{DevicesLocation:v.iconType})}k.currentItem=v;oc(v);mc=b.sc}};ob.getViewContext=function(){return k};ob.setView=function(c,a){if(!c)oc(a);else{if(c!=Tb){Lb&&Lb.getQueue().reset();if(Kb){Kb.dispose();Kb=null}Trace.log("Creating "+c,d);Kb=Hc(c);Trace.log("Done creating "+c,d)}if(Kb){Tb=c;k.currentViewType=Tb;var f=Y;if(c===i)f=kb;else if(c===m)f=rb;else if(b.isMruQuery(a))f=qb;else if(b.isSharedQuery(a))f=ab;else if(b.isSearchQuery(a))f=Z;else if(b.isGroupRoot(a))f=L;else if(a.did)f=S;else if(b.isRootItem(a))f=jb;k.biciPageId=f;if(k.itemKey!==C){k.previousItemKey=k.itemKey;k.itemKey=C}lc(a);$f.updateTitle(N.format(a.name));var n=e.getDefaultSetKey(),h=Wb!=a.key,j=kc!=n;if(h||j)Lb&&Lb.getQueue().reset();if(!a._isLoadingItem&&!l)if(h){!k.selectionManager.hasPreselectedChild(a)&&Wb&&k.selectionManager.deselectAll(Wb,true);k.selectionManager.resetPreselectionFlag()}else if(j)k.selectionManager.resolveSelection(a);Trace.log("Rendering "+c+" ("+a.name+", id: "+a.id+", setKey: "+e.getDefaultSetKey()+")",d);Kb.render(a);Trace.log("Done rendering "+c,d);var l=a.folder&&I.getChildCount(a)>0&&!I.getChildByIndex(a,0,true),g=c;if(b.isGroupRoot(a))g+="-Group";else if(b.isMruQuery(a)&&b.isRootItem(a))g+="-MRU";else if(b.isSharedQuery(a)&&b.isRootItem(a))g+="-Shared";else if(b.isSearchQuery(a)&&b.isRootItem(a))g+="-Search";$CSIPerf.setPerformanceId(g+(Xb?"-Init":""));if(!a._isLoadingItem&&!l){Wb=a.key;kc=n;if(Xb)Xb=false;else if(h||j)$BSI.informPVHead();nc();$Do.when(Ec(c),0,function(){sutra.load("view",c)})}else sutra.load("view","")}}};ob.getBestEffortSortField=function(c,d){var b=Hb,e=$Cookie.getCookie("sd-v"),f=k.viewParams,g=$Utility.deserialize(c,"&",false,false),a=dc(d);if(a&&a.folder&&a.folder.defaultSort&&!a.isPlaceholder)b=a.folder.defaultSort+"";else b="0";return b};function yc(c,a){var d=ob.getBestEffortSortField(c,a);if(Mb===Gb&&!b.isSharedQuery(a))Mb=null;return Mb||Mb===0?Mb:d}ob.getBestEffortSortDirection=function(c,d){var b="0",e=k.viewParams,f=$Utility.deserialize(c,"&",false,false),a=dc(d);if(a&&a.folder&&a.folder.defaultSort&&!a.isPlaceholder)b=a.folder.defaultSortDirection;return b};function wc(a,b){if(Nb===null||Nb===undefined)return ob.getBestEffortSortDirection(a,b);else return Nb}function dc(a){if(a&&!a.folder)a=a.getParent();return a}function fc(){var c=C;if(v){var b=dc(v);if(b.key!=C)c=b.key}var a=x.getSessionValue(p+c);if(a){Mb=a.sortField;Nb=a.sortDirection}}var bc=ob.getGroupByParam=function(){var a="0,1,2",b=k.viewParams.qt;if(b=="shared"||b=="search")a="0";return a};function oc(a){if(k.viewParams.v==t)a=I.getPlaceholderItem(a.key,g("DevicesLanding.Header"),false,{isDevicesLandingPage:true});else if(k.viewParams.v==w)a=I.getPlaceholderItem(a.key,g("GroupsLanding.HeaderText"),false,{isGroupsLandingPage:true});var c=y,r=C,b=k.viewParams||{};if(a.commands)Ub=Ub||a;if(b.sff=="1"&&a.folder&&I.getChildCount(a)>0&&!a._isLoadingItem){var p=I.getChildCount(a),e;for(var f=0;f<p;f++){e=I.getChildByIndex(a,f);if(!e)return;else if(e.photo||e.video)break}if(e){b.id=e.id;a=e;C=a.key}}k.selectionMode=k["selectionMode"]||b.select;k.selectionManager&&k.selectionManager.setMultiSelectEnabled(k.selectionMode!=="single");b.sff="0";if(b.v==FilesConfig.folderPickerViewParam)c=q;else if(b.v==FilesConfig.filePickerViewParam)c=l;else if(k.viewParams.v===w||k.viewParams.v===t)c=y;else if(k.viewParams.v==D)c=s;else if(a.photo||a.video||a.isProcessingVideo)c=i;else if(a.isPdf&&!$B.Mobile)c=m;else if(!a.folder)if(Tb===i)c=i;else{var d=a.getParent();if(!d){a=I.getLoadingItem(a.key);C=a.key}else if(d.key!=C){var o=I.getIndexOfChild(d.key,a);if(o>-1){k.selectionManager.clickSelect(d,o,{preselect:true});k.preSelectedItemKey=a.key;b.id=d.id;a=d;C=a.key;v=a;Yb=false}else{Yb=true;a=I.getLoadingItem(d.key);C=d.key}}}ob.setView(c,a);if(Ub&&Ub.commands&&!gc&&b.action&&!Yb){var h=k.actionManager,n=h.getAction(b.action,Ub);if(n)h.doAction(n);else if($B.SignedOut&&b.action==="Download"){var j=jQuery(E);j.find("a").bind("click",function(){Sb();return false});k.errorManager.add({$element:j,priority:0,type:1})}gc=true}}function ic(){k.selectionManager.resolveSelection(v)}function nc(){if($BSI.isLoading()){var a=v,b=a&&a.folder&&I.getChildCount(a)>0&&!I.getChildByIndex(a,0,true);if(!a._isLoadingItem&&!b)if(!Kb.isLoaded||Kb.isLoaded()){$CSIPerf._ttg=(new Date).getTime();$BSI.informLoaded();if($B.Full)$Do.when("Bucket3.js",0,function(){$Do.when("Bucket4.js",0,function(){$Do.when("mapcontrol.ashx",0,function(){});$Do.when("Bucket2c.js",0,function(){})});if(!hc){hc=true;window.$Network.fetchCSS(FilesConfig.bucket3CssLocation,function(){if(!$B.IE)setTimeout(function(){$Do.register("Bucket3.css")},1e3);else $Do.register("Bucket3.css")})}})}}}function Ec(b){var a;if(b==l)a="FilePickerBucket.js";else if(b==q)a="FolderPickerBucket.js";else if($B.Mobile)a="MobileBucket2b.js";else a="Bucket4.js";return a}function Hc(a){var b=null;if(j[a])b=new j[a](Vb,k);else if(!cc){cc=true;if(a===m)$Do.when("Bucket2c.js",0,function(){});else if(a===s)$Do.when("Bucket4.js",0,function(){});$Do.when("wLive.Controls."+a,ob,function(){cc=false;ob.render()})}return b}function Fc(){return Dc<(new Date).getTime()}function uc(){$BSI.navigateTo($PF.getCurrentUrl(),"_top")}function Sb(){var a=zc(FilesConfig.si,$PF.getCurrentUrl());$BSI.navigateTo(a,"_top")}function zc(b,a){return b.replace(vb,"wreply="+a.encodeUrl())}function qc(a){Trace.log("Data changed: "+a.key,d);if(a.key==C)ob.render()}function Ac(a){switch(a.code){case T:case F:case G:case J:case tb:a.message=g("DA.Error"+a.code)}}function vc(a){if(a&&a.key==C){Ac(a);if(v._isLoadingItem){v=jQuery.extend(I.getLoadingItem(C),v);v.error=a}switch(a.code){case gb:case pb:case hb:case bb:Sb();break;case ib:$BSI.navigateTo(FilesConfig.suspendedUrl);break;case eb:$BSI.navigateTo(FilesConfig.marketBlockedUrl);break;case Q:uc();break;case db:$BSI.navigateTo("#cid="+FilesConfig.hcid.encodeUrl());var e=k.deviceItemSet.getByKey(k.viewParams.did.toLowerCase());if(e)k.deviceItemSet.remove(e);a.message=g("DA.Error"+a.code);var b=jQuery("<span>"+g("DA.Error"+a.code)+"</span>");sutra(b,"$Sutra.SkyDrive.RemoveDeviceSuccess");k.errorManager.add({$element:b,priority:1,type:2,code:a.code});break;case cb:case sb:case M:var f=jQuery.extend(I.getLoadingItem(C),v);f.error=a;Kb&&Kb.render(f);$Do.when($B.Mobile?"MobileBucket4.js":"Bucket4.js",0,function(){sutra.load("view",Tb)});break;default:if(a.code==mb||a.code==K)if(!Qb){Sb();return}else{v=jQuery.extend(I.getLoadingItem(C),v);v.error=a}var h=a.message||c("LoadGenericError"),d=jQuery(document.createElement("div")),i="<span>"+h.encodeHtml()+"</span>";d.html(i);k.errorManager.add({$element:d,priority:0,type:0,code:a.code});if(Kb)Kb.render(v)}}}function pc(){if(Kb&&Kb.resize){var a={w:h.width(),h:h.height()};if(ec.w!=a.w||ec.h!=a.h){Kb.resize();ec=a}}}function Gc(c,b){if(!Xb)$BSI.informNav("#"+$Utility.serialize(b),null,null,false,false,null,true);if(Fc())uc();else{k.viewParams=b;jc();if(wLive.Core.Search)a.Search.setSearchQuery(k.viewParams.q);ob.render()}}function jc(){var a=k.viewParams;a.did=a.did||"";a.group=parseInt(a.group||0);Ob=null;if(!a.id&&a.sc){var b=a.sc=a.sc.toLowerCase();switch(b){case u:Ob=nb;break;case r:Ob=wb}}else if(a.id&&a.id!=B&&a.qt==n)Ob=H}function lc(a){a.name=a.name||"";var d=k.viewParams;if(!a.parentKey&&a._missingName){var e=d.sc,c=d.qt,l=e&&e===r,j=e&&e===u,h=d.group&&d.group==="1",p=c&&c===ub,o=c&&c===n,m=c&&c===V&&window.FilesConfig.recycleBinEnabled,q=c&&c===Bb;if(!!d.did){var g=k.deviceItemSet.getByKey(d.did.toLowerCase());a.name=g?g.name:""}else if(p)if(h)a.name=W;else a.name=P;else if(o)a.name=fb.format(a.getSearchQuery());else if(h)a.name=a.ownerName||"";else if(q)a.name=U;else if(m)a.name=yb;else{var f=a.ownerCid&&a.ownerCid.toLowerCase()==FilesConfig.hcid.toLowerCase();if(l)a.name=f?Eb:a.ownerName?X.format(a.ownerName):"";else if(j)a.name=f?zb:a.ownerName?O.format(a.ownerName):"";else if(!a.parentKey&&!a._isLoadingItem)a.name=f?Ab:a.ownerName?R.format(a.ownerName):""}}else if(b.isSearchResult(a)){var i=a.getParent();if(i)lc(i)}}var Zb=null;function xc(){if(document.body.insertAdjacentElement){if(!Zb){var b=Zb=_ce("iframe"),a=b.style;a.width=a.height="1px";a.top=a.left="-1000px";a.position="absolute";b.tabIndex=-1;document.body.insertAdjacentElement("afterBegin",b)}Zb.contentWindow.location.replace("about:blank")}}function Mc(b,a){if(a===undefined||a==null)a="0";Mb=b;Nb=a;e.setDefaultSetKey(e.getSetKey(b,null,e.getSetKeyParts().ft,bc(),a));x.setSessionValue(p+C,{sortField:Mb,sortDirection:Nb});ob.render();v&&v.invalidate();setTimeout(xc,0)}}var k;a.PageController.getInstance=function(){return k};function I(){var c=jQuery("#filesPageContent"),a=FilesConfig,b=new wLive.Core.PageController(c,a.baseApiUrl,a.canary,a.appId,a.hcid,$Config.mkt,a.dataPageSize,primedResponse);$Do.when("$PF.attach",b,b.dispose);h.bind("unload",function(){b.dispose()});return b}function C(){k=I();k.render()}Trace.log("Script loaded",d);$Do.when("primedResponse",0,function(){Trace.log("Primed response available",d);if($Config.AjaxHistory&&$Config.AjaxHistory.state&&$Config.AjaxHistory.state["did"])$Do.when("getDevicesResponse",0,C);else C()})})();(function(){var b=wLive.Core,e=b.SkyDriveItem,j="c_search_SearchBox_box",i="root",l=(new Date).getTime(),f=0,d="",a=null,c=false;b.Search={execute:function(a){a=a||this.getSearchQuery();if(a===d)f++;var g=History;g.forceNextNavigate(true);var c=b.PageController.getInstance().getViewContext(),e=c.isSuper?"&cid="+c.viewParams.cid:"";$BSI.navigateTo("#qt=search&q="+encodeURIComponent(a)+e);if($B.IE)b.Search.takeFocus();return false},takeFocus:function(){var a=h();if(a)a.focus()},hasFocus:function(){var a=h();if(a)return a.is(":focus");return false},getSearchOrigin:function(){return l+f},getSearchQuery:function(){a||g();if(a)return a.getValue()},setSearchQuery:function(b){a||g();if(a)if(!b)a.resetDefault();else{k();a.setValue(b,true)}if(b!==d){d=b;f++}}};function g(){a=window["$SB"]&&window["$SB"]["sbs"]&&window["$SB"]["sbs"][j]}function k(){var f=b.PageController.getInstance().getViewContext(),a=f.viewParams;if(a.qt==="search"){var j=c;if(!a.id||a.id==i)c=false;else c=true;var h=e.getSetKey(b.JSONConstants.SortField.Relevancy,null,c?b.JSONConstants.FilterType.PhotosAndVideos:null);e.setDefaultSetKey(h);if(!c||!j||d!=a.q){var k=e.getItemKey(i,a.cid,a.group,a.qt,a.did,a.q),g=f.dataModel.getItem(k,true);if(g)g.expire()}}else c=false}function h(){var a=jQuery(".searchContainer input[name=query]");if(a.length==1)return a;return null}})();(function(){function a(c){var b=c.getElementsByTagName("meta");for(var a=0;a<b.length;a++)if(b[a].name=="viewport"){b[a].content=FilesConfig.isWac?"width=device-width, initial-scale=1.0, maximum-scale=4.0, minimum-scale=1.0":"width=device-width, initial-scale=1.0, maximum-scale=1.01, minimum-scale=0.99";break}}if($B.SF_iPhone&&!$B.Mobile)setTimeout(function(){a(document);a(window.parent.document)},100)})();(function(){defineNamespace("SkyDrive.Constants.FileTypes",{access:"access",audio:"audio",excel:"excel",exe:"exe",folder:"folder",file:"file",html:"html",infoPath:"infopath",oneNote:"onenote",pdf:"pdf",picture:"picture",powerPoint:"powerpoint",project:"project",publisher:"publisher",richText:"richtext",text:"text",video:"video",visio:"visio",word:"word",xaml:"xaml",xml:"xml",xps:"xps",zip:"zip"})})();(function(){var c=JBase.UI.ImageStripHelper,a=SkyDrive.Constants.FileTypes,b={audio:a.audio,doc:a.word,docm:a.word,docx:a.word,dot:a.word,dotm:a.word,dotx:a.word,exe:a.exe,html:a.html,mdb:a.access,mpp:a.project,odp:a.powerPoint,ods:a.excel,odt:a.word,one:a.oneNote,onepkg:a.oneNote,onetoc2:a.oneNote,notebook:a.oneNote,pdf:a.pdf,photo:a.picture,pot:a.powerPoint,potm:a.powerPoint,potx:a.powerPoint,ppa:a.powerPoint,ppam:a.powerPoint,pps:a.powerPoint,ppsm:a.powerPoint,ppsx:a.powerPoint,ppt:a.powerPoint,pptm:a.powerPoint,pptx:a.powerPoint,pub:a.publisher,rtf:a.richText,txt:a.text,video:a.video,vsd:a.visio,xaml:a.xaml,xla:a.excel,xlam:a.excel,xls:a.excel,xlsb:a.excel,xlsm:a.excel,xlsx:a.excel,xlt:a.excel,xltm:a.excel,xltx:a.excel,xml:a.xml,xps:a.xps,xsn:a.infoPath,zip:a.zip};defineNamespace("SkyDrive.FileTypeHelper",{getFileType:function(c){var d="";if(c){var e=c.iconType||"";d=c.folder?a.folder:b[e.toLowerCase()]}return d||a.file},getIconInfo:function(a,b,e){var d;if(a){var h=a.iconType||"",f="ft_"+b+"_"+h+(a.folder&&e?"Selected":"");d=c.getImageInfo(f);if(!d&&a.iconType){var g=b===16?"tiny":b===32?"smaller":"small";d={url:FilesConfig.foldersImgBaseUrl+"/icons/"+g+"/"+a.iconType+".png",containerSize:{width:b,height:b}}}}return d},isOfficeDocument:function(c){var b=this.getFileType(c);return b===a.word||b===a.excel||b===a.powerPoint||b===a.oneNote}})})();(function(){var a=JBase.UI.ImageStripHelper,c=wLive.Core.AleHelpers.getPCString,d=wLive.Core.SkyDriveItemHelper,o={width:192,height:130},g=!($B.IE&&$B.V<10),f=g?600:0,i=1500,k=30,p=c("ItemTileSurveyTag"),e={url:null},h=a.getImageInfo("warning","",c("RestrictedNotification.Visitor")),j=a.getImageInfo("warning","",c("RestrictedNotification.Owner").format("","")),m="ItemTile";Trace.register(m,{isEnabled:false});var b;defineSubClass("SkyDrive.UI.ItemTile",JBase.UI.BaseControl,function(){b=b||(wLive.Core&&wLive.Core.PageController&&wLive.Core.PageController.getInstance?wLive.Core.PageController.getInstance().getViewContext():{});this.baseTag="span";this.imageTile=this.createChild(JBase.UI.ImageTile,{imageAnimationDuration:this.imageAnimationDuration,baseClass:"thumbnail"});this.iconTile=this.createChild(JBase.UI.ImageTile);this.overlayTile=this.createChild(JBase.UI.ImageTile,{baseClass:"overlay"});this.notificationTile=this.createChild(JBase.UI.ImageTile,{baseClass:"notificationIcon"});this._transitionDuration=this.imageAnimationDuration},{_size:o,hasAlert:false,imageAnimationDuration:f,onDataContextChanged:function(h){var a=h.item||{};this._resetOnItemChange();var i=a.iconType==="Audio",g=SkyDrive.FileTypeHelper.isOfficeDocument(a),c=l(a,this._coverIndex),f=this._getThumbnailContainerSize(a);if(this._thumbnailSet!=c){this._thumbnailSet=c;this._thumbnail=c?d.pickThumbnail(c,f.width,f.height):null;this._thumbnailUrl=this._thumbnail?this._thumbnailSet.baseUrl+this._thumbnail.url:null}mix(this,{tileWidth:this._size.width,tileHeight:this._size.height,rootClass:"tileContent "+SkyDrive.FileTypeHelper.getFileType(a)+(this._thumbnailUrl?" hasThumbnail":"")+(g?" officeDoc":""),name:a.getDisplayName(b),childCount:a.form?p:a.folder&&!a.did?String(a.folder.totalCount):"",showNamePlate:!!(!this._thumbnailUrl||a.folder||g||i)&&!a.isProcessingVideo,showNotificationTab:this.shouldShowNotificationTab(a),hasIcon:!a.folder,decoratedName:d.highlightAndEncodeField(a,"name")+(a.isUnknownFileType&&a.extension?a.extension.encodeHtml():"")});this.imageTile.scaleToFit=this.scaleImage;this.imageTile.imageAnimationDuration=this._transitionDuration;this.imageTile.verticalCenterRatio=g?0:1/3;this.imageTile.setDataContext({url:this._thumbnailUrl,containerSize:f,imagePosition:this._thumbnail,originalSize:a.photo});this.iconTile.setDataContext(this.hasIcon&&this.showNamePlate?SkyDrive.FileTypeHelper.getIconInfo(a,16):e);this.notificationTile.setDataContext(this.getNotificationTileInfo(a));this.overlayTile.setDataContext(n(a,!this.showNamePlate))},_getThumbnailContainerSize:function(a){return a?{width:this._size.width-(SkyDrive.FileTypeHelper.isOfficeDocument(a)?2:0),height:this._size.height-(a.folder?k:0)}:this._size},setSize:function(a){if(this._size.width!==a.width||this._size.height!==a.height){this._size={width:a.width,height:a.height};this.imageTile&&this.dataContext&&this.imageTile.setDataContext({containerSize:this._getThumbnailContainerSize(this.dataContext.item)})}},pulse:function(){this._transitionDuration=i;this._coverIndex++;this.change()},canPulse:function(){var a=this.dataContext.item;return a&&a.folder&&a.folder.covers&&a.folder.covers.length>1},shouldShowNotificationTab:function(a){return a.itemStatus&&a.itemStatus>0&&a.isViewerOwner()&&a.sharingLevelValue!=4},getNotificationTileInfo:function(a){return this.showNotificationTab?d.isViewerOwner(a)?j:h:""},_resetOnItemChange:function(){var a=this.dataContext.item;if(a&&a.key!=this._lastItemKey){this._coverIndex=0;this._lastItemKey=a.key;this._transitionDuration=this.imageAnimationDuration}}});function n(c,d){var b;if(c&&d)if(c.isProcessingVideo)b="processingVideo_32";else if(c.video)b="video_32";return b?a.getImageInfo(b):e}function l(a,c){var b;if(a)if(a.folder){if(a.folder.covers&&a.folder.covers.length){c%=a.folder.covers.length;b=a.folder.covers[c]}}else b=a.thumbnailSet;return b}defineSubClass("wLive.Controls.NewItemTile",SkyDrive.UI.NewControlAdapter,null,{controlType:SkyDrive.UI.ItemTile})})();SkyDrive.UI.ItemTile.prototype.onRenderHtml=function(){return "<"+this.baseTag+""+sutraAttribute("SkyDrive.ItemTile")+' id="'+htmlAttributeEncode(this.id+"_0")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="c-'+this.controlName+" "+this.baseClass+'">'+'<span id="'+htmlAttributeEncode(this.id+"_1")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+""+generateAttributesString("class",this.rootClass)+">"+this.imageTile.renderHtml()+'<span id="'+htmlAttributeEncode(this.id+"_2")+'" style="'+this.baseStyle+" "+generateStyleAttribute("display",this.showNotificationTab)+'">'+'<span id="'+htmlAttributeEncode(this.id+"_3")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="notificationTab'+generateClassAttribute("alertMode",this.hasAlert)+'">'+"</span>"+this.notificationTile.renderHtml()+"</span>"+'<span id="'+htmlAttributeEncode(this.id+"_4")+'" style="'+this.baseStyle+" "+generateStyleAttribute("display",this.showNamePlate)+'" class="namePlate">'+'<span id="'+htmlAttributeEncode(this.id+"_5")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="count">'+htmlEncode(this.childCount)+"</span>"+"<span"+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="titleArea">'+'<span id="'+htmlAttributeEncode(this.id+"_6")+'" style="'+this.baseStyle+" "+generateStyleAttribute("display.inlineblock",this.hasIcon)+'" class="icon">'+this.iconTile.renderHtml()+"</span>"+"<span"+sutraAttribute("SkyDrive.ItemTitleName")+' id="'+htmlAttributeEncode(this.id+"_7")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="title"'+generateAttributesString("title",this.name)+">"+this.decoratedName+"</span>"+"</span>"+"</span>"+this.overlayTile.renderHtml()+"</span>"+"</"+this.baseTag+">"+""};processAnnotations(SkyDrive.UI.ItemTile,[{id:0},{id:1,attr:["class","rootClass"]},{id:2,css:["display","showNotificationTab"]},{id:3,className:["alertMode","hasAlert"]},{id:4,css:["display","showNamePlate"]},{id:5,attr:["text","childCount"]},{id:6,css:["display.inlineBlock","hasIcon"]},{id:7,attr:["html","decoratedName","title","name"]}]);(function(){var c=wLive.Core,l=wLive.Controls,b=c.AleHelpers.getPCString,k=c.SoftBlockEnum,i="Rename",g="RenameEditing",f="RenameComplete",h=new RegExp('([:|*|?|\\\\|/|;|"|<|>|||／|；|＊])'),e=9001,j=10,a;defineSubClass("SkyDrive.Models.ItemRenameModel",JBase.UI.BaseControl,function(){},{baseTag:null,onActivate:function(){a=a||c.PageController.getInstance().getViewContext();this.addElementListener(a,g,this._onRenameEditing);this.addElementListener(a,f,this._onRenameComplete)},_onRenameEditing:function(){a.errorManager.clear()},_onRenameComplete:function(e,a){var c=this;a.isNewFolder=a.item._isNewFolder;if(a.attempt<=j&&a.shouldCommit&&(a.oldValue!==a.newValue||a.item._isNewFolder)){var b=d(a.item,a.newValue);if(b)this._retryRenameOnFailure(a,b);else{a.item.highlights=null;$header&&$header.showLoading();a.item.updateItemProperty(a.propertyName,a.newValue,function(){c._onRenameSuccess(a)},function(b){c._onRenameFailure(a,b)},a.overrideLock)}}else this._cancelEdit(a)},_cancelEdit:function(c){var b=c.item;if(b._isNewFolder){var a=b.getParent();if(a){a.removePinnedSubfolder(b);a.invalidate()}}this._enableFolderCreation(c)},_onRenameSuccess:function(a){$header&&$header.hideLoading();this._enableFolderCreation(a)},_onRenameFailure:function(b,c){var g=this,f=c&&c.error,m=f?c.error.code:0,i=f?c.error.message:"",j=b.item;$header&&$header.hideLoading();g._enableFolderCreation(b);if(m===e){var d=c.error.data,h=d&&jQuery.parseJSON(d);_softBlockPopover=new l.SoftBlock(k.RenameAction,a.callerCid,j,h);_softBlockPopover.show(function(){b.overrideLock=true;g._onRenameComplete(null,b)},function(){})}else this._retryRenameOnFailure(b,i)},_retryRenameOnFailure:function(c,g){var e=c.item,h=e._isNewFolder?b("NewFolderErrorTitle"):b("RenameErrorTitleFormat").format(e.name),f=jQuery(_ce("span")).text(h+" "+g),d=a.errorManager;d.clear();d.add({$element:f,priority:0,type:0});c.hasError=true;setTimeout(function(){jQuery(a).trigger(i,c)},0)},_enableFolderCreation:function(b){b.isNewFolder&&(a.pendingFolderToCreate=false)}});function d(e,c){var a;if(!c)a=b("NameRequiredError");else if(c.startsWith(".")||!e.extension&&c.endsWith("."))a=b("CantStartOrEndWithDotError");else{var d=c.match(h);if(d&&d.length>1)a=b("InvalidTextFormatError").format(d[1])}return a}})();(function(){var d=27,e=13,b="RenameComplete",c="RenameEditing",a=null,f=wLive.Core.SoftBlockEnum;defineSubClass("SkyDrive.UI.ItemRenameBox",JBase.UI.BaseControl,function(){this.propertyToEdit="name";this._$editBox=null},{baseTag:"span",onDataContextChanged:function(a){var b=a.item;this.isRenameError=!!(this.renameEventArgs&&this.renameEventArgs.hasError)},onActivate:function(){var b=this.subElements.editBox,c=this.dataContext.item;b.value=this.renameEventArgs&&this.renameEventArgs.newValue?this.renameEventArgs.newValue:c.name;a=jQuery(wLive.Core.PageController.getInstance().getViewContext());this.isRenameError=false;this._isEditingComplete=false;setTimeout(function(){b.focus();b.select()},0);this.addElementListener(b,"keydown",this._onKeyDown);this.addElementListener(b,"blur",this._onBlur)},onDeactivate:function(){this.subElements.editBox.parentNode&&jQuery(this.subElements.editBox).blur()},_onBlur:function(){this._completeEdit(!(this.renameEventArgs&&this.renameEventArgs.attempt>0))},_onKeyDown:function(f){var b=true;if(this.renameEventArgs&&this.renameEventArgs.hasError){this.renameEventArgs.hasError=false;a.trigger(c,this.renameEventArgs);this.change()}switch(f.which){case e:this._completeEdit(true);b=false;break;case d:this._completeEdit(false);b=false}return b},_getRenameEventArgs:function(b){var a=this.dataContext.item,c=b&&!a._isNewFolder?a[this.propertyToEdit]:null,d=b?this.subElements.editBox.value.trim():c;this.renameEventArgs=this.renameEventArgs||{};this.renameEventArgs.attempt=(this.renameEventArgs.attempt||0)+1;return mix(this.renameEventArgs,{key:a.key,item:a,shouldCommit:b,propertyName:this.propertyToEdit,oldValue:c,newValue:d})},_completeEdit:function(c){if(!this._isEditingComplete){this._isEditingComplete=true;a.trigger(b,this._getRenameEventArgs(c))}}})})();SkyDrive.UI.ItemRenameBox.prototype.onRenderHtml=function(){return "<"+this.baseTag+""+sutraAttribute("SkyDrive.ItemRenameBox")+' id="'+htmlAttributeEncode(this.id+"_0")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="c-'+this.controlName+" "+this.baseClass+'">'+'<span id="'+htmlAttributeEncode(this.id+"_1")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="inputContainer'+generateClassAttribute("isRenameError",this.isRenameError)+'">'+'<input type="text"'+sutraAttribute("SkyDrive.ItemRenameInput")+' id="'+htmlAttributeEncode(this.id+"_2")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+">"+"</input>"+"</span>"+"</"+this.baseTag+">"+""};processAnnotations(SkyDrive.UI.ItemRenameBox,[{id:0},{id:1,className:["isRenameError","isRenameError"]},{id:2,childId:"editBox"}]);(function(){var a=10;defineNamespace("SkyDrive.UI.SetColumnSizeHelper",{calculatePositions:function(e,h){var b,c,j=0,d=[],f=e.length;if(e&&f&&h){for(b=0;b<e.length;b++){c=e[b];if(c.fixedWidth){j+=c.fixedWidth+a;d[b]={width:c.fixedWidth}}}for(b=f-1;b>=0;b--){c=e[b];if(!c.fixedWidth)d[b]={width:Math.max(c.minWidth,Math.min(c.maxWidth,h-j-a))}}var g=0;for(b=0;b<f;b++){var i=d[b];i.left=b===0||g+i.width<=h?g:999999;g+=d[b].width+a}}return d}})})();(function(){defineSubClass("SkyDrive.UI.SetItemCell",JBase.UI.ContentControl,null,{baseTag:"span",getControlType:function(c){var b=SkyDrive.UI.SetTextCell,a=c.column;if(a.name==="name"||a.name==="searchName")b=SkyDrive.UI.SetNameCell;else if(a.getClickHandler&&a.getClickHandler(c.item))b=SkyDrive.UI.SetLinkCell;return b}})})();(function(){var e=JBase.UI.ImageStripHelper,c=wLive.Core.AleHelpers.getPCString,b=wLive.Core.SkyDriveItemHelper,a,i=c("SurveyBadge"),k={url:null},g=e.getImageInfo("warning","",c("RestrictedNotification.Visitor")),h=e.getImageInfo("warning","",c("RestrictedNotification.Owner").format("","")),j=$B.rtl?"right":"left",f="&hellip;",d=getSutraValue("SkyDrive.ItemRowInlineName");defineSubClass("SkyDrive.UI.SetNameCell",JBase.UI.BaseControl,function(){a=a||wLive.Core.PageController.getInstance().getViewContext();this.notificationIcon=this.createChild(JBase.UI.ImageTile);this.itemIcon=this.createChild(JBase.UI.ImageTile);this.itemRenameBox=this.createChild(JBase.UI.ContentControl,{baseTag:"span",baseClass:"editArea",disposeOnSwap:true,getControlType:bind(this,this._getItemRenameBoxContentType),getControlOptions:bind(this,this._getItemRenameBoxOptions)})},{baseTag:"span",onDataContextChanged:function(c){var a=c.item;if(a!=this._lastItem){this._lastItem=a;this.isRenaming=!!(a&&a._isNewFolder&&a._fromCreateFolderAction)}mix(this,{itemNameText:a.getDisplayName(),itemNameHtml:b.highlightAndEncodeField(a,"name")+(a.isUnknownFileType&&a.extension?a.extension.encodeHtml():""),snippetText:a.snippet?f+b.highlightAndEncodeField(a,"snippet")+f:"",surveyText:a.form?i:"",styleString:"width:"+c.position.width+"px;"+j+":"+c.position.left+"px",showNotificationTab:this.shouldShowNotificationTab(a)});this.languageDir=$B.ltr?"ltr":"rtl";this.notificationIcon.setDataContext(this.getNotificationTileInfo(a));this.itemIcon.setDataContext(SkyDrive.FileTypeHelper.getIconInfo(a,16,c.isSelected));this.itemRenameBox.setDataContext({item:this.isRenaming?this.dataContext.item:null});this._updateLinkClick(this.isActive)},onActivate:function(){this._updateLinkClick(true);this.addElementListener(a,"Rename",this._onRenameStart);this.addElementListener(a,"RenameComplete",this._onRenameComplete);d&&this.subElements.name.setAttribute("sutra",d)},shouldShowNotificationTab:function(a){return a.itemStatus&&a.itemStatus>0&&a.isViewerOwner()&&a.sharingLevelValue!=4},getNotificationTileInfo:function(a){return this.showNotificationTab?b.isViewerOwner(a)?h:g:""},_updateLinkClick:function(e){if(e){var b=a.actionManager,d=b.getAction("DefaultClick",this.dataContext.item),c=jQuery(this.subElements.itemLink);c.unbind();d&&b.setATagAction(d,c,"PC",null)}},_getItemRenameBoxContentType:function(){return this.isRenaming?SkyDrive.UI.ItemRenameBox:null},_getItemRenameBoxOptions:function(){return {renameEventArgs:this._lastRenameEventArgs}},_onRenameStart:function(c,a){var b=this.dataContext?this.dataContext.item:null;if(b&&a&&b.key===a.key){this.isRenaming=true;this._lastRenameEventArgs=a;this.change()}},_onRenameComplete:function(f,c){var b=this.dataContext?this.dataContext.item:null;if(b&&c&&b.key===c.key){b._lastRenameEventArgs=c;this.isRenaming=false;if(!this.dataContext.isSelected&&c.shouldCommit){var d=b.getParent(),e=d.getChildren().indexOf(b);a.selectionManager.clickSelect(d,e,{ctrl:false,shift:false})}this.change();this.element&&this.subElements.itemLink.focus()}}})})();SkyDrive.UI.SetNameCell.prototype.onRenderHtml=function(){return "<"+this.baseTag+' id="'+htmlAttributeEncode(this.id+"_0")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="c-'+this.controlName+" "+this.baseClass+' cell"'+generateAttributesString("style",this.styleString)+">"+'<a href="#" id="'+htmlAttributeEncode(this.id+"_1")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+""+generateAttributesString("aria-label",this.itemNameText)+">"+'<span id="'+htmlAttributeEncode(this.id+"_2")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="notification'+generateClassAttribute("visible",this.showNotificationTab)+'">'+this.notificationIcon.renderHtml()+"</span>"+this.itemIcon.renderHtml()+'<span id="'+htmlAttributeEncode(this.id+"_3")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="cellText"'+generateAttributesString("dir",this.languageDir)+">"+this.itemNameHtml+"</span>"+"</a>"+'<span id="'+htmlAttributeEncode(this.id+"_4")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="snippet">'+this.snippetText+"</span>"+'<span id="'+htmlAttributeEncode(this.id+"_5")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="cellForm">'+htmlEncode(this.surveyText)+"</span>"+'<div id="'+htmlAttributeEncode(this.id+"_6")+'" style="'+this.baseStyle+" "+generateStyleAttribute("display",this.isRenaming)+'">'+this.itemRenameBox.renderHtml()+"</div>"+"</"+this.baseTag+">"+""};processAnnotations(SkyDrive.UI.SetNameCell,[{id:0,attr:["style","styleString"]},{id:1,attr:["aria-label","itemNameText"],childId:"itemLink"},{id:2,className:["visible","showNotificationTab"]},{id:3,attr:["html","itemNameHtml","dir","languageDir"],childId:"name"},{id:4,attr:["html","snippetText"],childId:"snippet"},{id:5,attr:["text","surveyText"]},{id:6,css:["display","isRenaming"]}]);(function(){var a=$B.rtl?"right":"left";defineSubClass("SkyDrive.UI.SetTextCell",JBase.UI.BaseControl,function(){},{baseTag:"span",onDataContextChanged:function(b){var c=b.column;this.cellClass="cell cellText "+c.name;this.cellText=c.getText(b.item);this.hasContent=!!this.cellText;this.styleString="width:"+b.position.width+"px;"+a+":"+b.position.left+"px"}})})();SkyDrive.UI.SetTextCell.prototype.onRenderHtml=function(){return "<"+this.baseTag+' id="'+htmlAttributeEncode(this.id+"_0")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="c-'+this.controlName+" "+this.baseClass+'">'+'<span id="'+htmlAttributeEncode(this.id+"_1")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+""+generateAttributesString("class",this.cellClass,"style",this.styleString)+">"+htmlEncode(this.cellText)+"</span>"+"</"+this.baseTag+">"+""};processAnnotations(SkyDrive.UI.SetTextCell,[{id:0},{id:1,attr:["text","cellText","class","cellClass","style","styleString"]}]);(function(){var a=$B.rtl?"right":"left";defineSubClass("SkyDrive.UI.SetLinkCell",JBase.UI.BaseControl,function(){},{baseTag:"span",onDataContextChanged:function(b){var c=b.column;this.cellClass="cell cellText "+c.name;this.cellText=c.getText(b.item);this.width=b.position.width+"px";this.styleString="width:"+b.position.width+"px;"+a+":"+b.position.left+"px"},onActivate:function(){this.addElementListener(this.subElements.link,"click",this.dataContext.column.getClickHandler(this.dataContext.item))}})})();SkyDrive.UI.SetLinkCell.prototype.onRenderHtml=function(){return "<"+this.baseTag+' id="'+htmlAttributeEncode(this.id+"_0")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="c-'+this.controlName+" "+this.baseClass+' cell"'+generateAttributesString("style",this.styleString)+">"+'<a href="#" tabindex="-1" id="'+htmlAttributeEncode(this.id+"_1")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="cellText">'+htmlEncode(this.cellText)+"</a>"+"</"+this.baseTag+">"+""};processAnnotations(SkyDrive.UI.SetLinkCell,[{id:0,attr:["style","styleString"]},{id:1,attr:["text","cellText"],childId:"link"}]);(function(){var d=wLive.Core,a,f=43,b=getSutraValue("SkyDrive.ItemRowContainer"),c=getSutraValue("SkyDrive.SelectedItemRow"),e=getSutraValue("SkyDrive.ItemCheckbox"),h=32,g=46,i=113;defineSubClass("SkyDrive.UI.SetItemRow",JBase.UI.BaseControl,function(){a=a||wLive.Core.PageController.getInstance().getViewContext();this.columnRepeater=this.createChild(JBase.UI.Repeater,{baseTag:"span",_size:{},childControl:SkyDrive.UI.SetItemCell,getChildContext:function(b,a){return {column:b,position:this.dataContext.columnPositions[a],item:this.dataContext.parentItem,isSelected:this.dataContext.isSelected}}})},{_size:{width:100,height:30},onDataContextChanged:function(a){var e=a.item,d=this.dataContext.columns;this._updateSelectionState();this.columnRepeater.setDataContext({items:a.columns,columnPositions:SkyDrive.UI.SetColumnSizeHelper.calculatePositions(d,this._size.width-f),parentItem:e,isSelected:this.isSelected});if(this.isActive&&b)this.element.setAttribute("sutra",this.isSelected?c:b)},onActivate:function(){this.addElementListener(this.element,"contextmenu",this._onContextMenu);this.addElementListener(this.element,"click",this._onRowClick);this.addElementListener(a.selectionManager,wLive.Core.SelectionManager.SelectionChangedEvent,this.change);if(b){this.element.setAttribute("sutra",this.isSelected?c:b);this.subElements.checkbox.setAttribute("sutra",e)}this._onSelectionChanged()},setSize:function(a){if(!this._size||this._size.width!=a.width){this._size=a;this.change()}},onKeyDown:function(b){if(!d.PopoverHelpers.isPopoverVisible()&&!d.DomHelpers.isTextInputElement(jQuery(b.target)))switch(b.which){case g:case i:if(!this.anySelected&&this.dataContext.item)a.selectionManager.clickSelect(this.dataContext.item.getParent(),this.dataContext.itemIndex,{ctrl:false,shift:false});break;case h:a.selectionManager.clickSelect(this.dataContext.item.getParent(),this.dataContext.itemIndex,{ctrl:true,shift:b.shiftKey});return false}},setFocusState:function(a){this.isFocused=a;if(this.isActive){this._updateBindings();a&&jQuery("a",this.element)[0].focus()}},_onSelectionChanged:function(){this._updateSelectionState();this._updateBindings()},_updateSelectionState:function(){var b=this.dataContext,c=b.item||{},d=a.selectionManager;this.isSelected=b.itemIndex!==undefined&&c&&c.getParent?d.isSelected(c.getParent(),b.itemIndex):false;this.anySelected=d.anySelected()},_onRowClick:function(b){var c=jQuery(b.target||b.srcElement);if(this.dataContext.itemIndex!==undefined)if(c.closest(".checkArea").length){a.selectionManager.clickSelect(this.dataContext.item.getParent(),this.dataContext.itemIndex,{ctrl:true,shift:b.shiftKey});return false}else if(!c.closest("A,INPUT").length||!!c.closest(".c-SetLinkCell").length){a.selectionManager.clickSelect(this.dataContext.item.getParent(),this.dataContext.itemIndex,{ctrl:b.ctrlKey||b.metaKey,shift:b.shiftKey});a.contextMenu.hide();return false}},_onContextMenu:function(b){if(b.shiftKey)return true;var d={cancelDefault:false};raiseEvent(this,"contextMenuOpening",d,true);if(!d.cancelDefault){var i=this.dataContext.item,e=i.getParent(),f=this.dataContext.itemIndex,c=a.selectionManager;if(!c.isSelected(e,f))c.clickSelect(e,f);var h=c.getSelection(),g={pos:{x:b.pageX,y:b.pageY},sp:a.infoPaneClosed,ev:b,bici:"CM",fil:[]};a.contextMenu.render(null,h,g);return false}}})})();SkyDrive.UI.SetItemRow.prototype.onRenderHtml=function(){return "<"+this.baseTag+' id="'+htmlAttributeEncode(this.id+"_0")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="c-'+this.controlName+" "+this.baseClass+'">'+'<div id="'+htmlAttributeEncode(this.id+"_1")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="rowContainer'+generateClassAttribute("isSelected",this.isSelected,"isRangeSelected",this.anySelected,"isFocused",this.isFocused)+'">'+"<span"+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="border">'+"</span>"+"<span"+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="checkArea">'+"<span"+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="checkboxWrapper">'+'<input type="checkbox" tabindex="-1" id="'+htmlAttributeEncode(this.id+"_2")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+""+generateAttributesString("checked",this.isSelected)+">"+"</input>"+"<label"+(this.baseStyle?' style="'+this.baseStyle+'"':"")+">"+"</label>"+"</span>"+"</span>"+this.columnRepeater.renderHtml()+"</div>"+"</"+this.baseTag+">"+""};processAnnotations(SkyDrive.UI.SetItemRow,[{id:0},{id:1,className:["isSelected","isSelected","isRangeSelected","anySelected","isFocused","isFocused"]},{id:2,attr:["checked","isSelected"],childId:"checkbox"}]);(function(){var b=wLive.Core,a,c=43,d=32;defineSubClass("SkyDrive.UI.SetHeaderRow",JBase.UI.BaseControl,function(){a=a||b.PageController.getInstance().getViewContext();this.columnRepeater=this.createChild(JBase.UI.Repeater,{baseTag:"span",childControl:SkyDrive.UI.SetHeaderRowCell,getChildContext:function(b,a){return {column:b,item:this.dataContext.parentItem,position:this.dataContext.columnPositions[a]}}})},{sutraLabel:getSutraValue("SkyDrive.DetailsListColumnHeaders"),selectAllSutra:getSutraValue("SkyDrive.SelectAllCheckboxes"),onDataContextChanged:function(b){var e=b.columns,f=a.selectionManager,d=f.getSelection();this.isAllSelected=b.parentItem&&d&&d.selectionCount===b.parentItem.getChildren().getCount();this.columnRepeater.setDataContext({items:e,parentItem:b.parentItem,columnPositions:SkyDrive.UI.SetColumnSizeHelper.calculatePositions(e,this._size.width-c)})},onActivate:function(){this.addElementListener(this.subElements.checkArea,"click keydown",this._onSelectAllBoxClicked);this.addElementListener(a.selectionManager,wLive.Core.SelectionManager.SelectionChangedEvent,this.change);this.sutraLabel&&this.element.setAttribute("sutra",this.sutraLabel)},setSize:function(a){this._size=a;this.change()},_onSelectAllBoxClicked:function(g){if(g.type=="click"||g.which===d){var c=this.dataContext.parentItem,e=a.selectionManager;if(c){var f=e.getSelection();if(b.SkyDriveItem.areItemsSame(f.parent,c)&&f.selectionCount===a.dataModel.getChildCount(c))e.deselectAll(c);else e.selectAll(c);return false}}}})})();SkyDrive.UI.SetHeaderRow.prototype.onRenderHtml=function(){return "<"+this.baseTag+' id="'+htmlAttributeEncode(this.id+"_0")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="c-'+this.controlName+" "+this.baseClass+'">'+'<span id="'+htmlAttributeEncode(this.id+"_1")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="checkArea">'+'<span id="'+htmlAttributeEncode(this.id+"_2")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="checkboxWrapper"'+generateAttributesString("sutra",this.selectAllSutra)+">"+'<input type="checkbox" id="'+htmlAttributeEncode(this.id+"_3")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+""+generateAttributesString("checked",this.isAllSelected)+">"+"</input>"+"<label"+(this.baseStyle?' style="'+this.baseStyle+'"':"")+">"+"</label>"+"</span>"+"</span>"+this.columnRepeater.renderHtml()+"</"+this.baseTag+">"+""};processAnnotations(SkyDrive.UI.SetHeaderRow,[{id:0},{id:1,childId:"checkArea"},{id:2,attr:["sutra","selectAllSutra"]},{id:3,attr:["checked","isAllSelected"]}]);(function(){var j=wLive.Core,a=wLive.Core.JSONConstants.SortDirection,e=FilesConfig.foldersImgBaseUrl+"/sort-ascending.png",g=FilesConfig.foldersImgBaseUrl+"/sort-descending.png",i={url:null},h=$B.rtl?"right":"left",d="SkyDrive.HeaderText",f="SkyDrive.SortedUp",c="SkyDrive.SortedDown",b;defineSubClass("SkyDrive.UI.SetHeaderRowCell",JBase.UI.BaseControl,function(){b=b||wLive.Core.PageController.getInstance().getViewContext()},{baseTag:"span",onDataContextChanged:function(b){var a=b.column;mix(this,{columnSutra:getSutraValue("SkyDrive."+a.sutraLabel),cellTextSutra:getSutraValue(d),sortIconSutra:getSutraValue(a.isSortAscending?f:c),cellText:a.title,className:"cell "+a.name+(a.sortField===undefined?" unsortable":""),isSortColumn:a.isSortColumn,sortIconUrl:a.isSortAscending?g:e,styleString:"width:"+b.position.width+"px;"+h+":"+b.position.left+"px"})},onActivate:function(){this.addElementListener(this.subElements.columnLink,"click",this._onColumnClick)},_onColumnClick:function(){var c=this.dataContext.column,d=c.sortField;if(d!==undefined){var e=a.Default;c.biciCommand&&wLive.Core.BiciHelpers.reportClickAction(c.biciCommand,"PC");if(c.isSortColumn)e=c.isSortAscending?a.Descending:a.Ascending;b.sortBy(d,e)}return false}})})();SkyDrive.UI.SetHeaderRowCell.prototype.onRenderHtml=function(){return "<"+this.baseTag+' id="'+htmlAttributeEncode(this.id+"_0")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="c-'+this.controlName+" "+this.baseClass+'">'+'<a href="#" onclick="return false;" id="'+htmlAttributeEncode(this.id+"_1")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+""+generateAttributesString("class",this.className,"style",this.styleString,"sutra",this.columnSutra)+">"+'<span id="'+htmlAttributeEncode(this.id+"_2")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+""+generateAttributesString("sutra",this.cellTextSutra)+">"+htmlEncode(this.cellText)+"</span>"+'<span id="'+htmlAttributeEncode(this.id+"_3")+'" style="'+this.baseStyle+" "+generateStyleAttribute("display.inlineblock",this.isSortColumn)+'" class="sortIcon"'+generateAttributesString("sutra",this.sortIconSutra)+">"+'<img id="'+htmlAttributeEncode(this.id+"_4")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+""+generateAttributesString("src",this.sortIconUrl)+">"+"</img>"+"</span>"+"</a>"+"</"+this.baseTag+">"+""};processAnnotations(SkyDrive.UI.SetHeaderRowCell,[{id:0},{id:1,attr:["class","className","style","styleString","sutra","columnSutra"],childId:"columnLink"},{id:2,attr:["text","cellText","sutra","cellTextSutra"]},{id:3,css:["display.inlineBlock","isSortColumn"],attr:["sutra","sortIconSutra"]},{id:4,attr:["src","sortIconUrl"]}]);(function(){var b=wLive.Core,a,d=32,c=46,e=113;defineSubClass("SkyDrive.UI.SetItemTile",JBase.UI.BaseControl,function(){a=a||wLive.Core.PageController.getInstance().getViewContext();this.itemTile=this.createChild(SkyDrive.UI.ItemTile);this.itemRenameBox=this.createChild(JBase.UI.ContentControl,{baseTag:"span",baseClass:"editArea",disposeOnSwap:true,getControlType:bind(this,this._getItemRenameBoxContentType),getControlOptions:bind(this,this._getItemRenameBoxOptions)})},{onDataContextChanged:function(b){var a=b.item||{};if(a!=this._lastItem){this._lastItem=a;this.isFocused=false;this.isRenaming=!!(a&&a._isNewFolder&&a._fromCreateFolderAction)}this.isFile=!a.folder;this.itemNameText=a.getDisplayName();this.itemTile.setDataContext(b);this.itemRenameBox.setDataContext({item:this.isRenaming?this.dataContext.item:null});this._updateLinkClick(this.isActive);this._updateSelectionState()},onActivate:function(){var b=a.selectionManager;this.addElementListener(this.element,"contextmenu",this._onContextMenu);this.addElementListener(this.subElements.selectArea,"click",this._onSelectAreaClicked);this.addElementListener(b,wLive.Core.SelectionManager.SelectionChangedEvent,this._onSelectionChanged);this.addElementListener(a,"Rename",this._onRenameStart);this.addElementListener(a,"RenameComplete",this._onRenameComplete);this._onSelectionChanged();this._updateLinkClick(true)},onDeactivate:function(){this.subElements&&this.subElements.itemLink&&jQuery(this.subElements.itemLink).unbind()},setFocusState:function(a){this.isFocused=a;if(this.isActive){this._updateBindings();a&&this.subElements.itemLink.focus()}},setSize:function(a){this.itemTile.setSize(a)},pulse:function(){this.itemTile.pulse()},canPulse:function(){return this.itemTile.canPulse()},onKeyDown:function(f){if(!b.PopoverHelpers.isPopoverVisible()&&!b.DomHelpers.isTextInputElement(jQuery(f.target)))switch(f.which){case c:case e:if(!this.anySelected&&this.dataContext.item)a.selectionManager.clickSelect(this.dataContext.item.getParent(),this.dataContext.itemIndex,{ctrl:false,shift:false});break;case d:return this._onSelectAreaClicked(f)}},_onSelectionChanged:function(){this._updateSelectionState();this._updateBindings()},_updateSelectionState:function(){var b=this.dataContext,c=b.item||{},d=a.selectionManager;this.isSelected=b.itemIndex!==undefined&&c&&c.getParent?d.isSelected(c.getParent(),b.itemIndex):false;this.anySelected=d.anySelected();this.showSelected=this.anySelected||$B.SF_iPhone},_updateLinkClick:function(e){if(e){var b=a.actionManager,d=b.getAction("DefaultClick",this.dataContext.item),c=jQuery(this.subElements.itemLink);c.unbind();d&&b.setATagAction(d,c,"PC",null)}},_onRenameStart:function(c,a){var b=this.dataContext.item;if(b&&a&&b.key===a.key){this.isRenaming=true;this._lastRenameEventArgs=a;this.change()}},_onRenameComplete:function(c,a){var b=this.dataContext?this.dataContext.item:null;if(b&&a&&b.key===a.key){b._lastRenameEventArgs=a;this.isRenaming=false;this.change();this.element&&this.subElements.itemLink.focus()}},_getItemRenameBoxContentType:function(){return this.isRenaming?SkyDrive.UI.ItemRenameBox:null},_getItemRenameBoxOptions:function(){return {renameEventArgs:this._lastRenameEventArgs}},_onContextMenu:function(b){if(b.shiftKey)return true;var d={cancelDefault:false};raiseEvent(this,"contextMenuOpening",d,true);if(!d.cancelDefault){var i=this.dataContext.item,e=i.getParent(),f=this.dataContext.itemIndex,c=a.selectionManager;if(!c.isSelected(e,f))c.clickSelect(e,f);var h=c.getSelection(),g={pos:{x:b.pageX,y:b.pageY},sp:a.infoPaneClosed,ev:b,bici:"CM",fil:[]};a.contextMenu.render(null,h,g);return false}},_onSelectAreaClicked:function(b){if(this.dataContext.itemIndex!==undefined){var d=b&&b.shiftKey,c=a.selectionManager;c.clickSelect(this.dataContext.item.getParent(),this.dataContext.itemIndex,{ctrl:true,shift:d})}return false}})})();SkyDrive.UI.SetItemTile.prototype.onRenderHtml=function(){return "<"+this.baseTag+""+sutraAttribute("SkyDrive.SetItemTile")+' id="'+htmlAttributeEncode(this.id+"_0")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="c-'+this.controlName+" "+this.baseClass+'">'+'<a id="'+htmlAttributeEncode(this.id+"_1")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="canPress'+generateClassAttribute("isSelected",this.isSelected,"showSelected",this.showSelected,"anySelected",this.anySelected,"file",this.isFile,"isFocused",this.isFocused)+'"'+generateAttributesString("aria-label",this.itemNameText)+">"+"<span"+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="hoverWrapper">'+"<span"+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="focusBorder">'+"</span>"+this.itemTile.renderHtml()+"<span"+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="selectionBorder">'+"</span>"+"<span"+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="selectionTab">'+"</span>"+"<span"+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="selectBox">'+'<input type="checkbox" tabindex="-1"'+sutraAttribute("SkyDrive.SetItemCheckBox")+' id="'+htmlAttributeEncode(this.id+"_2")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="checkbox"'+generateAttributesString("checked",this.isSelected)+">"+"</input>"+"<label"+(this.baseStyle?' style="'+this.baseStyle+'"':"")+">"+"</label>"+"</span>"+"</span>"+"<span"+sutraAttribute("SkyDrive.SetItemCheckArea")+' id="'+htmlAttributeEncode(this.id+"_3")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="selectArea">'+"</span>"+"</a>"+'<div id="'+htmlAttributeEncode(this.id+"_4")+'" style="'+this.baseStyle+" "+generateStyleAttribute("display",this.isRenaming)+'">'+this.itemRenameBox.renderHtml()+"</div>"+"</"+this.baseTag+">"+""};processAnnotations(SkyDrive.UI.SetItemTile,[{id:0},{id:1,attr:["aria-label","itemNameText"],className:["isSelected","isSelected","showSelected","showSelected","anySelected","anySelected","file","isFile","isFocused","isFocused"],childId:"itemLink"},{id:2,attr:["checked","isSelected"]},{id:3,childId:"selectArea"},{id:4,css:["display","isRenaming"]}]);(function(){defineSubClass("SkyDrive.UI.SetGroupHeader",JBase.UI.BaseControl,function(){},{onDataContextChanged:function(b){var a=b.item;if(a){this.name=a.name||"";this.groupIndex=String(a.groupIndex);this.groupType=a.groupingId}}})})();SkyDrive.UI.SetGroupHeader.prototype.onRenderHtml=function(){return "<"+this.baseTag+' id="'+htmlAttributeEncode(this.id+"_0")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="c-'+this.controlName+" "+this.baseClass+'">'+'<div id="'+htmlAttributeEncode(this.id+"_1")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="groupName"'+generateAttributesString("group-index",this.groupIndex,"group-type",this.groupType)+">"+htmlEncode(this.name)+"</div>"+"</"+this.baseTag+">"+""};processAnnotations(SkyDrive.UI.SetGroupHeader,[{id:0},{id:1,attr:["text","name","group-index","groupIndex","group-type","groupType"]}])