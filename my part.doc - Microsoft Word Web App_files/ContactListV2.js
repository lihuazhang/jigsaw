/* Copyright (C) 2012 Microsoft Corporation */(function(){var b=window.wLive,a=b.ContactList=b["ContactList"]||{};a.Controls=a["Controls"]||{};a.Core=a["Core"]||{}})();(function(){var k=window,a=k.wLive,b=k.jQuery,r=".VirtualizedGrid",e=0,d="unique-id",j=[].splice,f="mousedown",g="mouseover",h="mouseout",i="click",s="scroll",q="arrayChange",m="beginBatchUpdate",n="endBatchUpdate";a.ContactList.Controls.VirtualizedGrid=o;function o(l,kb,gb,db,hb,P){var c=this;c.$=b(this);e++;var y=r+e,w=l,p;if(P)p=P;else p=l.parent();var T=document.createElement("ul");w.append(T);w.css("overflow","hidden");var L=b(T);sutra(L,hb||"$Sutra.Shared.ContactsList");var j=b.extend({height:51,width:100,padding:{top:0,right:0,bottom:0,left:0},renderPages:3,maxColumns:1,itemClass:"",alphabetHelper:null,fadeBackground:true},db||{}),t=j.height+j.padding.top+j.padding.bottom,ib=j.width+j.padding.left+j.padding.right,Q,R,u,K,G,A,O,cb=-1,z=-1,H,M=false,J=kb,v="."+j.itemClass,Z="li"+v,D=-1,x,k=new Array(J.length),B=[],U=gb,o,F=false;N();if(j.letterHeader&&j.alphabetHelper)o=new a.ContactList.Controls.LetterHeaderGridLayout(c,p,U,j.alphabetHelper,j.fadeBackground);else o=new a.ContactList.Controls.ListGridLayout(c,U);o.init(J,k,B);E();p.bind(s+y,jb);var I=b([J]);I.bind(q+y,fb);I.bind(m+y,ab);I.bind(n+y,bb);if(j.supportsHover){l.delegate(v,g,W);l.delegate(v,h,X)}l.delegate(v,f,V);l.delegate(v,i,Y);function N(){Q=j.containerHeight||w.innerHeight();R=j.containerWidth||w.innerWidth();u=j.maxColumns!==0?j.maxColumns:Math.round(Math.floor(R/ib));K=Math.round(Math.ceil(Q/t));G=K*u;A=G*j.renderPages;O=K*j.renderPages*t}function ab(){F=true}function bb(){F=false;E();c.render()}c.isVisible=function(b){if(!F){x=x||S();var a=Math.floor(x.startIndex/u)*t;return b>=a&&b<=a+O}else return false};c.hide=function(){l.hide()};c.closeLetterPicker=function(){o&&o.closeLetterPicker&&o.closeLetterPicker()};c.show=function(){l.show()};c.setVisibility=function(a){p.css("overflow",a?"auto":"hidden");l.css("visibility",a?"visible":"hidden")};c.createTile=function(i,n,l,k,e,f){var a=[];a.push('<li class="');a.push(j.itemClass);if(e)for(var h=0,m=e.length;h<m;h++){a.push(" ");a.push(e[h])}a.push('" style="top:');a.push(n);a.push("px; left:");a.push(l);a.push("px");if(f)for(var g in f)if(g){a.push(";");a.push(g);a.push(":");a.push(f[g])}a.push('" data-');a.push(d);a.push('="');a.push(i.encodeHtmlAttribute());a.push('">');a.push(k);a.push("</li>");var c=b(a.join(""));c.data(d,i);sutra(c,"$Sutra.Shared.ContactsListItem");L.append(c);return c};c.getTileCount=function(){return k.length};c.getTileCountPerPage=function(){return G};c.getTile=function(a){return a<k.length?k[a]:null};c.getTileIndex=function(b){for(var a=k.length-1;a>=0;a-=1)if(k[a]===b)return a;return -1};function fb(d,a){if(!M){var b=a.change;if(b==="insert")o.processInsertedItems(a.index,a.items);else if(b==="remove")o.processRemovedItems(a.index,a.items);else if(b==="move")throw new Error("Move is not supported");else if(b==="refresh")eb();if(!F){E();c.render()}}}function eb(){for(var a=0,b=k.length;a<b;a++)k[a].remove();k=[];B=[];o.init(J,k,B);E();c.render()}function C(d){var a=b(d.target);return c.getItemForEvent(a)}function W(b){var a=C(b);if(a.mouseover)a.mouseover(b)}function X(b){var a=C(b);if(a.mouseout)a.mouseout(b)}function V(b){var a=C(b);if(a.mousedown)a.mousedown(b)}function Y(b){var a=C(b);if(a.click)a.click(b)}function E(){var b=L.innerHeight(),a=Math.ceil(k.length/u)*t;if(b!=a)w.css({height:a+"px"})}c.resize=function(){N();c.render();o.resize()};c.getScrollData=function(){return x};c.render=function(){if(D<0)D=w.offset().top-p.offset().top;x=S();var a=x.startIndex,c=0,d=Math.floor(a/u)*t,b=a,e,h=k.length,g=x.scrollTop;if(o.onRender)o.onRender(a,d,c);for(var f=0;f<A;f++)if(b<h){e=b%u;if(b!=a)if(e==0){d+=t;c=0}else c+=j.width;k[b++].render(b,d,c,g)}cb=a};c.scrollTo=function(a){var b=Math.floor(a/u)*t;p.scrollTop(b)};c.isItemVisible=function(c){var b=Math.floor(c/u)*t,a=p.scrollTop()-D;return a<=b&&b+t<=a+p.height()};c.getItemForEvent=function(b){var a=b.closest(Z),c=a.data(d);return B[c]};function jb(){c.render()}function S(){var d=p.scrollTop()-D,c=Math.floor(d/t)*u,g=Math.ceil(d/t)*u,a,b,e;if(c===z||z===-1){a=c;b=a+A}else if(c>z){a=c;b=a+A}else if(c<z){b=c+G;a=b-A}if(b>k.length){var f=b-k.length;b-=f;a-=f}if(a<0)a=0;z=c;if(H)if(H>d)e=-1;else if(H<d)e=1;else e=0;H=d;return {startIndex:a,endIndex:b,firstVisibleIndex:g,scrollTop:d,dir:e}}c.dispose=function(){if(!M){M=true;c.closeLetterPicker();o.dispose();p.unbind(y);if(j.supportsHover){l.undelegate(v,g,W);l.undelegate(v,h,X)}l.undelegate(v,f,V);l.undelegate(v,i,Y);I.unbind(y);w.empty();B=k=null;c.$.unbind()}}}a.ContactList.Controls.LetterHeaderGridLayout=l;function l(u,p,t,i,r){var e=this,f=u,g,b,d,n,o=t,h=new a.ContactList.Controls.LetterPicker(p,i,r);h.$.bind("letterClick",s);h.$.bind("close",q);function k(a){return i.getAlphabetLetter(a.sortName())}e.showLetterPicker=function(){f.setVisibility(false);var b=i.getAlphabet(),e=[];for(var a=0,g=b.length;a<g;a++)if(d[c(b[a])])e.push(b[a]);h.show(e)};e.closeLetterPicker=function(){h.close()};function q(){f.setVisibility(true)}function s(e,a){f.setVisibility(true);f.scrollTo(b.indexOf(d[c(a.letter)]));setTimeout(function(){f.$.triggerHandler("clickLetter",a)},0)}e.init=function(m,r,q){g=m;b=r;d=q;n=m.length;if(g.length>0){var i=-1,h,p=0,j=0;for(var a=0,s=g.length;a<s;a++){var c=k(g[a]);if(i!=c){i=c;h=b[p++]=l(c,j);j+=2}var e=o.createTile(f,g[a]);b[p++]=e;d[e.uniqueId]=e;h.itemsCount++}}};e.onRender=function(){};e.processInsertedItems=function(p,r){var h=[],u="",e,a;if(g.length>0&&p<n-1)if(p===0)e=0;else e=m(p,g[p-1])+1;else e=b.length;for(var q=0,v=r.length;q<v;q++){var i=k(r[q]);if(i!=u){a=d[c(i)];u=i;if(!a){a=l(i,0);h.push(a)}else{var t=b.indexOf(a);if(t>=e){h.push(a);b.splice(t,1)}}}var s=o.createTile(f,r[q]);h.push(s);d[s.uniqueId]=s;a.itemsCount++}j.apply(b,[e,0].concat(h))};e.processRemovedItems=function(h,f){for(var e=0,l=f.length;e<l;e++){var i=m(h,f[e]),g=b.splice(i,1);g[0].remove();delete d[g.uniqueId];var j=k(f[e]),a=d[c(j)];if(--a.itemsCount===0){a.remove();b.splice(b.indexOf(a,h),1);delete d[a.uniqueId]}}};function l(g){var b=new a.ContactList.Controls.LetterGridTile(c(g),g,f,e,i);d[b.uniqueId]=b;return b}function m(e,f){var d=-1;for(var c=e,g=b.length;c<g;c++)if(!(b[c]instanceof a.ContactList.Controls.LetterGridTile)&&b[c].itemEquals(f)){d=c;break}return d}e.resize=function(){h.resize()};e.dispose=function(){h.dispose()}}function c(a){return a}a.ContactList.Controls.ListGridLayout=p;function p(g,e){var a=this,f=g,d,c,b;a.init=function(i,j,h){d=i;c=j;b=h;for(var a=0,k=d.length;a<k;a++){var g=e.createTile(f,d[a]);c[a]=g;b[g.uniqueId]=g}};a.processInsertedItems=function(i,g){var h=[];for(var d=0,k=g.length;d<k;d++){var a=e.createTile(f,g[d]);h.push(a);b[a.uniqueId]=a}j.apply(c,[i,0].concat(h))};a.processRemovedItems=function(f,e){var d=c.splice(f,e.length);for(var a=0,g=d.length;a<g;a++){delete b[d[a].uniqueId];d[a].remove()}};a.resize=function(){};a.dispose=function(){}}})();(function(){var f=window,b=f.wLive;b.Search=b["Search"]||{};b.Search.RankSearchKeyWeight=c;function c(d,b,c){var a=this;a.key=d;a.weight=b;a.order=c}function d(){var d=this,g="<strong>",i="</strong>",b="",c="",e=" !\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~",h=new RegExp("["+e.escapeRegex()+"]","ig");d.accent=new function(){var b=this,a={a:/[\xE0-\xE4]/ig,e:/[\xE8-\xEB]/ig,i:/[\xED-\xEF]/ig,o:/[\xF3-\xF5]/ig,u:/[\xF9-\xFC]/ig,n:/\xF1/ig,y:/\xFF/ig,c:/\xE7/ig};b.fold=function(b){b=b.toLowerCase();for(var c in a)b=b.replace(a[c],c);return b}};d.getSuffixStringsFor=function(d){var b=[],a=null,c=null;if(d){b.push(a=d.lTrim());while((c=a.search(h))!=-1)b.push(a=a.substring(c+1).lTrim())}return b};function f(g,q,p){var d,n=[q].concat(q.split(" ")),f=new Array(g.length+2),r="(^|\\s"+(p?"|@":"")+(!p?"|["+e.escapeRegex()+"]":"")+")";for(d=0;d<f.length;d++)f[d]=0;for(d=0;d<n.length;d++){var s=n[d],m=a.accent.fold(g).replace(new RegExp(r+"("+a.accent.fold(s).escapeRegex()+")","ig"),"$1"+b+"$2"+c),o=0,h=0,j=0;while((o=m.indexOf(b,h))!=-1){h=m.indexOf(c,h+1);j+=2;for(var l=o-j+2;l<h-j+1;l++)f[l+1]=1}}var i=[];for(d=1;d<f.length;d++)if(f[d]!=f[d-1])i.push(d-1);var k=0;for(d=0;d<i.length;d++){k=i[d]+d;g=g.substr(0,k)+(d%2?c:b)+g.substr(k)}return g}d.isHighlighted=function(a){return a&&a.indexOf(g)-1};d.makeBold=function(d,e,j){var h=a.korean.match(d)?a.korean.highlight(d,e):f(d,e,j);return h.encodeHtml().replace(new RegExp(b.encodeHtml(),"g"),g).replace(new RegExp(c.encodeHtml(),"g"),i)};d.korean=new function(){var d=this,h=new RegExp("([\\uAC00-\\uD7AF])","g"),o=44032,i=4352,j=4449,k=4519,q=b,a=c,g={"ㄱ":"ᄀ","ㄲ":"ᄁ","ㄴ":"ᄂ","ㄷ":"ᄃ","ㄸ":"ᄄ","ㄹ":"ᄅ","ㅁ":"ᄆ","ㅂ":"ᄇ","ㅃ":"ᄈ","ㅅ":"ᄉ","ㅆ":"ᄊ","ㅇ":"ᄋ","ㅈ":"ᄌ","ㅉ":"ᄍ","ㅊ":"ᄎ","ㅋ":"ᄏ","ㅌ":"ᄐ","ㅍ":"ᄑ","ㅎ":"ᄒ"},m=l(g),p=new RegExp("([\\u1100-\\u1112][\\u1161-\\u1175][\\u11A8-\\u11C2]{0,1})","g"),n=new RegExp("([\\u1100-\\u1112]"+a+"{0,1}[\\u1161-\\u1175]"+a+"{0,1}[\\u11A8-\\u11C2]{0,1})","g");d.expand=function(a){a=a.replace(m,function(a){return g[a]});return a.replace(h,function(f){var a=f.charCodeAt(0)-o,b=Math.floor(a/588),d=Math.floor((a-b*588)/28),c=a%28;return e(b+i)+e(d+j)+(c?e(c+k):"")})};d.highlight=function(c,g){var b=f(d.expand(c),d.expand(g),0);return b.replace(n,function(b){return b.replace(a,"")+(b.match(a)?a:"")}).replace(p,function(a){var b=a.charCodeAt(0)-i,c=a.charCodeAt(1)-j,d=a.length>2?a.charCodeAt(2)-k:0;return e(b*588+c*28+d+44032)})};d.match=function(a){return a.match(h)};function e(a){return String.fromCharCode(a)}function l(){var a=["(["];for(var b in g)a.push(b);a.push("])");return new RegExp(a.join(""),"g")}}}var a=b.Search.Helpers=new d;b.Search.Indexer=e;function e(s){var b=this,d=null,k=/\s+/g,c=s,r=c.comparer,e=c.matchField;b.autoCompleteTokens=[];b.getMatches=function(u,D){m(u);var s=l(u),k=[],q=null,b=null,a;if(s=="")return {result:[],query:u};q=h(s);for(a=0;a<q.length;a++){b=q[a];k.push({obj:b.obj,weight:e(b.obj).toLowerCase()==s?b.weight+1.5:b.weight,bucket:0})}var r=s.split(" ");if(r.length>1)for(a=0;a<r.length;a++){q=h(r[a]);for(var x=0;x<q.length;x++){b=q[x];k.push({obj:b.obj,weight:b.weight-.1*Math.abs(a+1-b.order),bucket:a+1})}}var i=[];if(k.length){var A=c.compareParents?[o]:[];A.addRange([g,n]);k.sort(f(A));var d=null,t=null,w=null,v=null,C=r.length>1?r.length:0,z=function(a){d=a;t=d.bucket;w=t==0?0:1},B=function(){(!v||c.isValid(v.obj,d.obj))&&w==C&&i.push(v=d)};z(k[0]);for(a=1;a<k.length;a++){b=k[a];if(g(d,b)){B();z(b)}else{d.weight=d.weight+b.weight;if(t!=b.bucket){t=b.bucket;w++}}}B()}i.sort(f([p,j]));i.length=Math.min(i.length,D);var y=new Array(i.length);for(a=0;a<i.length;a++)y[a]=i[a].obj;return {result:y,query:u}};function f(a){return function(d,e){var c=0,b=0;while(c<a.length&&!(b=a[c++](d,e)));return b}}function o(a,b){return c.compareParents(a.obj,b.obj)}function n(a,b){return a.bucket-b.bucket}function g(a,b){return r(a.obj,b.obj)}function j(a,b){return e(a.obj).length-e(b.obj).length}function p(a,b){return b.weight-a.weight}function m(d){var a=0,c;while(a<b.autoCompleteTokens.length){c=i(b.autoCompleteTokens[a]);if(d.indexOf(c)==-1)b.autoCompleteTokens.splice(a,1);else{d=d.replace(c,"");a++}}}function i(a){return a}function l(a){a=q(a);return a.toLowerCase().trim().replace(k," ")}function q(a){for(var c=0;c<b.autoCompleteTokens.length;c++)a=a.replace(i(b.autoCompleteTokens[c]),"");return a}function h(b){return d.matchPrefix(a.accent.fold(a.korean.expand(b)))}b.initialize=function(f){d=new $Trie;for(var b=0;b<f.length;b++){var h=c.getKeysAndWeights(f[b]);for(var g=0;g<h.length;g++){var e=h[g];d.insert(a.accent.fold(a.korean.expand(e.key.toLowerCase().trim())),{obj:f[b],weight:e.weight,order:e.order})}}d.sort()}}$Do.register("wlxsearchshared")})();(function(){var c=window,e=c.wLive,a="@",b="#";e.ContactList.Core.AlphabetHelper=d;function d(){var d=this,e=[],f=[],h,g=c.$Config.ContactListV2;function i(){if(g){var d=g.alphabet;if(d){f.push(b);e[b]=-1;for(var j=0;j<=9;j++)e[j.toString()]=-1;var i=0;for(var c=0,l=d.length;c<l;c++){var k=d[c];f.push(k);e[k]=c;i++}e[a]=i;f.push(a);h=i}}}d.getAlphabetLetter=function(d){var c;if(d===undefined||d.length===0)c=a;else{c=d.substring(0,1).toUpperCase();if(e[c]===undefined)c=a;else if(c>="0"&&c<="9")c=b}return c};d.compareString=function(b,c,a){var f=e[d.getAlphabetLetter(b)],g=e[d.getAlphabetLetter(c)];if(f>g)return a?-1:1;else if(f<g)return a?1:-1;else if(b>c)return a?-1:1;else if(b<c)return a?1:-1;else return 0};d.getAlphabet=function(){return f};d.getDigitsLetter=function(){return b};d.getNonAlphabetLetter=function(){return a};d.getLetterHtml=function(b){if(b!==a)return b.encodeHtml();else return '<span class="GlobeIcon cl_ImgStrip">&nbsp;</span>'};i()}})();(function(){var b=window,g=b.wLive,a=b.jQuery,c="Hidden",e="<div>",d="click";g.ContactList.Controls.LetterPicker=f;function f(k,m,h){var f=this;f.$=a(f);var p=m.getAlphabet(),q=a("body");if(h)var i=a(e).addClass(c).addClass("UI_Dialog_BG").css({position:"absolute",width:a(b).width(),height:a(b).height()}).appendTo(q);var g=a(e).addClass(c).addClass("LetterPickerContainer").css(a.extend({overflow:"auto",position:"absolute"},l())).appendTo(q),j=a(e).addClass("LetterPicker");sutra(g,"$Sutra.Shared.ContactsLetterPicker");g.append(j);j.delegate(".Enabled",d,n);if(h)i.bind(d,o);function r(){if(h)i.addClass(c);g.addClass(c)}function o(){f.close()}function s(f){var c=[];for(var d=0,g=p.length;d<g;d++){var e=p[d];if(d%4===0&&d!==0)c.push('<div style="clear:both"></div>');c.push('<div class="Letter ');if(f.indexOf(e)!==-1)c.push("Enabled t_bci");else c.push("Disabled");c.push('" title="'+e.encodeHtml()+'">');c.push(m.getLetterHtml(e));c.push("</div>")}j.html(c.join(""));if(b.$Sutra)a(".Letter",j).each(function(){sutra(a(this),"$Sutra.Shared.ContactsLetterPickerLetter")})}f.show=function(a){s(a);f.resize();if(h)i.removeClass(c);g.removeClass(c)};f.close=function(){r();f.$.triggerHandler("close",null)};f.resize=function(){if(h)i.css({width:a(b).width(),height:a(b).height()});g.css(l())};function n(c){r();var b=a(c.target).closest(".Letter").attr("title");f.$.triggerHandler("letterClick",{letter:b})}function l(){var a=k.offset();return {top:a.top,left:a.left,width:k.innerWidth(),height:k.innerHeight()}}f.dispose=function(){f.$.unbind();j.undelegate(".Enabled",d,n);if(h){i.unbind(d,o);i.remove()}g.remove()}}})();(function(){var b=window,d=b.wLive,a=b.jQuery;d.ContactList.Controls.LetterGridTile=c;function c(c,e,f,d,b){var a=this;a._letter=e;a._grid=f;a.uniqueId=c;a._layout=d;a._alphabetHelper=b}c.prototype={uniqueId:null,_grid:null,_$container:null,_layout:null,_top:-1,_left:-1,_letter:"",itemsCount:0,render:function(f,d,c){var a=this;if(a._$container){if(d!==a._top||c!==a._left){a._$container.css({top:d+"px",left:c+"px"});a._top=d;a._left=c}a._renderUpdates()}else{a._onBeforeRender();a._$container=a._grid.createTile(a.uniqueId,d,c,a._getHtml(),a._getCssClasses(),a._getStyles());a._top=d;a._left=c;if(b.$Sutra)a._setupSutraTags()}},_onBeforeRender:a.noop,_renderUpdates:a.noop,_getHtml:function(){var a=this;return '<div class="Letter t_bci">'+a._alphabetHelper.getLetterHtml(a._letter)+"</div>"},_setupSutraTags:function(){var b=this;sutra(a(".Letter",b._$container),"$Sutra.Shared.ContactsListLetterTile")},_getCssClasses:a.noop,_getStyles:a.noop,click:function(){var a=this;a._layout.showLetterPicker()},remove:function(){var a=this;if(a._$container){a._$container.empty();a._$container=null}a.dispose()},dispose:a.noop}})();(function(){var c=window,b=c.wLive,a={};b.cpThrottle=function(b,c,d){if(a[b])clearTimeout(a[b]);a[b]=setTimeout(function(){d();delete a[b]},c)}})()